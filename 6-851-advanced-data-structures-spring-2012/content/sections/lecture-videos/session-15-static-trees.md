---
about_this_resource_text: '<p><strong>Description:</strong> Static trees: Least common
  ancestor, range minimum queries, level ancestor.</p> <p><strong>Speaker:</strong>
  Prof. Erik Demaine</p>'
course_id: 6-851-advanced-data-structures-spring-2012
embedded_media:
- id: Video-YouTube-Stream
  media_location: 0rCFkuQS968
  parent_uid: e09d39d87a1afddd42efb910e76b2d85
  title: Video-YouTube-Stream
  type: Video
  uid: a2da4e9933a2c2ed0c31e43104f2b896
- id: Video-iTunesU-MP4
  media_location: https://itunes.apple.com/us/itunes-u/session-15-static-trees/id735348884?i=169611717
  parent_uid: e09d39d87a1afddd42efb910e76b2d85
  title: Video-iTunes U-MP4
  type: Video
  uid: 2a34a72d09b0ec3b370195d9f8ef29f9
- id: Video-InternetArchive-MP4
  media_location: http://www.archive.org/download/MIT6.851S12/MIT6_851S12_lec15_300k.mp4
  parent_uid: e09d39d87a1afddd42efb910e76b2d85
  title: Video-Internet Archive-MP4
  type: Video
  uid: ef04333ea9facb2eb4baee2d4fc5328f
- id: Thumbnail-YouTube-JPG
  media_location: https://img.youtube.com/vi/0rCFkuQS968/default.jpg
  parent_uid: e09d39d87a1afddd42efb910e76b2d85
  title: Thumbnail-YouTube-JPG
  type: Thumbnail
  uid: 9c1f057012cf20568a0e17382272884b
- id: 3Play-3PlayYouTubeid-MP4
  media_location: 0rCFkuQS968
  parent_uid: e09d39d87a1afddd42efb910e76b2d85
  title: 3Play-3Play YouTube id
  type: 3Play
  uid: c130f8e14a7878ab9672a24a1bb36754
- id: 0rCFkuQS968.srt
  parent_uid: e09d39d87a1afddd42efb910e76b2d85
  technical_location: https://ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-851-advanced-data-structures-spring-2012/lecture-videos/session-15-static-trees/0rCFkuQS968.srt
  title: 3play caption file
  type: null
  uid: 1eb726b239da9b2a81e7af658c47c411
- id: 0rCFkuQS968.pdf
  parent_uid: e09d39d87a1afddd42efb910e76b2d85
  technical_location: https://ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-851-advanced-data-structures-spring-2012/lecture-videos/session-15-static-trees/0rCFkuQS968.pdf
  title: 3play pdf file
  type: null
  uid: 72fb807ac52479cfe36638d046ca12d3
- id: Caption-3Play YouTube id-SRT
  parent_uid: e09d39d87a1afddd42efb910e76b2d85
  title: Caption-3Play YouTube id-SRT-English - US
  type: Caption
  uid: 3d102b88626351be95f1699285787fd0
- id: Transcript-3Play YouTube id-PDF
  parent_uid: e09d39d87a1afddd42efb910e76b2d85
  title: Transcript-3Play YouTube id-PDF-English - US
  type: Transcript
  uid: 2dc9c6fc02821e4484cbc91443236547
inline_embed_id: 27659314session15:statictrees14056905
layout: video
order_index: null
parent_uid: b66cbbb7b35e74ff17cdbf44e5fb6b1d
related_resources_text: ''
short_url: session-15-static-trees
technical_location: https://ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-851-advanced-data-structures-spring-2012/lecture-videos/session-15-static-trees
template_type: Tabbed
title: 'Session 15: Static Trees'
transcript: <p><span m='90'>The</span> <span m='180'>following</span> <span m='630'>content</span>
  <span m='1200'>is</span> <span m='1320'>provided</span> <span m='1770'>under</span>
  <span m='2009'>a</span> <span m='2070'>Creative</span> <span m='2490'>Commons</span>
  <span m='2910'>license.</span> <span m='4030'>Your</span> <span m='4200'>support</span>
  <span m='4710'>will</span> <span m='4860'>help</span> <span m='5100'>MIT</span>
  <span m='5550'>OpenCourseWare</span> <span m='6360'>continue</span> <span m='6870'>to</span>
  <span m='6960'>offer</span> <span m='7380'>high</span> <span m='7620'>quality</span>
  <span m='8100'>educational</span> <span m='8730'>resources</span> <span m='9360'>for</span>
  <span m='9510'>free.</span> <span m='10720'>To</span> <span m='10740'>make</span>
  <span m='10920'>a</span> <span m='10980'>donation</span> <span m='11730'>or</span>
  <span m='11940'>view</span> <span m='12390'>additional</span> <span m='12810'>materials</span>
  <span m='13320'>from</span> <span m='13500'>hundreds</span> <span m='13920'>of</span>
  <span m='14040'>MIT</span> <span m='14460'>courses,</span> <span m='15550'>visit</span>
  <span m='15780'>MIT</span> <span m='16200'>OpenCourseWare</span> <span m='17280'>at</span>
  <span m='17430'>ocw.mit.edu.</span> </p><p><span m='21910'>PROFESSOR:</span> <span
  m='21940'>All</span> <span m='21970'>right.</span> <span m='22090'>Today,</span>
  <span m='22480'>we're</span> <span m='22720'>going</span> <span m='23050'>to</span>
  <span m='23500'>look</span> <span m='23650'>at</span> <span m='23710'>some</span>
  <span m='24070'>kind</span> <span m='24280'>of</span> <span m='24340'>different</span>
  <span m='24670'>data</span> <span m='24880'>structures</span> <span m='25540'>for</span>
  <span m='26140'>static</span> <span m='27070'>trees.</span> <span m='28000'>So</span>
  <span m='28210'>we</span> <span m='28330'>have--</span> <span m='29200'>at</span>
  <span m='29290'>least</span> <span m='29470'>in</span> <span m='29560'>the</span>
  <span m='29620'>second</span> <span m='29890'>two</span> <span m='30010'>problems--</span>
  <span m='30340'>we</span> <span m='30400'>have</span> <span m='30490'>a</span> <span
  m='30520'>static</span> <span m='30880'>tree.</span> <span m='31210'>We</span> <span
  m='31270'>want</span> <span m='31390'>to</span> <span m='31450'>preprocess</span>
  <span m='32080'>it</span> <span m='32740'>to</span> <span m='32980'>answer</span>
  <span m='33310'>lots</span> <span m='33520'>of</span> <span m='33730'>queries.</span>
  <span m='34780'>And</span> <span m='35140'>all</span> <span m='35410'>the</span>
  <span m='35530'>queries</span> <span m='35920'>we're</span> <span m='36010'>going</span>
  <span m='36080'>to</span> <span m='36280'>support</span> <span m='36670'>today</span>
  <span m='37380'>we'll</span> <span m='37660'>do</span> <span m='37800'>in</span>
  <span m='37930'>constant</span> <span m='38380'>time</span> <span m='38635'>per</span>
  <span m='38890'>operation,</span> <span m='39400'>which</span> <span m='39550'>is</span>
  <span m='39670'>pretty</span> <span m='40360'>awesome,</span> <span m='40910'>and</span>
  <span m='40930'>linear</span> <span m='41260'>space.</span> <span m='42130'>That's</span>
  <span m='42280'>our</span> <span m='42400'>goal.</span> <span m='42880'>It's</span>
  <span m='43000'>going</span> <span m='43110'>to</span> <span m='43210'>be</span>
  <span m='43330'>hard</span> <span m='43510'>to</span> <span m='43600'>achieve</span>
  <span m='43900'>these</span> <span m='44050'>goals.</span> <span m='44450'>But</span>
  <span m='44500'>in</span> <span m='44590'>the</span> <span m='44710'>end,</span>
  <span m='44890'>we</span> <span m='45070'>will</span> <span m='45190'>do</span>
  <span m='45400'>it</span> <span m='46000'>for</span> <span m='46180'>all</span>
  <span m='46330'>three</span> <span m='46510'>of</span> <span m='46570'>these</span>
  <span m='46720'>problems.</span> </p><p><span m='47200'>So</span> <span m='47260'>let</span>
  <span m='47380'>me</span> <span m='47470'>tell</span> <span m='47680'>you</span>
  <span m='47770'>about</span> <span m='47980'>these</span> <span m='48160'>problems.</span>
  <span m='49480'>Range</span> <span m='50200'>minimum</span> <span m='50530'>queries,</span>
  <span m='53680'>you're</span> <span m='54490'>given</span> <span m='55090'>an</span>
  <span m='55240'>array</span> <span m='55780'>of</span> <span m='56770'>numbers.</span>
  <span m='67190'>And</span> <span m='67520'>the</span> <span m='67640'>kind</span>
  <span m='67850'>of</span> <span m='67970'>query</span> <span m='68300'>you</span>
  <span m='68390'>want</span> <span m='68540'>to</span> <span m='68600'>support--</span>
  <span m='71590'>we'll</span> <span m='72090'>call</span> <span m='72430'>RMQ</span>
  <span m='73757'>of</span> <span m='74214'>ij--</span> <span m='77420'>is</span>
  <span m='77780'>to</span> <span m='78050'>find</span> <span m='78380'>the</span>
  <span m='78470'>minimum</span> <span m='79370'>in</span> <span m='79520'>a</span>
  <span m='79550'>range.</span> <span m='81630'>So</span> <span m='81870'>we</span>
  <span m='82010'>have</span> <span m='82890'>Ai</span> <span m='84390'>up</span>
  <span m='84530'>to</span> <span m='84660'>Aj</span> <span m='92720'>and</span> <span
  m='92900'>we</span> <span m='93020'>want</span> <span m='93170'>to</span> <span
  m='93230'>compute</span> <span m='93560'>the</span> <span m='93650'>minimum</span>
  <span m='94280'>in</span> <span m='94430'>that</span> <span m='95030'>range.</span>
  <span m='95430'>So</span> <span m='95540'>i</span> <span m='95720'>and</span> <span
  m='95840'>j</span> <span m='96950'>form</span> <span m='97190'>the</span> <span
  m='97280'>query.</span> <span m='98840'>I</span> <span m='98880'>think</span> <span
  m='99050'>it's</span> <span m='99140'>pretty</span> <span m='99350'>clear</span>
  <span m='99560'>what</span> <span m='99710'>this</span> <span m='99860'>means.</span>
  </p><p><span m='100670'>I</span> <span m='100750'>give</span> <span m='100970'>you</span>
  <span m='101060'>an</span> <span m='101150'>interval</span> <span m='102080'>that</span>
  <span m='102200'>I</span> <span m='102260'>care</span> <span m='102500'>about,</span>
  <span m='103285'>ij,</span> <span m='104820'>and</span> <span m='105170'>I</span>
  <span m='105260'>want</span> <span m='105410'>to</span> <span m='105470'>know,</span>
  <span m='105710'>in</span> <span m='105920'>this</span> <span m='106220'>range,</span>
  <span m='106730'>what's</span> <span m='106940'>the</span> <span m='107030'>smallest</span>
  <span m='107390'>value.</span> <span m='108230'>And</span> <span m='108590'>a</span>
  <span m='108620'>little</span> <span m='108860'>more</span> <span m='109010'>subtle--</span>
  <span m='109340'>this</span> <span m='109520'>will</span> <span m='109730'>come</span>
  <span m='109970'>up</span> <span m='110090'>later.</span> <span m='110750'>I</span>
  <span m='111050'>don't</span> <span m='111260'>just</span> <span m='111440'>want</span>
  <span m='111590'>to</span> <span m='111650'>know</span> <span m='111800'>the</span>
  <span m='111920'>value</span> <span m='112700'>that's</span> <span m='112910'>there--</span>
  <span m='113180'>like</span> <span m='113380'>say</span> <span m='113570'>this</span>
  <span m='113780'>is</span> <span m='113870'>the</span> <span m='113990'>minimum</span>
  <span m='114380'>among</span> <span m='114710'>that</span> <span m='115130'>shaded</span>
  <span m='115520'>region.</span> <span m='116310'>But</span> <span m='116360'>I</span>
  <span m='116390'>also</span> <span m='116630'>want</span> <span m='116780'>to</span>
  <span m='116870'>know</span> <span m='117200'>the</span> <span m='117560'>index</span>
  <span m='119250'>K</span> <span m='120170'>between</span> <span m='120620'>i</span>
  <span m='120820'>and</span> <span m='120930'>j</span> <span m='122720'>of</span>
  <span m='122900'>that</span> <span m='123440'>element.</span> <span m='123930'>Of</span>
  <span m='124030'>course, if</span> <span m='124190'>I</span> <span m='124250'>know</span>
  <span m='124400'>the</span> <span m='124550'>index,</span> <span m='124910'>I</span>
  <span m='124970'>can</span> <span m='125090'>also</span> <span m='125300'>look</span>
  <span m='125510'>up</span> <span m='125630'>the</span> <span m='125720'>value.</span>
  <span m='126230'>So</span> <span m='126440'>it's</span> <span m='126560'>more</span>
  <span m='126770'>interesting</span> <span m='127220'>to</span> <span m='127310'>know</span>
  <span m='128210'>that</span> <span m='128419'>index.</span> </p><p><span m='130440'>OK.</span>
  <span m='130699'>This</span> <span m='130880'>is</span> <span m='131000'>a</span>
  <span m='131090'>non-tree</span> <span m='131650'>problem,</span> <span m='132380'>but</span>
  <span m='132560'>it</span> <span m='132650'>will</span> <span m='132770'>be</span>
  <span m='132920'>closely</span> <span m='133430'>related</span> <span m='133880'>to</span>
  <span m='134150'>tree</span> <span m='134360'>problem,</span> <span m='136670'>namely</span>
  <span m='137150'>LCA.</span> <span m='142240'>So</span> <span m='143170'>LCA</span>
  <span m='143510'>problem</span> <span m='144350'>is</span> <span m='144620'>you</span>
  <span m='144740'>want</span> <span m='144860'>to</span> <span m='144920'>preprocess</span>
  <span m='146750'>a</span> <span m='146930'>tree.</span> <span m='148000'>It's</span>
  <span m='148550'>a</span> <span m='148730'>rooted</span> <span m='149150'>tree,</span>
  <span m='154970'>and</span> <span m='155180'>the</span> <span m='155240'>query</span>
  <span m='155730'>is</span> <span m='158870'>LCA</span> <span m='161420'>of</span>
  <span m='161690'>two</span> <span m='161900'>nodes.</span> <span m='162950'>Which</span>
  <span m='163430'>I</span> <span m='163490'>think</span> <span m='163730'>you know,</span>
  <span m='164100'>or</span> <span m='164470'>I guess</span> <span m='164840'>I call</span>
  <span m='165050'>them</span> <span m='165260'>x</span> <span m='165500'>and</span>
  <span m='165590'>y.</span> <span m='167210'>So it</span> <span m='167630'>has</span>
  <span m='167870'>two</span> <span m='168050'>nodes</span> <span m='168410'>x</span>
  <span m='168560'>and</span> <span m='168650'>y</span> <span m='168830'>in</span>
  <span m='168920'>the</span> <span m='169040'>tree.</span> <span m='170540'>I</span>
  <span m='170660'>want</span> <span m='170810'>to</span> <span m='170900'>find</span>
  <span m='171450'>their</span> <span m='171650'>lowest</span> <span m='172010'>common</span>
  <span m='172310'>ancestor,</span> <span m='173460'>which</span> <span m='173570'>looks</span>
  <span m='173690'>something</span> <span m='174020'>like</span> <span m='174170'>that.</span>
  <span m='177110'>At some</span> <span m='177540'>point</span> <span m='177730'>they</span>
  <span m='177860'>have</span> <span m='177960'>shared</span> <span m='178190'>ancestors,</span>
  <span m='179210'>and</span> <span m='179410'>we</span> <span m='179540'>want</span>
  <span m='179690'>to</span> <span m='179750'>find</span> <span m='179930'>that</span>
  <span m='180080'>lowest</span> <span m='180410'>one.</span> </p><p><span m='182210'>And</span>
  <span m='182390'>then</span> <span m='182600'>another</span> <span m='182870'>problem</span>
  <span m='183110'>we're</span> <span m='183170'>going</span> <span m='183290'>to</span>
  <span m='183350'>solve</span> <span m='183800'>is</span> <span m='184070'>level</span>
  <span m='184400'>ancestor,</span> <span m='185460'>which</span> <span m='185480'>again,</span>
  <span m='186120'>preprocess</span> <span m='186750'>a</span> <span m='186830'>rooted</span>
  <span m='187080'>tree</span> <span m='191450'>and</span> <span m='191780'>the</span>
  <span m='191870'>query</span> <span m='192260'>is</span> <span m='193790'>a</span>
  <span m='193820'>little</span> <span m='194060'>different.</span> <span m='198050'>Given</span>
  <span m='198320'>a</span> <span m='198380'>node</span> <span m='199220'>and</span>
  <span m='199460'>an</span> <span m='199550'>integer</span> <span m='200000'>k--</span>
  <span m='202130'>positive</span> <span m='202550'>integer--</span> <span m='204320'>I</span>
  <span m='204440'>want</span> <span m='204590'>to</span> <span m='204680'>find</span>
  <span m='205220'>the</span> <span m='206630'>kth</span> <span m='207110'>ancestor</span>
  <span m='207890'>of</span> <span m='208070'>that</span> <span m='208250'>node.</span>
  <span m='210740'>Which you</span> <span m='210890'>might</span> <span m='211100'>write</span>
  <span m='211370'>parent</span> <span m='211730'>to</span> <span m='211880'>the</span>
  <span m='212000'>k,</span> <span m='212360'>meaning</span> <span m='213275'>I</span>
  <span m='213680'>have</span> <span m='213950'>a</span> <span m='214030'>node</span>
  <span m='214300'>x,</span> <span m='217040'>the</span> <span m='217310'>first</span>
  <span m='217610'>ancestor</span> <span m='217910'>is</span> <span m='218210'>its</span>
  <span m='218340'>parent.</span> <span m='221780'>Eventually</span> <span m='222290'>want</span>
  <span m='222480'>to</span> <span m='222590'>get</span> <span m='222920'>to</span>
  <span m='224240'>the</span> <span m='224480'>kth</span> <span m='224930'>ancestor.</span>
  </p><p><span m='225720'>So</span> <span m='225850'>I want to</span> <span m='225950'>jump</span>
  <span m='226160'>from</span> <span m='226460'>x</span> <span m='227380'>to</span>
  <span m='227540'>there.</span> <span m='229520'>So</span> <span m='229720'>it's</span>
  <span m='229850'>like</span> <span m='230060'>teleporting</span> <span m='230690'>to</span>
  <span m='230960'>a</span> <span m='231110'>target</span> <span m='231950'>height</span>
  <span m='232340'>above</span> <span m='232670'>me.</span> <span m='233840'>Obviously,</span>
  <span m='234260'>k</span> <span m='234590'>cannot</span> <span m='234920'>be</span>
  <span m='235070'>larger</span> <span m='235400'>than</span> <span m='235580'>the</span>
  <span m='235670'>depth</span> <span m='235970'>of</span> <span m='236090'>the</span>
  <span m='236180'>node.</span> <span m='238550'>So</span> <span m='238760'>these</span>
  <span m='238940'>are</span> <span m='239000'>the</span> <span m='239090'>three</span>
  <span m='239300'>problems</span> <span m='239630'>we're</span> <span m='239690'>going</span>
  <span m='239810'>to</span> <span m='239870'>solve</span> <span m='240140'>today,</span>
  <span m='240905'>RMQ,</span> <span m='242330'>LCA,</span> <span m='243320'>and</span>
  <span m='243460'>LA.</span> <span m='246380'>Using</span> <span m='247220'>somewhat</span>
  <span m='247940'>similar</span> <span m='248270'>techniques,</span> <span m='248750'>we're</span>
  <span m='248830'>going</span> <span m='248930'>to</span> <span m='249020'>use</span>
  <span m='249230'>a</span> <span m='249440'>nice</span> <span m='249680'>technique</span>
  <span m='250010'>called</span> <span m='250250'>table</span> <span m='250580'>look-up,</span>
  <span m='251330'>which</span> <span m='251480'>is</span> <span m='251990'>generally</span>
  <span m='252350'>useful</span> <span m='252620'>for</span> <span m='252770'>a</span>
  <span m='252800'>lot</span> <span m='252980'>of</span> <span m='253070'>data</span>
  <span m='253220'>structures.</span> <span m='253640'>We</span> <span m='253790'>are</span>
  <span m='253880'>working</span> <span m='254240'>in</span> <span m='254330'>the</span>
  <span m='254420'>Word</span> <span m='254690'>RAM</span> <span m='255860'>throughout.</span>
  <span m='258060'>But</span> <span m='258370'>that's</span> <span m='258589'>not</span>
  <span m='258829'>as</span> <span m='258980'>essential</span> <span m='259490'>as</span>
  <span m='259579'>it</span> <span m='259670'>has</span> <span m='259880'>been</span>
  <span m='260060'>in</span> <span m='260180'>our</span> <span m='260269'>past</span>
  <span m='260630'>integer</span> <span m='260959'>data</span> <span m='261170'>structures.</span>
  </p><p><span m='264620'>Now</span> <span m='264830'>the</span> <span m='264950'>fun</span>
  <span m='265220'>thing</span> <span m='265520'>about</span> <span m='265790'>these</span>
  <span m='265970'>problems</span> <span m='266540'>is</span> <span m='266690'>while</span>
  <span m='266930'>LCA</span> <span m='267410'>and</span> <span m='267540'>LA</span>
  <span m='267830'>look</span> <span m='268400'>quite</span> <span m='268700'>similar--</span>
  <span m='270110'>I</span> <span m='270170'>mean,</span> <span m='270350'>they</span>
  <span m='270440'>even</span> <span m='270770'>share</span> <span m='271010'>two</span>
  <span m='271220'>letters</span> <span m='272050'>out</span> <span m='272200'>of</span>
  <span m='272330'>three--</span> <span m='273830'>they're</span> <span m='274370'>quite</span>
  <span m='274700'>different.</span> <span m='275060'>As</span> <span m='275180'>far</span>
  <span m='275330'>as</span> <span m='275450'>I</span> <span m='275540'>know,</span>
  <span m='275690'>you</span> <span m='275830'>need</span> <span m='276050'>fairly</span>
  <span m='276410'>different</span> <span m='276710'>techniques</span> <span m='277130'>to</span>
  <span m='277250'>deal</span> <span m='277520'>with--</span> <span m='277940'>or</span>
  <span m='278180'>as</span> <span m='278270'>far</span> <span m='278420'>as</span>
  <span m='278510'>anyone</span> <span m='278870'>knows--</span> <span m='279550'>you
  need</span> <span m='279700'>pretty</span> <span m='279950'>different</span> <span
  m='280220'>techniques</span> <span m='280610'>to</span> <span m='280700'>deal</span>
  <span m='280880'>with</span> <span m='281030'>both</span> <span m='281240'>of</span>
  <span m='281300'>them.</span> <span m='282410'>The</span> <span m='282680'>original</span>
  <span m='283070'>paper</span> <span m='283370'>that</span> <span m='283440'>solved</span>
  <span m='283820'>level</span> <span m='284060'>ancestors</span> <span m='284600'>kind</span>
  <span m='284780'>of</span> <span m='285020'>lamented</span> <span m='285560'>on</span>
  <span m='285680'>this.</span> </p><p><span m='287360'>RMQ,</span> <span m='287960'>on</span>
  <span m='288050'>the</span> <span m='288170'>other</span> <span m='288350'>hand,</span>
  <span m='288740'>turns</span> <span m='289010'>out</span> <span m='289160'>to</span>
  <span m='289280'>be</span> <span m='289400'>basically</span> <span m='290000'>identical</span>
  <span m='290630'>to</span> <span m='290780'>LCA.</span> <span m='292190'>So</span>
  <span m='292400'>that's</span> <span m='293090'>the</span> <span m='293180'>more</span>
  <span m='293360'>surprising</span> <span m='293870'>thing,</span> <span m='294750'>and</span>
  <span m='294920'>I</span> <span m='295010'>want</span> <span m='295160'>to</span>
  <span m='295220'>start</span> <span m='295550'>with</span> <span m='296420'>that.</span>
  <span m='297560'>Again,</span> <span m='297830'>our</span> <span m='297890'>goal</span>
  <span m='298130'>is</span> <span m='298250'>to</span> <span m='298370'>get</span>
  <span m='298520'>constant</span> <span m='298900'>time,</span> <span m='299150'>linear</span>
  <span m='299390'>space</span> <span m='299690'>for</span> <span m='299810'>all</span>
  <span m='299940'>these</span> <span m='300110'>problems.</span> <span m='302390'>Constant</span>
  <span m='302750'>time</span> <span m='302960'>is</span> <span m='303080'>easy</span>
  <span m='303290'>to</span> <span m='303380'>get</span> <span m='303650'>with</span>
  <span m='304340'>polynomial</span> <span m='305030'>space.</span> <span m='305450'>You</span>
  <span m='305540'>could</span> <span m='305660'>just</span> <span m='305810'>store</span>
  <span m='306110'>all</span> <span m='306290'>the</span> <span m='306440'>answers.</span>
  <span m='306960'>There's</span> <span m='307130'>only</span> <span m='307400'>n</span>
  <span m='307580'>squared</span> <span m='308840'>different</span> <span m='309110'>queries</span>
  <span m='309620'>for</span> <span m='309770'>all</span> <span m='309950'>these</span>
  <span m='310130'>problems,</span> <span m='311210'>so</span> <span m='311330'>quadratic</span>
  <span m='311750'>space</span> <span m='312030'>is</span> <span m='312110'>easy.</span>
  <span m='313090'>Linear</span> <span m='313320'>space</span> <span m='313550'>is</span>
  <span m='313770'>the</span> <span m='313850'>hard</span> <span m='314030'>part.</span>
  </p><p><span m='315540'>So</span> <span m='315590'>let</span> <span m='315740'>me</span>
  <span m='315830'>tell</span> <span m='316070'>you</span> <span m='316220'>about</span>
  <span m='316700'>a</span> <span m='316760'>nice</span> <span m='317120'>reduction</span>
  <span m='319130'>from</span> <span m='319460'>an</span> <span m='319550'>array</span>
  <span m='319940'>to</span> <span m='320240'>a</span> <span m='320540'>tree.</span>
  <span m='330830'>Very</span> <span m='331010'>simple</span> <span m='331340'>idea.</span>
  <span m='332430'>It's</span> <span m='332480'>called</span> <span m='332630'>the</span>
  <span m='332720'>Cartesian</span> <span m='333230'>tree.</span> <span m='333450'>It</span>
  <span m='333530'>goes</span> <span m='333710'>back</span> <span m='333950'>to</span>
  <span m='334250'>Gabow</span> <span m='335060'>Bentley</span> <span m='335360'>and</span>
  <span m='335450'>Tarjan</span> <span m='335720'>in</span> <span m='335840'>1984.</span>
  <span m='337110'>It's</span> <span m='337130'>an</span> <span m='337220'>old</span>
  <span m='337550'>idea,</span> <span m='338420'>but</span> <span m='338510'>it</span>
  <span m='338600'>comes</span> <span m='338870'>up</span> <span m='338990'>now</span>
  <span m='339230'>and</span> <span m='339320'>then,</span> <span m='340370'>and</span>
  <span m='340490'>in</span> <span m='340550'>particular,</span> <span m='340970'>provides</span>
  <span m='341370'>the</span> <span m='341410'>equivalence</span> <span m='341810'>between</span>
  <span m='342060'>RMQ</span> <span m='342530'>and</span> <span m='342630'>LCA,</span>
  <span m='343520'>or</span> <span m='343610'>one</span> <span m='343820'>direction</span>
  <span m='344240'>of</span> <span m='344360'>it.</span> <span m='345980'>I</span>
  <span m='346070'>just</span> <span m='346280'>take</span> <span m='347750'>a</span>
  <span m='347810'>minimum</span> <span m='348290'>element--</span> <span m='351170'>let's</span>
  <span m='351320'>call</span> <span m='351560'>it</span> <span m='351690'>Ai--</span>
  <span m='353010'>of</span> <span m='353210'>the</span> <span m='353330'>array.</span>
  <span m='355370'>Let</span> <span m='355610'>that</span> <span m='355760'>be</span>
  <span m='356270'>the</span> <span m='356390'>root</span> <span m='356660'>of</span>
  <span m='356810'>my</span> <span m='356960'>tree.</span> <span m='358560'>And</span>
  <span m='358640'>then</span> <span m='359780'>the</span> <span m='359870'>left</span>
  <span m='360080'>sub-tree</span> <span m='361760'>of</span> <span m='361970'>T</span>
  <span m='363350'>is</span> <span m='363410'>just</span> <span m='363560'>going</span>
  <span m='363680'>to</span> <span m='363770'>be</span> <span m='364910'>a</span>
  <span m='365000'>Cartesian</span> <span m='365540'>tree</span> <span m='369620'>on</span>
  <span m='370220'>all</span> <span m='370640'>the</span> <span m='370940'>elements</span>
  <span m='371390'>to</span> <span m='371540'>the</span> <span m='371690'>left</span>
  <span m='372050'>of</span> <span m='372230'>i.</span> <span m='372610'>So</span>
  <span m='373010'>A</span> <span m='373880'>less</span> <span m='374210'>than</span>
  <span m='374390'>i,</span> <span m='375740'>and</span> <span m='375860'>then</span>
  <span m='375980'>the</span> <span m='376070'>right</span> <span m='376310'>sub-tree</span>
  <span m='379220'>is</span> <span m='379400'>going</span> <span m='379550'>to</span>
  <span m='379640'>be</span> <span m='380690'>A</span> <span m='381890'>greater</span>
  <span m='382190'>than</span> <span m='382340'>i.</span> </p><p><span m='383960'>So</span>
  <span m='384170'>let's</span> <span m='384410'>do</span> <span m='384680'>little</span>
  <span m='384890'>example.</span> <span m='392560'>Suppose</span> <span m='392850'>we</span>
  <span m='392940'>have</span> <span m='395820'>8,</span> <span m='396090'>7,</span>
  <span m='396590'>2,</span> <span m='397590'>8,</span> <span m='398090'>6,</span>
  <span m='400090'>9,</span> <span m='401090'>4,</span> <span m='401533'>5.</span>
  <span m='405210'>So</span> <span m='406290'>the</span> <span m='406350'>minimum</span>
  <span m='406680'>in</span> <span m='406740'>this</span> <span m='406890'>rate</span>
  <span m='407220'>is</span> <span m='407450'>2.</span> <span m='408150'>So</span>
  <span m='408330'>it</span> <span m='408480'>gets</span> <span m='408720'>promoted</span>
  <span m='409140'>to</span> <span m='409260'>the</span> <span m='409380'>root,</span>
  <span m='410140'>which</span> <span m='410190'>decomposes</span> <span m='411090'>the</span>
  <span m='411210'>problem</span> <span m='411690'>into</span> <span m='412290'>two</span>
  <span m='412390'>halves,</span> <span m='413840'>the</span> <span m='414230'>left</span>
  <span m='414510'>half</span> <span m='415350'>and</span> <span m='415500'>the</span>
  <span m='415590'>right</span> <span m='415770'>half.</span> <span m='416280'>So</span>
  <span m='416820'>drawing</span> <span m='417150'>the</span> <span m='417240'>tree,</span>
  <span m='418110'>I</span> <span m='418230'>put</span> <span m='418410'>2--</span>
  <span m='420060'>maybe</span> <span m='420240'>over</span> <span m='420390'>here</span>
  <span m='420630'>is</span> <span m='421050'>actually</span> <span m='421350'>nicer--</span>
  <span m='422130'>2</span> <span m='422490'>at</span> <span m='422580'>the</span>
  <span m='422670'>root.</span> <span m='423870'>On</span> <span m='424020'>the</span>
  <span m='424080'>left</span> <span m='424290'>side,</span> <span m='424890'>7</span>
  <span m='425250'>is</span> <span m='425340'>the</span> <span m='425400'>smallest.</span>
  <span m='426440'>And</span> <span m='426540'>so</span> <span m='426600'>it's</span>
  <span m='426720'>going</span> <span m='426890'>to</span> <span m='426960'>get</span>
  <span m='427080'>promoted</span> <span m='427470'>to</span> <span m='427650'>be</span>
  <span m='427740'>the</span> <span m='427860'>root,</span> <span m='428550'>and</span>
  <span m='428640'>so</span> <span m='428850'>the</span> <span m='428910'>left</span>
  <span m='429090'>side</span> <span m='429420'>will</span> <span m='429570'>look</span>
  <span m='429750'>like</span> <span m='429960'>this.</span> </p><p><span m='432060'>On</span>
  <span m='432240'>the</span> <span m='432330'>right</span> <span m='432510'>side,</span>
  <span m='433380'>the</span> <span m='433470'>minimum</span> <span m='433860'>is</span>
  <span m='434340'>4,</span> <span m='435840'>so</span> <span m='439480'>4</span>
  <span m='439860'>is</span> <span m='440100'>the</span> <span m='441270'>right</span>
  <span m='441600'>root,</span> <span m='442470'>which</span> <span m='442650'>decomposes</span>
  <span m='443370'>into</span> <span m='443880'>the</span> <span m='443920'>left</span>
  <span m='444210'>half</span> <span m='444460'>there,</span> <span m='445200'>the</span>
  <span m='445290'>right</span> <span m='445470'>half</span> <span m='445710'>there.</span>
  <span m='445920'>So</span> <span m='446070'>the</span> <span m='446190'>right</span>
  <span m='446370'>thing</span> <span m='446610'>is</span> <span m='446760'>just</span>
  <span m='447060'>5.</span> <span m='449400'>Here</span> <span m='449820'>the</span>
  <span m='449940'>minimum</span> <span m='450390'>is</span> <span m='450600'>6,</span>
  <span m='451440'>and</span> <span m='451710'>so</span> <span m='451920'>we</span>
  <span m='452040'>get</span> <span m='452220'>a</span> <span m='452280'>nice</span>
  <span m='452640'>binary</span> <span m='453060'>tree</span> <span m='454050'>on</span>
  <span m='454170'>the</span> <span m='454260'>left</span> <span m='454560'>here.</span>
  <span m='457970'>OK.</span> <span m='458250'>This</span> <span m='458430'>is</span>
  <span m='458520'>not</span> <span m='458760'>a</span> <span m='458820'>binary</span>
  <span m='459210'>search</span> <span m='459540'>tree.</span> <span m='460650'>It's</span>
  <span m='460890'>a</span> <span m='460980'>min</span> <span m='461250'>heap.</span>
  <span m='469330'>Cartesian</span> <span m='469840'>tree</span> <span m='470290'>is</span>
  <span m='470530'>a</span> <span m='470660'>min</span> <span m='470920'>heap.</span>
  </p><p><span m='473450'>But</span> <span m='473660'>Cartesian</span> <span m='474220'>trees</span>
  <span m='474460'>have</span> <span m='474730'>a</span> <span m='474790'>more</span>
  <span m='474970'>interesting</span> <span m='475390'>property,</span> <span m='476420'>which</span>
  <span m='476530'>I've</span> <span m='476710'>kind</span> <span m='476890'>of</span>
  <span m='477010'>alluded</span> <span m='477280'>to</span> <span m='477580'>a</span>
  <span m='477610'>couple</span> <span m='477850'>of</span> <span m='477910'>times</span>
  <span m='478210'>already,</span> <span m='479750'>which</span> <span m='479860'>is</span>
  <span m='479980'>that</span> <span m='480160'>LCAs</span> <span m='480850'>in</span>
  <span m='480940'>this</span> <span m='481150'>tree</span> <span m='481630'>correspond</span>
  <span m='482140'>to</span> <span m='482230'>RMQs</span> <span m='482890'>in</span>
  <span m='483010'>this</span> <span m='483190'>array.</span> <span m='484970'>So</span>
  <span m='485140'>let's</span> <span m='485410'>do</span> <span m='485590'>some</span>
  <span m='485770'>examples.</span> <span m='487400'>Let's</span> <span m='487510'>say
  I</span> <span m='487840'>do</span> <span m='488720'>LCA</span> <span m='489240'>of</span>
  <span m='489430'>7</span> <span m='489910'>and</span> <span m='490030'>8.</span>
  <span m='491140'>That's</span> <span m='491410'>2.</span> <span m='492100'>Anything</span>
  <span m='492520'>from</span> <span m='492640'>the</span> <span m='492730'>left</span>
  <span m='492940'>and</span> <span m='493030'>the</span> <span m='493120'>right</span>
  <span m='493690'>sub-tree,</span> <span m='494500'>the</span> <span m='494620'>LCA</span>
  <span m='495250'>is</span> <span m='495490'>2.</span> <span m='496630'>And</span>
  <span m='496810'>indeed,</span> <span m='497170'>if</span> <span m='497380'>I</span>
  <span m='497470'>take</span> <span m='497680'>anything,</span> <span m='498280'>any</span>
  <span m='498520'>interval</span> <span m='498940'>that</span> <span m='499090'>spans</span>
  <span m='499660'>2,</span> <span m='500490'>then</span> <span m='500680'>the</span>
  <span m='500780'>RMQ</span> <span m='501340'>is</span> <span m='501580'>2.</span>
  <span m='502810'>If</span> <span m='502900'>I</span> <span m='502990'>don't</span>
  <span m='503260'>span</span> <span m='503590'>2,</span> <span m='503860'>I'm</span>
  <span m='503980'>either</span> <span m='504220'>in</span> <span m='504280'>the</span>
  <span m='504370'>left</span> <span m='504640'>or</span> <span m='504730'>in</span>
  <span m='504820'>the</span> <span m='504880'>right.</span> <span m='505100'>Let's</span>
  <span m='505240'>say</span> <span m='505420'>I'm</span> <span m='505510'>on</span>
  <span m='505630'>the</span> <span m='505720'>right,</span> <span m='506620'>say
  I</span> <span m='506920'>do</span> <span m='507040'>an</span> <span m='507100'>LCA</span>
  <span m='507430'>between</span> <span m='507730'>9</span> <span m='508090'>and</span>
  <span m='508210'>5.</span> <span m='508790'>I</span> <span m='508870'>get</span>
  <span m='509050'>4</span> <span m='510520'>because,</span> <span m='511050'>yeah,</span>
  <span m='511350'>the</span> <span m='511570'>RMQ</span> <span m='511760'>between</span>
  <span m='512070'>9 and</span> <span m='512434'>5</span> <span m='512799'>is</span>
  <span m='513100'>4.</span> <span m='514449'>Make</span> <span m='514789'>sense?</span>
  </p><p><span m='515710'>Same</span> <span m='516340'>problem,</span> <span m='516789'>really,</span>
  <span m='518620'>because</span> <span m='520210'>it's</span> <span m='520360'>all</span>
  <span m='520510'>about</span> <span m='520809'>which</span> <span m='521080'>mins--</span>
  <span m='521860'>I</span> <span m='521919'>mean</span> <span m='522110'>in</span>
  <span m='522190'>the</span> <span m='522280'>sequence</span> <span m='522760'>of</span>
  <span m='522880'>mins--</span> <span m='523240'>which</span> <span m='523480'>mins</span>
  <span m='523750'>do</span> <span m='523890'>you</span> <span m='523960'>contain?</span>
  <span m='524320'>If</span> <span m='524410'>you</span> <span m='524530'>contain</span>
  <span m='525370'>the</span> <span m='525460'>first</span> <span m='525730'>min,
  you</span> <span m='526090'>contain</span> <span m='526420'>the</span> <span m='526510'>highest</span>
  <span m='526990'>min you</span> <span m='527320'>contain.</span> <span m='528250'>That</span>
  <span m='528520'>is</span> <span m='528820'>the</span> <span m='529870'>answer</span>
  <span m='532000'>and</span> <span m='532180'>that's</span> <span m='533410'>what</span>
  <span m='533560'>LCA</span> <span m='534400'>in</span> <span m='534550'>this</span>
  <span m='534730'>tree</span> <span m='535330'>gives</span> <span m='535540'>you.</span>
  <span m='536730'>So</span> <span m='537070'>LCA</span> <span m='538750'>i</span>
  <span m='538960'>and</span> <span m='539110'>j</span> <span m='539780'>in</span>
  <span m='539980'>this</span> <span m='540250'>tree</span> <span m='540625'>T</span>
  <span m='541900'>equals</span> <span m='542620'>RMQ</span> <span m='544170'>in</span>
  <span m='544390'>the</span> <span m='544510'>original</span> <span m='544900'>array</span>
  <span m='546340'>of</span> <span m='546550'>the</span> <span m='546670'>corresponding</span>
  <span m='547540'>elements.</span> <span m='548090'>So</span> <span m='548200'>there</span>
  <span m='548300'>is</span> <span m='548440'>a</span> <span m='548500'>bijection</span>
  <span m='549160'>between</span> <span m='549520'>these</span> <span m='549700'>items,</span>
  <span m='551080'>and</span> <span m='551200'>so</span> <span m='551380'>I</span>
  <span m='551530'>and</span> <span m='551650'>J</span> <span m='551860'>here</span>
  <span m='552040'>represents</span> <span m='552730'>nodes,</span> <span m='553090'>and</span>
  <span m='553180'>here</span> <span m='553450'>corresponding</span> <span m='554140'>to</span>
  <span m='554350'>the</span> <span m='554470'>corresponding</span> <span m='555370'>items</span>
  <span m='555740'>in</span> <span m='555910'>A.</span> </p><p><span m='558340'>OK.</span>
  <span m='558610'>So</span> <span m='558820'>this</span> <span m='559060'>says</span>
  <span m='559420'>if</span> <span m='559660'>you</span> <span m='559810'>wanted</span>
  <span m='560110'>to</span> <span m='560260'>solve</span> <span m='560810'>RMQ,</span>
  <span m='561610'>you</span> <span m='561790'>can</span> <span m='561940'>reduce</span>
  <span m='562360'>it</span> <span m='562480'>to</span> <span m='562630'>an</span>
  <span m='562750'>LCA</span> <span m='563170'>problem.</span> <span m='565860'>Quick</span>
  <span m='566770'>note</span> <span m='567250'>here,</span> <span m='567580'>which</span>
  <span m='567850'>is--</span> <span m='569680'>yeah.</span> <span m='570370'>There's</span>
  <span m='570760'>a</span> <span m='570820'>couple</span> <span m='571060'>of</span>
  <span m='571120'>different</span> <span m='571390'>versions</span> <span m='571720'>of</span>
  <span m='571840'>Cartesian</span> <span m='572290'>trees</span> <span m='572530'>when</span>
  <span m='572710'>you</span> <span m='572830'>have</span> <span m='573460'>ties,</span>
  <span m='574090'>so</span> <span m='574270'>here</span> <span m='574450'>I</span>
  <span m='574510'>only</span> <span m='574690'>had</span> <span m='574870'>one</span>
  <span m='575110'>2.</span> <span m='575880'>If</span> <span m='576000'>there</span>
  <span m='576100'>was</span> <span m='576220'>another</span> <span m='576580'>2,</span>
  <span m='577750'>then</span> <span m='579160'>you</span> <span m='579280'>could</span>
  <span m='579430'>either</span> <span m='579670'>just</span> <span m='580120'>break</span>
  <span m='580330'>ties</span> <span m='580600'>arbitrarily</span> <span m='581170'>and</span>
  <span m='581290'>you</span> <span m='581390'>get</span> <span m='581500'>a</span>
  <span m='581560'>binary</span> <span m='581890'>tree,</span> <span m='582820'>or</span>
  <span m='582970'>you</span> <span m='583090'>could</span> <span m='583300'>make</span>
  <span m='583540'>them</span> <span m='583690'>all</span> <span m='583930'>one</span>
  <span m='584170'>node,</span> <span m='584870'>which</span> <span m='585150'>is</span>
  <span m='585260'>kind</span> <span m='585430'>of</span> <span m='585490'>messier,</span>
  <span m='586480'>and</span> <span m='586600'>then</span> <span m='586750'>you</span>
  <span m='586840'>get</span> <span m='587020'>a</span> <span m='587520'>non-binary</span>
  <span m='588220'>tree.</span> </p><p><span m='588520'>I</span> <span m='588610'>think</span>
  <span m='588790'>I'll</span> <span m='588880'>say</span> <span m='589960'>we</span>
  <span m='590110'>disambiguate</span> <span m='590860'>arbitrarily.</span> <span
  m='592210'>Just</span> <span m='592360'>pick</span> <span m='592600'>any</span>
  <span m='592840'>min,</span> <span m='593860'>and</span> <span m='593980'>then</span>
  <span m='594100'>you</span> <span m='594190'>get</span> <span m='594400'>a</span>
  <span m='594460'>binary</span> <span m='594790'>tree.</span> <span m='595020'>It</span>
  <span m='595150'>won't</span> <span m='595360'>affect</span> <span m='595660'>the</span>
  <span m='595750'>answer.</span> <span m='596910'>But</span> <span m='597090'>I</span>
  <span m='597160'>think</span> <span m='597370'>the</span> <span m='597490'>original</span>
  <span m='597880'>paper</span> <span m='598210'>might</span> <span m='598420'>do</span>
  <span m='598570'>it a</span> <span m='598770'>different</span> <span m='599160'>way.</span>
  <span m='602480'>OK.</span> <span m='606250'>Let's</span> <span m='606400'>see.</span>
  <span m='606880'>So</span> <span m='607120'>then</span> <span m='608950'>let</span>
  <span m='609130'>me</span> <span m='609250'>just</span> <span m='609400'>mention</span>
  <span m='609700'>a</span> <span m='609760'>fun</span> <span m='609970'>fact</span>
  <span m='610300'>about</span> <span m='610510'>this</span> <span m='610690'>reduction,</span>
  <span m='611420'>which</span> <span m='611500'>is</span> <span m='611590'>that</span>
  <span m='611740'>you</span> <span m='611860'>can</span> <span m='611980'>compute</span>
  <span m='612370'>it</span> <span m='612490'>in</span> <span m='612640'>linear</span>
  <span m='612940'>time.</span> <span m='614230'>This</span> <span m='614440'>is</span>
  <span m='614650'>a</span> <span m='614770'>fun</span> <span m='615010'>fact</span>
  <span m='615330'>we</span> <span m='615460'>basically</span> <span m='615910'>saw</span>
  <span m='616090'>last</span> <span m='616390'>class,</span> <span m='616990'>although</span>
  <span m='617380'>in</span> <span m='617530'>a</span> <span m='617590'>completely</span>
  <span m='618070'>different</span> <span m='618370'>setting, so</span> <span m='618820'>it's</span>
  <span m='618990'>not</span> <span m='619330'>at</span> <span m='619450'>all</span>
  <span m='619660'>obvious.</span> <span m='621160'>But</span> <span m='621430'>you</span>
  <span m='621580'>may</span> <span m='621730'>recall,</span> <span m='622250'>we</span>
  <span m='622330'>had</span> <span m='622510'>a</span> <span m='622570'>method</span>
  <span m='623080'>last</span> <span m='623350'>time</span> <span m='623740'>for</span>
  <span m='624430'>building</span> <span m='624910'>a</span> <span m='625030'>compressed</span>
  <span m='625570'>trie</span> <span m='626380'>in</span> <span m='626500'>linear</span>
  <span m='626800'>time.</span> <span m='627520'>Basically,</span> <span m='628070'>same</span>
  <span m='628390'>thing</span> <span m='628960'>works</span> <span m='629230'>here,</span>
  <span m='629530'>although</span> <span m='629640'>it</span> <span m='629710'>seems</span>
  <span m='630070'>quite</span> <span m='630310'>different.</span> </p><p><span m='631496'>The</span>
  <span m='631880'>idea</span> <span m='631960'>is</span> <span m='632110'>if</span>
  <span m='632230'>you</span> <span m='632350'>want</span> <span m='632470'>to</span>
  <span m='632560'>build</span> <span m='632860'>this,</span> <span m='633220'>if</span>
  <span m='633340'>you</span> <span m='633430'>build</span> <span m='633630'>a</span>
  <span m='633700'>Cartesian</span> <span m='634120'>tree</span> <span m='634300'>according</span>
  <span m='634570'>to</span> <span m='634630'>this</span> <span m='634810'>recursive</span>
  <span m='635260'>algorithm,</span> <span m='635680'>you</span> <span m='635800'>will</span>
  <span m='635920'>spend</span> <span m='636440'>n</span> <span m='636600'>log</span>
  <span m='636820'>n</span> <span m='636940'>time</span> <span m='637360'>or</span>
  <span m='637510'>actually,</span> <span m='637810'>maybe</span> <span m='637990'>even</span>
  <span m='638200'>quadratic</span> <span m='638680'>time,</span> <span m='639320'>if</span>
  <span m='639420'>you're</span> <span m='639550'>computing</span> <span m='640000'>min</span>
  <span m='640660'>with</span> <span m='640820'>a</span> <span m='640890'>linear</span>
  <span m='641170'>scan.</span> <span m='642190'>So</span> <span m='642340'>don't</span>
  <span m='642790'>use</span> <span m='642970'>that</span> <span m='643090'>recursive</span>
  <span m='643510'>algorithm.</span> <span m='644080'>Just</span> <span m='644290'>walk</span>
  <span m='644560'>through</span> <span m='644740'>the</span> <span m='644890'>array,</span>
  <span m='645160'>left</span> <span m='645400'>to</span> <span m='645490'>right,</span>
  <span m='645700'>one</span> <span m='645850'>at</span> <span m='645940'>a</span>
  <span m='646000'>time.</span> <span m='646690'>So</span> <span m='646840'>first</span>
  <span m='647080'>you</span> <span m='647170'>insert</span> <span m='647470'>8.</span>
  <span m='648250'>Then</span> <span m='648400'>you</span> <span m='648520'>insert</span>
  <span m='648790'>7, and</span> <span m='649110'>you</span> <span m='649210'>realize</span>
  <span m='649720'>7</span> <span m='650230'>would</span> <span m='650380'>have</span>
  <span m='650650'>would</span> <span m='650860'>have</span> <span m='650980'>won,</span>
  <span m='651460'>so</span> <span m='651760'>you</span> <span m='651910'>put</span>
  <span m='652090'>7</span> <span m='652510'>above</span> <span m='652930'>8.</span>
  </p><p><span m='653980'>Then</span> <span m='654160'>you</span> <span m='654280'>insert</span>
  <span m='654580'>2.</span> <span m='654750'>You</span> <span m='654850'>say</span>
  <span m='656020'>that's</span> <span m='656230'>even</span> <span m='656440'>higher</span>
  <span m='656740'>than</span> <span m='656890'>7,</span> <span m='657340'>so</span>
  <span m='657640'>I</span> <span m='657700'>have</span> <span m='657850'>to</span>
  <span m='657970'>put</span> <span m='658120'>it</span> <span m='658240'>up</span>
  <span m='658390'>here.</span> <span m='659590'>Then</span> <span m='659830'>you</span>
  <span m='660070'>insert</span> <span m='660580'>8</span> <span m='661270'>so</span>
  <span m='661450'>that</span> <span m='661780'>you'll</span> <span m='661930'>just</span>
  <span m='662620'>go</span> <span m='662860'>down</span> <span m='663280'>from</span>
  <span m='663490'>there,</span> <span m='663640'>and</span> <span m='663730'>you</span>
  <span m='663820'>put</span> <span m='664060'>8</span> <span m='664390'>as</span>
  <span m='664560'>a</span> <span m='664630'>right</span> <span m='664870'>child</span>
  <span m='665200'>of</span> <span m='665290'>2.</span> <span m='666250'>Then</span>
  <span m='666440'>you</span> <span m='666540'>insert</span> <span m='666820'>6.</span>
  <span m='667120'>You</span> <span m='667180'>say</span> <span m='667390'>whoops,</span>
  <span m='668770'>6</span> <span m='669400'>actually</span> <span m='669790'>would</span>
  <span m='670030'>have</span> <span m='670180'>gone</span> <span m='670540'>in</span>
  <span m='670720'>between</span> <span m='671230'>2</span> <span m='671440'>and</span>
  <span m='671560'>8.</span> <span m='672790'>And</span> <span m='672840'>the</span>
  <span m='672940'>way</span> <span m='673090'>you'd</span> <span m='673240'>see</span>
  <span m='673420'>that</span> <span m='673630'>is--</span> <span m='675240'>I</span>
  <span m='675270'>mean,</span> <span m='675400'>at</span> <span m='675520'>that</span>
  <span m='675730'>moment,</span> <span m='676210'>your</span> <span m='676420'>tree</span>
  <span m='676780'>looks</span> <span m='676960'>something</span> <span m='677290'>like</span>
  <span m='677470'>this.</span> <span m='677710'>You've</span> <span m='677830'>got</span>
  <span m='678010'>2,</span> <span m='679270'>8,</span> <span m='680290'>and</span>
  <span m='680440'>there's</span> <span m='680560'>other</span> <span m='680770'>stuff</span>
  <span m='681010'>to</span> <span m='681100'>the</span> <span m='681190'>left,</span>
  <span m='681490'>but</span> <span m='681640'>I</span> <span m='681700'>don't</span>
  <span m='681880'>actually</span> <span m='682210'>care.</span> <span m='682450'>I</span>
  <span m='682480'>just</span> <span m='682660'>care</span> <span m='682840'>about</span>
  <span m='683020'>the</span> <span m='683140'>right</span> <span m='683320'>spine.</span>
  </p><p><span m='683970'>I</span> <span m='684070'>say</span> <span m='684250'>I'm</span>
  <span m='684490'>inserting</span> <span m='684880'>6.</span> <span m='685690'>6</span>
  <span m='686020'>would</span> <span m='686140'>have</span> <span m='686230'>been</span>
  <span m='686380'>above</span> <span m='686740'>8,</span> <span m='687490'>but</span>
  <span m='687670'>not</span> <span m='687880'>above</span> <span m='688150'>2.</span>
  <span m='688390'>Therefore,</span> <span m='688720'>it</span> <span m='688810'>fits</span>
  <span m='689500'>along</span> <span m='689860'>this</span> <span m='690040'>edge,</span>
  <span m='691090'>and</span> <span m='691180'>so</span> <span m='691330'>I</span>
  <span m='691420'>convert</span> <span m='691870'>this</span> <span m='692110'>tree</span>
  <span m='694690'>into</span> <span m='696910'>this</span> <span m='697090'>pattern,</span>
  <span m='698110'>and</span> <span m='698200'>it</span> <span m='698260'>will</span>
  <span m='698410'>always</span> <span m='698710'>look</span> <span m='699490'>like</span>
  <span m='699730'>this.</span> <span m='703090'>8</span> <span m='703230'>becomes</span>
  <span m='703620'>a</span> <span m='703680'>child</span> <span m='704070'>of</span>
  <span m='704170'>7--</span> <span m='705240'>sorry,</span> <span m='705510'>6.</span>
  <span m='707760'>6.</span> <span m='709380'>Thanks.</span> <span m='711006'>Not</span>
  <span m='711420'>7.</span> <span m='712350'>7</span> <span m='712620'>was</span>
  <span m='712800'>on</span> <span m='712890'>the</span> <span m='712950'>left.</span>
  <span m='713280'>This</span> <span m='713760'>is</span> <span m='713970'>the</span>
  <span m='714090'>guy</span> <span m='714310'>I'm</span> <span m='714420'>inserting</span>
  <span m='714870'>next</span> <span m='715200'>because</span> <span m='715800'>here.</span>
  <span m='718390'>So</span> <span m='720600'>I</span> <span m='720690'>guess</span>
  <span m='720870'>it's</span> <span m='720990'>a</span> <span m='721050'>left</span>
  <span m='721260'>child</span> <span m='721500'>because</span> <span m='721680'>it's</span>
  <span m='721800'>the</span> <span m='721920'>first</span> <span m='722160'>one.</span>
  <span m='723450'>So</span> <span m='723680'>we</span> <span m='723780'>insert</span>
  <span m='724070'>6</span> <span m='724290'>like</span> <span m='724470'>this.</span>
  <span m='725170'>So</span> <span m='725190'>now</span> <span m='725430'>the</span>
  <span m='725520'>new</span> <span m='725700'>right</span> <span m='725880'>spine</span>
  <span m='726330'>is</span> <span m='726570'>2,</span> <span m='726810'>6,</span>
  <span m='727560'>and</span> <span m='727710'>from</span> <span m='727890'>then</span>
  <span m='728040'>on,</span> <span m='728190'>we</span> <span m='728310'>will</span>
  <span m='728400'>always</span> <span m='728670'>be</span> <span m='728790'>working</span>
  <span m='729120'>to</span> <span m='729270'>the</span> <span m='729390'>right</span>
  <span m='729660'>of</span> <span m='729810'>that.</span> <span m='730080'>We'll</span>
  <span m='730200'>never</span> <span m='730470'>be</span> <span m='730590'>touching</span>
  <span m='731010'>any</span> <span m='731160'>of</span> <span m='731220'>this</span>
  <span m='731400'>left</span> <span m='731610'>stuff.</span> </p><p><span m='733120'>OK.</span>
  <span m='733530'>So</span> <span m='734160'>how</span> <span m='734280'>long</span>
  <span m='734460'>did</span> <span m='734550'>it</span> <span m='734610'>take</span>
  <span m='734790'>me</span> <span m='734880'>to</span> <span m='734970'>do</span>
  <span m='735120'>that?</span> <span m='735390'>In</span> <span m='735510'>general,</span>
  <span m='736420'>I</span> <span m='736520'>have</span> <span m='736710'>a</span>
  <span m='736770'>right</span> <span m='737010'>spine</span> <span m='738180'>of</span>
  <span m='738300'>the</span> <span m='738390'>tree,</span> <span m='738690'>which</span>
  <span m='738870'>are</span> <span m='738960'>all</span> <span m='739200'>right</span>
  <span m='739470'>edges,</span> <span m='740730'>and</span> <span m='740880'>I</span>
  <span m='741000'>might</span> <span m='741180'>have</span> <span m='741330'>to</span>
  <span m='741450'>walk</span> <span m='741780'>up</span> <span m='741990'>several</span>
  <span m='742440'>steps</span> <span m='742860'>before</span> <span m='743130'>I</span>
  <span m='743160'>discover</span> <span m='743550'>whoops,</span> <span m='744180'>this</span>
  <span m='744510'>is</span> <span m='744660'>where</span> <span m='745290'>the</span>
  <span m='745380'>next</span> <span m='745680'>item</span> <span m='747360'>belongs.</span>
  <span m='748620'>And</span> <span m='748740'>then</span> <span m='748920'>I</span>
  <span m='749010'>convert</span> <span m='749450'>it</span> <span m='749580'>into</span>
  <span m='750870'>this</span> <span m='751110'>new</span> <span m='752220'>entry,</span>
  <span m='752970'>which</span> <span m='753090'>has</span> <span m='753240'>a</span>
  <span m='753280'>left</span> <span m='753540'>child,</span> <span m='754500'>which</span>
  <span m='754650'>is</span> <span m='754770'>that</span> <span m='754980'>stuff.</span>
  <span m='756010'>But</span> <span m='756030'>this</span> <span m='756180'>stuff</span>
  <span m='756390'>becomes</span> <span m='756720'>irrelevant</span> <span m='757180'>from</span>
  <span m='757350'>then</span> <span m='757500'>on,</span> <span m='757650'>because</span>
  <span m='757830'>now,</span> <span m='758100'>this</span> <span m='758310'>is</span>
  <span m='758430'>the</span> <span m='758550'>new</span> <span m='758700'>right</span>
  <span m='758910'>spine.</span> <span m='760120'>And</span> <span m='760220'>so</span>
  <span m='760230'>if</span> <span m='760320'>this</span> <span m='760530'>is</span>
  <span m='760650'>a</span> <span m='760710'>long</span> <span m='761010'>walk,</span>
  <span m='761850'>I</span> <span m='761970'>charge</span> <span m='762420'>that</span>
  <span m='762630'>to</span> <span m='762780'>the</span> <span m='762900'>decrease</span>
  <span m='763470'>in</span> <span m='763620'>the</span> <span m='763710'>length</span>
  <span m='763920'>of</span> <span m='763980'>the</span> <span m='764100'>right</span>
  <span m='764310'>spine,</span> <span m='765150'>just</span> <span m='765390'>like</span>
  <span m='766020'>that</span> <span m='766290'>algorithm</span> <span m='766740'>last</span>
  <span m='766950'>time.</span> </p><p><span m='767460'>Slightly</span> <span m='767940'>different</span>
  <span m='768180'>notion</span> <span m='768450'>of</span> <span m='768540'>right</span>
  <span m='768720'>spine.</span> <span m='770670'>So</span> <span m='771240'>same</span>
  <span m='771570'>amortization,</span> <span m='772350'>you</span> <span m='772470'>get</span>
  <span m='772650'>linear</span> <span m='772920'>time,</span> <span m='773590'>and</span>
  <span m='773830'>you</span> <span m='773910'>can</span> <span m='774060'>build</span>
  <span m='774250'>the</span> <span m='774330'>Cartesian</span> <span m='774810'>tree.</span>
  <span m='774990'>This</span> <span m='775170'>is</span> <span m='775290'>actually</span>
  <span m='775590'>where</span> <span m='775770'>that</span> <span m='775950'>algorithm</span>
  <span m='776340'>comes</span> <span m='776610'>from.</span> <span m='776850'>This</span>
  <span m='777000'>one</span> <span m='777150'>was</span> <span m='777300'>first,</span>
  <span m='777660'>I</span> <span m='777960'>believe.</span> <span m='781410'>Questions?</span>
  <span m='783610'>I'm</span> <span m='783900'>not</span> <span m='784140'>worrying</span>
  <span m='784410'>too</span> <span m='784560'>much</span> <span m='784770'>about</span>
  <span m='785520'>build</span> <span m='785790'>time,</span> <span m='786180'>how</span>
  <span m='786360'>long</span> <span m='786540'>it</span> <span m='786600'>takes</span>
  <span m='786810'>to</span> <span m='786900'>build</span> <span m='787110'>these</span>
  <span m='787260'>data</span> <span m='787440'>structures,</span> <span m='787860'>but</span>
  <span m='787980'>they</span> <span m='788100'>can</span> <span m='788280'>all</span>
  <span m='788400'>be</span> <span m='788520'>built</span> <span m='788760'>in</span>
  <span m='788880'>linear</span> <span m='789150'>time.</span> <span m='789930'>And</span>
  <span m='790050'>this</span> <span m='790230'>is</span> <span m='790350'>one</span>
  <span m='790500'>of</span> <span m='790590'>the</span> <span m='791820'>cooler</span>
  <span m='792190'>algorithms,</span> <span m='792540'>and</span> <span m='792630'>it's</span>
  <span m='792750'>a</span> <span m='792810'>nice</span> <span m='792990'>tie</span>
  <span m='793200'>into</span> <span m='793410'>last</span> <span m='793680'>lecture.</span>
  </p><p><span m='795150'>So</span> <span m='795870'>that's</span> <span m='796110'>a</span>
  <span m='796170'>reduction</span> <span m='796530'>from</span> <span m='796680'>RMQ</span>
  <span m='797010'>to</span> <span m='797160'>LCA,</span> <span m='797550'>so</span>
  <span m='797700'>now</span> <span m='797970'>all</span> <span m='798210'>of</span>
  <span m='798300'>our</span> <span m='798390'>problems</span> <span m='798870'>are</span>
  <span m='798990'>about</span> <span m='799260'>trees,</span> <span m='799680'>in</span>
  <span m='799770'>some</span> <span m='799980'>sense.</span> <span m='801270'>I</span>
  <span m='801330'>mean,</span> <span m='801510'>there's</span> <span m='801660'>a</span>
  <span m='801720'>reason</span> <span m='802020'>I</span> <span m='802080'>mentioned</span>
  <span m='802370'>RMQ.</span> <span m='802830'>Not</span> <span m='803010'>just</span>
  <span m='803190'>that</span> <span m='803340'>it's</span> <span m='803460'>a</span>
  <span m='803610'>handy</span> <span m='803910'>problem</span> <span m='804240'>to</span>
  <span m='804360'>have</span> <span m='804450'>solved,</span> <span m='805350'>but</span>
  <span m='805500'>we're</span> <span m='805710'>actually</span> <span m='806010'>going</span>
  <span m='806130'>to</span> <span m='806190'>use</span> <span m='806400'>RMQ</span>
  <span m='806980'>to</span> <span m='807150'>solve</span> <span m='807690'>LCA.</span>
  <span m='809250'>So</span> <span m='809460'>we're</span> <span m='809550'>going</span>
  <span m='809660'>to</span> <span m='809760'>go</span> <span m='809880'>back</span>
  <span m='810120'>and</span> <span m='810210'>forth</span> <span m='810510'>between</span>
  <span m='810780'>the</span> <span m='810870'>two</span> <span m='811920'>a</span>
  <span m='811980'>lot.</span> <span m='814870'>Actually,</span> <span m='815130'>we'll</span>
  <span m='815220'>spend</span> <span m='815430'>most</span> <span m='815610'>of</span>
  <span m='815700'>our</span> <span m='815790'>time</span> <span m='816060'>in</span>
  <span m='816170'>the</span> <span m='816220'>RMQ</span> <span m='816700'>land.</span>
  </p><p><span m='817410'>So</span> <span m='817590'>let</span> <span m='817740'>me</span>
  <span m='817890'>tell</span> <span m='818040'>you</span> <span m='818130'>about</span>
  <span m='818370'>the</span> <span m='818460'>reverse</span> <span m='818820'>direction,</span>
  <span m='820830'>if</span> <span m='820950'>you</span> <span m='821070'>want</span>
  <span m='821220'>to</span> <span m='821280'>reduce</span> <span m='822840'>LCA</span>
  <span m='823470'>to</span> <span m='823590'>RMQ.</span> <span m='825330'>That</span>
  <span m='825480'>also</span> <span m='825810'>works.</span> <span m='828300'>And</span>
  <span m='828480'>you</span> <span m='828570'>can</span> <span m='828720'>kind</span>
  <span m='828960'>of</span> <span m='829050'>see</span> <span m='829320'>it</span>
  <span m='831860'>in</span> <span m='831980'>this</span> <span m='832160'>picture.</span>
  <span m='833510'>If</span> <span m='833660'>I</span> <span m='833750'>gave</span>
  <span m='834020'>you</span> <span m='834110'>this</span> <span m='834620'>tree,</span>
  <span m='835280'>how</span> <span m='835490'>would</span> <span m='835670'>you</span>
  <span m='835790'>reconstruct</span> <span m='836390'>this</span> <span m='836600'>array?</span>
  <span m='837500'>Pop</span> <span m='837710'>quiz.</span> <span m='839730'>How do</span>
  <span m='839950'>I</span> <span m='840020'>go</span> <span m='840140'>from</span>
  <span m='840320'>here</span> <span m='840980'>to</span> <span m='841100'>here?</span>
  <span m='847820'>In-order</span> <span m='848180'>traversal,</span> <span m='848820'>yep.</span>
  <span m='849590'>Just</span> <span m='850130'>doing</span> <span m='850320'>an</span>
  <span m='850440'>in-order</span> <span m='850640'>traversal,</span> <span m='851060'>write</span>
  <span m='851240'>those</span> <span m='851390'>guys--</span> <span m='851750'>I</span>
  <span m='851840'>mean,</span> <span m='852650'>yeah.</span> <span m='853850'>Pretty</span>
  <span m='854030'>easy.</span> <span m='854300'>Now,</span> <span m='854960'>not</span>
  <span m='855140'>so</span> <span m='855470'>easy</span> <span m='855770'>because</span>
  <span m='856880'>in</span> <span m='857060'>the</span> <span m='857270'>LCA</span>
  <span m='857660'>problem,</span> <span m='858020'>I</span> <span m='858110'>don't</span>
  <span m='858230'>have</span> <span m='858410'>numbers</span> <span m='858800'>in</span>
  <span m='858920'>the</span> <span m='859010'>nodes.</span> <span m='859730'>So</span>
  <span m='860030'>if</span> <span m='860180'>I</span> <span m='860270'>do</span>
  <span m='860420'>an</span> <span m='860510'>in-order</span> <span m='860810'>walk</span>
  <span m='861110'>and</span> <span m='861200'>I</span> <span m='861290'>write</span>
  <span m='861590'>stuff,</span> <span m='861950'>it's</span> <span m='862070'>like,</span>
  <span m='862670'>what</span> <span m='862820'>should</span> <span m='863000'>I</span>
  <span m='863090'>write</span> <span m='863330'>for</span> <span m='863450'>each</span>
  <span m='863600'>of</span> <span m='863660'>the</span> <span m='863750'>nodes.</span>
  <span m='864910'>Any</span> <span m='865030'>suggestions?</span> </p><p><span m='885450'>AUDIENCE:</span>
  <span m='885943'>[INAUDIBLE]</span> </p><p><span m='887430'>PROFESSOR:</span> <span
  m='887475'>The</span> <span m='887520'>height?</span> <span m='888090'>Not</span>
  <span m='888210'>quite</span> <span m='888420'>the</span> <span m='888510'>height.</span>
  <span m='888900'>The</span> <span m='889020'>depth.</span> <span m='896000'>That</span>
  <span m='896160'>will</span> <span m='896280'>work.</span> <span m='898590'>So</span>
  <span m='899520'>let's</span> <span m='900270'>do</span> <span m='900450'>it,</span>
  <span m='900570'>just</span> <span m='900750'>so</span> <span m='902040'>it's</span>
  <span m='902160'>clear.</span> <span m='904256'>Look at</span> <span m='904660'>the</span>
  <span m='904770'>same</span> <span m='905070'>tree</span> <span m='909354'>Is that
  the</span> <span m='909840'>same</span> <span m='910170'>tree?</span> <span m='912290'>Yep.</span>
  <span m='912745'>So</span> <span m='913200'>I</span> <span m='913380'>write</span>
  <span m='913500'>the</span> <span m='913590'>depths.</span> <span m='914615'>0,</span>
  <span m='915100'>1,</span> <span m='915515'>1,</span> <span m='915930'>2,</span>
  <span m='916920'>2,</span> <span m='917910'>2,</span> <span m='919395'>3,</span>
  <span m='920385'>3.</span> <span m='920880'>It's either</span> <span m='921090'>height</span>
  <span m='921240'>or</span> <span m='921330'>depth, and</span> <span m='921690'>you</span>
  <span m='921780'>try</span> <span m='921960'>them</span> <span m='922110'>both.</span>
  <span m='922530'>This</span> <span m='922690'>is</span> <span m='922800'>depth.</span>
  <span m='924790'>So</span> <span m='924960'>I</span> <span m='925050'>do</span>
  <span m='925170'>an</span> <span m='925230'>in-order</span> <span m='925620'>walk</span>
  <span m='926010'>I</span> <span m='926130'>get</span> <span m='926850'>2,</span>
  <span m='927420'>1,</span> <span m='928330'>0--</span> <span m='931570'>can you</span>
  <span m='931770'>read</span> <span m='932010'>my</span> <span m='932160'>writing--</span>
  <span m='932490'>3,</span> <span m='933180'>2,</span> <span m='934230'>3,</span>
  <span m='935220'>1,</span> <span m='935760'>2.</span> <span m='935970'>It's</span>
  <span m='936090'>funny</span> <span m='936330'>doing</span> <span m='936570'>an</span>
  <span m='936740'>in-order</span> <span m='936900'>traversal</span> <span m='937380'>on</span>
  <span m='937460'>something</span> <span m='937740'>that's</span> <span m='937890'>not</span>
  <span m='938070'>a</span> <span m='938130'>binary</span> <span m='938430'>search</span>
  <span m='938730'>tree,</span> <span m='939180'>but</span> <span m='939960'>there</span>
  <span m='940110'>it</span> <span m='940200'>is.</span> <span m='940590'>That's</span>
  <span m='940920'>the</span> <span m='941340'>order</span> <span m='941610'>in</span>
  <span m='941670'>which</span> <span m='941820'>you</span> <span m='941910'>visit</span>
  <span m='942180'>the</span> <span m='942270'>nodes.</span> </p><p><span m='943350'>And</span>
  <span m='945890'>you</span> <span m='946140'>stare</span> <span m='946440'>at</span>
  <span m='946530'>it</span> <span m='946650'>long</span> <span m='946860'>enough,</span>
  <span m='947190'>this</span> <span m='947460'>sequence</span> <span m='948630'>will</span>
  <span m='948780'>behave</span> <span m='949350'>exactly</span> <span m='950100'>the</span>
  <span m='950220'>same</span> <span m='951060'>as</span> <span m='951240'>this</span>
  <span m='951330'>sequence.</span> <span m='952380'>Of</span> <span m='952530'>course,</span>
  <span m='952710'>not</span> <span m='952920'>in</span> <span m='953010'>terms</span>
  <span m='953250'>of</span> <span m='953310'>the</span> <span m='953430'>actual</span>
  <span m='953760'>values</span> <span m='954210'>returned.</span> <span m='955510'>But</span>
  <span m='955680'>if</span> <span m='955890'>you</span> <span m='956010'>do</span>
  <span m='956190'>the</span> <span m='956400'>argument</span> <span m='957000'>version</span>
  <span m='957480'>of</span> <span m='957730'>RMQ,</span> <span m='958650'>you</span>
  <span m='958710'>just</span> <span m='958920'>ask</span> <span m='959160'>for</span>
  <span m='959340'>what's</span> <span m='959610'>the</span> <span m='959760'>index</span>
  <span m='960270'>that</span> <span m='960390'>gives</span> <span m='960600'>me</span>
  <span m='960720'>the</span> <span m='960840'>min.</span> <span m='961830'>If</span>
  <span m='961980'>you</span> <span m='962130'>can</span> <span m='962280'>solve</span>
  <span m='962580'>RMQ</span> <span m='963000'>on</span> <span m='963150'>this</span>
  <span m='963690'>structure,</span> <span m='965660'>then</span> <span m='965850'>that</span>
  <span m='966960'>RMQ</span> <span m='967350'>will</span> <span m='967470'>give</span>
  <span m='967650'>exactly</span> <span m='968190'>the</span> <span m='968310'>same</span>
  <span m='969000'>answers</span> <span m='970050'>as</span> <span m='970200'>this</span>
  <span m='970380'>structure.</span> <span m='972030'>Just</span> <span m='972180'>kind</span>
  <span m='972360'>of</span> <span m='972420'>nifty.</span> <span m='973680'>Because</span>
  <span m='973860'>here</span> <span m='974040'>I</span> <span m='974100'>had</span>
  <span m='974310'>numbers,</span> <span m='974790'>they</span> <span m='974880'>could</span>
  <span m='975060'>be</span> <span m='975180'>all</span> <span m='975330'>over</span>
  <span m='975510'>the</span> <span m='975600'>place.</span> <span m='977260'>Here</span>
  <span m='978210'>I</span> <span m='978330'>have</span> <span m='979080'>very</span>
  <span m='979260'>clean</span> <span m='979530'>numbers.</span> <span m='979940'>They</span>
  <span m='980100'>will</span> <span m='980190'>go</span> <span m='980370'>between</span>
  <span m='980760'>0</span> <span m='981630'>and</span> <span m='981780'>the</span>
  <span m='981870'>height</span> <span m='982020'>of</span> <span m='982140'>the</span>
  <span m='982230'>tree.</span> </p><p><span m='984670'>So</span> <span m='984750'>in</span>
  <span m='984840'>general</span> <span m='985110'>at</span> <span m='985210'>most,</span>
  <span m='986280'>0,</span> <span m='986610'>2,</span> <span m='986910'>n</span>
  <span m='987060'>minus</span> <span m='987330'>1.</span> <span m='988090'>So</span>
  <span m='988800'>fun</span> <span m='989520'>consequence</span> <span m='990090'>of</span>
  <span m='990150'>this</span> <span m='990840'>is</span> <span m='990990'>you</span>
  <span m='991080'>get</span> <span m='991320'>a</span> <span m='991680'>tool</span>
  <span m='991980'>for</span> <span m='992340'>universe</span> <span m='992820'>reduction</span>
  <span m='997490'>in</span> <span m='997730'>RMQ.</span> <span m='998410'>The</span>
  <span m='998530'>tree</span> <span m='998740'>problems</span> <span m='999070'>don't</span>
  <span m='999250'>have</span> <span m='999400'>this</span> <span m='999550'>issue,</span>
  <span m='999790'>because</span> <span m='999970'>they</span> <span m='1000060'>don't</span>
  <span m='1000210'>involve</span> <span m='1000540'>numbers.</span> <span m='1000900'>They</span>
  <span m='1000990'>involve</span> <span m='1001320'>trees,</span> <span m='1002730'>and</span>
  <span m='1002850'>that's</span> <span m='1003030'>why</span> <span m='1003240'>this</span>
  <span m='1003420'>reduction</span> <span m='1003870'>does</span> <span m='1004140'>this.</span>
  <span m='1004710'>But</span> <span m='1004800'>you</span> <span m='1004950'>can</span>
  <span m='1005100'>start</span> <span m='1005490'>from</span> <span m='1006300'>an</span>
  <span m='1006450'>arbitrary</span> <span m='1007860'>ordered</span> <span m='1008190'>universe</span>
  <span m='1014190'>and</span> <span m='1014280'>have</span> <span m='1014490'>an</span>
  <span m='1014610'>RMQ</span> <span m='1015090'>problem</span> <span m='1015510'>on</span>
  <span m='1015690'>that,</span> <span m='1016860'>and</span> <span m='1017010'>you</span>
  <span m='1017130'>can</span> <span m='1017280'>convert</span> <span m='1017610'>it</span>
  <span m='1017700'>to</span> <span m='1017790'>LCA.</span> <span m='1019140'>And</span>
  <span m='1019290'>then</span> <span m='1019380'>you</span> <span m='1019470'>can</span>
  <span m='1019620'>convert</span> <span m='1019950'>it</span> <span m='1020040'>to</span>
  <span m='1022920'>a</span> <span m='1022980'>nice</span> <span m='1023220'>clean</span>
  <span m='1026460'>universe</span> <span m='1027089'>RMQ,</span> <span m='1030599'>just</span>
  <span m='1030810'>by</span> <span m='1031440'>doing</span> <span m='1031650'>the</span>
  <span m='1031740'>Cartesian</span> <span m='1032220'>tree</span> <span m='1032460'>and</span>
  <span m='1032550'>then</span> <span m='1032700'>doing</span> <span m='1033030'>the</span>
  <span m='1033150'>in-order</span> <span m='1033420'>traversal</span> <span m='1033930'>of</span>
  <span m='1034020'>the</span> <span m='1034140'>depths.</span> </p><p><span m='1037430'>This</span>
  <span m='1037670'>is</span> <span m='1038300'>kind</span> <span m='1038510'>of</span>
  <span m='1038569'>nifty</span> <span m='1038900'>because</span> <span m='1040010'>if</span>
  <span m='1040160'>you</span> <span m='1040280'>look</span> <span m='1040460'>at</span>
  <span m='1040609'>these</span> <span m='1040849'>algorithms,</span> <span m='1041480'>they</span>
  <span m='1041750'>only</span> <span m='1042020'>assume</span> <span m='1042500'>a</span>
  <span m='1042560'>comparison</span> <span m='1043160'>model.</span> <span m='1044040'>So</span>
  <span m='1044089'>these</span> <span m='1044300'>don't</span> <span m='1044480'>have</span>
  <span m='1044630'>to</span> <span m='1044720'>be</span> <span m='1044839'>numbers.</span>
  <span m='1045200'>They</span> <span m='1045290'>just</span> <span m='1045470'>have</span>
  <span m='1045589'>to</span> <span m='1045650'>be</span> <span m='1045740'>something</span>
  <span m='1046160'>from</span> <span m='1046310'>a</span> <span m='1046369'>totally</span>
  <span m='1046740'>ordered</span> <span m='1046970'>universe</span> <span m='1047359'>that</span>
  <span m='1047480'>you</span> <span m='1047599'>can</span> <span m='1047690'>compare</span>
  <span m='1048020'>in</span> <span m='1048109'>constant</span> <span m='1048430'>time.</span>
  <span m='1049220'>You</span> <span m='1049310'>do</span> <span m='1049430'>this</span>
  <span m='1049580'>reduction,</span> <span m='1050300'>and</span> <span m='1050450'>now</span>
  <span m='1050690'>we</span> <span m='1050780'>can</span> <span m='1050930'>assume</span>
  <span m='1051170'>they're</span> <span m='1051380'>integers,</span> <span m='1052520'>nice</span>
  <span m='1052700'>small</span> <span m='1053120'>integers,</span> <span m='1053630'>and</span>
  <span m='1053720'>that</span> <span m='1053870'>will</span> <span m='1054020'>let</span>
  <span m='1054200'>us</span> <span m='1054320'>solve</span> <span m='1054590'>things</span>
  <span m='1054830'>in</span> <span m='1054950'>constant</span> <span m='1055310'>time</span>
  <span m='1055970'>using</span> <span m='1056270'>the</span> <span m='1056330'>Word</span>
  <span m='1056510'>RAM.</span> <span m='1058040'>So</span> <span m='1058130'>you</span>
  <span m='1058190'>don't</span> <span m='1058340'>need</span> <span m='1058460'>to</span>
  <span m='1058550'>assume</span> <span m='1058820'>that</span> <span m='1058970'>about</span>
  <span m='1059150'>the</span> <span m='1059240'>original</span> <span m='1059540'>values.</span>
  </p><p><span m='1062250'>Cool.</span> <span m='1064110'>So,</span> <span m='1064720'>time</span>
  <span m='1064940'>to</span> <span m='1065000'>actually</span> <span m='1065280'>solve</span>
  <span m='1065580'>something.</span> <span m='1066160'>We've</span> <span m='1066390'>done</span>
  <span m='1067050'>reductions.</span> <span m='1067335'>We</span> <span m='1067620'>now
  know</span> <span m='1067710'>RMQ</span> <span m='1068460'>and</span> <span m='1068550'>LCA
  are</span> <span m='1068970'>equivalent.</span> <span m='1069750'>Let's</span> <span
  m='1069930'>solve</span> <span m='1070230'>them</span> <span m='1070380'>both.</span>
  <span m='1081500'>Kind</span> <span m='1081680'>of</span> <span m='1081770'>like</span>
  <span m='1082040'>the</span> <span m='1082400'>last</span> <span m='1084960'>of</span>
  <span m='1085360'>the</span> <span m='1085460'>sorting</span> <span m='1085880'>we</span>
  <span m='1085970'>saw,</span> <span m='1086410'>there's</span> <span m='1086550'>going</span>
  <span m='1086740'>to</span> <span m='1086810'>be</span> <span m='1086870'>a</span>
  <span m='1086930'>lot</span> <span m='1087080'>of</span> <span m='1087170'>steps.</span>
  <span m='1088100'>They're</span> <span m='1088250'>not</span> <span m='1088460'>sequential</span>
  <span m='1088970'>steps.</span> <span m='1089270'>These</span> <span m='1089450'>are</span>
  <span m='1089540'>like</span> <span m='1090260'>different</span> <span m='1090590'>versions</span>
  <span m='1091040'>of</span> <span m='1091220'>a</span> <span m='1091250'>data</span>
  <span m='1091490'>structure</span> <span m='1091850'>for</span> <span m='1092000'>solving</span>
  <span m='1092360'>RMQ,</span> <span m='1093620'>and</span> <span m='1093830'>they're</span>
  <span m='1093920'>going</span> <span m='1094040'>to</span> <span m='1094130'>be</span>
  <span m='1094490'>getting</span> <span m='1094790'>progressively</span> <span m='1095420'>better</span>
  <span m='1095720'>and</span> <span m='1095810'>better.</span> </p><p><span m='1097540'>So</span>
  <span m='1102730'>LCA</span> <span m='1104836'>which</span> <span m='1105250'>applies</span>
  <span m='1106160'>RMQ.</span> <span m='1110450'>This</span> <span m='1110630'>is</span>
  <span m='1110750'>originally</span> <span m='1111110'>solved</span> <span m='1111380'>by</span>
  <span m='1111530'>Harel</span> <span m='1111860'>and Tarjan</span> <span m='1112290'>in</span>
  <span m='1112370'>1984,</span> <span m='1113660'>but</span> <span m='1113780'>is</span>
  <span m='1114380'>rather</span> <span m='1114620'>complicated.</span> <span m='1116030'>And</span>
  <span m='1116150'>then</span> <span m='1116450'>what</span> <span m='1116600'>I'm</span>
  <span m='1116810'>going</span> <span m='1116960'>to</span> <span m='1117020'>talk</span>
  <span m='1117230'>about</span> <span m='1117440'>is</span> <span m='1117530'>a</span>
  <span m='1117590'>version</span> <span m='1117920'>from</span> <span m='1118280'>2000</span>
  <span m='1120080'>by</span> <span m='1120290'>Bender and</span> <span m='1120620'>Farach-Colton,</span>
  <span m='1121580'>same</span> <span m='1121910'>authors</span> <span m='1122270'>from</span>
  <span m='1122420'>the</span> <span m='1122540'>cache-oblivious</span> <span m='1123080'>B-trees.</span>
  <span m='1124830'>That's</span> <span m='1125070'>a</span> <span m='1125780'>much</span>
  <span m='1126020'>simpler</span> <span m='1126590'>presentation.</span> <span m='1128420'>So</span>
  <span m='1129470'>first</span> <span m='1129740'>step</span> <span m='1131720'>is</span>
  <span m='1131870'>I</span> <span m='1131960'>want</span> <span m='1132170'>to</span>
  <span m='1132230'>do</span> <span m='1132350'>this</span> <span m='1132530'>reduction</span>
  <span m='1133070'>again</span> <span m='1133760'>from</span> <span m='1134180'>LCA</span>
  <span m='1134630'>to</span> <span m='1134720'>RMQ,</span> <span m='1135830'>but</span>
  <span m='1136040'>slightly</span> <span m='1136490'>differently.</span> </p><p><span
  m='1138200'>And</span> <span m='1138300'>we're</span> <span m='1138400'>going to</span>
  <span m='1138500'>get</span> <span m='1138740'>a</span> <span m='1138860'>more</span>
  <span m='1139070'>restricted</span> <span m='1139520'>problem</span> <span m='1139850'>called</span>
  <span m='1140090'>plus</span> <span m='1140360'>or</span> <span m='1140450'>minus</span>
  <span m='1140780'>1</span> <span m='1141155'>RMQ.</span> <span m='1145130'>What</span>
  <span m='1145310'>is</span> <span m='1145420'>plus</span> <span m='1145640'>or</span>
  <span m='1145700'>minus</span> <span m='1145970'>1 RMQ?</span> <span m='1147140'>Just</span>
  <span m='1147350'>means</span> <span m='1147680'>that</span> <span m='1148460'>you</span>
  <span m='1148670'>get</span> <span m='1148850'>an</span> <span m='1148970'>array</span>
  <span m='1150170'>where</span> <span m='1150530'>all</span> <span m='1150770'>the</span>
  <span m='1150830'>adjacent</span> <span m='1151220'>values</span> <span m='1153170'>differ</span>
  <span m='1154820'>by</span> <span m='1155030'>plus</span> <span m='1155300'>or</span>
  <span m='1155390'>minus</span> <span m='1155660'>1.</span> <span m='1159170'>And</span>
  <span m='1159410'>if</span> <span m='1159590'>you</span> <span m='1159680'>look</span>
  <span m='1159860'>at</span> <span m='1159920'>the</span> <span m='1160010'>numbers</span>
  <span m='1160370'>here,</span> <span m='1160970'>a</span> <span m='1161060'>lot</span>
  <span m='1161330'>of</span> <span m='1161390'>them</span> <span m='1161540'>differ</span>
  <span m='1161810'>by</span> <span m='1161960'>plus</span> <span m='1162230'>or</span>
  <span m='1162320'>minus</span> <span m='1162620'>1.</span> <span m='1163540'>These</span>
  <span m='1164000'>all</span> <span m='1164180'>do.</span> <span m='1164690'>But</span>
  <span m='1164870'>then</span> <span m='1165080'>there</span> <span m='1165190'>are</span>
  <span m='1165210'>some</span> <span m='1165560'>big</span> <span m='1165800'>gaps--</span>
  <span m='1166250'>like</span> <span m='1166490'>this</span> <span m='1166850'>has</span>
  <span m='1167030'>a</span> <span m='1167090'>gap</span> <span m='1167330'>of</span>
  <span m='1167420'>3,</span> <span m='1167870'>this</span> <span m='1168060'>has</span>
  <span m='1168260'>a</span> <span m='1168320'>gap</span> <span m='1168590'>of</span>
  <span m='1168710'>2.</span> <span m='1169440'>This</span> <span m='1169580'>is</span>
  <span m='1169730'>plus</span> <span m='1169970'>or</span> <span m='1170030'>minus</span>
  <span m='1170295'>1.</span> </p><p><span m='1171710'>That's</span> <span m='1171920'>almost</span>
  <span m='1172280'>right,</span> <span m='1172850'>and</span> <span m='1173210'>if</span>
  <span m='1173980'>you</span> <span m='1174140'>just</span> <span m='1174320'>stare</span>
  <span m='1174590'>at</span> <span m='1174680'>this</span> <span m='1174980'>idea</span>
  <span m='1175580'>of</span> <span m='1175970'>tree</span> <span m='1176240'>walk</span>
  <span m='1177170'>enough,</span> <span m='1178550'>you'll</span> <span m='1178700'>realize</span>
  <span m='1179180'>a</span> <span m='1179270'>little</span> <span m='1179600'>trick</span>
  <span m='1179900'>to</span> <span m='1180050'>make</span> <span m='1180230'>the</span>
  <span m='1180350'>array</span> <span m='1180560'>a</span> <span m='1180590'>little</span>
  <span m='1180830'>bit</span> <span m='1180980'>bigger,</span> <span m='1182340'>but</span>
  <span m='1183400'>give</span> <span m='1183650'>you</span> <span m='1183770'>plus</span>
  <span m='1184010'>or</span> <span m='1184100'>minus</span> <span m='1184370'>ones.</span>
  <span m='1185360'>If</span> <span m='1185770'>you've</span> <span m='1185870'>done</span>
  <span m='1186020'>a</span> <span m='1186080'>lot</span> <span m='1186200'>of</span>
  <span m='1186260'>tree</span> <span m='1186530'>traversal,</span> <span m='1187120'>this</span>
  <span m='1187300'>will</span> <span m='1187430'>come</span> <span m='1187670'>quite</span>
  <span m='1187850'>naturally.</span> <span m='1190040'>This</span> <span m='1191390'>is</span>
  <span m='1191480'>a</span> <span m='1191570'>depth</span> <span m='1191840'>first</span>
  <span m='1192110'>search.</span> <span m='1193530'>This</span> <span m='1193550'>is</span>
  <span m='1193670'>how</span> <span m='1194060'>the</span> <span m='1194210'>depth</span>
  <span m='1194420'>first</span> <span m='1194660'>search</span> <span m='1194990'>order</span>
  <span m='1195460'>of</span> <span m='1195740'>visiting</span> <span m='1196160'>a</span>
  <span m='1196230'>tree</span> <span m='1196580'>in</span> <span m='1196730'>order.</span>
  <span m='1198210'>This</span> <span m='1198670'>is</span> <span m='1198740'>usually</span>
  <span m='1199010'>called</span> <span m='1199250'>an</span> <span m='1199370'>Eulerian</span>
  <span m='1200060'>tour.</span> <span m='1200660'>The</span> <span m='1200930'>concept</span>
  <span m='1201320'>we'll</span> <span m='1201440'>come</span> <span m='1201650'>back</span>
  <span m='1201890'>to</span> <span m='1202960'>in</span> <span m='1203060'>a</span>
  <span m='1203120'>few</span> <span m='1203330'>lectures.</span> <span m='1204450'>But</span>
  <span m='1204760'>Euler</span> <span m='1205130'>tour</span> <span m='1205400'>just</span>
  <span m='1205610'>means</span> <span m='1205850'>you</span> <span m='1205910'>visit</span>
  <span m='1206210'>every</span> <span m='1206450'>edge</span> <span m='1206630'>twice,</span>
  <span m='1208070'>in</span> <span m='1208190'>this</span> <span m='1208310'>case.</span>
  <span m='1210710'>If</span> <span m='1210860'>you</span> <span m='1210920'>look</span>
  <span m='1211070'>at</span> <span m='1211160'>the</span> <span m='1211280'>node</span>
  <span m='1211610'>visits,</span> <span m='1211865'>I'm</span> <span m='1212120'>visiting</span>
  <span m='1212510'>this</span> <span m='1212660'>node</span> <span m='1212960'>here,</span>
  <span m='1214090'>here,</span> <span m='1214630'>and</span> <span m='1214820'>here,</span>
  <span m='1215240'>three</span> <span m='1215450'>times.</span> <span m='1216590'>But</span>
  <span m='1216770'>it's</span> <span m='1217100'>amortized</span> <span m='1217550'>constant,</span>
  <span m='1218000'>because</span> <span m='1218330'>every</span> <span m='1218570'>edge</span>
  <span m='1218720'>is</span> <span m='1218840'>just</span> <span m='1219110'>visited</span>
  <span m='1219500'>twice.</span> </p><p><span m='1221270'>What</span> <span m='1221420'>I'd</span>
  <span m='1221510'>like</span> <span m='1221660'>to</span> <span m='1221750'>do</span>
  <span m='1221840'>is</span> <span m='1222040'>follow</span> <span m='1222260'>an</span>
  <span m='1222500'>Euler</span> <span m='1222800'>tour</span> <span m='1223790'>and</span>
  <span m='1223910'>then</span> <span m='1224000'>write</span> <span m='1224270'>down</span>
  <span m='1227240'>all</span> <span m='1227540'>the</span> <span m='1227870'>nodes</span>
  <span m='1228170'>that</span> <span m='1228290'>I</span> <span m='1228380'>visit,</span>
  <span m='1229490'>but</span> <span m='1229610'>with</span> <span m='1229790'>repetition.</span>
  <span m='1231710'>So</span> <span m='1231920'>in</span> <span m='1232040'>that</span>
  <span m='1232160'>picture</span> <span m='1234050'>I</span> <span m='1234230'>will</span>
  <span m='1234380'>get</span> <span m='1236540'>0,</span> <span m='1238160'>1,</span>
  <span m='1238940'>2,</span> <span m='1239750'>1.</span> <span m='1241010'>I</span>
  <span m='1241100'>go</span> <span m='1241790'>0,</span> <span m='1242270'>1,</span>
  <span m='1242750'>2,</span> <span m='1243140'>back</span> <span m='1243440'>to</span>
  <span m='1243560'>1,</span> <span m='1244290'>back</span> <span m='1244490'>to</span>
  <span m='1244610'>0,</span> <span m='1247280'>then</span> <span m='1247580'>over</span>
  <span m='1247850'>to</span> <span m='1248000'>the</span> <span m='1248120'>1</span>
  <span m='1248450'>on</span> <span m='1248570'>the</span> <span m='1248660'>right,</span>
  <span m='1249770'>then</span> <span m='1250060'>to</span> <span m='1250350'>the</span>
  <span m='1250740'>2,</span> <span m='1251590'>then</span> <span m='1251810'>to</span>
  <span m='1252010'>the</span> <span m='1252080'>3,</span> <span m='1252740'>then</span>
  <span m='1252890'>back</span> <span m='1253160'>up</span> <span m='1253280'>to</span>
  <span m='1253400'>the</span> <span m='1253520'>2,</span> <span m='1253760'>then</span>
  <span m='1253940'>down</span> <span m='1254120'>to</span> <span m='1254210'>the</span>
  <span m='1254330'>other</span> <span m='1254540'>3,</span> <span m='1255260'>then</span>
  <span m='1255410'>back</span> <span m='1255580'>up</span> <span m='1255740'>to</span>
  <span m='1255830'>the</span> <span m='1255950'>2,</span> <span m='1256220'>back</span>
  <span m='1256480'>up</span> <span m='1256640'>to</span> <span m='1256730'>the</span>
  <span m='1256850'>1,</span> <span m='1257120'>back</span> <span m='1257630'>down</span>
  <span m='1257990'>to</span> <span m='1258110'>the</span> <span m='1258290'>last</span>
  <span m='1259010'>node</span> <span m='1259820'>on</span> <span m='1259910'>the</span>
  <span m='1260000'>right,</span> <span m='1260690'>and</span> <span m='1260780'>back</span>
  <span m='1261080'>up</span> <span m='1261500'>and</span> <span m='1261590'>back</span>
  <span m='1261890'>up.</span> </p><p><span m='1263360'>OK.</span> <span m='1263540'>This</span>
  <span m='1263750'>is</span> <span m='1263930'>what</span> <span m='1264110'>we</span>
  <span m='1264230'>call</span> <span m='1264960'>Euler</span> <span m='1265250'>tour.</span>
  <span m='1266300'>So</span> <span m='1266470'>multiple</span> <span m='1266870'>visits--</span>
  <span m='1267290'>for</span> <span m='1267380'>example,</span> <span m='1267800'>here's</span>
  <span m='1268130'>all</span> <span m='1268250'>the</span> <span m='1268340'>places</span>
  <span m='1268760'>that</span> <span m='1268910'>the</span> <span m='1269030'>root</span>
  <span m='1269810'>is</span> <span m='1269960'>visited.</span> <span m='1271670'>Here's</span>
  <span m='1273200'>all</span> <span m='1273410'>the</span> <span m='1273530'>places</span>
  <span m='1273980'>that</span> <span m='1274160'>this</span> <span m='1274340'>node</span>
  <span m='1274580'>is</span> <span m='1274730'>visited,</span> <span m='1276050'>then</span>
  <span m='1276890'>this</span> <span m='1277100'>node</span> <span m='1277460'>is</span>
  <span m='1277610'>visited</span> <span m='1278570'>3</span> <span m='1278810'>times.</span>
  <span m='1280430'>It's</span> <span m='1280580'>going</span> <span m='1280710'>to</span>
  <span m='1280790'>be</span> <span m='1280880'>visited</span> <span m='1281240'>once</span>
  <span m='1281480'>per</span> <span m='1281720'>incident</span> <span m='1282080'>edge.</span>
  <span m='1283890'>I</span> <span m='1284070'>think</span> <span m='1284300'>you</span>
  <span m='1284390'>get</span> <span m='1285410'>the</span> <span m='1285500'>pattern.</span>
  <span m='1286840'>I'm</span> <span m='1286910'>just</span> <span m='1287060'>going</span>
  <span m='1287180'>to</span> <span m='1287240'>store</span> <span m='1287510'>this.</span>
  <span m='1288680'>And</span> <span m='1289280'>what</span> <span m='1289460'>else</span>
  <span m='1289610'>am</span> <span m='1289700'>I</span> <span m='1289750'>going</span>
  <span m='1289830'>to</span> <span m='1289940'>do?</span> <span m='1291020'>Let's</span>
  <span m='1291140'>see.</span> <span m='1291410'>Each</span> <span m='1291770'>node</span>
  <span m='1297110'>in</span> <span m='1297260'>the</span> <span m='1297350'>tree</span>
  <span m='1298470'>stores,</span> <span m='1301340'>let's</span> <span m='1301460'>say,</span>
  <span m='1301610'>the</span> <span m='1301730'>first</span> <span m='1303440'>visit</span>
  <span m='1303860'>in</span> <span m='1304010'>the</span> <span m='1304130'>array.</span>
  <span m='1305450'>Pretty</span> <span m='1305690'>sure</span> <span m='1305870'>this</span>
  <span m='1306020'>is</span> <span m='1306140'>enough.</span> <span m='1307160'>You</span>
  <span m='1307220'>could</span> <span m='1307520'>maybe</span> <span m='1307760'>store</span>
  <span m='1307970'>the</span> <span m='1308060'>last</span> <span m='1308330'>visit</span>
  <span m='1308570'>as</span> <span m='1308690'>well.</span> <span m='1308960'>We</span>
  <span m='1309080'>can</span> <span m='1309200'>only</span> <span m='1309410'>store</span>
  <span m='1309590'>a</span> <span m='1309620'>constant</span> <span m='1309980'>number</span>
  <span m='1310190'>of</span> <span m='1310280'>things.</span> </p><p><span m='1311790'>And</span>
  <span m='1314210'>I</span> <span m='1314300'>guess</span> <span m='1314630'>each</span>
  <span m='1318170'>array</span> <span m='1318500'>item</span> <span m='1323150'>stores</span>
  <span m='1323600'>a</span> <span m='1323660'>pointer</span> <span m='1324500'>to</span>
  <span m='1324710'>the</span> <span m='1324800'>corresponding</span> <span m='1325430'>node</span>
  <span m='1325670'>in</span> <span m='1325760'>the</span> <span m='1325850'>tree.</span>
  <span m='1332590'>OK.</span> <span m='1332840'>So</span> <span m='1332990'>each</span>
  <span m='1333290'>instance</span> <span m='1333740'>of</span> <span m='1333830'>the</span>
  <span m='1333920'>0</span> <span m='1334430'>stores</span> <span m='1334760'>a</span>
  <span m='1334820'>pointer</span> <span m='1335090'>to</span> <span m='1335210'>the</span>
  <span m='1335300'>root,</span> <span m='1335960'>and</span> <span m='1336080'>so</span>
  <span m='1336290'>on.</span> <span m='1338470'>It's</span> <span m='1338630'>kind</span>
  <span m='1338900'>of</span> <span m='1338960'>what</span> <span m='1339140'>these</span>
  <span m='1339950'>horizontal</span> <span m='1340370'>bars</span> <span m='1340700'>are</span>
  <span m='1340820'>indicating,</span> <span m='1341360'>but</span> <span m='1341660'>those</span>
  <span m='1341870'>aren't</span> <span m='1341990'>actually</span> <span m='1342350'>stored.</span>
  <span m='1343760'>OK.</span> <span m='1344330'>So</span> <span m='1344750'>I</span>
  <span m='1344870'>claim</span> <span m='1345800'>still</span> <span m='1346370'>RMQ</span>
  <span m='1346970'>and</span> <span m='1347070'>here</span> <span m='1347930'>is</span>
  <span m='1348110'>the</span> <span m='1348200'>same</span> <span m='1348740'>as</span>
  <span m='1349340'>LCA</span> <span m='1350480'>over</span> <span m='1350690'>there.</span>
  <span m='1352390'>It's</span> <span m='1352580'>maybe</span> <span m='1352820'>a</span>
  <span m='1352850'>little</span> <span m='1353120'>more</span> <span m='1353270'>subtle,</span>
  <span m='1354770'>but</span> <span m='1354980'>now</span> <span m='1355550'>if</span>
  <span m='1356240'>I</span> <span m='1356300'>want</span> <span m='1356480'>to</span>
  <span m='1356540'>compute</span> <span m='1356870'>the</span> <span m='1356990'>LCA</span>
  <span m='1357380'>of</span> <span m='1357470'>two</span> <span m='1357620'>nodes,</span>
  <span m='1359300'>I</span> <span m='1359510'>look</span> <span m='1359720'>at</span>
  <span m='1359810'>their</span> <span m='1359960'>first</span> <span m='1360350'>occurrences.</span>
  </p><p><span m='1361110'>So</span> <span m='1361220'>let's</span> <span m='1361460'>do--</span>
  <span m='1361900'>I don't</span> <span m='1361980'>know--</span> <span m='1362690'>2</span>
  <span m='1363230'>and</span> <span m='1363650'>3.</span> <span m='1364910'>Here,</span>
  <span m='1365670'>this 2</span> <span m='1365990'>and</span> <span m='1366110'>this</span>
  <span m='1366290'>3.</span> <span m='1366530'>I</span> <span m='1366590'>didn't</span>
  <span m='1366770'>label</span> <span m='1367070'>them,</span> <span m='1367970'>but</span>
  <span m='1368150'>I</span> <span m='1368210'>happen</span> <span m='1368510'>to</span>
  <span m='1368600'>know</span> <span m='1368750'>where</span> <span m='1368870'>they</span>
  <span m='1369020'>are.</span> <span m='1369515'>2</span> <span m='1370010'>is</span>
  <span m='1370160'>here,</span> <span m='1370390'>and</span> <span m='1370470'>it's</span>
  <span m='1370580'>the</span> <span m='1370700'>first</span> <span m='1371030'>3.</span>
  <span m='1374150'>Now</span> <span m='1374330'>here,</span> <span m='1374600'>they</span>
  <span m='1374840'>happen</span> <span m='1375020'>to</span> <span m='1375190'>only</span>
  <span m='1375410'>occur</span> <span m='1375860'>once</span> <span m='1376220'>in</span>
  <span m='1376280'>the</span> <span m='1376400'>tour,</span> <span m='1376700'>so</span>
  <span m='1376850'>it's</span> <span m='1376940'>a</span> <span m='1377000'>little</span>
  <span m='1377210'>clearer.</span> <span m='1377710'>If</span> <span m='1377790'>I</span>
  <span m='1377860'>compute</span> <span m='1378170'>the</span> <span m='1378230'>RMQ,</span>
  <span m='1378740'>I</span> <span m='1378800'>get</span> <span m='1378980'>this</span>
  <span m='1379160'>0,</span> <span m='1379550'>this</span> <span m='1379850'>0,</span>
  <span m='1380590'>as</span> <span m='1380660'>opposed</span> <span m='1380900'>to</span>
  <span m='1380960'>the</span> <span m='1381050'>other</span> <span m='1381200'>0s,</span>
  <span m='1381500'>but</span> <span m='1381620'>this</span> <span m='1381710'>0</span>
  <span m='1382010'>points</span> <span m='1382370'>to</span> <span m='1382550'>the</span>
  <span m='1382670'>root,</span> <span m='1383090'>so</span> <span m='1383270'>I</span>
  <span m='1383360'>get</span> <span m='1383510'>the</span> <span m='1383650'>LCA.</span>
  </p><p><span m='1385400'>Let's</span> <span m='1385640'>do</span> <span m='1385790'>ones</span>
  <span m='1386060'>that</span> <span m='1386180'>do</span> <span m='1386300'>not</span>
  <span m='1386480'>have</span> <span m='1386720'>unique</span> <span m='1386990'>occurrences.</span>
  <span m='1387570'>So</span> <span m='1387650'>like,</span> <span m='1388130'>this</span>
  <span m='1388370'>guy</span> <span m='1388730'>and</span> <span m='1388850'>this</span>
  <span m='1389030'>guy,</span> <span m='1389270'>the</span> <span m='1389390'>first</span>
  <span m='1389720'>1</span> <span m='1390390'>and</span> <span m='1390410'>the</span>
  <span m='1390500'>first</span> <span m='1390770'>2</span> <span m='1391475'>It'd</span>
  <span m='1391850'>be</span> <span m='1392120'>this</span> <span m='1392390'>1</span>
  <span m='1393660'>and</span> <span m='1393680'>this</span> <span m='1393890'>1.</span>
  <span m='1395000'>In</span> <span m='1395090'>fact,</span> <span m='1395430'>I</span>
  <span m='1395530'>think</span> <span m='1395570'>any</span> <span m='1395780'>of</span>
  <span m='1395840'>the</span> <span m='1395930'>2s</span> <span m='1396200'>would</span>
  <span m='1396320'>work.</span> <span m='1396560'>Doesn't</span> <span m='1396800'>really</span>
  <span m='1396980'>matter.</span> <span m='1397700'>Just have</span> <span m='1397910'>to</span>
  <span m='1398000'>pick</span> <span m='1398180'>one</span> <span m='1398330'>of</span>
  <span m='1398390'>them.</span> <span m='1398730'>So</span> <span m='1398840'>I</span>
  <span m='1398900'>picked</span> <span m='1399080'>the</span> <span m='1399170'>leftmost</span>
  <span m='1399560'>one</span> <span m='1399740'>for</span> <span m='1399890'>consistency.</span>
  <span m='1401150'>Then</span> <span m='1402280'>I</span> <span m='1402390'>take</span>
  <span m='1402600'>the</span> <span m='1402690'>RMQ,</span> <span m='1403050'>again</span>
  <span m='1403410'>I</span> <span m='1403480'>get</span> <span m='1403650'>0.</span>
  <span m='1404400'>You</span> <span m='1404460'>can</span> <span m='1404610'>test</span>
  <span m='1404790'>that</span> <span m='1404940'>for</span> <span m='1405060'>all</span>
  <span m='1405210'>of</span> <span m='1405270'>them.</span> <span m='1405960'>I</span>
  <span m='1405990'>think</span> <span m='1406240'>the</span> <span m='1406620'>slightly</span>
  <span m='1406980'>more</span> <span m='1407130'>subtle</span> <span m='1407430'>case
  is</span> <span m='1407790'>when</span> <span m='1408000'>one</span> <span m='1408270'>node</span>
  <span m='1408570'>is</span> <span m='1408690'>an</span> <span m='1408810'>ancestor</span>
  <span m='1409500'>of</span> <span m='1409590'>another.</span> </p><p><span m='1410140'>So</span>
  <span m='1410250'>let's</span> <span m='1410460'>do</span> <span m='1410580'>that,</span>
  <span m='1411180'>1</span> <span m='1411540'>here</span> <span m='1412290'>and</span>
  <span m='1412470'>3</span> <span m='1412770'>there.</span> <span m='1415060'>I</span>
  <span m='1415180'>think</span> <span m='1415350'>here</span> <span m='1415530'>you</span>
  <span m='1415650'>do</span> <span m='1415770'>need</span> <span m='1415920'>to</span>
  <span m='1416040'>be</span> <span m='1416190'>leftmost</span> <span m='1416730'>or</span>
  <span m='1416880'>rightmost,</span> <span m='1417390'>consistently.</span> <span
  m='1418920'>So</span> <span m='1419100'>I</span> <span m='1419160'>take</span> <span
  m='1419460'>the</span> <span m='1419710'>1</span> <span m='1420700'>and</span> <span
  m='1420810'>I</span> <span m='1420900'>take</span> <span m='1421110'>the</span>
  <span m='1421200'>second</span> <span m='1421710'>3.</span> <span m='1423600'>OK.</span>
  <span m='1423830'>I</span> <span m='1424080'>take</span> <span m='1424350'>the</span>
  <span m='1424530'>RMQ</span> <span m='1425010'>of</span> <span m='1425100'>that,</span>
  <span m='1425370'>I</span> <span m='1425460'>get</span> <span m='1425640'>1</span>
  <span m='1426570'>which</span> <span m='1426810'>is</span> <span m='1427080'>the</span>
  <span m='1427230'>higher</span> <span m='1427620'>of</span> <span m='1427740'>the</span>
  <span m='1427860'>two.</span> <span m='1429220'>OK.</span> <span m='1429320'>So</span>
  <span m='1429590'>it</span> <span m='1429870'>seems</span> <span m='1430110'>to</span>
  <span m='1430200'>work.</span> <span m='1431100'>Actually,</span> <span m='1431370'>I</span>
  <span m='1431430'>think</span> <span m='1431610'>it</span> <span m='1431670'>would</span>
  <span m='1431790'>work</span> <span m='1431970'>no</span> <span m='1432060'>matter</span>
  <span m='1432300'>which</span> <span m='1432990'>guy</span> <span m='1433140'>you</span>
  <span m='1433230'>pick.</span> <span m='1433500'>I</span> <span m='1433590'>just</span>
  <span m='1433860'>picked</span> <span m='1434040'>the</span> <span m='1434160'>first</span>
  <span m='1434400'>one.</span> </p><p><span m='1436390'>OK,</span> <span m='1436800'>no</span>
  <span m='1436950'>big</span> <span m='1437130'>deal.</span> <span m='1439110'>You're</span>
  <span m='1439260'>not</span> <span m='1439380'>going</span> <span m='1439500'>to</span>
  <span m='1439560'>see</span> <span m='1439710'>why</span> <span m='1439920'>this</span>
  <span m='1440070'>is</span> <span m='1440160'>useful</span> <span m='1440490'>for</span>
  <span m='1440670'>a</span> <span m='1440700'>little</span> <span m='1440910'>bit</span>
  <span m='1441330'>until</span> <span m='1441600'>step</span> <span m='1442320'>4</span>
  <span m='1443180'>or</span> <span m='1443220'>something,</span> <span m='1443640'>but</span>
  <span m='1444330'>we've</span> <span m='1444570'>slightly</span> <span m='1445080'>simplified</span>
  <span m='1445560'>our</span> <span m='1445650'>problem</span> <span m='1446010'>to</span>
  <span m='1446130'>this</span> <span m='1446280'>plus</span> <span m='1446520'>or</span>
  <span m='1446610'>minus</span> <span m='1446880'>1</span> <span m='1447270'>RMQ.</span>
  <span m='1448110'>Otherwise</span> <span m='1448740'>identical</span> <span m='1449730'>to</span>
  <span m='1449850'>this</span> <span m='1450340'>in-order</span> <span m='1450690'>traversal.</span>
  <span m='1451300'>So</span> <span m='1451500'>not</span> <span m='1451650'>a</span>
  <span m='1451710'>big</span> <span m='1451860'>deal,</span> <span m='1452760'>but</span>
  <span m='1453260'>we'll</span> <span m='1453390'>need</span> <span m='1453570'>it</span>
  <span m='1453660'>later.</span> <span m='1456730'>OK.</span> <span m='1474560'>That
  was</span> <span m='1474780'>a</span> <span m='1474840'>reduction.</span> <span
  m='1475350'>Next,</span> <span m='1475560'>we're</span> <span m='1475650'>finally</span>
  <span m='1476100'>going</span> <span m='1476220'>to</span> <span m='1476280'>actually</span>
  <span m='1476580'>solve</span> <span m='1476840'>something.</span> <span m='1478140'>I'm</span>
  <span m='1478200'>going</span> <span m='1478320'>to</span> <span m='1478380'>do</span>
  <span m='1478630'>constant</span> <span m='1479220'>time,</span> <span m='1480790'>n
  log</span> <span m='1481290'>n</span> <span m='1481470'>space,</span> <span m='1485260'>RMQ.</span>
  <span m='1487920'>This</span> <span m='1488160'>data</span> <span m='1488370'>structure</span>
  <span m='1488730'>will</span> <span m='1488880'>not</span> <span m='1489240'>require</span>
  <span m='1489750'>plus</span> <span m='1490020'>or</span> <span m='1490110'>minus
  1</span> <span m='1490380'>RMQ.</span> <span m='1490910'>It</span> <span m='1490980'>works</span>
  <span m='1491160'>for</span> <span m='1491310'>any</span> <span m='1491520'>RMQ.</span>
  <span m='1492660'>It's</span> <span m='1492780'>actually</span> <span m='1493020'>a</span>
  <span m='1493050'>very</span> <span m='1493230'>simple</span> <span m='1493560'>idea,</span>
  <span m='1494560'>and</span> <span m='1494670'>it's</span> <span m='1494820'>almost</span>
  <span m='1495210'>what</span> <span m='1495360'>we</span> <span m='1495450'>need.</span>
  <span m='1495790'>But</span> <span m='1495870'>we're</span> <span m='1496020'>going</span>
  <span m='1496170'>to</span> <span m='1496230'>have</span> <span m='1496380'>to</span>
  <span m='1496470'>get</span> <span m='1496620'>rid</span> <span m='1496710'>of</span>
  <span m='1496770'>this</span> <span m='1496920'>log</span> <span m='1497160'>factor.</span>
  <span m='1497500'>That</span> <span m='1497670'>will</span> <span m='1497820'>be</span>
  <span m='1497970'>step</span> <span m='1498300'>3.</span> </p><p><span m='1500050'>OK,</span>
  <span m='1500460'>so</span> <span m='1500640'>here's</span> <span m='1500850'>the</span>
  <span m='1500940'>idea.</span> <span m='1501240'>You've</span> <span m='1501420'>got</span>
  <span m='1501660'>an</span> <span m='1501780'>array.</span> <span m='1504000'>And</span>
  <span m='1504150'>now</span> <span m='1504330'>someone</span> <span m='1504690'>gives</span>
  <span m='1504870'>you</span> <span m='1505200'>an</span> <span m='1505320'>arbitrary</span>
  <span m='1505920'>interval</span> <span m='1506670'>from</span> <span m='1506970'>here</span>
  <span m='1508230'>to</span> <span m='1508470'>here.</span> <span m='1511260'>Ideally,</span>
  <span m='1511710'>I</span> <span m='1511800'>just</span> <span m='1511980'>store</span>
  <span m='1512640'>the</span> <span m='1512820'>mins</span> <span m='1513180'>for</span>
  <span m='1513330'>every</span> <span m='1513600'>possible</span> <span m='1513990'>interval,</span>
  <span m='1514290'>but</span> <span m='1514410'>there's</span> <span m='1514560'>n</span>
  <span m='1514740'>squared</span> <span m='1515070'>intervals.</span> <span m='1515955'>So</span>
  <span m='1516270'>instead,</span> <span m='1516760'>what</span> <span m='1516810'>I'm</span>
  <span m='1516870'>going</span> <span m='1516990'>to</span> <span m='1517080'>do</span>
  <span m='1518100'>is</span> <span m='1519090'>store</span> <span m='1519600'>the</span>
  <span m='1519750'>answer</span> <span m='1520830'>not</span> <span m='1520950'>for</span>
  <span m='1521130'>all</span> <span m='1521400'>the</span> <span m='1521520'>intervals,</span>
  <span m='1522630'>but</span> <span m='1522930'>for</span> <span m='1523500'>all</span>
  <span m='1523830'>intervals</span> <span m='1524460'>of</span> <span m='1524610'>length</span>
  <span m='1524880'>of</span> <span m='1524970'>power</span> <span m='1525300'>of</span>
  <span m='1525420'>2.</span> <span m='1527286'>It's a</span> <span m='1527700'>trick</span>
  <span m='1527940'>you've</span> <span m='1528060'>probably</span> <span m='1528570'>seen</span>
  <span m='1529020'>before.</span> </p><p><span m='1532500'>This</span> <span m='1532650'>is</span>
  <span m='1533430'>the</span> <span m='1533490'>easy</span> <span m='1533850'>thing</span>
  <span m='1534090'>to</span> <span m='1534180'>do.</span> <span m='1534550'>And</span>
  <span m='1534650'>then</span> <span m='1534690'>the</span> <span m='1534840'>interesting</span>
  <span m='1535290'>thing</span> <span m='1535440'>is</span> <span m='1535560'>how</span>
  <span m='1535650'>you</span> <span m='1535800'>make</span> <span m='1536010'>it</span>
  <span m='1536160'>actually</span> <span m='1536490'>get</span> <span m='1536670'>down</span>
  <span m='1536830'>to</span> <span m='1536890'>linear</span> <span m='1537490'>space.</span>
  <span m='1540570'>Length,</span> <span m='1543360'>power</span> <span m='1543810'>of</span>
  <span m='1543960'>2.</span> <span m='1546860'>OK.</span> <span m='1547040'>There</span>
  <span m='1547160'>are</span> <span m='1547230'>only</span> <span m='1547710'>log</span>
  <span m='1548150'>n</span> <span m='1548350'>possible</span> <span m='1548880'>powers</span>
  <span m='1549240'>of</span> <span m='1549330'>2.</span> <span m='1550230'>There's</span>
  <span m='1550380'>still</span> <span m='1550640'>n</span> <span m='1550890'>different</span>
  <span m='1551160'>start</span> <span m='1551520'>points</span> <span m='1551880'>for</span>
  <span m='1552000'>those</span> <span m='1552210'>intervals,</span> <span m='1553200'>so</span>
  <span m='1553470'>total</span> <span m='1553800'>number</span> <span m='1554010'>of</span>
  <span m='1554100'>intervals</span> <span m='1554550'>is</span> <span m='1554680'>n</span>
  <span m='1554970'>log n.</span> <span m='1555720'>So</span> <span m='1555930'>this</span>
  <span m='1556110'>is</span> <span m='1556200'>n log</span> <span m='1556590'>n</span>
  <span m='1556710'>space,</span> <span m='1557010'>because</span> <span m='1557160'>I'm</span>
  <span m='1557260'>storing</span> <span m='1558900'>an</span> <span m='1558960'>index</span>
  <span m='1559410'>for</span> <span m='1559530'>each</span> <span m='1559710'>of</span>
  <span m='1559770'>them.</span> <span m='1562520'>OK.</span> <span m='1564370'>And</span>
  <span m='1564550'>then</span> <span m='1564850'>if</span> <span m='1565060'>I</span>
  <span m='1565150'>have</span> <span m='1565330'>an</span> <span m='1565450'>arbitrary</span>
  <span m='1566090'>query,</span> <span m='1566890'>the</span> <span m='1566980'>point</span>
  <span m='1567280'>is--</span> <span m='1567520'>let's</span> <span m='1567730'>call</span>
  <span m='1567970'>it</span> <span m='1568060'>length</span> <span m='1568410'>k--</span>
  <span m='1570280'>then</span> <span m='1570490'>I</span> <span m='1570580'>can</span>
  <span m='1570760'>cover</span> <span m='1571180'>it</span> <span m='1572050'>by</span>
  <span m='1572290'>two</span> <span m='1572620'>intervals</span> <span m='1574300'>of</span>
  <span m='1574540'>length</span> <span m='1575370'>a</span> <span m='1575530'>power</span>
  <span m='1575860'>of</span> <span m='1575950'>2.</span> <span m='1576790'>They</span>
  <span m='1576880'>will</span> <span m='1577000'>be</span> <span m='1577120'>the</span>
  <span m='1577240'>same</span> <span m='1577510'>length.</span> <span m='1578500'>They</span>
  <span m='1578680'>will</span> <span m='1578800'>be</span> <span m='1578980'>length</span>
  <span m='1580080'>2</span> <span m='1580520'>to</span> <span m='1580860'>the</span>
  <span m='1580960'>floor</span> <span m='1581980'>of</span> <span m='1582130'>log</span>
  <span m='1582410'>k,</span> <span m='1583060'>the</span> <span m='1583180'>next</span>
  <span m='1583540'>smaller</span> <span m='1584110'>power</span> <span m='1584500'>of</span>
  <span m='1584620'>2</span> <span m='1585160'>below</span> <span m='1585490'>k.</span>
  </p><p><span m='1586180'>Maybe</span> <span m='1586450'>k</span> <span m='1586600'>is</span>
  <span m='1586690'>a</span> <span m='1586750'>power</span> <span m='1586960'>of</span>
  <span m='1587080'>2,</span> <span m='1587290'>in</span> <span m='1587380'>which</span>
  <span m='1587560'>case,</span> <span m='1587800'>it's</span> <span m='1587890'>just</span>
  <span m='1588070'>one</span> <span m='1588310'>interval</span> <span m='1588670'>or</span>
  <span m='1588910'>two</span> <span m='1589270'>equal</span> <span m='1589600'>intervals.</span>
  <span m='1590800'>But</span> <span m='1590920'>in</span> <span m='1591010'>general,</span>
  <span m='1591280'>you</span> <span m='1591370'>just</span> <span m='1591490'>take</span>
  <span m='1591930'>the</span> <span m='1592110'>next</span> <span m='1592300'>smaller</span>
  <span m='1592600'>power</span> <span m='1592840'>of</span> <span m='1592930'>2.</span>
  <span m='1593500'>That</span> <span m='1593620'>will</span> <span m='1593740'>cover</span>
  <span m='1594790'>more</span> <span m='1595030'>than</span> <span m='1595180'>half</span>
  <span m='1595540'>of</span> <span m='1595660'>the</span> <span m='1595750'>thing,</span>
  <span m='1596560'>of</span> <span m='1596650'>the</span> <span m='1596770'>interval.</span>
  <span m='1597700'>And</span> <span m='1597820'>so</span> <span m='1598600'>you</span>
  <span m='1598780'>have</span> <span m='1598960'>one</span> <span m='1599170'>that's</span>
  <span m='1599290'>left</span> <span m='1599500'>aligned,</span> <span m='1599800'>one</span>
  <span m='1599950'>that's</span> <span m='1600100'>right</span> <span m='1600250'>aligned.</span>
  <span m='1600520'>Together,</span> <span m='1600880'>those</span> <span m='1601030'>will</span>
  <span m='1601120'>cover</span> <span m='1601420'>everything.</span> <span m='1602320'>And</span>
  <span m='1602470'>because</span> <span m='1603280'>the</span> <span m='1603540'>min</span>
  <span m='1603850'>operation</span> <span m='1604480'>has</span> <span m='1604720'>this</span>
  <span m='1604930'>nifty</span> <span m='1605260'>feature</span> <span m='1605680'>that</span>
  <span m='1606340'>you</span> <span m='1606490'>can</span> <span m='1606640'>take</span>
  <span m='1606850'>the</span> <span m='1606970'>min</span> <span m='1607120'>of</span>
  <span m='1607210'>all</span> <span m='1607360'>these,</span> <span m='1607660'>min</span>
  <span m='1607810'>of</span> <span m='1607900'>all</span> <span m='1608020'>these,</span>
  <span m='1608200'>take</span> <span m='1608380'>the</span> <span m='1608500'>min</span>
  <span m='1608650'>of</span> <span m='1608770'>the</span> <span m='1608860'>2.</span>
  <span m='1609490'>You</span> <span m='1609610'>will</span> <span m='1609700'>get</span>
  <span m='1609850'>the</span> <span m='1610010'>min</span> <span m='1610120'>overall.</span>
  <span m='1611530'>It</span> <span m='1611700'>doesn't</span> <span m='1612010'>hurt</span>
  <span m='1612310'>to</span> <span m='1612460'>have</span> <span m='1612880'>duplicate</span>
  <span m='1613300'>entries.</span> <span m='1614090'>That's</span> <span m='1614260'>kind</span>
  <span m='1614410'>of</span> <span m='1614470'>an</span> <span m='1614530'>important</span>
  <span m='1615970'>property</span> <span m='1616300'>of</span> <span m='1616390'>min.</span>
  <span m='1618650'>It</span> <span m='1618730'>holds</span> <span m='1618910'>for</span>
  <span m='1619030'>other</span> <span m='1619390'>properties</span> <span m='1619780'>too,</span>
  <span m='1619930'>like</span> <span m='1620290'>max,</span> <span m='1621700'>but</span>
  <span m='1621880'>not</span> <span m='1622030'>everything.</span> </p><p><span m='1622840'>Then</span>
  <span m='1623410'>boom,</span> <span m='1623920'>we've</span> <span m='1624160'>solved</span>
  <span m='1624520'>RMQ.</span> <span m='1625240'>I</span> <span m='1625300'>think</span>
  <span m='1625440'>it's</span> <span m='1625570'>clear.</span> <span m='1625810'>You</span>
  <span m='1625900'>do</span> <span m='1626170'>two</span> <span m='1626410'>queries,</span>
  <span m='1627370'>take</span> <span m='1627580'>the</span> <span m='1627670'>min</span>
  <span m='1627880'>of</span> <span m='1628000'>the</span> <span m='1628090'>two--</span>
  <span m='1628570'>actually,</span> <span m='1629050'>you</span> <span m='1629170'>have</span>
  <span m='1629350'>to</span> <span m='1629470'>restore</span> <span m='1629770'>the</span>
  <span m='1629920'>arg mins.</span> <span m='1630305'>So</span> <span m='1630690'>it's</span>
  <span m='1630790'>a</span> <span m='1630890'>little</span> <span m='1630910'>more</span>
  <span m='1631060'>work,</span> <span m='1631410'>but</span> <span m='1631970'>constant</span>
  <span m='1632235'>time.</span> <span m='1634660'>Cool.</span> <span m='1635420'>That</span>
  <span m='1635480'>was</span> <span m='1635630'>easy.</span> <span m='1642070'>Leave</span>
  <span m='1642400'>LCA</span> <span m='1642820'>up</span> <span m='1642970'>there.</span>
  <span m='1650180'>OK.</span> <span m='1650790'>So</span> <span m='1651000'>we're</span>
  <span m='1651120'>almost</span> <span m='1651510'>there,</span> <span m='1651820'>right.</span>
  <span m='1652020'>Just</span> <span m='1652300'>a</span> <span m='1652350'>log</span>
  <span m='1652650'>factor</span> <span m='1653070'>off.</span> <span m='1654420'>So</span>
  <span m='1655560'>what</span> <span m='1655740'>technique</span> <span m='1656160'>do</span>
  <span m='1656370'>we</span> <span m='1656490'>have</span> <span m='1656910'>for</span>
  <span m='1657300'>shaving</span> <span m='1657690'>log</span> <span m='1657900'>factors?</span>
  </p><p><span m='1660880'>Indirection,</span> <span m='1661660'>yeah,</span> <span
  m='1662760'>our</span> <span m='1662880'>good</span> <span m='1663120'>friend</span>
  <span m='1663600'>indirection.</span> <span m='1667470'>Indirection</span> <span
  m='1668100'>comes</span> <span m='1668370'>to</span> <span m='1668430'>our</span>
  <span m='1668490'>rescue</span> <span m='1668910'>yet</span> <span m='1669120'>again,</span>
  <span m='1670140'>but</span> <span m='1670320'>we</span> <span m='1670410'>won't</span>
  <span m='1670590'>be</span> <span m='1670710'>done.</span> <span m='1672150'>The</span>
  <span m='1672210'>idea</span> <span m='1672420'>is,</span> <span m='1672670'>well,</span>
  <span m='1673050'>want</span> <span m='1673320'>to</span> <span m='1673440'>remove</span>
  <span m='1673740'>a</span> <span m='1673770'>log</span> <span m='1673980'>factor.</span>
  <span m='1674280'>Before</span> <span m='1674640'>we</span> <span m='1675090'>removed</span>
  <span m='1675390'>log</span> <span m='1675600'>factors</span> <span m='1675990'>from</span>
  <span m='1676200'>time,</span> <span m='1677010'>but</span> <span m='1677190'>there's</span>
  <span m='1677340'>no</span> <span m='1677490'>real</span> <span m='1677700'>time</span>
  <span m='1678030'>here,</span> <span m='1678270'>right.</span> <span m='1678390'>Everything's</span>
  <span m='1678730'>constant</span> <span m='1679170'>time.</span> <span m='1679890'>But</span>
  <span m='1680400'>we</span> <span m='1680520'>can</span> <span m='1680640'>use</span>
  <span m='1680820'>indirection</span> <span m='1681300'>to</span> <span m='1681420'>shave
  a</span> <span m='1681730'>log</span> <span m='1681960'>factor</span> <span m='1682260'>in</span>
  <span m='1682350'>space,</span> <span m='1682770'>too.</span> <span m='1683790'>Let's</span>
  <span m='1684090'>just</span> <span m='1685230'>divide.</span> <span m='1687120'>So</span>
  <span m='1687270'>this</span> <span m='1687480'>is</span> <span m='1687570'>again</span>
  <span m='1687810'>for</span> <span m='1689930'>RMQ.</span> <span m='1691980'>So</span>
  <span m='1692190'>I</span> <span m='1692250'>have</span> <span m='1692370'>an</span>
  <span m='1692460'>array,</span> <span m='1693330'>I'm</span> <span m='1693430'>going</span>
  <span m='1693530'>to</span> <span m='1693630'>divide</span> <span m='1693930'>the</span>
  <span m='1694050'>array</span> <span m='1694830'>into</span> <span m='1695160'>groups</span>
  <span m='1698010'>of</span> <span m='1698220'>size,</span> <span m='1700270'>I</span>
  <span m='1700320'>believe</span> <span m='1700860'>1/2</span> <span m='1701230'>log
  n</span> <span m='1702880'>would</span> <span m='1703130'>be</span> <span m='1703260'>the</span>
  <span m='1703350'>right</span> <span m='1703620'>magic</span> <span m='1703950'>number.</span>
  <span m='1704940'>It's</span> <span m='1705060'>going</span> <span m='1705150'>to</span>
  <span m='1705240'>be</span> <span m='1705330'>theta</span> <span m='1705600'>log</span>
  <span m='1705870'>n,</span> <span m='1706020'>but</span> <span m='1706170'>I</span>
  <span m='1706350'>need</span> <span m='1706530'>a</span> <span m='1706590'>specific</span>
  <span m='1707130'>constant</span> <span m='1707580'>for</span> <span m='1707760'>step</span>
  <span m='1708000'>4.</span> </p><p><span m='1710910'>So</span> <span m='1712050'>what</span>
  <span m='1712170'>does</span> <span m='1712290'>that</span> <span m='1712470'>mean?</span>
  <span m='1713610'>I</span> <span m='1713670'>have</span> <span m='1713940'>the</span>
  <span m='1714030'>first</span> <span m='1714740'>1/2</span> <span m='1715070'>log</span>
  <span m='1715310'>n</span> <span m='1715440'>entries</span> <span m='1716880'>in</span>
  <span m='1716970'>the</span> <span m='1717090'>array.</span> <span m='1717820'>Then</span>
  <span m='1717960'>I</span> <span m='1718050'>have</span> <span m='1718380'>the</span>
  <span m='1718470'>next</span> <span m='1718740'>1/2</span> <span m='1718960'>log</span>
  <span m='1719400'>entries,</span> <span m='1721530'>and</span> <span m='1723060'>then
  I</span> <span m='1723450'>have</span> <span m='1723870'>the</span> <span m='1723960'>last</span>
  <span m='1724950'>1/2</span> <span m='1725130'>log</span> <span m='1725340'>n</span>
  <span m='1725460'>entries.</span> <span m='1727200'>OK,</span> <span m='1727320'>that's</span>
  <span m='1727500'>easy</span> <span m='1727740'>enough.</span> <span m='1730560'>But</span>
  <span m='1730680'>now</span> <span m='1730830'>I'd</span> <span m='1730920'>like</span>
  <span m='1731070'>to</span> <span m='1731160'>tie</span> <span m='1731470'>all</span>
  <span m='1731680'>these</span> <span m='1731820'>structures</span> <span m='1732210'>together.</span>
  <span m='1733210'>A</span> <span m='1733400'>natural</span> <span m='1733680'>way</span>
  <span m='1733770'>to</span> <span m='1733860'>do</span> <span m='1733980'>that</span>
  <span m='1734280'>is</span> <span m='1734430'>with</span> <span m='1734600'>a</span>
  <span m='1734670'>big</span> <span m='1734820'>structure</span> <span m='1735180'>on</span>
  <span m='1735300'>top</span> <span m='1737040'>of</span> <span m='1737190'>size,</span>
  <span m='1738420'>n</span> <span m='1738570'>over log</span> <span m='1738900'>n,</span>
  <span m='1740280'>I</span> <span m='1740370'>guess</span> <span m='1740610'>with</span>
  <span m='1740760'>a</span> <span m='1740850'>factor</span> <span m='1741210'>2</span>
  <span m='1741540'>out</span> <span m='1741690'>here.</span> <span m='1743670'>n</span>
  <span m='1743880'>over</span> <span m='1744210'>1/2</span> <span m='1744570'>log
  n.</span> <span m='1747210'>How</span> <span m='1747330'>do</span> <span m='1747420'>I</span>
  <span m='1747510'>do</span> <span m='1747660'>that?</span> <span m='1748240'>Well,</span>
  <span m='1748430'>this</span> <span m='1748570'>is</span> <span m='1748680'>an</span>
  <span m='1748770'>RMQ</span> <span m='1749220'>problem,</span> <span m='1749850'>so</span>
  <span m='1750100'>the</span> <span m='1750150'>natural</span> <span m='1750450'>thing</span>
  <span m='1750630'>to</span> <span m='1750720'>do</span> <span m='1750840'>is</span>
  <span m='1750900'>just</span> <span m='1751050'>take</span> <span m='1751260'>the</span>
  <span m='1751380'>min</span> <span m='1752060'>of</span> <span m='1752280'>everything</span>
  <span m='1752640'>here.</span> <span m='1753400'>So</span> <span m='1753870'>the</span>
  <span m='1753960'>red</span> <span m='1754170'>here</span> <span m='1754380'>is</span>
  <span m='1754470'>going</span> <span m='1754620'>to</span> <span m='1754680'>denote</span>
  <span m='1755100'>taking</span> <span m='1755430'>the</span> <span m='1755550'>min,</span>
  <span m='1756480'>and</span> <span m='1756660'>take</span> <span m='1756870'>that--</span>
  <span m='1757310'>the</span> <span m='1757460'>one</span> <span m='1757740'>item</span>
  <span m='1758010'>that</span> <span m='1758100'>results</span> <span m='1758430'>by</span>
  <span m='1758580'>taking</span> <span m='1758880'>the</span> <span m='1758970'>min</span>
  <span m='1759150'>in</span> <span m='1759240'>that</span> <span m='1759390'>group,</span>
  <span m='1760200'>and</span> <span m='1760380'>promoting</span> <span m='1760920'>it</span>
  <span m='1761010'>to</span> <span m='1761130'>the</span> <span m='1761250'>next</span>
  <span m='1761460'>level.</span> </p><p><span m='1762520'>This</span> <span m='1762570'>is</span>
  <span m='1762690'>a</span> <span m='1762750'>static</span> <span m='1763110'>thing</span>
  <span m='1763350'>we</span> <span m='1763440'>do</span> <span m='1763590'>ahead</span>
  <span m='1763770'>of</span> <span m='1763860'>time.</span> <span m='1765250'>Now</span>
  <span m='1765570'>if</span> <span m='1765720'>I'm</span> <span m='1765840'>given</span>
  <span m='1766080'>a</span> <span m='1766140'>query,</span> <span m='1767220'>like</span>
  <span m='1767460'>say,</span> <span m='1768120'>this</span> <span m='1768540'>interval,</span>
  <span m='1770680'>what</span> <span m='1770880'>I</span> <span m='1770940'>need</span>
  <span m='1771090'>to</span> <span m='1771210'>do</span> <span m='1771390'>is</span>
  <span m='1771540'>first</span> <span m='1771900'>compute</span> <span m='1772410'>the</span>
  <span m='1772590'>min</span> <span m='1773760'>in</span> <span m='1773940'>this</span>
  <span m='1774180'>range</span> <span m='1774600'>within</span> <span m='1775040'>a</span>
  <span m='1775260'>bottom</span> <span m='1775680'>structure.</span> <span m='1777300'>Maybe</span>
  <span m='1777600'>also</span> <span m='1777870'>compute</span> <span m='1778170'>the</span>
  <span m='1778260'>min</span> <span m='1778440'>within</span> <span m='1778710'>this</span>
  <span m='1778890'>range,</span> <span m='1779190'>the</span> <span m='1779280'>last</span>
  <span m='1779520'>bottom</span> <span m='1779820'>structure,</span> <span m='1780210'>and</span>
  <span m='1780300'>then</span> <span m='1780990'>these</span> <span m='1781290'>guys</span>
  <span m='1781590'>are</span> <span m='1781680'>all</span> <span m='1781860'>taken</span>
  <span m='1782160'>in</span> <span m='1782250'>entirety.</span> <span m='1782820'>So</span>
  <span m='1782970'>I</span> <span m='1783030'>can</span> <span m='1783150'>just</span>
  <span m='1783300'>take</span> <span m='1783480'>the</span> <span m='1783570'>corresponding</span>
  <span m='1784320'>interval</span> <span m='1784680'>up</span> <span m='1784890'>here</span>
  <span m='1786330'>and</span> <span m='1786480'>that</span> <span m='1786630'>will</span>
  <span m='1786750'>give</span> <span m='1786990'>me</span> <span m='1787230'>simultaneously</span>
  <span m='1787950'>the</span> <span m='1788070'>mins</span> <span m='1788370'>of</span>
  <span m='1788460'>everything</span> <span m='1788820'>below.</span> <span m='1789660'>So</span>
  <span m='1789810'>now</span> <span m='1790050'>a</span> <span m='1790110'>query</span>
  <span m='1792360'>is</span> <span m='1792540'>going</span> <span m='1792810'>to</span>
  <span m='1792960'>be</span> <span m='1794040'>the</span> <span m='1794160'>min</span>
  <span m='1795510'>of</span> <span m='1797370'>two</span> <span m='1797580'>bottoms</span>
  <span m='1801420'>and</span> <span m='1801570'>one</span> <span m='1801840'>top.</span>
  </p><p><span m='1803550'>In</span> <span m='1803670'>other</span> <span m='1803820'>words,</span>
  <span m='1803970'>I</span> <span m='1804060'>do</span> <span m='1804210'>one</span>
  <span m='1804520'>top</span> <span m='1804785'>RMQ</span> <span m='1805500'>query</span>
  <span m='1806040'>for</span> <span m='1806190'>everything</span> <span m='1806550'>between,</span>
  <span m='1807840'>strictly</span> <span m='1808290'>between</span> <span m='1808680'>the</span>
  <span m='1808770'>two</span> <span m='1808980'>ends.</span> <span m='1809760'>Then</span>
  <span m='1809910'>I</span> <span m='1809970'>do</span> <span m='1810150'>a</span>
  <span m='1810210'>bottom</span> <span m='1810630'>query</span> <span m='1810990'>for</span>
  <span m='1811200'>the</span> <span m='1811410'>one</span> <span m='1811650'>end,
  a</span> <span m='1811950'>bottom</span> <span m='1812280'>query</span> <span m='1812520'>for</span>
  <span m='1812640'>the</span> <span m='1812760'>other</span> <span m='1813000'>end.</span>
  <span m='1813720'>Take</span> <span m='1813930'>the</span> <span m='1814050'>min</span>
  <span m='1814380'>of</span> <span m='1814500'>all</span> <span m='1814650'>those</span>
  <span m='1814860'>values</span> <span m='1815340'>and</span> <span m='1815430'>really,</span>
  <span m='1815660'>it's</span> <span m='1815730'>the</span> <span m='1815820'>arg
  min,</span> <span m='1816540'>but.</span> <span m='1818510'>Clear?</span> <span
  m='1818880'>So</span> <span m='1819330'>it</span> <span m='1819450'>would</span>
  <span m='1819570'>be</span> <span m='1819660'>constant</span> <span m='1820020'>time</span>
  <span m='1820350'>if</span> <span m='1820560'>I</span> <span m='1820620'>can</span>
  <span m='1820770'>do</span> <span m='1820860'>bottom</span> <span m='1821190'>in</span>
  <span m='1821280'>constant</span> <span m='1821610'>time,</span> <span m='1821820'>if</span>
  <span m='1821940'>I</span> <span m='1822030'>can</span> <span m='1822150'>do</span>
  <span m='1822240'>top in</span> <span m='1822660'>constant</span> <span m='1823130'>time.</span>
  <span m='1824040'>But</span> <span m='1824190'>the</span> <span m='1824280'>big</span>
  <span m='1824520'>win</span> <span m='1824760'>is</span> <span m='1824920'>that</span>
  <span m='1825000'>this</span> <span m='1825180'>top</span> <span m='1825510'>structure</span>
  <span m='1826440'>only</span> <span m='1826710'>has</span> <span m='1826890'>to</span>
  <span m='1826980'>store</span> <span m='1827280'>n</span> <span m='1827430'>over</span>
  <span m='1827640'>log</span> <span m='1827880'>n</span> <span m='1828030'>items.</span>
  <span m='1829050'>So</span> <span m='1829350'>I</span> <span m='1829440'>can</span>
  <span m='1829590'>afford</span> <span m='1830250'>an</span> <span m='1830370'>n</span>
  <span m='1830550'>log</span> <span m='1830850'>n</span> <span m='1831660'>space</span>
  <span m='1832140'>data</span> <span m='1832380'>structure,</span> <span m='1832830'>because</span>
  <span m='1833070'>the</span> <span m='1833160'>logs</span> <span m='1833460'>cancel.</span>
  </p><p><span m='1834930'>So</span> <span m='1835080'>I'm</span> <span m='1835170'>going</span>
  <span m='1835380'>to</span> <span m='1835500'>use</span> <span m='1835770'>structure</span>
  <span m='1836220'>2</span> <span m='1837350'>for</span> <span m='1837600'>the</span>
  <span m='1837690'>top.</span> <span m='1838800'>That</span> <span m='1838920'>will</span>
  <span m='1839010'>give</span> <span m='1839160'>me</span> <span m='1839310'>constant</span>
  <span m='1839760'>time</span> <span m='1840070'>up here,</span> <span m='1840710'>linear</span>
  <span m='1841020'>space.</span> <span m='1842440'>So</span> <span m='1842520'>all</span>
  <span m='1842730'>that's</span> <span m='1842910'>left</span> <span m='1843240'>is</span>
  <span m='1843390'>to</span> <span m='1843480'>solve</span> <span m='1843810'>the</span>
  <span m='1843930'>bottoms</span> <span m='1844530'>individually.</span> <span m='1846240'>Again,</span>
  <span m='1846570'>similar</span> <span m='1846930'>kind</span> <span m='1847080'>of</span>
  <span m='1847200'>structure</span> <span m='1847630'>to</span> <span m='1847860'>[INAUDIBLE].</span>
  <span m='1848310'>We</span> <span m='1848370'>have</span> <span m='1848460'>a</span>
  <span m='1848520'>summary</span> <span m='1848880'>structure</span> <span m='1849330'>and</span>
  <span m='1849450'>we</span> <span m='1849540'>have</span> <span m='1850170'>the</span>
  <span m='1850260'>details</span> <span m='1850650'>down</span> <span m='1850830'>below.</span>
  <span m='1851160'>But</span> <span m='1851490'>the</span> <span m='1851670'>parameters</span>
  <span m='1852210'>are</span> <span m='1852300'>way</span> <span m='1852480'>out</span>
  <span m='1852570'>of</span> <span m='1852630'>whack.</span> <span m='1852900'>It's</span>
  <span m='1853020'>no</span> <span m='1853140'>longer</span> <span m='1853350'>root</span>
  <span m='1853560'>n,</span> <span m='1853710'>root</span> <span m='1853890'>n.</span>
  <span m='1854520'>Now</span> <span m='1854670'>these</span> <span m='1854850'>guys</span>
  <span m='1855060'>are</span> <span m='1855150'>super</span> <span m='1855450'>tiny</span>
  <span m='1855910'>because</span> <span m='1856050'>we</span> <span m='1856170'>only</span>
  <span m='1856380'>needed</span> <span m='1856650'>this</span> <span m='1856800'>to</span>
  <span m='1856920'>be</span> <span m='1857040'>a</span> <span m='1857070'>little</span>
  <span m='1857430'>bit</span> <span m='1857580'>smaller</span> <span m='1858480'>than</span>
  <span m='1858680'>n,</span> <span m='1859410'>and</span> <span m='1859500'>then</span>
  <span m='1859740'>this</span> <span m='1859950'>would</span> <span m='1860100'>work</span>
  <span m='1860310'>out</span> <span m='1860460'>to</span> <span m='1860580'>linear</span>
  <span m='1860880'>space.</span> </p><p><span m='1863010'>OK.</span> <span m='1863940'>So</span>
  <span m='1865050'>step</span> <span m='1865290'>4</span> <span m='1865620'>is</span>
  <span m='1865740'>going</span> <span m='1865880'>to</span> <span m='1865980'>be</span>
  <span m='1866130'>how</span> <span m='1866280'>do</span> <span m='1866370'>we</span>
  <span m='1866460'>solve</span> <span m='1866730'>the</span> <span m='1866820'>bottom</span>
  <span m='1867120'>structures.</span> <span m='1880326'>So</span> <span m='1880820'>step</span>
  <span m='1881120'>4.</span> <span m='1883310'>This</span> <span m='1883490'>is</span>
  <span m='1883610'>where</span> <span m='1883730'>we're</span> <span m='1883820'>going</span>
  <span m='1883930'>to</span> <span m='1884030'>use</span> <span m='1884810'>technique</span>
  <span m='1885125'>of</span> <span m='1885440'>lookup</span> <span m='1885740'>tables</span>
  <span m='1893830'>for</span> <span m='1894170'>bottom</span> <span m='1895280'>groups.</span>
  <span m='1898390'>This</span> <span m='1898490'>is</span> <span m='1898550'>going</span>
  <span m='1898700'>to</span> <span m='1898760'>be</span> <span m='1898850'>slightly</span>
  <span m='1899240'>weird</span> <span m='1899450'>to</span> <span m='1899570'>phrase,</span>
  <span m='1899840'>because</span> <span m='1900080'>on</span> <span m='1900170'>the</span>
  <span m='1900290'>one</span> <span m='1900470'>hand,</span> <span m='1900720'>I</span>
  <span m='1900820'>want</span> <span m='1900830'>to</span> <span m='1900890'>be</span>
  <span m='1901010'>thinking</span> <span m='1901400'>about</span> <span m='1901610'>an</span>
  <span m='1901730'>individual</span> <span m='1902360'>group,</span> <span m='1903230'>but</span>
  <span m='1903440'>my</span> <span m='1903590'>solution</span> <span m='1904100'>is</span>
  <span m='1904190'>actually</span> <span m='1904490'>going</span> <span m='1904610'>to</span>
  <span m='1904670'>solve</span> <span m='1905000'>all</span> <span m='1905240'>groups</span>
  <span m='1905510'>simultaneously,</span> <span m='1906260'>and</span> <span m='1906330'>it's</span>
  <span m='1906410'>kind</span> <span m='1906590'>of</span> <span m='1906680'>important.</span>
  <span m='1907260'>But</span> <span m='1907340'>for</span> <span m='1907490'>now,</span>
  <span m='1908310'>let's</span> <span m='1908360'>just</span> <span m='1908510'>think</span>
  <span m='1908810'>of</span> <span m='1909720'>one</span> <span m='1909980'>group.</span>
  </p><p><span m='1911990'>So</span> <span m='1912760'>it</span> <span m='1913150'>has</span>
  <span m='1913400'>size</span> <span m='1913760'>n</span> <span m='1914000'>prime</span>
  <span m='1914690'>and</span> <span m='1915080'>n</span> <span m='1915350'>prime</span>
  <span m='1915770'>is 1/2</span> <span m='1916220'>log n.</span> <span m='1918200'>I</span>
  <span m='1918290'>need</span> <span m='1918440'>to</span> <span m='1918560'>remember</span>
  <span m='1918950'>how</span> <span m='1919100'>it</span> <span m='1919160'>relates</span>
  <span m='1919440'>to</span> <span m='1919490'>the</span> <span m='1919580'>original</span>
  <span m='1919910'>value of</span> <span m='1920210'>n</span> <span m='1920420'>so</span>
  <span m='1920600'>I</span> <span m='1920690'>know</span> <span m='1920810'>how</span>
  <span m='1920930'>to</span> <span m='1921590'>pay</span> <span m='1921770'>for</span>
  <span m='1921890'>things.</span> <span m='1922920'>The</span> <span m='1923020'>idea</span>
  <span m='1923180'>is</span> <span m='1923930'>there's</span> <span m='1924140'>really</span>
  <span m='1924470'>not</span> <span m='1924770'>many</span> <span m='1925370'>different</span>
  <span m='1925940'>problems</span> <span m='1926630'>of</span> <span m='1926780'>size</span>
  <span m='1927210'>1/2</span> <span m='1927380'>log n.</span> <span m='1928520'>And</span>
  <span m='1928640'>here's</span> <span m='1929090'>where</span> <span m='1929210'>we're</span>
  <span m='1929330'>going</span> <span m='1929400'>to</span> <span m='1929510'>use</span>
  <span m='1929720'>the</span> <span m='1929810'>fact</span> <span m='1930140'>that</span>
  <span m='1930260'>we're</span> <span m='1930530'>in</span> <span m='1930770'>plus</span>
  <span m='1931100'>or</span> <span m='1931190'>minus</span> <span m='1931520'>1</span>
  <span m='1932220'>land.</span> <span m='1934110'>We</span> <span m='1934250'>have</span>
  <span m='1934430'>this</span> <span m='1934610'>giant</span> <span m='1936110'>string</span>
  <span m='1936530'>of</span> <span m='1936830'>integers.</span> <span m='1937970'>Well,</span>
  <span m='1938170'>now</span> <span m='1938270'>we're</span> <span m='1938370'>looking</span>
  <span m='1938570'>at</span> <span m='1938960'>log</span> <span m='1939290'>n</span>
  <span m='1939410'>of</span> <span m='1939530'>them</span> <span m='1939720'>to</span>
  <span m='1939800'>say</span> <span m='1939980'>OK,</span> <span m='1940400'>this</span>
  <span m='1940700'>here,</span> <span m='1941180'>this</span> <span m='1941540'>is</span>
  <span m='1941660'>a</span> <span m='1941720'>sequence</span> <span m='1942050'>0,</span>
  <span m='1942480'>1,</span> <span m='1942720'>2,</span> <span m='1942930'>3.</span>
  <span m='1945590'>Over</span> <span m='1945860'>here</span> <span m='1946490'>a</span>
  <span m='1946720'>0,</span> <span m='1947120'>1,</span> <span m='1947390'>2,</span>
  <span m='1947600'>1.</span> <span m='1948200'>There's</span> <span m='1948350'>all</span>
  <span m='1948500'>these</span> <span m='1948650'>different</span> <span m='1948920'>things.</span>
  <span m='1949790'>Then</span> <span m='1949970'>there's</span> <span m='1950150'>other</span>
  <span m='1950330'>things</span> <span m='1950540'>like</span> <span m='1950720'>2,</span>
  <span m='1950950'>3,</span> <span m='1951260'>2,</span> <span m='1951530'>3.</span>
  </p><p><span m='1954350'>So</span> <span m='1955720'>there's</span> <span m='1956090'>a</span>
  <span m='1956150'>couple</span> <span m='1956420'>annoying</span> <span m='1956690'>things.</span>
  <span m='1957000'>One</span> <span m='1957110'>is</span> <span m='1957920'>it</span>
  <span m='1958010'>matters</span> <span m='1958520'>what</span> <span m='1958730'>value</span>
  <span m='1959000'>you</span> <span m='1959270'>start</span> <span m='1959600'>at,</span>
  <span m='1960350'>a</span> <span m='1960570'>b,</span> <span m='1960800'>and</span>
  <span m='1960920'>then</span> <span m='1961070'>it</span> <span m='1961160'>matters</span>
  <span m='1961520'>what</span> <span m='1961700'>the</span> <span m='1961820'>sequence</span>
  <span m='1962210'>of</span> <span m='1962270'>plus</span> <span m='1962600'>and</span>
  <span m='1962690'>minus</span> <span m='1962990'>1s</span> <span m='1963260'>are</span>
  <span m='1963380'>after</span> <span m='1963740'>that.</span> <span m='1966020'>OK.</span>
  <span m='1966440'>I</span> <span m='1966560'>claim</span> <span m='1966800'>it</span>
  <span m='1966860'>doesn't</span> <span m='1967100'>really</span> <span m='1967310'>matter</span>
  <span m='1967550'>what</span> <span m='1967730'>value you</span> <span m='1968120'>start</span>
  <span m='1968450'>at,</span> <span m='1969710'>because</span> <span m='1971210'>RMQ,</span>
  <span m='1973070'>this</span> <span m='1973220'>query,</span> <span m='1974810'>is</span>
  <span m='1974960'>invariant</span> <span m='1978680'>under</span> <span m='1981080'>adding</span>
  <span m='1984110'>some</span> <span m='1984380'>value</span> <span m='1984810'>x</span>
  <span m='1985880'>to</span> <span m='1987170'>all</span> <span m='1987530'>entries,</span>
  <span m='1988370'>all</span> <span m='1988580'>values,</span> <span m='1989540'>in</span>
  <span m='1989630'>the</span> <span m='1989750'>array.</span> <span m='1990720'>Or</span>
  <span m='1991090'>if</span> <span m='1991220'>I</span> <span m='1991370'>add</span>
  <span m='1991730'>100</span> <span m='1992180'>to</span> <span m='1992300'>every</span>
  <span m='1992540'>value,</span> <span m='1992900'>then</span> <span m='1993140'>the</span>
  <span m='1993260'>minimums</span> <span m='1993590'>stay</span> <span m='1993830'>the</span>
  <span m='1993920'>same</span> <span m='1994280'>in</span> <span m='1994490'>position.</span>
  <span m='1995690'>So</span> <span m='1995840'>again,</span> <span m='1996260'>here</span>
  <span m='1996470'>I'm</span> <span m='1996590'>thinking</span> <span m='1996860'>of</span>
  <span m='1996950'>RMQ</span> <span m='1997310'>as</span> <span m='1997400'>an</span>
  <span m='1997490'>arg min.</span> <span m='1998220'>So</span> <span m='1998320'>it's</span>
  <span m='1998780'>giving</span> <span m='1999050'>just</span> <span m='1999170'>the</span>
  <span m='1999290'>index</span> <span m='1999680'>of</span> <span m='1999740'>where</span>
  <span m='1999890'>it</span> <span m='1999950'>lives.</span> </p><p><span m='2001600'>So</span>
  <span m='2001960'>in</span> <span m='2002050'>particular,</span> <span m='2003070'>I'm</span>
  <span m='2003280'>going</span> <span m='2003550'>to</span> <span m='2003850'>add</span>
  <span m='2005500'>minus</span> <span m='2006160'>the</span> <span m='2006280'>first</span>
  <span m='2006640'>value</span> <span m='2007030'>of</span> <span m='2007120'>the</span>
  <span m='2007240'>array</span> <span m='2008590'>to</span> <span m='2008920'>all</span>
  <span m='2009070'>values.</span> <span m='2013210'>I</span> <span m='2013270'>should</span>
  <span m='2013420'>probably</span> <span m='2013690'>call</span> <span m='2013870'>this--</span>
  <span m='2014790'>well,</span> <span m='2015610'>yeah.</span> <span m='2016720'>Here</span>
  <span m='2017030'>I'm</span> <span m='2017350'>just</span> <span m='2017530'>thinking</span>
  <span m='2017740'>about</span> <span m='2017920'>a</span> <span m='2017980'>single</span>
  <span m='2018280'>group</span> <span m='2018550'>for</span> <span m='2018730'>now.</span>
  <span m='2019580'>So</span> <span m='2019690'>in</span> <span m='2019780'>a</span>
  <span m='2019840'>single</span> <span m='2020110'>group,</span> <span m='2020800'>saying</span>
  <span m='2021010'>well,</span> <span m='2021140'>it</span> <span m='2021260'>starts</span>
  <span m='2021530'>at</span> <span m='2021610'>some</span> <span m='2021820'>value.</span>
  <span m='2022570'>I'm</span> <span m='2022690'>just</span> <span m='2022810'>going</span>
  <span m='2022930'>to</span> <span m='2023200'>decrease</span> <span m='2023950'>all</span>
  <span m='2024190'>these</span> <span m='2024400'>things</span> <span m='2024760'>by</span>
  <span m='2024970'>whatever</span> <span m='2025270'>that</span> <span m='2025420'>value</span>
  <span m='2025810'>is.</span> <span m='2026500'>Now</span> <span m='2026680'>some</span>
  <span m='2026860'>of</span> <span m='2026920'>them</span> <span m='2027040'>might</span>
  <span m='2027190'>become</span> <span m='2027460'>negative,</span> <span m='2027970'>but</span>
  <span m='2028780'>at</span> <span m='2028900'>least</span> <span m='2029080'>now</span>
  <span m='2029260'>we</span> <span m='2029350'>start</span> <span m='2029590'>with
  a</span> <span m='2029770'>0.</span> <span m='2030730'>So</span> <span m='2031930'>what</span>
  <span m='2032050'>we</span> <span m='2032140'>start</span> <span m='2032380'>with</span>
  <span m='2032650'>is</span> <span m='2032860'>irrelevant.</span> </p><p><span m='2035180'>What</span>
  <span m='2035290'>remains,</span> <span m='2036250'>the</span> <span m='2036460'>remaining</span>
  <span m='2036850'>numbers</span> <span m='2037180'>here</span> <span m='2037390'>are</span>
  <span m='2037480'>completely</span> <span m='2038020'>defined</span> <span m='2038530'>by</span>
  <span m='2039160'>the</span> <span m='2039880'>gaps</span> <span m='2040450'>between</span>
  <span m='2040870'>or</span> <span m='2041040'>the</span> <span m='2041350'>difs</span>
  <span m='2041770'>between</span> <span m='2042400'>consecutive</span> <span m='2043060'>items,</span>
  <span m='2043870'>and</span> <span m='2043960'>the</span> <span m='2044050'>difs</span>
  <span m='2044320'>are</span> <span m='2044440'>all</span> <span m='2044620'>plus</span>
  <span m='2044890'>or</span> <span m='2044950'>minus</span> <span m='2045250'>1.</span>
  <span m='2046555'>So</span> <span m='2046990'>now</span> <span m='2048400'>the</span>
  <span m='2048489'>number</span> <span m='2048820'>of</span> <span m='2048909'>possible</span>
  <span m='2050500'>arrays</span> <span m='2057100'>in</span> <span m='2057219'>a</span>
  <span m='2057280'>group,</span> <span m='2059010'>so</span> <span m='2059469'>in</span>
  <span m='2059590'>a</span> <span m='2059650'>single</span> <span m='2059949'>group,</span>
  <span m='2061510'>is</span> <span m='2061659'>equal</span> <span m='2061989'>to</span>
  <span m='2062409'>the</span> <span m='2062530'>number</span> <span m='2062980'>of</span>
  <span m='2063670'>plus</span> <span m='2063969'>or</span> <span m='2064060'>minus</span>
  <span m='2064389'>1</span> <span m='2064799'>strings</span> <span m='2068060'>of</span>
  <span m='2069130'>length</span> <span m='2071139'>n</span> <span m='2071380'>prime,</span>
  <span m='2071870'>which</span> <span m='2071949'>is</span> <span m='2072070'>1/2</span>
  <span m='2072360'>log n.</span> <span m='2077120'>And</span> <span m='2077679'>the</span>
  <span m='2077770'>number</span> <span m='2078040'>of</span> <span m='2078100'>plus</span>
  <span m='2078340'>or</span> <span m='2078429'>minus</span> <span m='2078699'>1</span>
  <span m='2078880'>strings</span> <span m='2079210'>of</span> <span m='2079330'>length</span>
  <span m='2079600'>n</span> <span m='2079750'>prime</span> <span m='2080530'>is</span>
  <span m='2080739'>2</span> <span m='2080949'>to</span> <span m='2081040'>the</span>
  <span m='2081159'>n</span> <span m='2081310'>prime.</span> </p><p><span m='2082670'>So</span>
  <span m='2082690'>we</span> <span m='2082780'>get</span> <span m='2082929'>2</span>
  <span m='2083199'>to</span> <span m='2083310'>the</span> <span m='2083409'>1/2</span>
  <span m='2083650'>log</span> <span m='2083909'>n,</span> <span m='2084610'>also</span>
  <span m='2084909'>known</span> <span m='2085120'>as</span> <span m='2085659'>square</span>
  <span m='2085960'>root</span> <span m='2086110'>of</span> <span m='2086210'>n.</span>
  <span m='2088150'>Square root</span> <span m='2088510'>of</span> <span m='2088600'>n</span>
  <span m='2088719'>is</span> <span m='2088840'>small.</span> <span m='2089530'>We're</span>
  <span m='2089780'>aiming</span> <span m='2090100'>for</span> <span m='2090360'>linear</span>
  <span m='2090699'>space.</span> <span m='2091219'>This</span> <span m='2091300'>means</span>
  <span m='2092290'>that</span> <span m='2092440'>for</span> <span m='2092770'>every--</span>
  <span m='2093730'>not</span> <span m='2093940'>only</span> <span m='2094120'>for</span>
  <span m='2094239'>every</span> <span m='2094420'>group,</span> <span m='2095159'>there</span>
  <span m='2095489'>is</span> <span m='2095620'>n</span> <span m='2095710'>over</span>
  <span m='2095920'>log</span> <span m='2096159'>n</span> <span m='2096310'>groups--</span>
  <span m='2096730'>but</span> <span m='2096880'>actually</span> <span m='2097540'>many</span>
  <span m='2097810'>of</span> <span m='2097870'>the</span> <span m='2097960'>groups</span>
  <span m='2098170'>have</span> <span m='2098320'>to</span> <span m='2098410'>be</span>
  <span m='2098530'>the</span> <span m='2098620'>same.</span> <span m='2099140'>There's</span>
  <span m='2099290'>n over</span> <span m='2099580'>log</span> <span m='2099820'>n</span>
  <span m='2099970'>groups,</span> <span m='2100270'>but</span> <span m='2101050'>there's</span>
  <span m='2101230'>only</span> <span m='2101530'>root</span> <span m='2101830'>n</span>
  <span m='2102220'>different</span> <span m='2102730'>types</span> <span m='2103090'>of</span>
  <span m='2103180'>groups.</span> <span m='2104450'>So</span> <span m='2104590'>on</span>
  <span m='2104710'>average,</span> <span m='2105130'>like</span> <span m='2105370'>root</span>
  <span m='2105640'>n</span> <span m='2105910'>over</span> <span m='2106310'>log</span>
  <span m='2106700'>n</span> <span m='2107200'>occurrences</span> <span m='2107770'>of</span>
  <span m='2107890'>each.</span> </p><p><span m='2109090'>So</span> <span m='2109300'>we</span>
  <span m='2109390'>can</span> <span m='2109510'>kind</span> <span m='2109690'>of</span>
  <span m='2109780'>compress</span> <span m='2110170'>things</span> <span m='2110410'>down</span>
  <span m='2110640'>and</span> <span m='2110730'>say</span> <span m='2110890'>hey,</span>
  <span m='2112730'>I</span> <span m='2112750'>would</span> <span m='2112930'>like</span>
  <span m='2113110'>to</span> <span m='2113200'>just</span> <span m='2113410'>like</span>
  <span m='2113560'>store</span> <span m='2113800'>a</span> <span m='2113830'>lookup</span>
  <span m='2114160'>table</span> <span m='2114430'>for</span> <span m='2114580'>each</span>
  <span m='2114730'>one</span> <span m='2114910'>of</span> <span m='2114970'>these,</span>
  <span m='2115210'>but</span> <span m='2115330'>that</span> <span m='2115480'>would</span>
  <span m='2115600'>be</span> <span m='2115720'>quadratic</span> <span m='2116170'>space.</span>
  <span m='2117310'>But</span> <span m='2117460'>there's</span> <span m='2117610'>really</span>
  <span m='2117880'>only</span> <span m='2118180'>square</span> <span m='2118280'>root</span>
  <span m='2118420'>of</span> <span m='2118540'>n</span> <span m='2118660'>different</span>
  <span m='2118900'>types.</span> <span m='2119360'>So</span> <span m='2119440'>if</span>
  <span m='2119530'>I</span> <span m='2119620'>use</span> <span m='2119890'>a</span>
  <span m='2119950'>layer</span> <span m='2120250'>of</span> <span m='2120880'>indirection,</span>
  <span m='2121720'>I</span> <span m='2121810'>guess--</span> <span m='2122410'>different</span>
  <span m='2122680'>sort</span> <span m='2122890'>of</span> <span m='2122980'>indirection--</span>
  <span m='2123835'>if</span> <span m='2124120'>I</span> <span m='2124180'>just</span>
  <span m='2124360'>have,</span> <span m='2124900'>for</span> <span m='2125110'>each</span>
  <span m='2125260'>of</span> <span m='2125320'>these</span> <span m='2125500'>groups,</span>
  <span m='2125900'>I</span> <span m='2126000'>just</span> <span m='2126010'>store</span>
  <span m='2126190'>a</span> <span m='2126220'>pointer</span> <span m='2126700'>to</span>
  <span m='2126880'>the</span> <span m='2127060'>type</span> <span m='2127690'>of</span>
  <span m='2127870'>group,</span> <span m='2128860'>which</span> <span m='2129040'>is</span>
  <span m='2129220'>what</span> <span m='2129520'>the</span> <span m='2129640'>plus</span>
  <span m='2129910'>or</span> <span m='2130000'>minus</span> <span m='2130270'>1</span>
  <span m='2130525'>string</span> <span m='2130780'>is,</span> <span m='2131980'>and</span>
  <span m='2132070'>then</span> <span m='2132220'>for</span> <span m='2132340'>that</span>
  <span m='2132550'>type,</span> <span m='2133120'>I</span> <span m='2133240'>store</span>
  <span m='2133510'>a</span> <span m='2133540'>lookup</span> <span m='2133840'>table</span>
  <span m='2134200'>of</span> <span m='2134320'>all</span> <span m='2134560'>possibilities.</span>
  <span m='2135730'>That</span> <span m='2135910'>will</span> <span m='2136030'>be</span>
  <span m='2136180'>efficient.</span> </p><p><span m='2136900'>Let</span> <span m='2136990'>me</span>
  <span m='2137960'>show</span> <span m='2138280'>that</span> <span m='2138460'>to</span>
  <span m='2138610'>you.</span> <span m='2141200'>This</span> <span m='2141410'>is</span>
  <span m='2141500'>a</span> <span m='2141560'>very</span> <span m='2142700'>handy</span>
  <span m='2143030'>idea.</span> <span m='2143390'>In</span> <span m='2143540'>general,</span>
  <span m='2145370'>if</span> <span m='2145460'>you</span> <span m='2145520'>have</span>
  <span m='2145610'>a</span> <span m='2145670'>lot</span> <span m='2145940'>of</span>
  <span m='2146000'>things</span> <span m='2146300'>of</span> <span m='2146390'>size</span>
  <span m='2146820'>roughly</span> <span m='2147020'>log</span> <span m='2147320'>n,</span>
  <span m='2147960'>lookup</span> <span m='2148220'>tables</span> <span m='2149720'>are</span>
  <span m='2150080'>a</span> <span m='2150410'>good</span> <span m='2150620'>idea.</span>
  <span m='2154520'>And</span> <span m='2154640'>this</span> <span m='2154820'>naturally</span>
  <span m='2155240'>arises</span> <span m='2155690'>when</span> <span m='2155840'>you're</span>
  <span m='2155930'>using</span> <span m='2156260'>indirection,</span> <span m='2156860'>because</span>
  <span m='2157040'>usually</span> <span m='2157340'>you</span> <span m='2157400'>just</span>
  <span m='2157550'>need</span> <span m='2157700'>to</span> <span m='2157790'>shave</span>
  <span m='2158180'>a</span> <span m='2158240'>log</span> <span m='2158540'>or</span>
  <span m='2158630'>two.</span> <span m='2160340'>So</span> <span m='2160520'>here</span>
  <span m='2160700'>we</span> <span m='2160790'>have</span> <span m='2161870'>these</span>
  <span m='2162140'>different</span> <span m='2162410'>types.</span> <span m='2163610'>So</span>
  <span m='2164090'>what</span> <span m='2164240'>we're</span> <span m='2164330'>going</span>
  <span m='2164420'>to</span> <span m='2164510'>do</span> <span m='2164930'>is</span>
  <span m='2165080'>store</span> <span m='2167470'>a</span> <span m='2167510'>lookup</span>
  <span m='2167870'>table</span> <span m='2173360'>that</span> <span m='2173510'>says</span>
  <span m='2174380'>for</span> <span m='2174590'>each</span> <span m='2174830'>group</span>
  <span m='2175070'>type,</span> <span m='2176370'>I'll</span> <span m='2176660'>just</span>
  <span m='2176810'>say</span> <span m='2176960'>a</span> <span m='2176990'>lookup</span>
  <span m='2177290'>table</span> <span m='2178520'>of</span> <span m='2180050'>all</span>
  <span m='2180590'>answers,</span> <span m='2184130'>do</span> <span m='2184310'>that</span>
  <span m='2184610'>for</span> <span m='2184850'>each</span> <span m='2186050'>group</span>
  <span m='2186440'>type.</span> <span m='2191030'>Group</span> <span m='2191210'>type,</span>
  <span m='2191580'>meaning</span> <span m='2191830'>the</span> <span m='2191930'>plus</span>
  <span m='2192170'>or</span> <span m='2192260'>minus</span> <span m='2192530'>1 string.</span>
  <span m='2192970'>It's</span> <span m='2193100'>really</span> <span m='2193670'>what</span>
  <span m='2193880'>is</span> <span m='2194030'>in</span> <span m='2194150'>that</span>
  <span m='2194300'>group</span> <span m='2194630'>after</span> <span m='2194840'>you</span>
  <span m='2194930'>do</span> <span m='2195050'>this</span> <span m='2195200'>shifting.</span>
  </p><p><span m='2196990'>OK.</span> <span m='2197330'>Now</span> <span m='2197510'>there's</span>
  <span m='2197690'>square</span> <span m='2197790'>root</span> <span m='2198050'>of</span>
  <span m='2198250'>n group</span> <span m='2198470'>types.</span> <span m='2201620'>What</span>
  <span m='2201740'>does</span> <span m='2201860'>it</span> <span m='2201920'>take</span>
  <span m='2202130'>to</span> <span m='2202220'>store</span> <span m='2202400'>the</span>
  <span m='2202520'>answers?</span> <span m='2203390'>Well,</span> <span m='2204100'>there</span>
  <span m='2204350'>is,</span> <span m='2204830'>I</span> <span m='2204890'>guess,</span>
  <span m='2205640'>1/2</span> <span m='2205940'>log</span> <span m='2206270'>n</span>
  <span m='2207440'>squared</span> <span m='2208730'>different</span> <span m='2209060'>queries,</span>
  <span m='2210680'>because</span> <span m='2210870'>n</span> <span m='2211140'>prime</span>
  <span m='2211400'>is</span> <span m='2211770'>1/2 log</span> <span m='2212140'>n,</span>
  <span m='2212820'>and</span> <span m='2212960'>a</span> <span m='2213020'>query</span>
  <span m='2213290'>is</span> <span m='2213380'>defined</span> <span m='2213710'>by</span>
  <span m='2213800'>the</span> <span m='2213920'>two</span> <span m='2214070'>endpoints.</span>
  <span m='2214490'>So there's</span> <span m='2214790'>at</span> <span m='2214850'>most</span>
  <span m='2215090'>this</span> <span m='2215270'>many</span> <span m='2215480'>queries.</span>
  <span m='2216650'>Each</span> <span m='2216860'>query,</span> <span m='2217490'>to</span>
  <span m='2217580'>store</span> <span m='2217820'>the</span> <span m='2217940'>answer,</span>
  <span m='2218900'>is</span> <span m='2219050'>going</span> <span m='2219230'>to</span>
  <span m='2219290'>take</span> <span m='2219950'>order</span> <span m='2220320'>log</span>
  <span m='2220610'>log</span> <span m='2220820'>n</span> <span m='2220970'>bits--</span>
  <span m='2221450'>this</span> <span m='2221490'>is</span> <span m='2221600'>if</span>
  <span m='2221750'>you're</span> <span m='2221870'>fancy--</span> <span m='2223910'>because</span>
  <span m='2224360'>the</span> <span m='2224510'>answer</span> <span m='2224900'>is</span>
  <span m='2225050'>an</span> <span m='2225170'>index</span> <span m='2225650'>into</span>
  <span m='2225890'>that</span> <span m='2226070'>array</span> <span m='2227060'>of</span>
  <span m='2227180'>size</span> <span m='2227450'>1/2</span> <span m='2227680'>log</span>
  <span m='2227890'>n,</span> <span m='2228070'>so</span> <span m='2228200'>you</span>
  <span m='2228290'>need</span> <span m='2228500'>log</span> <span m='2228740'>log</span>
  <span m='2228920'>n</span> <span m='2229040'>bits</span> <span m='2229250'>to</span>
  <span m='2229370'>write</span> <span m='2229520'>down</span> <span m='2229760'>that.</span>
  </p><p><span m='2230840'>So</span> <span m='2231080'>the</span> <span m='2231200'>total</span>
  <span m='2231470'>size</span> <span m='2231770'>of</span> <span m='2231860'>this</span>
  <span m='2232010'>lookup</span> <span m='2232280'>table</span> <span m='2234110'>is</span>
  <span m='2234290'>the</span> <span m='2234410'>product</span> <span m='2234830'>of</span>
  <span m='2234920'>these</span> <span m='2235100'>things.</span> <span m='2236720'>We</span>
  <span m='2236840'>have</span> <span m='2236960'>to</span> <span m='2237050'>write</span>
  <span m='2237580'>root n</span> <span m='2237950'>look</span> <span m='2238130'>up</span>
  <span m='2238220'>tables.</span> <span m='2239120'>Each</span> <span m='2242210'>stores</span>
  <span m='2242600'>log</span> <span m='2242930'>squared</span> <span m='2243350'>n</span>
  <span m='2243560'>different</span> <span m='2243800'>values,</span> <span m='2244790'>and</span>
  <span m='2244910'>the</span> <span m='2245000'>values</span> <span m='2245480'>require</span>
  <span m='2245900'>log</span> <span m='2246180'>log</span> <span m='2246330'>n</span>
  <span m='2246470'>bits.</span> <span m='2248310'>So</span> <span m='2248450'>total</span>
  <span m='2248780'>number</span> <span m='2249020'>of</span> <span m='2249080'>bits</span>
  <span m='2250130'>is</span> <span m='2250280'>this</span> <span m='2250490'>thing,</span>
  <span m='2251240'>and</span> <span m='2251360'>this</span> <span m='2251540'>thing</span>
  <span m='2251840'>is</span> <span m='2252200'>little</span> <span m='2252540'>o</span>
  <span m='2252880'>of</span> <span m='2253040'>n.</span> <span m='2254390'>So</span>
  <span m='2254690'>smaller</span> <span m='2255050'>than</span> <span m='2255200'>linear,</span>
  <span m='2255770'>so</span> <span m='2255920'>it's</span> <span m='2256040'>irrelevant.</span>
  <span m='2257480'>Can</span> <span m='2257600'>store</span> <span m='2257840'>for</span>
  <span m='2257990'>free.</span> </p><p><span m='2259700'>Now</span> <span m='2260420'>if</span>
  <span m='2260720'>we</span> <span m='2260900'>have</span> <span m='2261140'>a</span>
  <span m='2261170'>bottom</span> <span m='2261530'>group,</span> <span m='2261800'>the</span>
  <span m='2261890'>one</span> <span m='2262040'>thing</span> <span m='2262220'>we</span>
  <span m='2262310'>need</span> <span m='2262460'>to</span> <span m='2262580'>do</span>
  <span m='2262700'>is</span> <span m='2262760'>store</span> <span m='2262970'>a</span>
  <span m='2263000'>pointer</span> <span m='2263480'>from</span> <span m='2263660'>that</span>
  <span m='2263870'>bottom</span> <span m='2264170'>group</span> <span m='2265010'>to</span>
  <span m='2266210'>the</span> <span m='2266330'>corresponding</span> <span m='2267920'>section</span>
  <span m='2268430'>of</span> <span m='2268550'>the</span> <span m='2268640'>lookup</span>
  <span m='2268970'>table</span> <span m='2269870'>for</span> <span m='2269990'>that</span>
  <span m='2270170'>group</span> <span m='2270380'>type.</span> <span m='2271976'>So</span>
  <span m='2272390'>each</span> <span m='2272600'>group</span> <span m='2276890'>stores</span>
  <span m='2277430'>a</span> <span m='2277490'>pointer</span> <span m='2283820'>into</span>
  <span m='2284450'>lookup</span> <span m='2284750'>table.</span> </p><p><span m='2288290'>I'm</span>
  <span m='2288470'>of</span> <span m='2288590'>two</span> <span m='2288770'>minds</span>
  <span m='2289100'>whether</span> <span m='2289430'>I</span> <span m='2289520'>think</span>
  <span m='2289730'>of</span> <span m='2289850'>this</span> <span m='2290120'>as</span>
  <span m='2290330'>a</span> <span m='2290390'>single</span> <span m='2290720'>lookup</span>
  <span m='2291050'>table</span> <span m='2291800'>that's</span> <span m='2292190'>parameterized</span>
  <span m='2292850'>first</span> <span m='2293150'>by</span> <span m='2293300'>group</span>
  <span m='2293540'>type,</span> <span m='2293960'>and</span> <span m='2294050'>then</span>
  <span m='2294260'>by</span> <span m='2294470'>the</span> <span m='2294560'>query.</span>
  <span m='2295480'>So</span> <span m='2295550'>it's</span> <span m='2295670'>like</span>
  <span m='2295790'>a</span> <span m='2295850'>two-dimensional</span> <span m='2296420'>table</span>
  <span m='2297030'>or</span> <span m='2297170'>three-dimensional,</span> <span m='2297860'>depending</span>
  <span m='2298190'>how</span> <span m='2298310'>you</span> <span m='2298400'>count.</span>
  <span m='2299150'>Or</span> <span m='2299300'>you</span> <span m='2299390'>can</span>
  <span m='2299540'>think</span> <span m='2299690'>of</span> <span m='2299780'>there</span>
  <span m='2299900'>being</span> <span m='2300080'>several</span> <span m='2300500'>lookup</span>
  <span m='2300800'>tables,</span> <span m='2301290'>one</span> <span m='2301340'>for</span>
  <span m='2301490'>each</span> <span m='2301610'>group</span> <span m='2301820'>type,</span>
  <span m='2302090'>and</span> <span m='2302180'>then</span> <span m='2302270'>you're</span>
  <span m='2302360'>pointing</span> <span m='2302630'>to</span> <span m='2302720'>a</span>
  <span m='2302780'>single</span> <span m='2303050'>lookup</span> <span m='2303320'>table.</span>
  <span m='2303810'>However,</span> <span m='2304010'>you</span> <span m='2304070'>want</span>
  <span m='2304190'>to</span> <span m='2304250'>think</span> <span m='2304400'>about</span>
  <span m='2304640'>it,</span> <span m='2304730'>same</span> <span m='2304970'>thing.</span>
  <span m='2306050'>Same</span> <span m='2306290'>difference,</span> <span m='2306600'>as</span>
  <span m='2306910'>they</span> <span m='2307070'>say.</span> </p><p><span m='2309260'>This</span>
  <span m='2309530'>gives</span> <span m='2309800'>us</span> <span m='2310400'>linear</span>
  <span m='2310790'>space.</span> <span m='2311300'>These</span> <span m='2311480'>pointers</span>
  <span m='2311870'>take</span> <span m='2312020'>linear</span> <span m='2312290'>space.</span>
  <span m='2312650'>The</span> <span m='2312740'>top</span> <span m='2313010'>structure</span>
  <span m='2313370'>takes</span> <span m='2313550'>linear</span> <span m='2313820'>space</span>
  <span m='2314180'>linear</span> <span m='2314420'>number</span> <span m='2314630'>of</span>
  <span m='2314720'>words,</span> <span m='2317060'>and</span> <span m='2317300'>constant</span>
  <span m='2317760'>query</span> <span m='2317960'>time,</span> <span m='2318650'>because</span>
  <span m='2318890'>lookup</span> <span m='2319160'>tables</span> <span m='2319520'>are</span>
  <span m='2319640'>very</span> <span m='2319880'>fast.</span> <span m='2320750'>Just</span>
  <span m='2320960'>look</span> <span m='2321230'>into</span> <span m='2321500'>them.</span>
  <span m='2322070'>They</span> <span m='2322190'>give</span> <span m='2322370'>you</span>
  <span m='2322460'>the</span> <span m='2322580'>answer.</span> <span m='2323360'>So</span>
  <span m='2323630'>you</span> <span m='2323750'>can</span> <span m='2323870'>do</span>
  <span m='2323960'>a</span> <span m='2323990'>lookup</span> <span m='2324290'>table</span>
  <span m='2324590'>here,</span> <span m='2325310'>lookup</span> <span m='2325610'>table</span>
  <span m='2325880'>here.</span> <span m='2326820'>And</span> <span m='2326900'>then</span>
  <span m='2327680'>over</span> <span m='2327920'>here,</span> <span m='2328250'>you</span>
  <span m='2328430'>do</span> <span m='2328670'>the</span> <span m='2329750'>covering</span>
  <span m='2330290'>by</span> <span m='2330470'>2,</span> <span m='2331850'>powers</span>
  <span m='2332210'>of</span> <span m='2332300'>2</span> <span m='2332450'>intervals.</span>
  <span m='2332990'>Again,</span> <span m='2333290'>we</span> <span m='2333410'>have</span>
  <span m='2333560'>a</span> <span m='2333620'>lookup</span> <span m='2333950'>table</span>
  <span m='2334250'>for</span> <span m='2334400'>those</span> <span m='2334670'>intervals,</span>
  <span m='2335660'>so</span> <span m='2335810'>it's</span> <span m='2335930'>like</span>
  <span m='2336140'>we're</span> <span m='2336230'>looking</span> <span m='2336440'>into</span>
  <span m='2336590'>four</span> <span m='2336800'>tables,</span> <span m='2337400'>take</span>
  <span m='2337610'>the</span> <span m='2337760'>min</span> <span m='2337850'>of</span>
  <span m='2337940'>them</span> <span m='2338060'>all,</span> <span m='2338590'>done.</span>
  </p><p><span m='2340610'>That</span> <span m='2340850'>is</span> <span m='2341090'>RMQ,</span>
  <span m='2342650'>and</span> <span m='2342920'>also</span> <span m='2343370'>LCA.</span>
  <span m='2344180'>Actually</span> <span m='2344420'>it was</span> <span m='2344540'>really</span>
  <span m='2344780'>LCA</span> <span m='2345200'>that</span> <span m='2345320'>we</span>
  <span m='2345410'>solved,</span> <span m='2346340'>because</span> <span m='2347360'>we</span>
  <span m='2347480'>solved</span> <span m='2347690'>plus</span> <span m='2347960'>or</span>
  <span m='2348050'>minus</span> <span m='2348320'>1 RMQ,</span> <span m='2349490'>which</span>
  <span m='2349670'>solved</span> <span m='2349940'>LCA,</span> <span m='2351110'>but</span>
  <span m='2351410'>by</span> <span m='2354630'>the</span> <span m='2354740'>Cartesian</span>
  <span m='2355190'>tree</span> <span m='2355370'>reduction,</span> <span m='2355910'>that</span>
  <span m='2356120'>also</span> <span m='2356390'>solves</span> <span m='2356660'>RMQ.</span>
  <span m='2359570'>Now</span> <span m='2359720'>we</span> <span m='2359840'>solved</span>
  <span m='2360590'>2</span> <span m='2360890'>out</span> <span m='2360980'>of</span>
  <span m='2361070'>3</span> <span m='2361250'>of</span> <span m='2361340'>our</span>
  <span m='2361430'>problems.</span> <span m='2362870'>Any</span> <span m='2362970'>questions?</span>
  </p><p><span m='2366750'>Level</span> <span m='2366990'>ancestors</span> <span m='2367410'>are</span>
  <span m='2367440'>going</span> <span m='2367560'>to</span> <span m='2367620'>be</span>
  <span m='2367710'>harder,</span> <span m='2370250'>little</span> <span m='2370530'>bit</span>
  <span m='2370650'>harder.</span> <span m='2371490'>Similar</span> <span m='2371820'>number</span>
  <span m='2372030'>of</span> <span m='2372090'>steps.</span> <span m='2373350'>I'd</span>
  <span m='2373440'>say</span> <span m='2373620'>they're</span> <span m='2373740'>a</span>
  <span m='2373770'>little</span> <span m='2373980'>more</span> <span m='2374220'>clever.</span>
  <span m='2375330'>This</span> <span m='2375720'>I feel is</span> <span m='2375990'>pretty</span>
  <span m='2376200'>easy.</span> <span m='2376830'>Very</span> <span m='2377010'>simple</span>
  <span m='2377340'>style</span> <span m='2377640'>of</span> <span m='2377730'>indirection,</span>
  <span m='2378750'>very</span> <span m='2378930'>simple</span> <span m='2379230'>style</span>
  <span m='2379560'>of</span> <span m='2380070'>enumeration</span> <span m='2380730'>here.</span>
  <span m='2381450'>It's</span> <span m='2381570'>going</span> <span m='2381680'>to</span>
  <span m='2381780'>be</span> <span m='2382050'>a</span> <span m='2382080'>little</span>
  <span m='2382320'>more</span> <span m='2382470'>sophisticated</span> <span m='2383040'>and</span>
  <span m='2383130'>a</span> <span m='2383160'>little</span> <span m='2383400'>bit</span>
  <span m='2383520'>more</span> <span m='2383700'>representative</span> <span m='2384390'>of</span>
  <span m='2384600'>the</span> <span m='2384750'>general</span> <span m='2385110'>case</span>
  <span m='2387630'>for</span> <span m='2387790'>level</span> <span m='2388110'>ancestors.</span>
  <span m='2392360'>Definitely</span> <span m='2392720'>fancier.</span> <span m='2396620'>Level</span>
  <span m='2396860'>ancestors</span> <span m='2397400'>is</span> <span m='2397450'>a</span>
  <span m='2397490'>similar</span> <span m='2397880'>story</span> <span m='2398550'>we</span>
  <span m='2398710'>solved</span> <span m='2399740'>a</span> <span m='2399800'>while</span>
  <span m='2400010'>ago,</span> <span m='2401540'>but</span> <span m='2401660'>it</span>
  <span m='2401720'>was</span> <span m='2401810'>kind</span> <span m='2401960'>of</span>
  <span m='2402030'>a</span> <span m='2402050'>complicated</span> <span m='2402560'>solution.</span>
  <span m='2403170'>And</span> <span m='2403270'>then</span> <span m='2403520'>Bender</span>
  <span m='2403820'>and</span> <span m='2403910'>Farach-Colton</span> <span m='2405680'>found</span>
  <span m='2405950'>it</span> <span m='2406550'>and</span> <span m='2406640'>said</span>
  <span m='2406790'>hey,</span> <span m='2407150'>we</span> <span m='2407270'>can</span>
  <span m='2407420'>simplify</span> <span m='2407810'>this.</span> <span m='2408770'>And</span>
  <span m='2408890'>I'm</span> <span m='2408950'>going</span> <span m='2409070'>to</span>
  <span m='2409610'>give</span> <span m='2409790'>you</span> <span m='2409850'>the</span>
  <span m='2409970'>simplified</span> <span m='2410480'>version.</span> </p><p><span
  m='2412700'>So</span> <span m='2412910'>this</span> <span m='2413180'>is</span>
  <span m='2414260'>level</span> <span m='2414530'>ancestors.</span> <span m='2415640'>Says</span>
  <span m='2415740'>originally</span> <span m='2416090'>solved</span> <span m='2416480'>by</span>
  <span m='2416810'>Berkman</span> <span m='2417260'>and</span> <span m='2417380'>Vishkin</span>
  <span m='2417860'>in</span> <span m='2417980'>1994,</span> <span m='2419060'>OK,</span>
  <span m='2419300'>not</span> <span m='2419510'>so</span> <span m='2419720'>long</span>
  <span m='2419960'>ago.</span> <span m='2421010'>And</span> <span m='2421100'>then</span>
  <span m='2421400'>the</span> <span m='2421520'>new</span> <span m='2421670'>version</span>
  <span m='2422000'>is</span> <span m='2422090'>from</span> <span m='2422210'>2004.</span>
  <span m='2425690'>Ready?</span> <span m='2426800'>Level</span> <span m='2427070'>ancestors.</span>
  <span m='2427580'>What</span> <span m='2427730'>was</span> <span m='2427850'>the</span>
  <span m='2427970'>problem</span> <span m='2428420'>again?</span> <span m='2429710'>Here</span>
  <span m='2429890'>it</span> <span m='2429950'>is.</span> <span m='2430580'>I</span>
  <span m='2430640'>gave</span> <span m='2430820'>you</span> <span m='2430910'>a</span>
  <span m='2430970'>rooted</span> <span m='2431240'>tree,</span> <span m='2432370'>give</span>
  <span m='2432550'>you</span> <span m='2432640'>a</span> <span m='2432680'>node,</span>
  <span m='2434150'>and</span> <span m='2434900'>a</span> <span m='2435290'>level</span>
  <span m='2436100'>that</span> <span m='2436250'>I</span> <span m='2436310'>want</span>
  <span m='2436490'>to</span> <span m='2436550'>go</span> <span m='2436730'>up,</span>
  <span m='2437750'>and</span> <span m='2437900'>then</span> <span m='2438050'>I</span>
  <span m='2438170'>level</span> <span m='2438530'>up</span> <span m='2438730'>by</span>
  <span m='2438960'>k,</span> <span m='2439620'>so I</span> <span m='2439940'>go</span>
  <span m='2440090'>to</span> <span m='2440180'>the</span> <span m='2440270'>kth</span>
  <span m='2440580'>ancestor,</span> <span m='2441960'>or</span> <span m='2442260'>parent</span>
  <span m='2442610'>to</span> <span m='2442730'>the</span> <span m='2442820'>k.</span>
  </p><p><span m='2445470'>This</span> <span m='2445580'>may</span> <span m='2445820'>seem</span>
  <span m='2446150'>superficially</span> <span m='2446810'>like</span> <span m='2447130'>LCA,</span>
  <span m='2447650'>but</span> <span m='2447860'>it's</span> <span m='2448040'>very</span>
  <span m='2448280'>different,</span> <span m='2449090'>because</span> <span m='2449510'>as</span>
  <span m='2449660'>you</span> <span m='2449780'>can</span> <span m='2449900'>see,</span>
  <span m='2450470'>RMQ</span> <span m='2450980'>was</span> <span m='2451160'>very</span>
  <span m='2451490'>specific</span> <span m='2451745'>to</span> <span m='2452000'>LCA.</span>
  <span m='2452540'>It's</span> <span m='2452660'>not</span> <span m='2452810'>going</span>
  <span m='2452930'>to</span> <span m='2453110'>let</span> <span m='2453290'>you</span>
  <span m='2453380'>solve</span> <span m='2453650'>level</span> <span m='2453890'>ancestors</span>
  <span m='2454430'>in</span> <span m='2454520'>any</span> <span m='2454700'>sense.</span>
  <span m='2456200'>I</span> <span m='2456260'>don't</span> <span m='2456440'>think.</span>
  <span m='2457400'>Maybe</span> <span m='2457610'>you</span> <span m='2457700'>could</span>
  <span m='2457820'>try</span> <span m='2458000'>to</span> <span m='2458090'>do</span>
  <span m='2458180'>the</span> <span m='2458270'>Cartesian</span> <span m='2458690'>tree</span>
  <span m='2458870'>reduction,</span> <span m='2459340'>but</span> <span m='2460810'>solution</span>
  <span m='2461420'>we'll</span> <span m='2461540'>see</span> <span m='2461750'>is</span>
  <span m='2461870'>completely</span> <span m='2462260'>different,</span> <span m='2463520'>although</span>
  <span m='2463790'>similar</span> <span m='2464180'>in</span> <span m='2464270'>spirit.</span>
  <span m='2465860'>So</span> <span m='2467030'>step</span> <span m='2467300'>1.</span>
  <span m='2469970'>This</span> <span m='2470120'>one's</span> <span m='2470260'>going</span>
  <span m='2470350'>to</span> <span m='2470480'>be</span> <span m='2470600'>a</span>
  <span m='2470660'>little</span> <span m='2470900'>bit</span> <span m='2471020'>less</span>
  <span m='2471230'>obvious</span> <span m='2471620'>that</span> <span m='2471740'>we</span>
  <span m='2471890'>will</span> <span m='2472100'>succeed.</span> <span m='2472980'>Here</span>
  <span m='2473750'>we</span> <span m='2473870'>started</span> <span m='2474140'>with</span>
  <span m='2474290'>n log</span> <span m='2474560'>n</span> <span m='2474800'>space</span>
  <span m='2475250'>which</span> <span m='2475370'>is</span> <span m='2475520'>shaving</span>
  <span m='2475860'>a log,</span> <span m='2476330'>no</span> <span m='2476450'>big</span>
  <span m='2476630'>deal.</span> <span m='2477300'>Here,</span> <span m='2477710'>I'm</span>
  <span m='2477830'>going</span> <span m='2477950'>to</span> <span m='2478040'>give</span>
  <span m='2478190'>you</span> <span m='2478310'>a</span> <span m='2478370'>couple</span>
  <span m='2478760'>of</span> <span m='2478820'>strategies</span> <span m='2479300'>that</span>
  <span m='2479420'>aren't</span> <span m='2479570'>even</span> <span m='2479780'>constant</span>
  <span m='2480160'>time,</span> <span m='2480500'>they're</span> <span m='2480650'>log</span>
  <span m='2481080'>time</span> <span m='2481310'>or</span> <span m='2481490'>worse.</span>
  <span m='2482690'>And</span> <span m='2482840'>yet</span> <span m='2483020'>you</span>
  <span m='2483140'>combine</span> <span m='2483590'>them</span> <span m='2483740'>and</span>
  <span m='2483830'>you</span> <span m='2483950'>get</span> <span m='2484070'>constant</span>
  <span m='2484370'>time.</span> <span m='2485951'>It's</span> <span m='2486380'>crazy.</span>
  </p><p><span m='2491490'>Again,</span> <span m='2492590'>each</span> <span m='2492830'>of</span>
  <span m='2492890'>the</span> <span m='2493220'>pieces</span> <span m='2493640'>is</span>
  <span m='2493760'>going</span> <span m='2493880'>to</span> <span m='2493970'>be</span>
  <span m='2494090'>pretty</span> <span m='2494660'>intuitive,</span> <span m='2495510'>not</span>
  <span m='2496460'>super</span> <span m='2496760'>surprising,</span> <span m='2502520'>but</span>
  <span m='2502730'>it's</span> <span m='2502880'>one</span> <span m='2503030'>of</span>
  <span m='2503090'>these</span> <span m='2503240'>things</span> <span m='2503480'>where</span>
  <span m='2503690'>you</span> <span m='2504140'>take</span> <span m='2504410'>all</span>
  <span m='2504530'>these</span> <span m='2504680'>ingredients</span> <span m='2505280'>that</span>
  <span m='2505400'>are</span> <span m='2505490'>all</span> <span m='2505610'>kind</span>
  <span m='2505790'>of</span> <span m='2505880'>obvious,</span> <span m='2506570'>you</span>
  <span m='2506630'>stare</span> <span m='2506870'>at</span> <span m='2506960'>them</span>
  <span m='2507110'>for</span> <span m='2507230'>a</span> <span m='2507290'>while</span>
  <span m='2507540'>like,</span> <span m='2507740'>oh,</span> <span m='2508160'>I</span>
  <span m='2508620'>put them</span> <span m='2508910'>together</span> <span m='2509270'>and</span>
  <span m='2509360'>it</span> <span m='2509420'>works.</span> <span m='2509750'>It's</span>
  <span m='2510080'>like</span> <span m='2510230'>magic.</span> <span m='2511490'>All</span>
  <span m='2511550'>right,</span> <span m='2511940'>so</span> <span m='2512600'>first</span>
  <span m='2512900'>goal</span> <span m='2513140'>is</span> <span m='2513230'>going</span>
  <span m='2513380'>to</span> <span m='2513440'>be</span> <span m='2513650'>n log</span>
  <span m='2514070'>n</span> <span m='2514190'>space,</span> <span m='2514820'>log</span>
  <span m='2515210'>n</span> <span m='2515380'>query.</span> <span m='2516920'>So</span>
  <span m='2516980'>here's</span> <span m='2517250'>a</span> <span m='2517340'>way</span>
  <span m='2517430'>to</span> <span m='2517550'>do</span> <span m='2517730'>it</span>
  <span m='2517850'>with</span> <span m='2518040'>a</span> <span m='2518120'>technique</span>
  <span m='2518510'>called</span> <span m='2518750'>jump</span> <span m='2519050'>pointers.</span>
  </p><p><span m='2527510'>In</span> <span m='2527600'>this</span> <span m='2527750'>case,</span>
  <span m='2527960'>nodes</span> <span m='2528200'>are</span> <span m='2528270'>going</span>
  <span m='2528350'>to</span> <span m='2528570'>have</span> <span m='2528800'>log</span>
  <span m='2529170'>n</span> <span m='2529310'>different</span> <span m='2529550'>pointers,</span>
  <span m='2531290'>and</span> <span m='2531530'>they're</span> <span m='2531680'>going</span>
  <span m='2531800'>to</span> <span m='2531860'>point</span> <span m='2532130'>to
  the</span> <span m='2532460'>2</span> <span m='2532790'>to the</span> <span m='2532940'>ith</span>
  <span m='2533180'>ancestor</span> <span m='2536210'>for</span> <span m='2536390'>all</span>
  <span m='2536640'>i.</span> <span m='2540281'>I</span> <span m='2540770'>guess</span>
  <span m='2540980'>maximum</span> <span m='2541400'>possible</span> <span m='2541790'>i</span>
  <span m='2541970'>would</span> <span m='2542090'>be</span> <span m='2542280'>log</span>
  <span m='2542575'>n.</span> <span m='2542870'>You can</span> <span m='2543020'>never</span>
  <span m='2543230'>go</span> <span m='2543510'>up</span> <span m='2543770'>more</span>
  <span m='2544010'>than</span> <span m='2544190'>n.</span> <span m='2546230'>So</span>
  <span m='2546650'>I</span> <span m='2546710'>mean,</span> <span m='2546890'>ideally</span>
  <span m='2547220'>you'd</span> <span m='2547370'>have</span> <span m='2547520'>a</span>
  <span m='2547580'>pointer</span> <span m='2547820'>to</span> <span m='2547940'>all</span>
  <span m='2548120'>your</span> <span m='2548270'>ancestors</span> <span m='2549150'>in</span>
  <span m='2549680'>array,</span> <span m='2550370'>boom.</span> <span m='2550660'>In</span>
  <span m='2550900'>the</span> <span m='2550970'>quadratic</span> <span m='2551360'>space,</span>
  <span m='2551720'>you</span> <span m='2551780'>solve</span> <span m='2552020'>your</span>
  <span m='2552140'>problem</span> <span m='2552500'>in</span> <span m='2552800'>constant</span>
  <span m='2553210'>time.</span> <span m='2553970'>But</span> <span m='2554530'>it's</span>
  <span m='2554660'>a</span> <span m='2554690'>little</span> <span m='2554870'>more</span>
  <span m='2555020'>interesting.</span> <span m='2555470'>Now</span> <span m='2555810'>every</span>
  <span m='2556460'>node</span> <span m='2556760'>only</span> <span m='2557060'>has</span>
  <span m='2557240'>pointers</span> <span m='2557720'>to</span> <span m='2558560'>log</span>
  <span m='2558800'>n</span> <span m='2558920'>different</span> <span m='2559160'>places</span>
  <span m='2559430'>so</span> <span m='2559700'>it's</span> <span m='2560070'>looking</span>
  <span m='2560420'>like</span> <span m='2561590'>this.</span> <span m='2564212'>This</span>
  <span m='2564650'>is</span> <span m='2564910'>the</span> <span m='2565040'>ancestor</span>
  <span m='2565520'>path.</span> <span m='2567950'>So</span> <span m='2568170'>n log</span>
  <span m='2568490'>n</span> <span m='2568610'>space,</span> <span m='2569150'>and</span>
  <span m='2569270'>I</span> <span m='2569330'>claim</span> <span m='2570010'>with</span>
  <span m='2570170'>this,</span> <span m='2570380'>you</span> <span m='2570470'>can</span>
  <span m='2570650'>roughly</span> <span m='2571100'>do</span> <span m='2571430'>a</span>
  <span m='2571580'>binary</span> <span m='2572000'>search,</span> <span m='2572960'>if</span>
  <span m='2573020'>you</span> <span m='2573140'>wanted</span> <span m='2573350'>to.</span>
  </p><p><span m='2574410'>Now</span> <span m='2575270'>we're</span> <span m='2575420'>not</span>
  <span m='2575570'>actually</span> <span m='2575780'>going</span> <span m='2575900'>to</span>
  <span m='2575960'>use</span> <span m='2576110'>this</span> <span m='2576230'>query</span>
  <span m='2576590'>algorithm</span> <span m='2576920'>for</span> <span m='2577040'>anything,</span>
  <span m='2577430'>but</span> <span m='2577660'>I'll</span> <span m='2577790'>write</span>
  <span m='2577970'>it</span> <span m='2578030'>down</span> <span m='2578270'>just</span>
  <span m='2579930'>so</span> <span m='2580240'>it</span> <span m='2580300'>feels</span>
  <span m='2580520'>like</span> <span m='2580670'>we've</span> <span m='2580820'>accomplished</span>
  <span m='2581270'>something,</span> <span m='2581780'>mainly</span> <span m='2582200'>log</span>
  <span m='2582470'>n</span> <span m='2582630'>query</span> <span m='2582920'>time.</span>
  <span m='2584030'>So</span> <span m='2586520'>what</span> <span m='2586700'>do</span>
  <span m='2586820'>I</span> <span m='2586940'>do?</span> <span m='2587390'>I</span>
  <span m='2587510'>set</span> <span m='2588110'>x</span> <span m='2588530'>to</span>
  <span m='2588710'>be</span> <span m='2589230'>the</span> <span m='2589970'>2</span>
  <span m='2590390'>to</span> <span m='2590540'>the</span> <span m='2590690'>floor</span>
  <span m='2591710'>log</span> <span m='2592520'>kth</span> <span m='2593990'>ancestor</span>
  <span m='2594590'>of</span> <span m='2594680'>x.</span> <span m='2597810'>OK,</span>
  <span m='2597930'>remember</span> <span m='2598460'>we're</span> <span m='2598610'>given</span>
  <span m='2598970'>a</span> <span m='2599060'>node</span> <span m='2599780'>x</span>
  <span m='2601610'>and</span> <span m='2602660'>a</span> <span m='2604310'>value</span>
  <span m='2604760'>k</span> <span m='2605000'>that</span> <span m='2605150'>we</span>
  <span m='2605270'>want</span> <span m='2605420'>to</span> <span m='2605510'>rise</span>
  <span m='2605900'>by.</span> <span m='2606530'>So</span> <span m='2606680'>I</span>
  <span m='2606770'>take</span> <span m='2607040'>the</span> <span m='2607130'>power</span>
  <span m='2607430'>of</span> <span m='2607570'>2</span> <span m='2608300'>just</span>
  <span m='2608660'>below</span> <span m='2609080'>k--</span> <span m='2609430'>that's</span>
  <span m='2609650'>2</span> <span m='2609890'>the</span> <span m='2609980'>floor</span>
  <span m='2610220'>log</span> <span m='2610440'>k.</span> <span m='2611150'>I</span>
  <span m='2611270'>go</span> <span m='2611450'>up</span> <span m='2611670'>that</span>
  <span m='2611810'>much,</span> <span m='2612550'>and</span> <span m='2612720'>that's</span>
  <span m='2612950'>my</span> <span m='2613070'>new</span> <span m='2613220'>x,</span>
  <span m='2613580'>and</span> <span m='2613700'>then</span> <span m='2613820'>I</span>
  <span m='2613880'>set</span> <span m='2614120'>k</span> <span m='2614480'>to</span>
  <span m='2614660'>be</span> <span m='2615650'>k</span> <span m='2616040'>minus</span>
  <span m='2617030'>that</span> <span m='2617330'>value.</span> <span m='2618560'>That's</span>
  <span m='2618740'>how</span> <span m='2618860'>much</span> <span m='2619070'>I</span>
  <span m='2619130'>have</span> <span m='2619310'>left</span> <span m='2619550'>to</span>
  <span m='2619670'>go.</span> </p><p><span m='2621490'>OK.</span> <span m='2621800'>This</span>
  <span m='2622100'>thing</span> <span m='2622400'>will</span> <span m='2622550'>be</span>
  <span m='2622760'>less</span> <span m='2623090'>than</span> <span m='2623210'>k</span>
  <span m='2623390'>over</span> <span m='2623570'>2.</span> <span m='2625430'>Because</span>
  <span m='2626180'>the</span> <span m='2626420'>next</span> <span m='2626720'>previous</span>
  <span m='2627200'>power</span> <span m='2627470'>of</span> <span m='2627530'>2</span>
  <span m='2627890'>is</span> <span m='2628250'>at</span> <span m='2628310'>least,</span>
  <span m='2628550'>is</span> <span m='2628700'>bigger</span> <span m='2628970'>than</span>
  <span m='2629120'>half</span> <span m='2629480'>of</span> <span m='2630410'>the</span>
  <span m='2630470'>thing.</span> <span m='2630710'>So</span> <span m='2630830'>we</span>
  <span m='2630920'>got</span> <span m='2631160'>more</span> <span m='2631370'>than</span>
  <span m='2631460'>halfway</span> <span m='2631840'>there,</span> <span m='2632690'>and</span>
  <span m='2632810'>so</span> <span m='2632990'>after</span> <span m='2633230'>log</span>
  <span m='2633480'>n</span> <span m='2633590'>iterations,</span> <span m='2634100'>we'll</span>
  <span m='2634250'>actually</span> <span m='2634520'>get</span> <span m='2634700'>there.</span>
  <span m='2635950'>That's</span> <span m='2636170'>pretty</span> <span m='2636350'>easy.</span>
  <span m='2638250'>That's</span> <span m='2638350'>jump</span> <span m='2638520'>pointers</span>
  <span m='2641420'>to</span> <span m='2641750'>two</span> <span m='2641990'>logs</span>
  <span m='2642380'>that</span> <span m='2642500'>we</span> <span m='2642590'>need</span>
  <span m='2642710'>to</span> <span m='2642800'>get</span> <span m='2642950'>rid</span>
  <span m='2643100'>of,</span> <span m='2644120'>and</span> <span m='2644210'>yes,</span>
  <span m='2644510'>we</span> <span m='2644630'>will</span> <span m='2644810'>use</span>
  <span m='2644960'>indirection,</span> <span m='2645530'>but</span> <span m='2645650'>not</span>
  <span m='2645830'>yet.</span> <span m='2654590'>First,</span> <span m='2654730'>we</span>
  <span m='2654850'>need</span> <span m='2655210'>some</span> <span m='2655960'>more</span>
  <span m='2656200'>ingredients.</span> </p><p><span m='2661270'>This</span> <span
  m='2661450'>next</span> <span m='2661720'>ingredient</span> <span m='2662200'>is</span>
  <span m='2662380'>kind</span> <span m='2662560'>of</span> <span m='2662620'>funny,</span>
  <span m='2662920'>because</span> <span m='2663100'>it</span> <span m='2663190'>will</span>
  <span m='2663310'>seem</span> <span m='2663580'>useless.</span> <span m='2665180'>But</span>
  <span m='2665560'>in</span> <span m='2665680'>fact,</span> <span m='2666140'>it</span>
  <span m='2666160'>is</span> <span m='2666310'>useful</span> <span m='2667570'>as</span>
  <span m='2667720'>a</span> <span m='2667780'>step</span> <span m='2668080'>towards</span>
  <span m='2668450'>ingredient</span> <span m='2668910'>3.</span> <span m='2670000'>So</span>
  <span m='2670160'>the</span> <span m='2670200'>next</span> <span m='2670450'>trick</span>
  <span m='2670720'>is</span> <span m='2670840'>called</span> <span m='2671140'>long</span>
  <span m='2671650'>path</span> <span m='2672150'>decomposition.</span> <span m='2680170'>In</span>
  <span m='2680650'>general,</span> <span m='2680980'>this</span> <span m='2681160'>class</span>
  <span m='2681640'>covers</span> <span m='2682000'>a</span> <span m='2682060'>lot</span>
  <span m='2682270'>of</span> <span m='2682330'>different</span> <span m='2682630'>treaty</span>
  <span m='2682960'>compositions.</span> <span m='2685030'>We</span> <span m='2685210'>did</span>
  <span m='2685600'>preferred</span> <span m='2686110'>path</span> <span m='2686560'>decomposition</span>
  <span m='2687080'>for</span> <span m='2687220'>tango</span> <span m='2687580'>trees.</span>
  <span m='2689160'>We're</span> <span m='2689470'>going</span> <span m='2689640'>to</span>
  <span m='2689710'>do</span> <span m='2689800'>long</span> <span m='2690040'>path</span>
  <span m='2690370'>now.</span> <span m='2690700'>We'll</span> <span m='2690760'>do</span>
  <span m='2690880'>another</span> <span m='2691090'>one</span> <span m='2691210'>called</span>
  <span m='2691360'>heavy</span> <span m='2691630'>path</span> <span m='2691990'>later.</span>
  <span m='2692800'>There's</span> <span m='2693010'>a</span> <span m='2693070'>lot</span>
  <span m='2693220'>of</span> <span m='2693310'>them</span> <span m='2693430'>out</span>
  <span m='2693580'>there.</span> <span m='2694270'>This</span> <span m='2694450'>one</span>
  <span m='2695260'>won't</span> <span m='2695440'>seem</span> <span m='2695650'>very</span>
  <span m='2695830'>useful</span> <span m='2696190'>at</span> <span m='2696250'>first,</span>
  <span m='2696730'>because</span> <span m='2697490'>while</span> <span m='2697720'>it</span>
  <span m='2697780'>will</span> <span m='2697960'>achieve</span> <span m='2698260'>linear</span>
  <span m='2698590'>space,</span> <span m='2700420'>it</span> <span m='2700540'>will</span>
  <span m='2700690'>achieve</span> <span m='2701470'>the</span> <span m='2701560'>amazing</span>
  <span m='2702120'>square</span> <span m='2702490'>root</span> <span m='2702670'>of</span>
  <span m='2702760'>n</span> <span m='2702910'>query,</span> <span m='2704380'>which</span>
  <span m='2704650'>I</span> <span m='2704740'>guess</span> <span m='2705580'>is</span>
  <span m='2705820'>new.</span> <span m='2706270'>I</span> <span m='2706330'>mean,</span>
  <span m='2706630'>we</span> <span m='2706720'>don't</span> <span m='2706870'>know</span>
  <span m='2707020'>how</span> <span m='2707110'>to</span> <span m='2707200'>do</span>
  <span m='2707350'>that</span> <span m='2707560'>yet</span> <span m='2708040'>with</span>
  <span m='2708180'>linear</span> <span m='2708460'>space.</span> <span m='2710860'>Not</span>
  <span m='2711040'>so</span> <span m='2711250'>obvious</span> <span m='2711550'>how</span>
  <span m='2711630'>to</span> <span m='2711730'>get</span> <span m='2711930'>root</span>
  <span m='2712060'>n.</span> </p><p><span m='2712240'>But</span> <span m='2712450'>anyway,</span>
  <span m='2714190'>don't</span> <span m='2714730'>worry</span> <span m='2714970'>about</span>
  <span m='2715210'>the</span> <span m='2715300'>query</span> <span m='2715570'>time.</span>
  <span m='2716680'>It's</span> <span m='2716770'>more</span> <span m='2716940'>the</span>
  <span m='2717040'>concept</span> <span m='2717550'>of</span> <span m='2717640'>long</span>
  <span m='2717880'>path</span> <span m='2718270'>that's</span> <span m='2718420'>interesting.</span>
  <span m='2718960'>It's</span> <span m='2719110'>a</span> <span m='2719170'>step</span>
  <span m='2719500'>in</span> <span m='2719590'>the</span> <span m='2719650'>right</span>
  <span m='2719830'>direction.</span> <span m='2721580'>So</span> <span m='2721630'>here's</span>
  <span m='2721870'>what</span> <span m='2722050'>here's</span> <span m='2722290'>how</span>
  <span m='2722440'>we're</span> <span m='2722530'>going</span> <span m='2722650'>to</span>
  <span m='2722710'>decompose</span> <span m='2723250'>a</span> <span m='2723370'>tree.</span>
  <span m='2723820'>First</span> <span m='2724060'>thing</span> <span m='2724240'>we</span>
  <span m='2724330'>do</span> <span m='2725020'>is</span> <span m='2725170'>find</span>
  <span m='2726400'>the</span> <span m='2726520'>longest</span> <span m='2728510'>route</span>
  <span m='2729020'>to</span> <span m='2729220'>leaf</span> <span m='2729490'>path</span>
  <span m='2730570'>in</span> <span m='2730690'>the</span> <span m='2730780'>tree,</span>
  <span m='2735160'>because</span> <span m='2735370'>if</span> <span m='2735490'>you</span>
  <span m='2735580'>look</span> <span m='2735760'>at</span> <span m='2735850'>a</span>
  <span m='2735910'>tree,</span> <span m='2736940'>it</span> <span m='2737040'>has</span>
  <span m='2737110'>some</span> <span m='2738820'>wavy</span> <span m='2739180'>bottom.</span>
  <span m='2739690'>Take</span> <span m='2739930'>the</span> <span m='2740020'>deepest</span>
  <span m='2740440'>node.</span> <span m='2741400'>Take</span> <span m='2741580'>the</span>
  <span m='2741670'>path</span> <span m='2742210'>the</span> <span m='2742300'>unique</span>
  <span m='2742540'>path</span> <span m='2742780'>from</span> <span m='2742930'>the</span>
  <span m='2743020'>root</span> <span m='2743170'>to</span> <span m='2743290'>that</span>
  <span m='2743440'>node.</span> <span m='2744870'>OK.</span> </p><p><span m='2745630'>When</span>
  <span m='2745750'>I</span> <span m='2745840'>do</span> <span m='2746020'>that,</span>
  <span m='2747390'>I</span> <span m='2747510'>could</span> <span m='2747710'>imagine</span>
  <span m='2748180'>deleting</span> <span m='2748600'>those</span> <span m='2748810'>nodes.</span>
  <span m='2749410'>I</span> <span m='2749440'>mean,</span> <span m='2750230'>there's</span>
  <span m='2750430'>that</span> <span m='2750610'>path,</span> <span m='2750970'>and</span>
  <span m='2751060'>then</span> <span m='2751180'>there's</span> <span m='2751330'>everything</span>
  <span m='2751720'>else,</span> <span m='2751990'>which</span> <span m='2752140'>means</span>
  <span m='2752890'>there's</span> <span m='2753040'>all</span> <span m='2753220'>these</span>
  <span m='2753700'>triangles</span> <span m='2754300'>hanging</span> <span m='2754750'>off</span>
  <span m='2755080'>of</span> <span m='2755950'>that</span> <span m='2756160'>path,</span>
  <span m='2756520'>some</span> <span m='2756730'>on</span> <span m='2756820'>the</span>
  <span m='2756910'>left,</span> <span m='2758050'>some</span> <span m='2758320'>on</span>
  <span m='2758410'>the</span> <span m='2758500'>right.</span> <span m='2760400'>Actually,</span>
  <span m='2762090'>I</span> <span m='2763440'>haven't</span> <span m='2763660'>talked</span>
  <span m='2763930'>about</span> <span m='2764170'>this,</span> <span m='2764440'>but</span>
  <span m='2765220'>both</span> <span m='2765460'>LCA</span> <span m='2766210'>and</span>
  <span m='2766690'>level</span> <span m='2766960'>ancestors</span> <span m='2769300'>work</span>
  <span m='2769540'>not</span> <span m='2769720'>just</span> <span m='2769900'>for</span>
  <span m='2769990'>binary</span> <span m='2770350'>trees.</span> <span m='2770620'>They</span>
  <span m='2770740'>work</span> <span m='2770890'>for</span> <span m='2771010'>arbitrary</span>
  <span m='2771460'>trees.</span> </p><p><span m='2773000'>And</span> <span m='2773200'>somewhere</span>
  <span m='2773740'>along</span> <span m='2774070'>here--</span> <span m='2775660'>yeah,</span>
  <span m='2776830'>here.</span> <span m='2777760'>This</span> <span m='2777970'>reduction</span>
  <span m='2778570'>of</span> <span m='2778720'>using</span> <span m='2779020'>the</span>
  <span m='2779110'>Euler</span> <span m='2779440'>tour</span> <span m='2780250'>works</span>
  <span m='2780550'>for</span> <span m='2780670'>non-binary</span> <span m='2781360'>trees,</span>
  <span m='2781690'>too.</span> <span m='2782500'>That's</span> <span m='2782680'>actually</span>
  <span m='2783070'>another</span> <span m='2783400'>reason</span> <span m='2783730'>why</span>
  <span m='2783880'>this</span> <span m='2784090'>reduction</span> <span m='2784570'>is</span>
  <span m='2784690'>better</span> <span m='2785080'>than</span> <span m='2785410'>in-order</span>
  <span m='2785810'>traversal</span> <span m='2786370'>by</span> <span m='2786520'>itself.</span>
  <span m='2787330'>In-order</span> <span m='2787600'>traversal</span> <span m='2788050'>works</span>
  <span m='2788320'>only</span> <span m='2788650'>for</span> <span m='2789580'>binary</span>
  <span m='2789940'>trees.</span> <span m='2790630'>This</span> <span m='2790780'>thing</span>
  <span m='2790990'>works</span> <span m='2791170'>for</span> <span m='2791290'>any</span>
  <span m='2791470'>tree.</span> <span m='2792190'>In</span> <span m='2792340'>that</span>
  <span m='2792490'>case,</span> <span m='2793020'>in</span> <span m='2793180'>an</span>
  <span m='2793270'>arbitrary</span> <span m='2793660'>tree,</span> <span m='2793900'>you</span>
  <span m='2794020'>visit</span> <span m='2794350'>the</span> <span m='2794430'>node</span>
  <span m='2794670'>many,</span> <span m='2795020'>many</span> <span m='2795130'>times</span>
  <span m='2795490'>potentially.</span> <span m='2796300'>OK,</span> <span m='2796660'>but
  it will</span> <span m='2796950'>still</span> <span m='2797110'>be</span> <span
  m='2797240'>linear</span> <span m='2797500'>space</span> <span m='2797980'>and</span>
  <span m='2798790'>everything</span> <span m='2799060'>will</span> <span m='2799150'>still</span>
  <span m='2799330'>work.</span> </p><p><span m='2799930'>Here</span> <span m='2800200'>also,</span>
  <span m='2800620'>I</span> <span m='2800710'>want</span> <span m='2800890'>to</span>
  <span m='2800980'>handle</span> <span m='2801340'>non-binary</span> <span m='2801880'>trees.</span>
  <span m='2802210'>So</span> <span m='2803230'>I'm</span> <span m='2803290'>going</span>
  <span m='2803410'>to</span> <span m='2803470'>draw</span> <span m='2803980'>things</span>
  <span m='2804250'>hanging</span> <span m='2804550'>off,</span> <span m='2804730'>but</span>
  <span m='2804850'>in</span> <span m='2804910'>fact,</span> <span m='2805090'>there</span>
  <span m='2805180'>might</span> <span m='2805330'>be</span> <span m='2805450'>several</span>
  <span m='2805780'>things</span> <span m='2806020'>hanging</span> <span m='2806320'>off</span>
  <span m='2806500'>here,</span> <span m='2806690'>each</span> <span m='2807530'>their</span>
  <span m='2807710'>own</span> <span m='2807890'>little</span> <span m='2808090'>tree.</span>
  <span m='2809200'>OK,</span> <span m='2809410'>but</span> <span m='2809560'>the</span>
  <span m='2809650'>point</span> <span m='2809860'>is--</span> <span m='2810910'>where's</span>
  <span m='2811270'>my</span> <span m='2811430'>red.</span> <span m='2814690'>Here.</span>
  <span m='2816300'>There</span> <span m='2816490'>was</span> <span m='2816610'>this</span>
  <span m='2816760'>one</span> <span m='2817060'>path</span> <span m='2817380'>in</span>
  <span m='2817450'>the</span> <span m='2817540'>beginning,</span> <span m='2818080'>the</span>
  <span m='2818170'>longest</span> <span m='2818560'>path,</span> <span m='2819850'>and</span>
  <span m='2819940'>then</span> <span m='2820060'>there's</span> <span m='2820180'>stuff</span>
  <span m='2820450'>hanging</span> <span m='2820780'>off</span> <span m='2820960'>of</span>
  <span m='2821050'>it.</span> <span m='2821680'>So</span> <span m='2821830'>just</span>
  <span m='2822010'>recurse</span> <span m='2822295'>on</span> <span m='2822580'>all</span>
  <span m='2822670'>the</span> <span m='2822790'>things</span> <span m='2823000'>hanging</span>
  <span m='2823300'>off</span> <span m='2823480'>of</span> <span m='2823600'>it.</span>
  <span m='2825760'>Recursively</span> <span m='2826330'>decompose</span> <span m='2827350'>those</span>
  <span m='2827950'>sub-trees.</span> </p><p><span m='2848032'>OK.</span> <span m='2849540'>Not</span>
  <span m='2849720'>clear</span> <span m='2849930'>what</span> <span m='2850040'>this</span>
  <span m='2850170'>is</span> <span m='2850230'>going</span> <span m='2850350'>to</span>
  <span m='2850440'>give</span> <span m='2850620'>you.</span> <span m='2850770'>In</span>
  <span m='2850890'>fact,</span> <span m='2851230'>it's</span> <span m='2851330'>not</span>
  <span m='2851370'>going</span> <span m='2851490'>to</span> <span m='2851550'>be</span>
  <span m='2851640'>so</span> <span m='2852000'>awesome,</span> <span m='2852390'>but</span>
  <span m='2852540'>it</span> <span m='2852660'>will</span> <span m='2852810'>be</span>
  <span m='2852960'>a</span> <span m='2852990'>starting</span> <span m='2853350'>point.</span>
  <span m='2855140'>Now</span> <span m='2855300'>you</span> <span m='2855480'>can</span>
  <span m='2855750'>answer</span> <span m='2856020'>a</span> <span m='2856080'>query</span>
  <span m='2856470'>with</span> <span m='2856680'>this,</span> <span m='2857640'>as</span>
  <span m='2857790'>follows.</span> <span m='2860440'>Query--</span> <span m='2862890'>oh,</span>
  <span m='2863130'>sorry.</span> <span m='2863400'>I</span> <span m='2863460'>should</span>
  <span m='2863640'>say</span> <span m='2863970'>how</span> <span m='2864120'>we're</span>
  <span m='2864210'>actually</span> <span m='2864450'>storing</span> <span m='2865320'>these</span>
  <span m='2865470'>paths.</span> <span m='2866340'>Here's</span> <span m='2867190'>the</span>
  <span m='2867780'>cool</span> <span m='2868020'>idea</span> <span m='2868770'>with</span>
  <span m='2868890'>this</span> <span m='2869040'>path</span> <span m='2869610'>thing.</span>
  <span m='2870260'>I</span> <span m='2870670'>have</span> <span m='2870910'>this</span>
  <span m='2871050'>path.</span> <span m='2872130'>I'd</span> <span m='2872280'>like</span>
  <span m='2872460'>to</span> <span m='2872610'>be</span> <span m='2872670'>able</span>
  <span m='2872820'>to</span> <span m='2872940'>jump</span> <span m='2873240'>around</span>
  <span m='2873690'>at</span> <span m='2873780'>least--</span> <span m='2874770'>suppose</span>
  <span m='2875070'>your</span> <span m='2875160'>tree</span> <span m='2875370'>was</span>
  <span m='2875550'>a</span> <span m='2875610'>path.</span> <span m='2876500'>Suppose</span>
  <span m='2876660'>your</span> <span m='2876810'>tree</span> <span m='2877020'>were</span>
  <span m='2877260'>a</span> <span m='2877380'>path.</span> <span m='2878160'>Then</span>
  <span m='2878790'>what</span> <span m='2878910'>would</span> <span m='2879030'>you</span>
  <span m='2879120'>want</span> <span m='2879270'>to</span> <span m='2879330'>do?</span>
  <span m='2879930'>Store</span> <span m='2880230'>the</span> <span m='2880320'>nodes</span>
  <span m='2880740'>in</span> <span m='2880920'>an</span> <span m='2881040'>array</span>
  <span m='2882030'>ordered</span> <span m='2882360'>by</span> <span m='2882660'>depth,</span>
  <span m='2883610'>because</span> <span m='2883770'>then</span> <span m='2883890'>if</span>
  <span m='2884010'>you're</span> <span m='2884130'>a</span> <span m='2884190'>position</span>
  <span m='2884610'>i</span> <span m='2884940'>and</span> <span m='2885040'>you</span>
  <span m='2885060'>need</span> <span m='2885210'>to</span> <span m='2885300'>go</span>
  <span m='2885450'>to</span> <span m='2885630'>position</span> <span m='2886200'>i</span>
  <span m='2886420'>minus</span> <span m='2886910'>k,</span> <span m='2887520'>boom.</span>
  <span m='2887820'>That's</span> <span m='2888150'>just</span> <span m='2888340'>a</span>
  <span m='2888420'>look</span> <span m='2888630'>up</span> <span m='2888780'>into</span>
  <span m='2888960'>your</span> <span m='2889110'>array.</span> </p><p><span m='2889990'>So</span>
  <span m='2890010'>I'm</span> <span m='2890070'>going</span> <span m='2890190'>to</span>
  <span m='2890250'>store</span> <span m='2890580'>each</span> <span m='2890790'>path</span>
  <span m='2891720'>as</span> <span m='2891900'>an</span> <span m='2891990'>array,</span>
  <span m='2897610'>as</span> <span m='2899430'>an</span> <span m='2899550'>array</span>
  <span m='2903180'>of</span> <span m='2903300'>nodes</span> <span m='2904950'>or</span>
  <span m='2905070'>node</span> <span m='2905280'>pointers,</span> <span m='2905760'>I</span>
  <span m='2905820'>guess,</span> <span m='2907770'>ordered</span> <span m='2908100'>by</span>
  <span m='2908310'>depth.</span> <span m='2910080'>So</span> <span m='2910560'>if</span>
  <span m='2910860'>it</span> <span m='2910950'>happens,</span> <span m='2912100'>so</span>
  <span m='2912180'>if</span> <span m='2912870'>my</span> <span m='2913050'>query</span>
  <span m='2913470'>value</span> <span m='2913770'>x</span> <span m='2914190'>is</span>
  <span m='2914370'>somewhere</span> <span m='2914670'>on</span> <span m='2914820'>this</span>
  <span m='2915420'>path,</span> <span m='2916950'>and</span> <span m='2917760'>if</span>
  <span m='2918600'>this</span> <span m='2918810'>path</span> <span m='2919290'>encompasses</span>
  <span m='2920010'>where</span> <span m='2920160'>I</span> <span m='2920250'>need</span>
  <span m='2920430'>to</span> <span m='2920550'>go--</span> <span m='2920980'>so</span>
  <span m='2921210'>if</span> <span m='2921450'>I</span> <span m='2921750'>need</span>
  <span m='2921960'>to</span> <span m='2922050'>go</span> <span m='2922180'>k</span>
  <span m='2922500'>up</span> <span m='2922710'>and</span> <span m='2922830'>I</span>
  <span m='2922890'>end</span> <span m='2923010'>up</span> <span m='2923160'>here--</span>
  <span m='2924240'>then</span> <span m='2924420'>that's</span> <span m='2924630'>instantaneous.</span>
  <span m='2925890'>The</span> <span m='2926010'>trouble</span> <span m='2926370'>would</span>
  <span m='2926550'>be</span> <span m='2927030'>is</span> <span m='2927240'>if</span>
  <span m='2927390'>I</span> <span m='2927480'>have</span> <span m='2927690'>a</span>
  <span m='2927750'>query,</span> <span m='2928270'>let's</span> <span m='2928350'>say,</span>
  <span m='2928650'>over</span> <span m='2929010'>here.</span> <span m='2930530'>And</span>
  <span m='2930690'>so</span> <span m='2930900'>there's</span> <span m='2931050'>going</span>
  <span m='2931210'>to</span> <span m='2931290'>be</span> <span m='2932130'>a</span>
  <span m='2932400'>path</span> <span m='2933720'>that</span> <span m='2933890'>guy</span>
  <span m='2934020'>lives</span> <span m='2934260'>on,</span> <span m='2935190'>but</span>
  <span m='2935370'>maybe</span> <span m='2935670'>the kth</span> <span m='2935980'>ancestor</span>
  <span m='2936600'>is</span> <span m='2936660'>not</span> <span m='2936840'>on</span>
  <span m='2937050'>that</span> <span m='2937200'>path.</span> <span m='2937540'>It</span>
  <span m='2937620'>could</span> <span m='2937800'>be</span> <span m='2937950'>on</span>
  <span m='2938100'>a</span> <span m='2938160'>higher</span> <span m='2938460'>up</span>
  <span m='2938580'>path.</span> <span m='2939910'>It</span> <span m='2940110'>could</span>
  <span m='2940260'>be</span> <span m='2940350'>on</span> <span m='2940440'>the</span>
  <span m='2940530'>red</span> <span m='2940710'>path,</span> <span m='2941060'>and</span>
  <span m='2941160'>I</span> <span m='2941220'>can't</span> <span m='2941460'>jump</span>
  <span m='2941700'>there</span> <span m='2941850'>instantaneously.</span> </p><p><span
  m='2943710'>Nonetheless,</span> <span m='2944130'>there</span> <span m='2944310'>is</span>
  <span m='2944490'>a</span> <span m='2944640'>decent</span> <span m='2945090'>query</span>
  <span m='2945420'>algorithm</span> <span m='2945810'>here.</span> <span m='2947200'>All</span>
  <span m='2947340'>right.</span> <span m='2951230'>So</span> <span m='2956124'>Here's
  what</span> <span m='2956610'>we're going to</span> <span m='2956860'>do.</span>
  <span m='2957900'>If</span> <span m='2962400'>k</span> <span m='2962850'>is</span>
  <span m='2963030'>less</span> <span m='2963270'>than</span> <span m='2963390'>or</span>
  <span m='2963450'>equal</span> <span m='2963690'>to</span> <span m='2965160'>the</span>
  <span m='2965430'>index</span> <span m='2966810'>i</span> <span m='2968056'>of</span>
  <span m='2968430'>node</span> <span m='2969970'>x</span> <span m='2971400'>on</span>
  <span m='2971670'>its</span> <span m='2971820'>path.</span> <span m='2977580'>So</span>
  <span m='2977730'>every</span> <span m='2978060'>node</span> <span m='2978270'>belongs</span>
  <span m='2978660'>to</span> <span m='2978780'>exactly</span> <span m='2979260'>one</span>
  <span m='2979470'>path.</span> <span m='2980130'>This is</span> <span m='2980350'>a</span>
  <span m='2980490'>path</span> <span m='2981030'>decomposition.</span> <span m='2981840'>It's</span>
  <span m='2981960'>a</span> <span m='2982020'>partition</span> <span m='2982590'>of</span>
  <span m='2982710'>the</span> <span m='2982800'>tree</span> <span m='2983100'>into</span>
  <span m='2983310'>paths.</span> <span m='2985110'>Not</span> <span m='2985290'>all</span>
  <span m='2985380'>the</span> <span m='2985500'>edges</span> <span m='2985770'>are</span>
  <span m='2985830'>represented,</span> <span m='2986370'>but</span> <span m='2986490'>all</span>
  <span m='2986700'>the</span> <span m='2986880'>nodes</span> <span m='2987210'>are</span>
  <span m='2987300'>there.</span> <span m='2988980'>All</span> <span m='2989160'>the</span>
  <span m='2989250'>nodes</span> <span m='2989580'>belong</span> <span m='2989880'>to</span>
  <span m='2989940'>some</span> <span m='2990150'>path,</span> <span m='2993020'>and</span>
  <span m='2993300'>we're</span> <span m='2993450'>going</span> <span m='2993570'>to</span>
  <span m='2993630'>store,</span> <span m='2994020'>for</span> <span m='2994200'>every</span>
  <span m='2994440'>node,</span> <span m='2995640'>store</span> <span m='2996000'>what</span>
  <span m='2996150'>its</span> <span m='2996270'>index</span> <span m='2996585'>is</span>
  <span m='2996900'>and</span> <span m='2997470'>where</span> <span m='2997680'>it</span>
  <span m='2997770'>lives</span> <span m='2998070'>in</span> <span m='2998220'>its</span>
  <span m='2998490'>array.</span> </p><p><span m='2999780'>So</span> <span m='2999930'>look</span>
  <span m='3000140'>at</span> <span m='3000260'>that</span> <span m='3000500'>index</span>
  <span m='3001070'>in</span> <span m='3001160'>the</span> <span m='3001280'>array.</span>
  <span m='3002330'>If</span> <span m='3002510'>k</span> <span m='3002810'>is</span>
  <span m='3002930'>less</span> <span m='3003170'>than</span> <span m='3003290'>or</span>
  <span m='3003350'>equal</span> <span m='3003650'>to</span> <span m='3003920'>that</span>
  <span m='3004190'>index,</span> <span m='3005330'>then</span> <span m='3006380'>we</span>
  <span m='3006560'>can</span> <span m='3006680'>solve</span> <span m='3006980'>our</span>
  <span m='3007040'>problem</span> <span m='3007430'>instantly</span> <span m='3008810'>by</span>
  <span m='3009680'>looking</span> <span m='3010070'>at</span> <span m='3010160'>the</span>
  <span m='3010280'>path</span> <span m='3010610'>array</span> <span m='3012440'>at</span>
  <span m='3012590'>position</span> <span m='3014196'>i</span> <span m='3014670'>minus</span>
  <span m='3015090'>k.</span> <span m='3015590'>That's</span> <span m='3015770'>what</span>
  <span m='3015860'>I</span> <span m='3015950'>said</span> <span m='3016130'>before.</span>
  <span m='3017930'>If</span> <span m='3018110'>our</span> <span m='3018610'>kth</span>
  <span m='3018840'>ancestor</span> <span m='3019360'>is</span> <span m='3019520'>within</span>
  <span m='3019760'>the</span> <span m='3019850'>path,</span> <span m='3020210'>then</span>
  <span m='3020390'>that's</span> <span m='3020630'>where</span> <span m='3020780'>it</span>
  <span m='3020840'>will</span> <span m='3020960'>be,</span> <span m='3021880'>and</span>
  <span m='3022030'>that's</span> <span m='3022190'>going</span> <span m='3022310'>to</span>
  <span m='3022370'>work</span> <span m='3022610'>as</span> <span m='3022730'>long</span>
  <span m='3022910'>as</span> <span m='3023030'>that</span> <span m='3023240'>is</span>
  <span m='3023450'>non-negative.</span> <span m='3025260'>If</span> <span m='3025360'>I</span>
  <span m='3025430'>get to</span> <span m='3025610'>negative,</span> <span m='3025970'>that</span>
  <span m='3026120'>means</span> <span m='3026300'>it's</span> <span m='3026470'>another</span>
  <span m='3026780'>path.</span> <span m='3028380'>So</span> <span m='3028460'>that's</span>
  <span m='3028770'>the</span> <span m='3028880'>good</span> <span m='3029090'>case.</span>
  </p><p><span m='3030590'>The</span> <span m='3030740'>other</span> <span m='3030950'>case</span>
  <span m='3032330'>is</span> <span m='3034030'>we're</span> <span m='3034280'>just</span>
  <span m='3034490'>going</span> <span m='3034670'>to</span> <span m='3034780'>do</span>
  <span m='3034970'>some</span> <span m='3035630'>recursion,</span> <span m='3036140'>essentially.</span>
  <span m='3041100'>So</span> <span m='3041180'>we're</span> <span m='3041240'>going</span>
  <span m='3041360'>to</span> <span m='3041450'>go</span> <span m='3041570'>as</span>
  <span m='3041690'>high</span> <span m='3041960'>as</span> <span m='3042080'>we</span>
  <span m='3042230'>can</span> <span m='3042500'>with</span> <span m='3042650'>this</span>
  <span m='3042830'>path.</span> <span m='3043460'>We're</span> <span m='3043550'>going</span>
  <span m='3043670'>to</span> <span m='3043730'>look</span> <span m='3043910'>at</span>
  <span m='3044030'>path</span> <span m='3044360'>array</span> <span m='3045500'>at</span>
  <span m='3045620'>position</span> <span m='3046180'>0.</span> <span m='3047420'>Go</span>
  <span m='3047570'>to</span> <span m='3047660'>the</span> <span m='3047780'>parent</span>
  <span m='3048350'>of</span> <span m='3048440'>that.</span> <span m='3048710'>Let's</span>
  <span m='3048860'>suppose</span> <span m='3049160'>every</span> <span m='3049370'>node</span>
  <span m='3049580'>has</span> <span m='3049760'>a</span> <span m='3049790'>parent</span>
  <span m='3050060'>pointer.</span> <span m='3050450'>That's</span> <span m='3050660'>easy,</span>
  <span m='3051400'>regular</span> <span m='3051800'>tree,</span> <span m='3052880'>and</span>
  <span m='3053030'>then</span> <span m='3053240'>decrease</span> <span m='3054950'>k</span>
  <span m='3055640'>by</span> <span m='3057650'>1</span> <span m='3057950'>plus</span>
  <span m='3058220'>i.</span> <span m='3059940'>So</span> <span m='3060450'>the</span>
  <span m='3060620'>array</span> <span m='3060890'>let</span> <span m='3061070'>us</span>
  <span m='3061220'>jump</span> <span m='3061490'>up</span> <span m='3061710'>i</span>
  <span m='3061940'>steps--</span> <span m='3062570'>that's</span> <span m='3062930'>this</span>
  <span m='3063110'>part--</span> <span m='3064400'>and</span> <span m='3064580'>then</span>
  <span m='3064760'>the</span> <span m='3064850'>parent</span> <span m='3066130'>stepped
  us</span> <span m='3066560'>up</span> <span m='3066680'>one</span> <span m='3066890'>more</span>
  <span m='3067100'>step.</span> <span m='3067460'>That's</span> <span m='3067640'>just</span>
  <span m='3067820'>to</span> <span m='3067910'>get</span> <span m='3068090'>to</span>
  <span m='3068210'>the</span> <span m='3068330'>next</span> <span m='3068630'>path</span>
  <span m='3068960'>above</span> <span m='3069230'>us.</span> </p><p><span m='3070910'>OK,</span>
  <span m='3071150'>so</span> <span m='3071330'>how</span> <span m='3071540'>much</span>
  <span m='3071720'>did</span> <span m='3071870'>this</span> <span m='3072050'>decrease</span>
  <span m='3072470'>k</span> <span m='3072710'>by?</span> <span m='3073300'>I'd</span>
  <span m='3073730'>like</span> <span m='3073910'>to</span> <span m='3074000'>say</span>
  <span m='3074630'>a</span> <span m='3074660'>factor</span> <span m='3074990'>of</span>
  <span m='3075050'>2</span> <span m='3075290'>and</span> <span m='3075380'>get</span>
  <span m='3075500'>log n,</span> <span m='3075920'>but</span> <span m='3076070'>in</span>
  <span m='3076190'>fact,</span> <span m='3076520'>no,</span> <span m='3076760'>it's</span>
  <span m='3076940'>not</span> <span m='3077150'>very</span> <span m='3077360'>good.</span>
  <span m='3078860'>It</span> <span m='3078960'>doesn't</span> <span m='3079100'>decrease</span>
  <span m='3079480'>k</span> <span m='3079670'>by</span> <span m='3079820'>very</span>
  <span m='3080000'>much.</span> <span m='3080300'>It</span> <span m='3080390'>does</span>
  <span m='3080570'>decrease</span> <span m='3080930'>k,</span> <span m='3081410'>guaranteed</span>
  <span m='3081770'>by</span> <span m='3081920'>at</span> <span m='3081980'>least</span>
  <span m='3082220'>1,</span> <span m='3083030'>so</span> <span m='3083210'>it's</span>
  <span m='3083330'>definitely</span> <span m='3083690'>linear</span> <span m='3083990'>time.</span>
  <span m='3085700'>And</span> <span m='3086030'>there's</span> <span m='3086300'>a</span>
  <span m='3086360'>bad</span> <span m='3087080'>tree,</span> <span m='3087440'>which</span>
  <span m='3087620'>is</span> <span m='3088850'>this.</span> <span m='3095100'>It's</span>
  <span m='3095360'>like</span> <span m='3095600'>a</span> <span m='3095690'>grid.</span>
  <span m='3096710'>Whoa.</span> <span m='3097430'>Sorry.</span> <span m='3101104'>OK,</span>
  <span m='3101590'>here's</span> <span m='3101930'>a</span> <span m='3101990'>tree.</span>
  <span m='3102680'>It's</span> <span m='3102770'>a</span> <span m='3102800'>binary</span>
  <span m='3103100'>tree.</span> <span m='3104820'>And</span> <span m='3104870'>if</span>
  <span m='3104930'>you</span> <span m='3105020'>set</span> <span m='3105230'>it</span>
  <span m='3105320'>up</span> <span m='3105470'>right,</span> <span m='3106070'>this</span>
  <span m='3106310'>is</span> <span m='3106400'>the</span> <span m='3106520'>longest</span>
  <span m='3106820'>path.</span> </p><p><span m='3107300'>And</span> <span m='3107480'>then</span>
  <span m='3107820'>when</span> <span m='3107960'>you</span> <span m='3108050'>decompose,</span>
  <span m='3108490'>this</span> <span m='3108680'>is</span> <span m='3108760'>the
  longest</span> <span m='3109100'>path,</span> <span m='3109340'>and</span> <span
  m='3109430'>this</span> <span m='3109580'>is the</span> <span m='3109790'>longest</span>
  <span m='3109900'>path,</span> <span m='3110150'>this is the</span> <span m='3110300'>longest</span>
  <span m='3110570'>path.</span> <span m='3111200'>If</span> <span m='3111320'>you</span>
  <span m='3111440'>query</span> <span m='3111800'>here,</span> <span m='3113030'>you'll</span>
  <span m='3113240'>walk</span> <span m='3113540'>up</span> <span m='3113660'>to</span>
  <span m='3113750'>here,</span> <span m='3114020'>and</span> <span m='3114110'>then</span>
  <span m='3114230'>walk</span> <span m='3114440'>up</span> <span m='3114530'>to</span>
  <span m='3114620'>here,</span> <span m='3114830'>and</span> <span m='3114920'>walk</span>
  <span m='3115130'>up</span> <span m='3115250'>to</span> <span m='3115340'>here,</span>
  <span m='3115460'>and</span> <span m='3115550'>walk</span> <span m='3115730'>up</span>
  <span m='3115850'>to</span> <span m='3115940'>here.</span> <span m='3116220'>So</span>
  <span m='3116270'>this</span> <span m='3116480'>is</span> <span m='3116600'>a</span>
  <span m='3117560'>square root of</span> <span m='3118050'>n</span> <span m='3118260'>lower</span>
  <span m='3118550'>bound</span> <span m='3118880'>for</span> <span m='3119000'>this</span>
  <span m='3119180'>algorithm.</span> <span m='3120510'>So</span> <span m='3121040'>not</span>
  <span m='3121220'>a</span> <span m='3121280'>good</span> <span m='3121430'>algorithm</span>
  <span m='3121820'>yet,</span> <span m='3122570'>but</span> <span m='3122750'>the</span>
  <span m='3122870'>makings</span> <span m='3123410'>of</span> <span m='3123530'>a</span>
  <span m='3123590'>good</span> <span m='3123770'>algorithm.</span> <span m='3139570'>Makings</span>
  <span m='3140320'>of</span> <span m='3140440'>step</span> <span m='3141070'>3,</span>
  <span m='3143660'>which is</span> <span m='3143800'>called</span> <span m='3144070'>ladder</span>
  <span m='3144560'>decomposition.</span> </p><p><span m='3152770'>Ladder</span> <span
  m='3153140'>decomposition</span> <span m='3153740'>is</span> <span m='3153800'>something</span>
  <span m='3154190'>I</span> <span m='3154250'>haven't</span> <span m='3154490'>really</span>
  <span m='3154670'>seen</span> <span m='3155000'>anywhere</span> <span m='3155540'>else.</span>
  <span m='3156890'>I</span> <span m='3156920'>think</span> <span m='3157130'>it</span>
  <span m='3157220'>comes</span> <span m='3157430'>from</span> <span m='3157520'>the</span>
  <span m='3157610'>parallel</span> <span m='3158100'>algorithms</span> <span m='3158390'>world</span>
  <span m='3159280'>in</span> <span m='3159350'>general.</span> <span m='3163830'>And</span>
  <span m='3164390'>now</span> <span m='3164630'>we're</span> <span m='3164750'>going</span>
  <span m='3164940'>to</span> <span m='3165140'>achieve</span> <span m='3166310'>linear</span>
  <span m='3167390'>space</span> <span m='3169910'>log</span> <span m='3170480'>n</span>
  <span m='3171560'>query.</span> <span m='3173760'>Now</span> <span m='3173960'>this</span>
  <span m='3174230'>is</span> <span m='3174350'>an</span> <span m='3174440'>improvement.</span>
  <span m='3175650'>So</span> <span m='3175750'>we</span> <span m='3175790'>have,</span>
  <span m='3176210'>at</span> <span m='3176360'>the</span> <span m='3176480'>moment,</span>
  <span m='3177200'>n log</span> <span m='3177600'>n</span> <span m='3177740'>space,</span>
  <span m='3178070'>log</span> <span m='3178400'>n</span> <span m='3178570'>query</span>
  <span m='3179090'>or</span> <span m='3180060'>n</span> <span m='3180440'>space</span>
  <span m='3181010'>root n</span> <span m='3181460'>query.</span> <span m='3182105'>We're</span>
  <span m='3182360'>basically</span> <span m='3182840'>taking</span> <span m='3183230'>the</span>
  <span m='3183320'>min</span> <span m='3183590'>of</span> <span m='3183780'>the</span>
  <span m='3184040'>two.</span> <span m='3185120'>And</span> <span m='3185420'>so</span>
  <span m='3185600'>we're</span> <span m='3185690'>getting</span> <span m='3187160'>linear</span>
  <span m='3187490'>space</span> <span m='3188270'>log</span> <span m='3188600'>n</span>
  <span m='3188720'>query.</span> <span m='3188990'>Still</span> <span m='3189290'>not</span>
  <span m='3189500'>perfect.</span> <span m='3190170'>We</span> <span m='3190190'>want</span>
  <span m='3190370'>constant</span> <span m='3190820'>query.</span> <span m='3191810'>That's</span>
  <span m='3192140'>when</span> <span m='3192320'>we'll</span> <span m='3192440'>use</span>
  <span m='3192620'>indirection,</span> <span m='3193910'>I</span> <span m='3193940'>think.</span>
  <span m='3195140'>Yeah,</span> <span m='3195590'>basically,</span> <span m='3196520'>a</span>
  <span m='3196580'>new</span> <span m='3196760'>type</span> <span m='3197030'>of</span>
  <span m='3197120'>indirection,</span> <span m='3197630'>but</span> <span m='3199340'>OK.</span>
  </p><p><span m='3200060'>So</span> <span m='3200480'>linear</span> <span m='3200930'>space</span>
  <span m='3202140'>log</span> <span m='3202370'>n</span> <span m='3202480'>query.</span>
  <span m='3202950'>Well,</span> <span m='3203960'>the</span> <span m='3204140'>idea</span>
  <span m='3204410'>is</span> <span m='3204620'>just</span> <span m='3204860'>to</span>
  <span m='3205070'>fix</span> <span m='3205970'>long</span> <span m='3206250'>paths,</span>
  <span m='3208040'>and</span> <span m='3208190'>it's</span> <span m='3208340'>a</span>
  <span m='3208400'>crazy</span> <span m='3208910'>idea,</span> <span m='3209540'>OK.</span>
  <span m='3209690'>Let</span> <span m='3209780'>me</span> <span m='3209870'>tell</span>
  <span m='3210020'>you</span> <span m='3210080'>the</span> <span m='3210200'>idea</span>
  <span m='3210590'>and</span> <span m='3210770'>then</span> <span m='3211810'>it's</span>
  <span m='3211970'>like,</span> <span m='3212690'>why</span> <span m='3212960'>would</span>
  <span m='3213110'>that</span> <span m='3213260'>be</span> <span m='3213380'>useful.</span>
  <span m='3214310'>But</span> <span m='3214640'>it's</span> <span m='3214850'>obvious</span>
  <span m='3215180'>that</span> <span m='3215300'>it</span> <span m='3215360'>doesn't</span>
  <span m='3215630'>hurt</span> <span m='3215870'>you,</span> <span m='3216810'>OK.</span>
  <span m='3217220'>When</span> <span m='3217400'>we</span> <span m='3218780'>have</span>
  <span m='3218960'>these</span> <span m='3219110'>paths,</span> <span m='3219770'>sometimes</span>
  <span m='3220280'>they're</span> <span m='3220400'>long.</span> <span m='3220970'>Sometimes</span>
  <span m='3221360'>they're</span> <span m='3221450'>not</span> <span m='3221630'>long</span>
  <span m='3221870'>enough.</span> <span m='3223310'>Just</span> <span m='3223490'>take</span>
  <span m='3223730'>each</span> <span m='3223910'>of</span> <span m='3223970'>these</span>
  <span m='3224090'>paths</span> <span m='3224420'>and</span> <span m='3224540'>extend</span>
  <span m='3224990'>them</span> <span m='3225230'>upwards</span> <span m='3225770'>by</span>
  <span m='3225950'>a</span> <span m='3225980'>factor</span> <span m='3226400'>of</span>
  <span m='3226510'>2.</span> <span m='3228900'>That's</span> <span m='3229330'>the</span>
  <span m='3229450'>idea.</span> <span m='3231110'>So</span> <span m='3231220'>take</span>
  <span m='3231490'>number</span> <span m='3231700'>2,</span> <span m='3232270'>extend</span>
  <span m='3233260'>each</span> <span m='3233500'>path</span> <span m='3236230'>upward</span>
  <span m='3238990'>2</span> <span m='3239220'>x.</span> <span m='3240430'>So</span>
  <span m='3240580'>that</span> <span m='3240920'>gives</span> <span m='3241170'>us</span>
  <span m='3242020'>call</span> <span m='3243250'>a</span> <span m='3243370'>ladder.</span>
  </p><p><span m='3246270'>OK,</span> <span m='3246550'>what</span> <span m='3246700'>happens?</span>
  <span m='3247160'>Well,</span> <span m='3247840'>paths</span> <span m='3248110'>are</span>
  <span m='3248170'>going</span> <span m='3248290'>to</span> <span m='3248350'>overlap.</span>
  <span m='3250810'>Fine.</span> <span m='3253000'>Ladders</span> <span m='3253360'>overlap.</span>
  <span m='3253860'>The</span> <span m='3254080'>original</span> <span m='3254410'>paths</span>
  <span m='3254710'>don't</span> <span m='3254890'>overlap.</span> <span m='3255730'>Ladders</span>
  <span m='3256090'>overlap.</span> <span m='3256510'>I</span> <span m='3256570'>don't</span>
  <span m='3256750'>really</span> <span m='3257200'>care</span> <span m='3257530'>if</span>
  <span m='3257680'>they</span> <span m='3257830'>overlap.</span> <span m='3258580'>How</span>
  <span m='3258730'>much</span> <span m='3258940'>space</span> <span m='3259290'>is</span>
  <span m='3259450'>there?</span> <span m='3260650'>It's</span> <span m='3260740'>still</span>
  <span m='3261040'>linear</span> <span m='3261370'>space,</span> <span m='3261700'>because</span>
  <span m='3261880'>I'm</span> <span m='3261970'>just</span> <span m='3262090'>doubling</span>
  <span m='3262630'>everything.</span> <span m='3263350'>So</span> <span m='3263550'>I've</span>
  <span m='3263640'>most</span> <span m='3263860'>doubled</span> <span m='3264250'>space</span>
  <span m='3265090'>relative</span> <span m='3265690'>to</span> <span m='3266500'>long</span>
  <span m='3266740'>path</span> <span m='3267040'>decomposition.</span> <span m='3267610'>I</span>
  <span m='3267640'>didn't</span> <span m='3267820'>mention</span> <span m='3268120'>it</span>
  <span m='3268570'>explicitly,</span> <span m='3269050'>but long</span> <span m='3269380'>path</span>
  <span m='3269660'>decomposition</span> <span m='3270010'>is</span> <span m='3270190'>linear</span>
  <span m='3270400'>space.</span> <span m='3270670'>We're</span> <span m='3270790'>just</span>
  <span m='3270910'>partitioning</span> <span m='3271510'>up</span> <span m='3271630'>the</span>
  <span m='3271720'>tree</span> <span m='3271960'>into</span> <span m='3272140'>little</span>
  <span m='3272290'>pieces.</span> <span m='3274630'>Doesn't</span> <span m='3274870'>take</span>
  <span m='3275110'>much.</span> </p><p><span m='3276070'>We</span> <span m='3276190'>have</span>
  <span m='3276280'>to</span> <span m='3276370'>store</span> <span m='3276580'>those</span>
  <span m='3276760'>arrays,</span> <span m='3277260'>but</span> <span m='3278470'>every</span>
  <span m='3278860'>node</span> <span m='3279100'>appears</span> <span m='3279400'>in</span>
  <span m='3279490'>exactly</span> <span m='3279880'>one</span> <span m='3280120'>cell</span>
  <span m='3280390'>here.</span> <span m='3280990'>Now</span> <span m='3281350'>every</span>
  <span m='3281560'>node</span> <span m='3281800'>will</span> <span m='3281920'>appear</span>
  <span m='3282220'>in,</span> <span m='3282340'>on</span> <span m='3282490'>average,</span>
  <span m='3282820'>two</span> <span m='3282940'>cells</span> <span m='3284230'>in</span>
  <span m='3284380'>some</span> <span m='3284620'>weird</span> <span m='3284860'>way.</span>
  <span m='3285100'>Like</span> <span m='3285610'>what</span> <span m='3285730'>happens</span>
  <span m='3286060'>over</span> <span m='3286240'>here?</span> <span m='3286570'>I
  have no</span> <span m='3286660'>idea.</span> <span m='3288850'>So</span> <span
  m='3289030'>this</span> <span m='3289210'>guy's</span> <span m='3289480'>length</span>
  <span m='3289750'>1.</span> <span m='3290590'>It's</span> <span m='3290740'>going</span>
  <span m='3290860'>to</span> <span m='3290920'>grow</span> <span m='3291100'>to</span>
  <span m='3291190'>length</span> <span m='3291450'>2.</span> <span m='3292060'>This</span>
  <span m='3292270'>one's</span> <span m='3292420'>length</span> <span m='3292690'>2,</span>
  <span m='3292970'>so now</span> <span m='3293360'>it'll</span> <span m='3293500'>grow
  to</span> <span m='3293770'>length</span> <span m='3294340'>4.</span> <span m='3295750'>This</span>
  <span m='3295930'>one's</span> <span m='3296170'>length</span> <span m='3296470'>3--</span>
  <span m='3297050'>and</span> <span m='3297140'>it</span> <span m='3297200'>depends
  on how you</span> <span m='3297580'>count.</span> <span m='3297890'>I'm counting</span>
  <span m='3298240'>nodes</span> <span m='3298540'>here.</span> <span m='3299170'>That's</span>
  <span m='3299440'>going</span> <span m='3299590'>to</span> <span m='3299650'>go</span>
  <span m='3299890'>here,</span> <span m='3300790'>all</span> <span m='3301000'>the</span>
  <span m='3301060'>way</span> <span m='3301210'>the</span> <span m='3301300'>top.</span>
  <span m='3303010'>Interesting.</span> <span m='3304840'>All</span> <span m='3305050'>the</span>
  <span m='3305170'>others</span> <span m='3305410'>will</span> <span m='3305500'>go</span>
  <span m='3305620'>to</span> <span m='3305680'>the</span> <span m='3305800'>top.</span>
  </p><p><span m='3306470'>So</span> <span m='3306790'>if</span> <span m='3307000'>I'm</span>
  <span m='3307150'>here,</span> <span m='3307810'>I</span> <span m='3307930'>walk</span>
  <span m='3308230'>here.</span> <span m='3309100'>Then</span> <span m='3309250'>I</span>
  <span m='3309280'>can</span> <span m='3309430'>jump</span> <span m='3309670'>all</span>
  <span m='3309820'>the</span> <span m='3309910'>way</span> <span m='3310000'>to</span>
  <span m='3310060'>the</span> <span m='3310180'>top.</span> <span m='3310570'>Then</span>
  <span m='3310740'>I</span> <span m='3310820'>can</span> <span m='3310930'>jump</span>
  <span m='3311230'>all</span> <span m='3311470'>the</span> <span m='3311560'>way</span>
  <span m='3311680'>to</span> <span m='3311770'>the</span> <span m='3311860'>root.</span>
  <span m='3313210'>Not</span> <span m='3313390'>totally</span> <span m='3313690'>obvious,</span>
  <span m='3314060'>but</span> <span m='3314140'>it</span> <span m='3314290'>actually</span>
  <span m='3314560'>will</span> <span m='3314710'>be</span> <span m='3314860'>log</span>
  <span m='3315140'>n</span> <span m='3316120'>steps.</span> <span m='3317000'>Let's</span>
  <span m='3318220'>prove</span> <span m='3318460'>that.</span> <span m='3318600'>This
  is</span> <span m='3318820'>again</span> <span m='3319060'>something</span> <span
  m='3319330'>we</span> <span m='3319420'>don't</span> <span m='3319600'>really</span>
  <span m='3319840'>need</span> <span m='3320020'>to</span> <span m='3320170'>know</span>
  <span m='3320530'>for</span> <span m='3320650'>the</span> <span m='3320770'>final</span>
  <span m='3321040'>solution,</span> <span m='3321490'>but</span> <span m='3322420'>kind</span>
  <span m='3322630'>of</span> <span m='3322720'>nice,</span> <span m='3323650'>kind</span>
  <span m='3323860'>of</span> <span m='3323950'>comforting</span> <span m='3324490'>to</span>
  <span m='3324610'>know</span> <span m='3324770'>that</span> <span m='3324890'>we've</span>
  <span m='3325060'>gotten</span> <span m='3325300'>down</span> <span m='3325470'>a</span>
  <span m='3325540'>log n</span> <span m='3325780'>query.</span> <span m='3327190'>So</span>
  <span m='3327490'>it's</span> <span m='3327610'>at</span> <span m='3327700'>most</span>
  <span m='3328000'>double</span> <span m='3328270'>the</span> <span m='3328360'>space.</span>
  <span m='3329770'>This is</span> <span m='3329880'>still</span> <span m='3330140'>linear.</span>
  <span m='3334030'>Now--</span> <span m='3335330'>oh,</span> <span m='3336160'>there's</span>
  <span m='3336340'>one</span> <span m='3336910'>catch.</span> </p><p><span m='3340750'>Over</span>
  <span m='3341200'>in</span> <span m='3341320'>this</span> <span m='3341530'>world,</span>
  <span m='3341920'>we</span> <span m='3342040'>said</span> <span m='3342940'>each--</span>
  <span m='3345660'>I</span> <span m='3345790'>didn't</span> <span m='3345970'>say</span>
  <span m='3346210'>it.</span> <span m='3347650'>I</span> <span m='3347770'>mentioned</span>
  <span m='3348100'>it</span> <span m='3348160'>out</span> <span m='3348340'>loud.</span>
  <span m='3349000'>Every</span> <span m='3349300'>node</span> <span m='3349900'>stores</span>
  <span m='3350500'>what</span> <span m='3350800'>array</span> <span m='3351130'>it</span>
  <span m='3351250'>lives</span> <span m='3351520'>in.</span> <span m='3352330'>Now</span>
  <span m='3352630'>a</span> <span m='3352720'>node</span> <span m='3353170'>lives</span>
  <span m='3353440'>in</span> <span m='3353530'>multiple</span> <span m='3353950'>arrays,</span>
  <span m='3355260'>OK.</span> <span m='3355720'>So</span> <span m='3356170'>which</span>
  <span m='3356380'>one</span> <span m='3356860'>do</span> <span m='3357010'>I</span>
  <span m='3357070'>store</span> <span m='3357250'>a</span> <span m='3357280'>pointer</span>
  <span m='3357580'>to?</span> <span m='3358360'>Well,</span> <span m='3358480'>there's</span>
  <span m='3358630'>one</span> <span m='3358930'>obvious</span> <span m='3359290'>one</span>
  <span m='3359500'>to</span> <span m='3359710'>store</span> <span m='3359950'>a</span>
  <span m='3360010'>pointer</span> <span m='3360310'>to.</span> <span m='3362890'>Whatever</span>
  <span m='3363250'>node</span> <span m='3363490'>you</span> <span m='3363580'>take</span>
  <span m='3364030'>lives</span> <span m='3364300'>in</span> <span m='3364450'>one</span>
  <span m='3364840'>path.</span> <span m='3365380'>In</span> <span m='3365530'>that</span>
  <span m='3365650'>long</span> <span m='3365950'>path</span> <span m='3366170'>decomposition,</span>
  <span m='3366480'>it</span> <span m='3366790'>still</span> <span m='3367000'>lives</span>
  <span m='3367180'>in</span> <span m='3367280'>one</span> <span m='3367480'>path.</span>
  <span m='3368230'>Store a</span> <span m='3368560'>pointer</span> <span m='3368950'>into</span>
  <span m='3369190'>that</span> <span m='3369510'>ladder.</span> </p><p><span m='3371660'>So</span>
  <span m='3371940'>node</span> <span m='3373010'>stores</span> <span m='3373360'>a</span>
  <span m='3373420'>pointer</span> <span m='3377920'>you</span> <span m='3378040'>could</span>
  <span m='3378160'>say</span> <span m='3378460'>to</span> <span m='3378640'>the</span>
  <span m='3378730'>ladder</span> <span m='3380320'>that</span> <span m='3380560'>contains</span>
  <span m='3381130'>it</span> <span m='3381460'>in</span> <span m='3381700'>the</span>
  <span m='3381910'>lower</span> <span m='3382330'>half.</span> <span m='3387550'>That</span>
  <span m='3387730'>corresponds</span> <span m='3388300'>to</span> <span m='3388390'>the</span>
  <span m='3388510'>one</span> <span m='3388690'>where</span> <span m='3388810'>it</span>
  <span m='3388870'>was</span> <span m='3388990'>an</span> <span m='3389080'>actual</span>
  <span m='3390040'>path.</span> <span m='3391150'>And</span> <span m='3391270'>only</span>
  <span m='3391570'>one</span> <span m='3391900'>ladder</span> <span m='3392230'>will</span>
  <span m='3392410'>contain</span> <span m='3393310'>a</span> <span m='3393370'>node</span>
  <span m='3393730'>in</span> <span m='3393880'>its</span> <span m='3394000'>lower</span>
  <span m='3394360'>half.</span> <span m='3395260'>The</span> <span m='3395320'>upper</span>
  <span m='3395560'>half</span> <span m='3395770'>was</span> <span m='3395920'>the</span>
  <span m='3395980'>extension.</span> <span m='3397100'>I</span> <span m='3397160'>guess</span>
  <span m='3397360'>it's</span> <span m='3397540'>like</span> <span m='3397720'>those</span>
  <span m='3397990'>folding</span> <span m='3398320'>ladders</span> <span m='3398730'>you</span>
  <span m='3398990'>extend.</span> </p><p><span m='3400560'>OK.</span> <span m='3402340'>Cool.</span>
  <span m='3402760'>So</span> <span m='3402910'>that's</span> <span m='3403120'>what</span>
  <span m='3403180'>we're</span> <span m='3403240'>going</span> <span m='3403340'>to</span>
  <span m='3403420'>do</span> <span m='3403540'>and</span> <span m='3403600'>also</span>
  <span m='3403920'>store</span> <span m='3404660'>its</span> <span m='3404980'>index</span>
  <span m='3405550'>in</span> <span m='3405700'>the</span> <span m='3405820'>array.</span>
  <span m='3407210'>Now</span> <span m='3407410'>we</span> <span m='3407560'>can</span>
  <span m='3407710'>do</span> <span m='3407830'>exactly</span> <span m='3408340'>this</span>
  <span m='3408490'>query</span> <span m='3408850'>algorithm</span> <span m='3409870'>again,</span>
  <span m='3410230'>except</span> <span m='3410560'>now</span> <span m='3410740'>instead</span>
  <span m='3410980'>of</span> <span m='3411040'>path,</span> <span m='3411340'>it
  says</span> <span m='3411600'>ladder.</span> <span m='3412570'>So</span> <span m='3412780'>you</span>
  <span m='3412930'>look</span> <span m='3413230'>at</span> <span m='3413410'>the</span>
  <span m='3413530'>index</span> <span m='3413950'>of</span> <span m='3414070'>the</span>
  <span m='3414160'>node</span> <span m='3414490'>in</span> <span m='3414610'>its</span>
  <span m='3414760'>ladder.</span> <span m='3415900'>If</span> <span m='3416140'>that</span>
  <span m='3416290'>index</span> <span m='3416740'>is</span> <span m='3417430'>larger</span>
  <span m='3417940'>than</span> <span m='3418120'>k,</span> <span m='3418780'>then</span>
  <span m='3418900'>boom,</span> <span m='3419320'>that</span> <span m='3419800'>ladder</span>
  <span m='3420190'>array</span> <span m='3420520'>will</span> <span m='3420640'>tell</span>
  <span m='3420790'>you</span> <span m='3420850'>exactly</span> <span m='3421240'>where</span>
  <span m='3421330'>to</span> <span m='3421420'>go.</span> <span m='3422200'>Otherwise</span>
  <span m='3423340'>you</span> <span m='3423460'>go</span> <span m='3423580'>to</span>
  <span m='3423670'>the</span> <span m='3423730'>top</span> <span m='3424030'>of</span>
  <span m='3424090'>the</span> <span m='3424150'>ladder</span> <span m='3424480'>and</span>
  <span m='3424570'>then</span> <span m='3424690'>you</span> <span m='3424780'>take</span>
  <span m='3424960'>the</span> <span m='3425050'>parent</span> <span m='3425350'>pointer,</span>
  <span m='3426160'>and</span> <span m='3426280'>you</span> <span m='3426370'>decrease</span>
  <span m='3426760'>by</span> <span m='3427300'>this.</span> </p><p><span m='3427510'>But</span>
  <span m='3427660'>now</span> <span m='3427900'>I</span> <span m='3427990'>claim</span>
  <span m='3428290'>that</span> <span m='3428410'>decrease</span> <span m='3428830'>will</span>
  <span m='3428950'>be</span> <span m='3429070'>substantial.</span> <span m='3431230'>Why?</span>
  <span m='3440470'>If</span> <span m='3440620'>I</span> <span m='3440710'>have</span>
  <span m='3440980'>a</span> <span m='3441040'>node</span> <span m='3441670'>of</span>
  <span m='3441880'>height</span> <span m='3442600'>h--</span> <span m='3445570'>remember,</span>
  <span m='3445840'>height</span> <span m='3446110'>of</span> <span m='3446200'>a</span>
  <span m='3446290'>node</span> <span m='3446770'>is</span> <span m='3446920'>the</span>
  <span m='3447340'>length of the</span> <span m='3447810'>longest</span> <span m='3448100'>path</span>
  <span m='3448240'>from</span> <span m='3448480'>there</span> <span m='3448880'>downward--</span>
  <span m='3452300'>it</span> <span m='3452320'>will</span> <span m='3452500'>be</span>
  <span m='3455230'>on</span> <span m='3455530'>a</span> <span m='3455590'>ladder</span>
  <span m='3458360'>of</span> <span m='3459130'>height</span> <span m='3461530'>at</span>
  <span m='3461650'>least</span> <span m='3462160'>2h.</span> <span m='3464335'>Why?</span>
  <span m='3464800'>Because</span> <span m='3465190'>if</span> <span m='3465340'>you</span>
  <span m='3465670'>look</span> <span m='3465880'>at</span> <span m='3465940'>a</span>
  <span m='3466000'>node</span> <span m='3466240'>of</span> <span m='3466330'>height</span>
  <span m='3466540'>h--</span> <span m='3467350'>like</span> <span m='3467530'>say,</span>
  <span m='3467830'>I</span> <span m='3467890'>don't</span> <span m='3467980'>know,</span>
  <span m='3468130'>this</span> <span m='3468310'>node--</span> <span m='3471220'>the</span>
  <span m='3471400'>longest</span> <span m='3471760'>path</span> <span m='3472000'>from</span>
  <span m='3472240'>there</span> <span m='3473080'>is</span> <span m='3473730'>substantial.</span>
  <span m='3474680'>I</span> <span m='3474770'>mean,</span> <span m='3474880'>if</span>
  <span m='3474970'>it's</span> <span m='3475090'>height</span> <span m='3475270'>h,</span>
  <span m='3475500'>then</span> <span m='3475620'>the</span> <span m='3475690'>longest</span>
  <span m='3475960'>path</span> <span m='3476270'>from</span> <span m='3476370'>there</span>
  <span m='3476380'>is</span> <span m='3476470'>length</span> <span m='3476670'>at</span>
  <span m='3476740'>least</span> <span m='3476950'>h.</span> <span m='3477850'>So</span>
  <span m='3478000'>every</span> <span m='3478270'>node of</span> <span m='3478420'>height
  h</span> <span m='3478830'>will</span> <span m='3478930'>be</span> <span m='3479050'>on</span>
  <span m='3479140'>a</span> <span m='3479200'>path</span> <span m='3480040'>of</span>
  <span m='3480190'>length</span> <span m='3480490'>at</span> <span m='3480550'>least</span>
  <span m='3480850'>h,</span> <span m='3481930'>and</span> <span m='3482350'>from</span>
  <span m='3482680'>there</span> <span m='3482830'>down.</span> </p><p><span m='3484120'>And</span>
  <span m='3484270'>so</span> <span m='3484480'>you</span> <span m='3484570'>look</span>
  <span m='3484750'>at</span> <span m='3484840'>the</span> <span m='3484930'>ladder.</span>
  <span m='3485260'>Well,</span> <span m='3485350'>that's</span> <span m='3485530'>going</span>
  <span m='3485680'>to</span> <span m='3485740'>be</span> <span m='3485860'>double</span>
  <span m='3486130'>that.</span> <span m='3486920'>So</span> <span m='3487030'>the</span>
  <span m='3487150'>ladder</span> <span m='3487420'>will</span> <span m='3487540'>be</span>
  <span m='3487810'>height</span> <span m='3488020'>at</span> <span m='3488110'>least</span>
  <span m='3488320'>2h,</span> <span m='3489670'>which</span> <span m='3489850'>means</span>
  <span m='3490090'>if</span> <span m='3490960'>your</span> <span m='3491080'>query</span>
  <span m='3491470'>starts</span> <span m='3491730'>at</span> <span m='3491800'>height</span>
  <span m='3492010'>h,</span> <span m='3493030'>after</span> <span m='3493390'>you</span>
  <span m='3493510'>do</span> <span m='3493810'>one</span> <span m='3494200'>step</span>
  <span m='3494650'>of</span> <span m='3494800'>this</span> <span m='3495040'>ladder</span>
  <span m='3495340'>search,</span> <span m='3496480'>you</span> <span m='3496660'>will</span>
  <span m='3496780'>get</span> <span m='3496930'>to</span> <span m='3497050'>height</span>
  <span m='3497200'>at</span> <span m='3497260'>least</span> <span m='3497440'>2h,</span>
  <span m='3497920'>and</span> <span m='3498010'>then</span> <span m='3498130'>4h,</span>
  <span m='3498610'>and</span> <span m='3498700'>then</span> <span m='3498820'>8h.</span>
  <span m='3499750'>You're</span> <span m='3499900'>increasing</span> <span m='3500350'>your</span>
  <span m='3500470'>height</span> <span m='3500740'>by</span> <span m='3500890'>a</span>
  <span m='3500920'>power of</span> <span m='3501400'>2,</span> <span m='3502180'>by</span>
  <span m='3502360'>a</span> <span m='3502390'>factor</span> <span m='3502750'>of</span>
  <span m='3502840'>2</span> <span m='3503020'>every</span> <span m='3503230'>time.</span>
  <span m='3504140'>So</span> <span m='3504220'>in</span> <span m='3504350'>log n</span>
  <span m='3504730'>steps,</span> <span m='3505060'>you</span> <span m='3505120'>will</span>
  <span m='3505240'>get</span> <span m='3505420'>to</span> <span m='3506350'>wherever</span>
  <span m='3506620'>you</span> <span m='3506680'>need</span> <span m='3506830'>to</span>
  <span m='3506950'>go.</span> <span m='3509000'>OK</span> <span m='3509990'>You don't</span>
  <span m='3510080'>have</span> <span m='3510170'>to</span> <span m='3510260'>worry</span>
  <span m='3510380'>about</span> <span m='3510560'>overshooting,</span> <span m='3511160'>because</span>
  <span m='3511700'>that's</span> <span m='3512060'>the</span> <span m='3512180'>case</span>
  <span m='3512510'>when</span> <span m='3512780'>the</span> <span m='3512930'>array</span>
  <span m='3513200'>tells</span> <span m='3513440'>you</span> <span m='3513530'>exactly</span>
  <span m='3513890'>where</span> <span m='3514040'>to</span> <span m='3514130'>go.</span>
  </p><p><span m='3515980'>OK.</span> <span m='3518930'>Time</span> <span m='3519290'>for</span>
  <span m='3519590'>the</span> <span m='3519710'>climax.</span> <span m='3522080'>It</span>
  <span m='3522170'>won't</span> <span m='3522320'>be</span> <span m='3522410'>the</span>
  <span m='3522560'>end,</span> <span m='3522950'>but</span> <span m='3523130'>it's</span>
  <span m='3523430'>the</span> <span m='3523550'>climax</span> <span m='3524000'>in</span>
  <span m='3524090'>the</span> <span m='3524150'>middle</span> <span m='3524360'>of</span>
  <span m='3524450'>the</span> <span m='3524510'>story.</span> <span m='3524930'>So</span>
  <span m='3525680'>we</span> <span m='3525860'>have</span> <span m='3526160'>on</span>
  <span m='3526370'>the</span> <span m='3526490'>one</span> <span m='3526670'>hand,</span>
  <span m='3527120'>jump</span> <span m='3527450'>pointers.</span> <span m='3527900'>Remember</span>
  <span m='3528170'>those?</span> <span m='3528890'>Jump</span> <span m='3529160'>pointers</span>
  <span m='3530330'>made</span> <span m='3530570'>small</span> <span m='3531050'>steps</span>
  <span m='3531410'>initially</span> <span m='3532910'>and</span> <span m='3533210'>got--</span>
  <span m='3535170'>actually,</span> <span m='3535490'>no.</span> <span m='3536840'>This</span>
  <span m='3536930'>is</span> <span m='3536990'>what</span> <span m='3537140'>it</span>
  <span m='3537230'>looks</span> <span m='3537470'>like</span> <span m='3537620'>for</span>
  <span m='3537710'>the</span> <span m='3537800'>data</span> <span m='3538010'>structure.</span>
  <span m='3539270'>But</span> <span m='3539420'>if</span> <span m='3539540'>you</span>
  <span m='3539630'>look</span> <span m='3539780'>at</span> <span m='3539840'>the</span>
  <span m='3539990'>algorithm,</span> <span m='3540440'>actually</span> <span m='3540650'>it</span>
  <span m='3540710'>makes</span> <span m='3541210'>a</span> <span m='3541280'>big</span>
  <span m='3541580'>step</span> <span m='3541910'>in</span> <span m='3542000'>the</span>
  <span m='3542090'>beginning.</span> <span m='3542860'>Right?</span> <span m='3542960'>It</span>
  <span m='3543020'>gets</span> <span m='3543380'>more</span> <span m='3543590'>than</span>
  <span m='3543740'>halfway</span> <span m='3544130'>there.</span> <span m='3544820'>Then</span>
  <span m='3544970'>it</span> <span m='3545030'>makes</span> <span m='3545180'>smaller</span>
  <span m='3545600'>and</span> <span m='3545690'>smaller</span> <span m='3546080'>steps,</span>
  <span m='3546410'>exponentially</span> <span m='3546920'>decreasing</span> <span
  m='3547430'>steps.</span> <span m='3547890'>Finally,</span> <span m='3548240'>it</span>
  <span m='3548300'>arrives</span> <span m='3549350'>at</span> <span m='3549590'>the</span>
  <span m='3550760'>intended</span> <span m='3551180'>node.</span> </p><p><span m='3552990'>Ladder</span>
  <span m='3553430'>decomposition</span> <span m='3554480'>is</span> <span m='3554720'>doing</span>
  <span m='3555080'>the</span> <span m='3555200'>reverse.</span> <span m='3556040'>If</span>
  <span m='3556130'>you</span> <span m='3556190'>start</span> <span m='3556490'>at</span>
  <span m='3556580'>low</span> <span m='3556820'>height,</span> <span m='3557240'>you're</span>
  <span m='3557420'>going</span> <span m='3557540'>to</span> <span m='3557600'>make</span>
  <span m='3557750'>very</span> <span m='3558050'>small</span> <span m='3558320'>steps</span>
  <span m='3558590'>in</span> <span m='3558680'>the</span> <span m='3558740'>beginning.</span>
  <span m='3559490'>As</span> <span m='3559670'>your</span> <span m='3559790'>height</span>
  <span m='3559970'>gets</span> <span m='3560180'>bigger,</span> <span m='3560570'>you're</span>
  <span m='3560750'>going</span> <span m='3560880'>to</span> <span m='3561080'>be</span>
  <span m='3561290'>making</span> <span m='3561560'>bigger</span> <span m='3561770'>and</span>
  <span m='3561860'>bigger</span> <span m='3562070'>steps.</span> <span m='3562790'>And</span>
  <span m='3562880'>then</span> <span m='3563030'>when</span> <span m='3563150'>you</span>
  <span m='3563210'>jump</span> <span m='3563480'>over</span> <span m='3563780'>your</span>
  <span m='3563900'>node,</span> <span m='3564140'>you</span> <span m='3564230'>found</span>
  <span m='3564530'>it</span> <span m='3564740'>instantly.</span> <span m='3565880'>So</span>
  <span m='3565990'>it's</span> <span m='3566090'>kind</span> <span m='3566330'>of</span>
  <span m='3566450'>the</span> <span m='3566600'>opposite</span> <span m='3568040'>of</span>
  <span m='3568190'>jump</span> <span m='3568460'>pointers.</span> <span m='3569340'>So</span>
  <span m='3569390'>what</span> <span m='3569510'>we're</span> <span m='3569600'>going</span>
  <span m='3569720'>to</span> <span m='3569810'>do</span> <span m='3570530'>is</span>
  <span m='3570650'>take</span> <span m='3570890'>jump</span> <span m='3571190'>pointers</span>
  <span m='3572630'>and</span> <span m='3572870'>add</span> <span m='3573170'>them</span>
  <span m='3574340'>to</span> <span m='3574490'>ladder</span> <span m='3574780'>decomposition.</span>
  <span m='3592096'>Huh.</span> </p><p><span m='3593580'>This is,</span> <span m='3594110'>I</span>
  <span m='3594380'>guess,</span> <span m='3594700'>version</span> <span m='3595140'>4.</span>
  <span m='3596170'>Combine</span> <span m='3599640'>jump</span> <span m='3599910'>pointers</span>
  <span m='3602490'>from</span> <span m='3602760'>one</span> <span m='3604440'>and</span>
  <span m='3604590'>ladders</span> <span m='3607380'>from</span> <span m='3607650'>three.</span>
  <span m='3608700'>Forget</span> <span m='3608970'>about</span> <span m='3609180'>two.
  Two</span> <span m='3609660'>is</span> <span m='3609810'>just</span> <span m='3609990'>a</span>
  <span m='3610050'>warm</span> <span m='3610290'>up</span> <span m='3610380'>for</span>
  <span m='3610530'>three.</span> <span m='3611940'>Long</span> <span m='3612150'>paths,</span>
  <span m='3612780'>defined</span> <span m='3613140'>ladders.</span> <span m='3615210'>So</span>
  <span m='3615390'>we've</span> <span m='3615480'>got</span> <span m='3615840'>one</span>
  <span m='3616080'>way</span> <span m='3616200'>to</span> <span m='3616320'>do</span>
  <span m='3616440'>log</span> <span m='3616740'>n</span> <span m='3616910'>query.</span>
  <span m='3617850'>We've</span> <span m='3618000'>got</span> <span m='3618180'>another</span>
  <span m='3618510'>way</span> <span m='3618660'>to</span> <span m='3618750'>do</span>
  <span m='3618900'>log</span> <span m='3619170'>n</span> <span m='3619330'>query.</span>
  <span m='3620250'>I</span> <span m='3620370'>combine</span> <span m='3620880'>them,</span>
  <span m='3621840'>and</span> <span m='3621960'>I</span> <span m='3622050'>get</span>
  <span m='3622470'>constant</span> <span m='3623100'>query.</span> <span m='3625610'>Because</span>
  <span m='3625820'>log</span> <span m='3626020'>n</span> <span m='3626120'>plus</span>
  <span m='3626330'>log</span> <span m='3626480'>n</span> <span m='3626660'>equals</span>
  <span m='3626990'>1.</span> <span m='3627260'>I</span> <span m='3627530'>don't</span>
  <span m='3627650'>know.</span> </p><p><span m='3632820'>OK,</span> <span m='3634040'>here's</span>
  <span m='3634250'>the</span> <span m='3634340'>idea.</span> <span m='3634760'>On</span>
  <span m='3634880'>the</span> <span m='3635000'>one</span> <span m='3635180'>hand,</span>
  <span m='3635390'>jump</span> <span m='3635620'>pointers</span> <span m='3636380'>make</span>
  <span m='3636500'>a</span> <span m='3636560'>big</span> <span m='3636830'>step</span>
  <span m='3637720'>and</span> <span m='3637900'>then</span> <span m='3638030'>smaller</span>
  <span m='3638330'>steps,</span> <span m='3639600'>right.</span> <span m='3640030'>Yeah,</span>
  <span m='3640580'>like</span> <span m='3640700'>that.</span> <span m='3641460'>And</span>
  <span m='3641540'>on</span> <span m='3641660'>the</span> <span m='3641750'>other</span>
  <span m='3641930'>hand,</span> <span m='3642150'>ladders</span> <span m='3643250'>make</span>
  <span m='3643400'>small</span> <span m='3643760'>steps.</span> <span m='3646390'>It's</span>
  <span m='3646550'>hard</span> <span m='3646700'>to</span> <span m='3646790'>draw.</span>
  <span m='3651400'>What</span> <span m='3651580'>I'd</span> <span m='3651670'>like</span>
  <span m='3651880'>to</span> <span m='3652030'>do</span> <span m='3656250'>is</span>
  <span m='3656410'>take</span> <span m='3657400'>this</span> <span m='3657700'>step</span>
  <span m='3658660'>and</span> <span m='3658810'>this</span> <span m='3659020'>step.</span>
  <span m='3659380'>That</span> <span m='3659710'>would</span> <span m='3659800'>be</span>
  <span m='3659890'>good,</span> <span m='3660150'>because</span> <span m='3660560'>only</span>
  <span m='3660760'>two</span> <span m='3660910'>of</span> <span m='3661000'>them.</span>
  <span m='3662110'>So</span> <span m='3663550'>query</span> <span m='3665900'>is</span>
  <span m='3666700'>going</span> <span m='3666850'>to</span> <span m='3666940'>do</span>
  <span m='3667150'>one</span> <span m='3667540'>jump,</span> <span m='3670140'>plus</span>
  <span m='3670600'>1</span> <span m='3671020'>ladder,</span> <span m='3673180'>in</span>
  <span m='3673300'>that</span> <span m='3673510'>order.</span> </p><p><span m='3675410'>See,</span>
  <span m='3675700'>the</span> <span m='3675850'>thing</span> <span m='3676060'>about</span>
  <span m='3676360'>ladders</span> <span m='3677560'>is</span> <span m='3677690'>it's</span>
  <span m='3677800'>really</span> <span m='3678070'>slow</span> <span m='3678370'>in</span>
  <span m='3678460'>the</span> <span m='3678520'>beginning,</span> <span m='3678790'>because</span>
  <span m='3678940'>your</span> <span m='3679060'>height</span> <span m='3679300'>is</span>
  <span m='3679390'>small.</span> <span m='3680110'>I</span> <span m='3680230'>really</span>
  <span m='3680500'>want</span> <span m='3680650'>to</span> <span m='3680710'>get</span>
  <span m='3681010'>large</span> <span m='3681370'>height.</span> <span m='3683170'>Jump</span>
  <span m='3683440'>pointers</span> <span m='3683830'>give</span> <span m='3684010'>you</span>
  <span m='3684100'>large</span> <span m='3684370'>height.</span> <span m='3684730'>The</span>
  <span m='3684850'>very</span> <span m='3685090'>first</span> <span m='3685360'>step,</span>
  <span m='3685690'>you</span> <span m='3685810'>get</span> <span m='3686500'>half</span>
  <span m='3686800'>the</span> <span m='3686890'>height</span> <span m='3687040'>you</span>
  <span m='3687130'>need.</span> <span m='3688720'>That's</span> <span m='3688900'>it.</span>
  <span m='3690600'>So</span> <span m='3691720'>when</span> <span m='3691900'>we</span>
  <span m='3692080'>do</span> <span m='3692290'>a</span> <span m='3692380'>jump,</span>
  <span m='3693640'>we</span> <span m='3696450'>do</span> <span m='3696640'>one</span>
  <span m='3696940'>step</span> <span m='3697240'>of</span> <span m='3697330'>the</span>
  <span m='3697420'>jump</span> <span m='3697690'>algorithm.</span> <span m='3698770'>What</span>
  <span m='3698920'>do</span> <span m='3699040'>we</span> <span m='3699190'>do?</span>
  <span m='3699430'>We</span> <span m='3699640'>reach</span> <span m='3701950'>height</span>
  <span m='3705040'>at</span> <span m='3705160'>least</span> <span m='3705580'>k</span>
  <span m='3706000'>over</span> <span m='3706240'>2</span> <span m='3707200'>above</span>
  <span m='3708090'>x.</span> <span m='3709040'>All</span> <span m='3709170'>right,</span>
  <span m='3709300'>we</span> <span m='3709420'>get</span> <span m='3709540'>halfway</span>
  <span m='3709960'>there.</span> <span m='3711650'>So</span> <span m='3711770'>our</span>
  <span m='3711850'>height--</span> <span m='3712610'>it's</span> <span m='3712770'>a</span>
  <span m='3712840'>little--</span> <span m='3713310'>let's</span> <span m='3713450'>say</span>
  <span m='3713650'>x</span> <span m='3713950'>has</span> <span m='3714190'>height</span>
  <span m='3714430'>h.</span> <span m='3716360'>OK,</span> <span m='3716560'>so</span>
  <span m='3716770'>then</span> <span m='3717400'>we</span> <span m='3717550'>get</span>
  <span m='3717730'>to</span> <span m='3717970'>height--</span> <span m='3718390'>this</span>
  <span m='3718570'>is</span> <span m='3718630'>saying</span> <span m='3718870'>we</span>
  <span m='3718960'>get</span> <span m='3719110'>to</span> <span m='3719230'>height</span>
  <span m='3719860'>h</span> <span m='3720220'>plus</span> <span m='3720570'>k over</span>
  <span m='3721030'>2.</span> </p><p><span m='3723370'>OK,</span> <span m='3723670'>that's</span>
  <span m='3723910'>good.</span> <span m='3724180'>This</span> <span m='3724390'>is</span>
  <span m='3724510'>a</span> <span m='3724570'>big</span> <span m='3724780'>height.</span>
  <span m='3726190'>Halfway</span> <span m='3726520'>there,</span> <span m='3727750'>I</span>
  <span m='3727780'>mean,</span> <span m='3728560'>halfway</span> <span m='3728890'>of</span>
  <span m='3729010'>the</span> <span m='3729160'>remainder</span> <span m='3729730'>after</span>
  <span m='3730030'>h.</span> <span m='3731410'>Now</span> <span m='3731650'>ladders</span>
  <span m='3732700'>double</span> <span m='3733000'>your</span> <span m='3733150'>height</span>
  <span m='3733360'>in</span> <span m='3733450'>every</span> <span m='3733690'>step.</span>
  <span m='3735620'>So</span> <span m='3735790'>ladder</span> <span m='3736210'>step--</span>
  <span m='3736990'>so</span> <span m='3737080'>this</span> <span m='3737260'>is</span>
  <span m='3737410'>the</span> <span m='3737530'>jump</span> <span m='3737800'>step.</span>
  <span m='3740540'>If</span> <span m='3740560'>you</span> <span m='3740620'>do</span>
  <span m='3740770'>one</span> <span m='3741070'>ladder</span> <span m='3741340'>step,</span>
  <span m='3742210'>you</span> <span m='3742420'>will</span> <span m='3742540'>reach</span>
  <span m='3742840'>height</span> <span m='3744280'>double</span> <span m='3744550'>that.</span>
  <span m='3744940'>So</span> <span m='3745120'>it's</span> <span m='3745270'>at</span>
  <span m='3745360'>least</span> <span m='3745930'>2</span> <span m='3746470'>h</span>
  <span m='3747010'>plus</span> <span m='3747340'>k,</span> <span m='3748580'>which
  is</span> <span m='3748870'>bigger</span> <span m='3749140'>than</span> <span m='3749290'>what</span>
  <span m='3749410'>we</span> <span m='3749560'>need.</span> <span m='3749900'>We</span>
  <span m='3749950'>need</span> <span m='3750220'>h</span> <span m='3750570'>plus</span>
  <span m='3750950'>k.</span> <span m='3751090'>That's</span> <span m='3751300'>where</span>
  <span m='3751420'>we're</span> <span m='3751540'>trying</span> <span m='3751750'>to</span>
  <span m='3751840'>go.</span> <span m='3752400'>And</span> <span m='3752500'>so</span>
  <span m='3752650'>we're</span> <span m='3752740'>done.</span> <span m='3755000'>Isn't</span>
  <span m='3755120'>that</span> <span m='3755270'>cool?</span> </p><p></p><p><span
  m='3760960'>So</span> <span m='3761750'>the</span> <span m='3761870'>annoying</span>
  <span m='3762170'>part</span> <span m='3762380'>is</span> <span m='3763010'>there's</span>
  <span m='3763430'>this</span> <span m='3763540'>extra</span> <span m='3763850'>part</span>
  <span m='3764060'>here.</span> <span m='3764750'>This</span> <span m='3764930'>is</span>
  <span m='3765080'>the</span> <span m='3765230'>h</span> <span m='3765800'>part</span>
  <span m='3766070'>and</span> <span m='3767060'>we</span> <span m='3767150'>start</span>
  <span m='3767420'>at</span> <span m='3767510'>some</span> <span m='3767750'>level.</span>
  <span m='3768110'>We</span> <span m='3768170'>don't</span> <span m='3768320'>know</span>
  <span m='3768440'>where.</span> <span m='3769090'>This is</span> <span m='3769250'>x.</span>
  <span m='3769580'>The</span> <span m='3769670'>worst</span> <span m='3769880'>case</span>
  <span m='3770150'>is</span> <span m='3770270'>maybe</span> <span m='3770540'>when</span>
  <span m='3770690'>it's</span> <span m='3771050'>very</span> <span m='3771230'>small,</span>
  <span m='3771620'>but</span> <span m='3772220'>whatever</span> <span m='3772550'>it</span>
  <span m='3772640'>is,</span> <span m='3773720'>we</span> <span m='3773870'>do</span>
  <span m='3773990'>this</span> <span m='3774140'>step</span> <span m='3774410'>and</span>
  <span m='3774850'>this</span> <span m='3775370'>is</span> <span m='3775460'>our</span>
  <span m='3775580'>target</span> <span m='3776030'>up</span> <span m='3776260'>here.</span>
  <span m='3777080'>This</span> <span m='3777320'>is</span> <span m='3777920'>height</span>
  <span m='3778150'>h</span> <span m='3778390'>plus</span> <span m='3778640'>k.</span>
  <span m='3780110'>In</span> <span m='3780340'>one</span> <span m='3780500'>step,</span>
  <span m='3780790'>we</span> <span m='3780890'>get</span> <span m='3781460'>more</span>
  <span m='3781640'>than</span> <span m='3781790'>halfway</span> <span m='3782210'>there</span>
  <span m='3782930'>with</span> <span m='3783140'>the</span> <span m='3783230'>jump</span>
  <span m='3783470'>pointer.</span> <span m='3785150'>And</span> <span m='3785300'>then</span>
  <span m='3785990'>the</span> <span m='3786110'>ladder</span> <span m='3786440'>will</span>
  <span m='3786560'>carry us</span> <span m='3786950'>the</span> <span m='3787040'>rest</span>
  <span m='3787220'>of</span> <span m='3787280'>the</span> <span m='3787340'>way.</span>
  </p><p><span m='3787530'>Because</span> <span m='3787890'>this</span> <span m='3788120'>is</span>
  <span m='3788220'>the</span> <span m='3788300'>ladder.</span> <span m='3788990'>We</span>
  <span m='3789080'>basically</span> <span m='3789470'>go</span> <span m='3789710'>horizontally</span>
  <span m='3790700'>to</span> <span m='3790880'>fall</span> <span m='3791180'>on</span>
  <span m='3791300'>this</span> <span m='3791450'>ladder,</span> <span m='3793310'>and</span>
  <span m='3793490'>it</span> <span m='3793580'>will</span> <span m='3793700'>cover</span>
  <span m='3794090'>us</span> <span m='3794270'>beyond</span> <span m='3795320'>where</span>
  <span m='3795470'>we</span> <span m='3795620'>need</span> <span m='3795770'>to</span>
  <span m='3795890'>go,</span> <span m='3796100'>beyond</span> <span m='3796520'>our</span>
  <span m='3796610'>wildest</span> <span m='3797030'>imaginations.</span> <span m='3797500'>So</span>
  <span m='3797970'>this</span> <span m='3798170'>is</span> <span m='3798260'>k over</span>
  <span m='3798620'>2.</span> <span m='3799790'>Because</span> <span m='3800000'>not</span>
  <span m='3800180'>only</span> <span m='3800390'>will</span> <span m='3800510'>it</span>
  <span m='3800570'>double</span> <span m='3800870'>this,</span> <span m='3801210'>which</span>
  <span m='3801260'>is</span> <span m='3801380'>what</span> <span m='3801500'>we</span>
  <span m='3801560'>need</span> <span m='3801740'>to</span> <span m='3801830'>double,</span>
  <span m='3802280'>it</span> <span m='3802370'>will</span> <span m='3802490'>also</span>
  <span m='3802790'>double</span> <span m='3803060'>whatever</span> <span m='3803160'>is</span>
  <span m='3803450'>down</span> <span m='3803660'>here,</span> <span m='3803840'>this</span>
  <span m='3803990'>h</span> <span m='3804230'>part.</span> <span m='3805820'>So</span>
  <span m='3806030'>it</span> <span m='3806090'>gets</span> <span m='3806280'>us</span>
  <span m='3806420'>way</span> <span m='3806660'>beyond</span> <span m='3807020'>where</span>
  <span m='3807140'>we</span> <span m='3807230'>need</span> <span m='3807380'>to</span>
  <span m='3807470'>go.</span> <span m='3808320'>I</span> <span m='3808420'>mean,</span>
  <span m='3808460'>could</span> <span m='3808580'>be h</span> <span m='3808840'>0.</span>
  <span m='3809250'>Then</span> <span m='3809360'>it</span> <span m='3809420'>gets</span>
  <span m='3809640'>us</span> <span m='3809810'>to</span> <span m='3809930'>exactly</span>
  <span m='3810380'>where</span> <span m='3810530'>we</span> <span m='3810620'>need</span>
  <span m='3810740'>to</span> <span m='3810890'>go.</span> </p><p><span m='3813590'>But</span>
  <span m='3813710'>then</span> <span m='3813860'>the</span> <span m='3813920'>ladder</span>
  <span m='3814490'>tells</span> <span m='3814700'>us</span> <span m='3814820'>where</span>
  <span m='3814910'>to</span> <span m='3814970'>go.</span> <span m='3815180'>So</span>
  <span m='3815330'>two</span> <span m='3815870'>steps</span> <span m='3816980'>constant</span>
  <span m='3817450'>time.</span> <span m='3821300'>Now</span> <span m='3821840'>one</span>
  <span m='3822050'>annoying</span> <span m='3822350'>thing</span> <span m='3822890'>is</span>
  <span m='3823110'>we're</span> <span m='3823220'>not</span> <span m='3823400'>done</span>
  <span m='3823580'>with</span> <span m='3823700'>space.</span> <span m='3825440'>So</span>
  <span m='3825590'>this</span> <span m='3825770'>is</span> <span m='3825890'>the</span>
  <span m='3826070'>anticlimax</span> <span m='3826790'>part.</span> <span m='3827420'>It's</span>
  <span m='3827550'>still</span> <span m='3827780'>going</span> <span m='3827930'>to</span>
  <span m='3827990'>be</span> <span m='3828140'>pretty</span> <span m='3828350'>interesting.</span>
  <span m='3829320'>We've</span> <span m='3829370'>got</span> <span m='3829490'>to</span>
  <span m='3829580'>shave</span> <span m='3829910'>off</span> <span m='3830120'>a</span>
  <span m='3830180'>log</span> <span m='3830420'>factor</span> <span m='3830750'>in</span>
  <span m='3830840'>space,</span> <span m='3831540'>but</span> <span m='3831640'>hey,</span>
  <span m='3831830'>we're</span> <span m='3831950'>experienced.</span> <span m='3832580'>We</span>
  <span m='3832640'>already</span> <span m='3832820'>did</span> <span m='3832970'>that</span>
  <span m='3833150'>once</span> <span m='3833390'>today.</span> <span m='3834290'>Question?</span>
  </p><p><span m='3834620'>Yeah.</span> <span m='3834760'>Why is it</span> <span m='3835237'>OK</span>
  <span m='3835714'>to go past</span> <span m='3836191'>your target?</span> </p><p></p><p><span
  m='3841940'>The question</span> <span m='3842210'>was</span> <span m='3842330'>why</span>
  <span m='3842540'>is</span> <span m='3842630'>it</span> <span m='3842720'>OK</span>
  <span m='3842960'>to</span> <span m='3843050'>go</span> <span m='3843200'>past</span>
  <span m='3843470'>our</span> <span m='3843530'>target?</span> <span m='3843830'>Jump</span>
  <span m='3844070'>pointers</span> <span m='3844400'>aren't</span> <span m='3844610'>allowed,</span>
  <span m='3844970'>because</span> <span m='3845150'>they</span> <span m='3845270'>only</span>
  <span m='3845450'>know</span> <span m='3845570'>how</span> <span m='3845660'>to</span>
  <span m='3845750'>go</span> <span m='3845960'>up.</span> <span m='3846720'>They</span>
  <span m='3846740'>can't</span> <span m='3847040'>overshoot.</span> <span m='3847740'>That's</span>
  <span m='3847850'>why</span> <span m='3848030'>they</span> <span m='3848150'>went</span>
  <span m='3848370'>less</span> <span m='3848600'>than</span> <span m='3848780'>halfway,</span>
  <span m='3849680'>or</span> <span m='3850010'>more</span> <span m='3850160'>than</span>
  <span m='3850310'>halfway,</span> <span m='3850640'>but</span> <span m='3850760'>less</span>
  <span m='3850970'>than</span> <span m='3851090'>the</span> <span m='3851150'>full</span>
  <span m='3851330'>way.</span> <span m='3852020'>Ladder</span> <span m='3852410'>decomposition</span>
  <span m='3853190'>can</span> <span m='3853550'>go</span> <span m='3853730'>beyond,</span>
  <span m='3854990'>because</span> <span m='3855320'>as</span> <span m='3855470'>soon</span>
  <span m='3855800'>as--</span> <span m='3856580'>the</span> <span m='3856670'>point</span>
  <span m='3856880'>is,</span> <span m='3857030'>as</span> <span m='3857150'>soon</span>
  <span m='3857480'>as--</span> <span m='3857830'>here's</span> <span m='3858200'>you,</span>
  <span m='3859020'>x,</span> <span m='3859880'>and</span> <span m='3860030'>here's</span>
  <span m='3860450'>your</span> <span m='3860710'>kth</span> <span m='3861020'>ancestor.</span>
  <span m='3861770'>This</span> <span m='3861950'>is</span> <span m='3862070'>the</span>
  <span m='3862190'>answer.</span> </p><p><span m='3863060'>As</span> <span m='3863120'>soon</span>
  <span m='3863270'>as</span> <span m='3863360'>you're</span> <span m='3863480'>in</span>
  <span m='3863570'>a</span> <span m='3863630'>common</span> <span m='3863960'>ladder,</span>
  <span m='3864360'>then</span> <span m='3864560'>the</span> <span m='3864650'>array</span>
  <span m='3864890'>tells</span> <span m='3865100'>you</span> <span m='3865220'>where</span>
  <span m='3865340'>to</span> <span m='3865460'>go.</span> <span m='3866190'>So</span>
  <span m='3866270'>even</span> <span m='3866540'>though</span> <span m='3866960'>the</span>
  <span m='3867080'>top</span> <span m='3867410'>of</span> <span m='3867470'>the</span>
  <span m='3867560'>ladder</span> <span m='3868070'>overshot,</span> <span m='3870110'>there</span>
  <span m='3870290'>will</span> <span m='3870410'>be</span> <span m='3870560'>a</span>
  <span m='3870590'>ladder</span> <span m='3871070'>connecting</span> <span m='3871520'>you</span>
  <span m='3871640'>to</span> <span m='3871790'>that</span> <span m='3871970'>top</span>
  <span m='3872240'>of</span> <span m='3872300'>the</span> <span m='3872350'>ladder.</span>
  <span m='3872690'>So</span> <span m='3873510'>as</span> <span m='3873590'>long</span>
  <span m='3873740'>as</span> <span m='3873830'>it's</span> <span m='3873920'>somewhere</span>
  <span m='3874220'>in</span> <span m='3874280'>between,</span> <span m='3874700'>it's</span>
  <span m='3874820'>free.</span> <span m='3876020'>Yeah, so</span> <span m='3876320'>that's</span>
  <span m='3876500'>why</span> <span m='3876600'>it's</span> <span m='3876690'>OK</span>
  <span m='3876980'>this</span> <span m='3877190'>goes</span> <span m='3877910'>potentially</span>
  <span m='3878300'>too</span> <span m='3878480'>high.</span> <span m='3879890'>So</span>
  <span m='3880010'>it's</span> <span m='3880130'>good</span> <span m='3880280'>for</span>
  <span m='3880400'>ladders,</span> <span m='3880730'>not</span> <span m='3880910'>good</span>
  <span m='3881060'>for</span> <span m='3881180'>jumps,</span> <span m='3881630'>but</span>
  <span m='3882230'>that's</span> <span m='3882530'>exactly</span> <span m='3882920'>where</span>
  <span m='3883040'>we</span> <span m='3883130'>have</span> <span m='3883340'>it</span>
  <span m='3884690'>Other</span> <span m='3884870'>questions?</span> <span m='3886160'>Yeah.</span>
  </p><p><span m='3886823'>AUDIENCE:</span> <span m='3887064'>[INAUDIBLE]</span> <span
  m='3887306'>jump</span> <span m='3887789'>pointers,</span> <span m='3890204'>wouldn't
  you be</span> <span m='3891170'>high</span> <span m='3891653'>up enough in the</span>
  <span m='3892136'>tree so that</span> <span m='3893585'>just the long path</span>
  <span m='3894068'>would work?</span> </p><p><span m='3895520'>PROFESSOR:</span>
  <span m='3895595'>Oh,</span> <span m='3895670'>interesting</span> <span m='3896060'>question.</span>
  <span m='3896450'>So</span> <span m='3896600'>would</span> <span m='3896750'>it</span>
  <span m='3896840'>be</span> <span m='3896960'>enough</span> <span m='3897260'>to</span>
  <span m='3897410'>do</span> <span m='3897650'>jump</span> <span m='3897960'>pointers</span>
  <span m='3898400'>plus</span> <span m='3898730'>long</span> <span m='3899030'>path?</span>
  <span m='3899450'>My</span> <span m='3899600'>guess</span> <span m='3899870'>is</span>
  <span m='3900050'>no.</span> <span m='3902030'>Jump</span> <span m='3902270'>pointers</span>
  <span m='3902630'>get</span> <span m='3902810'>you</span> <span m='3903050'>up</span>
  <span m='3903290'>to--</span> <span m='3904250'>so</span> <span m='3904370'>think</span>
  <span m='3904580'>of</span> <span m='3904670'>the</span> <span m='3904760'>case</span>
  <span m='3904970'>where</span> <span m='3905120'>h is</span> <span m='3905380'>0.</span>
  <span m='3905750'>Initially</span> <span m='3906140'>you're at</span> <span m='3906270'>height</span>
  <span m='3906550'>0.</span> <span m='3908060'>I</span> <span m='3908090'>think</span>
  <span m='3908390'>that's</span> <span m='3908600'>going</span> <span m='3908720'>to</span>
  <span m='3908780'>be</span> <span m='3908840'>a</span> <span m='3908900'>problem.</span>
  <span m='3909970'>You</span> <span m='3910160'>jump</span> <span m='3910550'>up</span>
  <span m='3910910'>to</span> <span m='3911300'>height</span> <span m='3911770'>k</span>
  <span m='3912080'>over</span> <span m='3912290'>2</span> <span m='3913430'>with</span>
  <span m='3913610'>a</span> <span m='3913700'>jump</span> <span m='3913940'>pointer.</span>
  </p><p><span m='3915470'>Now</span> <span m='3915710'>long</span> <span m='3915980'>path</span>
  <span m='3916250'>decomposition,</span> <span m='3916970'>you</span> <span m='3917090'>know</span>
  <span m='3917270'>that</span> <span m='3917470'>the</span> <span m='3917620'>path</span>
  <span m='3918170'>will</span> <span m='3918320'>have</span> <span m='3918560'>a</span>
  <span m='3918750'>length</span> <span m='3919130'>at</span> <span m='3919190'>least</span>
  <span m='3919550'>k</span> <span m='3919820'>over</span> <span m='3920030'>2,</span>
  <span m='3921170'>but</span> <span m='3921320'>you</span> <span m='3921500'>need</span>
  <span m='3921650'>to</span> <span m='3921770'>get</span> <span m='3921860'>up</span>
  <span m='3921980'>to</span> <span m='3922100'>k.</span> <span m='3922740'>And</span>
  <span m='3922880'>so</span> <span m='3923000'>you</span> <span m='3923150'>may</span>
  <span m='3923330'>get</span> <span m='3923510'>stuck</span> <span m='3923870'>in</span>
  <span m='3923960'>this</span> <span m='3924140'>kind</span> <span m='3924320'>of</span>
  <span m='3924380'>situation</span> <span m='3925010'>where</span> <span m='3926570'>maybe</span>
  <span m='3926750'>you're</span> <span m='3926840'>trying</span> <span m='3927020'>to</span>
  <span m='3927110'>get</span> <span m='3927200'>to</span> <span m='3927290'>the</span>
  <span m='3927380'>root</span> <span m='3927540'>and</span> <span m='3927620'>you</span>
  <span m='3927740'>jumped</span> <span m='3928050'>to</span> <span m='3928190'>here,</span>
  <span m='3929360'>but</span> <span m='3929480'>then</span> <span m='3930150'>you</span>
  <span m='3930350'>have</span> <span m='3930470'>to</span> <span m='3930560'>walk.</span>
  <span m='3931220'>So</span> <span m='3931370'>I</span> <span m='3931430'>think</span>
  <span m='3931670'>the</span> <span m='3931790'>long</span> <span m='3932000'>path's</span>
  <span m='3932270'>not</span> <span m='3932390'>enough.</span> <span m='3933140'>You</span>
  <span m='3933230'>need</span> <span m='3933380'>that</span> <span m='3933560'>factor</span>
  <span m='3933860'>of</span> <span m='3933950'>2,</span> <span m='3934100'>which</span>
  <span m='3934250'>the</span> <span m='3934340'>ladders</span> <span m='3934730'>give</span>
  <span m='3934910'>you.</span> </p><p><span m='3935720'>You</span> <span m='3935840'>can</span>
  <span m='3935960'>see</span> <span m='3936110'>where</span> <span m='3936230'>ladders</span>
  <span m='3936530'>come</span> <span m='3936710'>from</span> <span m='3936950'>now,</span>
  <span m='3937190'>right?</span> <span m='3937490'>I</span> <span m='3937550'>mean</span>
  <span m='3938390'>we</span> <span m='3938510'>got</span> <span m='3938690'>up</span>
  <span m='3938810'>to</span> <span m='3938990'>height</span> <span m='3939510'>k</span>
  <span m='3939750'>over</span> <span m='3939860'>2.</span> <span m='3940580'>Now</span>
  <span m='3940700'>we</span> <span m='3940790'>just</span> <span m='3940940'>need</span>
  <span m='3941060'>to</span> <span m='3941150'>double</span> <span m='3941450'>it.</span>
  <span m='3941640'>Hey,</span> <span m='3942020'>we</span> <span m='3942170'>can</span>
  <span m='3942320'>afford</span> <span m='3942590'>to</span> <span m='3942680'>double</span>
  <span m='3943010'>every</span> <span m='3943190'>path,</span> <span m='3944000'>but</span>
  <span m='3944180'>I</span> <span m='3944240'>think</span> <span m='3944420'>we</span>
  <span m='3944540'>need</span> <span m='3944830'>to.</span> <span m='3945385'>Are
  there</span> <span m='3945780'>questions?</span> </p><p><span m='3948690'>OK.</span>
  <span m='3950300'>So</span> <span m='3950720'>last</span> <span m='3951050'>thing</span>
  <span m='3951230'>to</span> <span m='3951350'>do</span> <span m='3952250'>is</span>
  <span m='3952460'>to</span> <span m='3952550'>shave</span> <span m='3952880'>off</span>
  <span m='3953060'>this</span> <span m='3953210'>log</span> <span m='3953480'>factor</span>
  <span m='3953900'>of</span> <span m='3953960'>space.</span> <span m='3956000'>Now,</span>
  <span m='3956120'>we're</span> <span m='3956210'>going</span> <span m='3956330'>to</span>
  <span m='3956390'>do</span> <span m='3956510'>that</span> <span m='3956690'>with</span>
  <span m='3956850'>indirection,</span> <span m='3957380'>of</span> <span m='3957470'>course,</span>
  <span m='3958560'>constant</span> <span m='3958990'>time</span> <span m='3959360'>and</span>
  <span m='3959690'>log n</span> <span m='3959930'>space.</span> <span m='3961040'>But</span>
  <span m='3961310'>it's</span> <span m='3961520'>not</span> <span m='3962510'>our</span>
  <span m='3962690'>usual</span> <span m='3963080'>type</span> <span m='3963350'>of</span>
  <span m='3963440'>indirection.</span> <span m='3968750'>Use</span> <span m='3968950'>this</span>
  <span m='3969110'>board.</span> <span m='3970540'>Indirections.</span> <span m='3971260'>So</span>
  <span m='3971680'>last</span> <span m='3972010'>time</span> <span m='3973510'>we</span>
  <span m='3973690'>did</span> <span m='3973880'>indirection,</span> <span m='3975400'>it</span>
  <span m='3975520'>was</span> <span m='3975670'>with</span> <span m='3975820'>an</span>
  <span m='3975910'>array.</span> <span m='3977120'>And</span> <span m='3977620'>actually</span>
  <span m='3977920'>pretty</span> <span m='3978130'>much</span> <span m='3978280'>every</span>
  <span m='3978580'>indirection</span> <span m='3978910'>we've</span> <span m='3979030'>done,</span>
  <span m='3979330'>it's</span> <span m='3979480'>been</span> <span m='3979720'>with</span>
  <span m='3979900'>an</span> <span m='3979990'>array-like</span> <span m='3980470'>thing.</span>
  <span m='3981160'>We</span> <span m='3981250'>could</span> <span m='3981400'>decompose</span>
  <span m='3981910'>into</span> <span m='3982090'>groups</span> <span m='3982390'>of</span>
  <span m='3982480'>size</span> <span m='3982960'>log n,</span> <span m='3984040'>the</span>
  <span m='3984100'>top</span> <span m='3984340'>thing</span> <span m='3984550'>was</span>
  <span m='3984700'>n</span> <span m='3984820'>over</span> <span m='3985000'>log</span>
  <span m='3985240'>n.</span> <span m='3986010'>So it was</span> <span m='3986210'>kind</span>
  <span m='3986410'>of</span> <span m='3986470'>clean.</span> </p><p><span m='3988180'>This</span>
  <span m='3988510'>structure</span> <span m='3988930'>is</span> <span m='3989050'>not</span>
  <span m='3989260'>so</span> <span m='3989410'>clean,</span> <span m='3990040'>because</span>
  <span m='3990550'>it's</span> <span m='3990730'>a</span> <span m='3990820'>tree.</span>
  <span m='3992200'>How</span> <span m='3992440'>do</span> <span m='3992530'>you</span>
  <span m='3992650'>decompose</span> <span m='3993220'>a</span> <span m='3993280'>tree</span>
  <span m='3993670'>into</span> <span m='3993910'>little</span> <span m='3994180'>things</span>
  <span m='3994450'>at</span> <span m='3994540'>the</span> <span m='3994630'>bottom</span>
  <span m='3995020'>of</span> <span m='3995140'>size log</span> <span m='3995560'>n</span>
  <span m='3995980'>and</span> <span m='3996070'>a</span> <span m='3996160'>top</span>
  <span m='3996460'>thing</span> <span m='3996700'>of</span> <span m='3996820'>size</span>
  <span m='3997060'>n</span> <span m='3997180'>over</span> <span m='3997330'>log</span>
  <span m='3997570'>n?</span> <span m='3998680'>Suppose,</span> <span m='3999730'>for</span>
  <span m='3999850'>example,</span> <span m='4000240'>your</span> <span m='4001410'>tree</span>
  <span m='4003000'>is</span> <span m='4003180'>a</span> <span m='4003210'>path.</span>
  <span m='4006840'>Bad</span> <span m='4007140'>news.</span> <span m='4009420'>If
  my</span> <span m='4009570'>tree</span> <span m='4009960'>were a</span> <span m='4010230'>path,</span>
  <span m='4014010'>well,</span> <span m='4014520'>I</span> <span m='4014580'>could</span>
  <span m='4014970'>trim</span> <span m='4015270'>off</span> <span m='4015960'>bottom</span>
  <span m='4016290'>thing</span> <span m='4016440'>of</span> <span m='4016530'>size</span>
  <span m='4016800'>log</span> <span m='4017020'>n.</span> <span m='4017340'>But</span>
  <span m='4017520'>now</span> <span m='4017760'>the</span> <span m='4017880'>rest</span>
  <span m='4018180'>is of</span> <span m='4018390'>size</span> <span m='4018810'>n</span>
  <span m='4019170'>minus</span> <span m='4019650'>log</span> <span m='4019970'>n,</span>
  <span m='4020770'>not</span> <span m='4021130'>n</span> <span m='4021440'>divided</span>
  <span m='4021750'>by</span> <span m='4021870'>log n.</span> <span m='4022260'>That's</span>
  <span m='4022530'>bad.</span> <span m='4023700'>I</span> <span m='4023760'>need</span>
  <span m='4023970'>to</span> <span m='4024060'>shave</span> <span m='4024300'>a</span>
  <span m='4024360'>factor</span> <span m='4024900'>of</span> <span m='4024990'>log</span>
  <span m='4025260'>n,</span> <span m='4025410'>not</span> <span m='4025650'>an</span>
  <span m='4025740'>additive</span> <span m='4026015'>log</span> <span m='4026290'>n.</span>
  </p><p><span m='4029780'>Can</span> <span m='4029930'>you</span> <span m='4029990'>tell</span>
  <span m='4030170'>me</span> <span m='4030290'>a</span> <span m='4030320'>good</span>
  <span m='4030500'>thing</span> <span m='4030680'>about</span> <span m='4030920'>a</span>
  <span m='4031010'>path?</span> <span m='4034300'>I</span> <span m='4034360'>mean,</span>
  <span m='4034510'>obviously,</span> <span m='4035020'>when</span> <span m='4035230'>we</span>
  <span m='4035320'>can</span> <span m='4035440'>put</span> <span m='4035620'>in</span>
  <span m='4035720'>an</span> <span m='4035830'>array.</span> <span m='4037150'>But</span>
  <span m='4037300'>can</span> <span m='4037420'>you</span> <span m='4037540'>quantify</span>
  <span m='4038200'>the</span> <span m='4038320'>goodness,</span> <span m='4039070'>or</span>
  <span m='4039460'>the</span> <span m='4039580'>pathlikedness</span> <span m='4040660'>of</span>
  <span m='4040870'>a</span> <span m='4041050'>tree?</span> <span m='4044984'>I</span>
  <span m='4045450'>erase this</span> <span m='4045880'>board.</span> <span m='4053170'>Kind</span>
  <span m='4053340'>of</span> <span m='4053400'>a</span> <span m='4053490'>vague</span>
  <span m='4053730'>question.</span> <span m='4061730'>Good</span> <span m='4061880'>thing</span>
  <span m='4062060'>about</span> <span m='4062270'>a</span> <span m='4062330'>path</span>
  <span m='4063650'>is</span> <span m='4063800'>that</span> <span m='4063920'>it</span>
  <span m='4063980'>doesn't</span> <span m='4064310'>have</span> <span m='4064490'>very</span>
  <span m='4064730'>many</span> <span m='4065030'>leaves.</span> <span m='4066050'>That's</span>
  <span m='4066200'>one</span> <span m='4066410'>way</span> <span m='4066530'>to</span>
  <span m='4066620'>quantify</span> <span m='4067130'>pathedness.</span> <span m='4068220'>Small</span>
  <span m='4068540'>number</span> <span m='4068780'>of</span> <span m='4068870'>leaves,</span>
  <span m='4069940'>I</span> <span m='4070070'>claim</span> <span m='4070970'>life's</span>
  <span m='4071270'>not</span> <span m='4071480'>so</span> <span m='4071700'>bad.</span>
  <span m='4074290'>I</span> <span m='4074440'>actually</span> <span m='4074800'>need</span>
  <span m='4074950'>to</span> <span m='4075100'>do</span> <span m='4075250'>that</span>
  <span m='4075460'>before</span> <span m='4078160'>we</span> <span m='4078250'>get</span>
  <span m='4078370'>to</span> <span m='4078460'>indirection.</span> </p><p><span m='4096010'>Step</span>
  <span m='4096310'>5</span> <span m='4098830'>is</span> <span m='4099460'>let's</span>
  <span m='4099700'>tune</span> <span m='4100120'>jump</span> <span m='4100359'>pointers</span>
  <span m='4100720'>a</span> <span m='4100779'>bit.</span> <span m='4104479'>I</span>
  <span m='4104660'>want</span> <span m='4104840'>to</span> <span m='4104920'>make</span>
  <span m='4105189'>them--</span> <span m='4108300'>so</span> <span m='4108460'>they're</span>
  <span m='4108670'>the</span> <span m='4108760'>problem,</span> <span m='4109210'>right?</span>
  <span m='4109390'>That's</span> <span m='4109630'>where</span> <span m='4109810'>we</span>
  <span m='4109899'>get</span> <span m='4110060'>n log</span> <span m='4110439'>n</span>
  <span m='4110560'>space.</span> <span m='4111330'>They're</span> <span m='4111479'>the</span>
  <span m='4111609'>only</span> <span m='4111910'>source</span> <span m='4112210'>of</span>
  <span m='4112330'>our</span> <span m='4112420'>n log n</span> <span m='4112899'>space.</span>
  <span m='4114370'>So</span> <span m='4114640'>what</span> <span m='4114819'>I'd</span>
  <span m='4114910'>like</span> <span m='4115060'>to</span> <span m='4115180'>do</span>
  <span m='4115630'>is</span> <span m='4118120'>in</span> <span m='4118300'>this</span>
  <span m='4118439'>situation</span> <span m='4119050'>where</span> <span m='4119170'>the</span>
  <span m='4119260'>number</span> <span m='4119500'>of</span> <span m='4119590'>leaves</span>
  <span m='4120010'>is</span> <span m='4120130'>small--</span> <span m='4121000'>we'll</span>
  <span m='4121170'>see</span> <span m='4121330'>what</span> <span m='4121450'>small</span>
  <span m='4121750'>is</span> <span m='4121870'>in</span> <span m='4121930'>a</span>
  <span m='4121990'>moment--</span> <span m='4122740'>I</span> <span m='4122890'>would</span>
  <span m='4123069'>like</span> <span m='4125069'>jump</span> <span m='4125290'>pointers</span>
  <span m='4125590'>to</span> <span m='4125710'>be</span> <span m='4125819'>linear
  size.</span> </p><p><span m='4129779'>OK,</span> <span m='4130790'>here's</span>
  <span m='4131029'>the</span> <span m='4131120'>idea.</span> <span m='4136250'>First</span>
  <span m='4136520'>idea</span> <span m='4136850'>is</span> <span m='4137600'>let's</span>
  <span m='4137870'>just</span> <span m='4138319'>store</span> <span m='4138859'>jump</span>
  <span m='4139100'>pointers</span> <span m='4139729'>from</span> <span m='4139939'>leaves.</span>
  <span m='4149290'>OK.</span> <span m='4150020'>So</span> <span m='4150290'>that</span>
  <span m='4150470'>would</span> <span m='4150590'>imply</span> <span m='4153050'>l</span>
  <span m='4153770'>log</span> <span m='4154790'>n</span> <span m='4155990'>space,</span>
  <span m='4156529'>I</span> <span m='4156590'>guess,</span> <span m='4156830'>plus</span>
  <span m='4157130'>linear</span> <span m='4158490'>overall.</span> <span m='4162948'>Instead</span>
  <span m='4163439'>of</span> <span m='4163600'>n log</span> <span m='4163939'>n,</span>
  <span m='4164120'>now</span> <span m='4164300'>we</span> <span m='4164390'>just</span>
  <span m='4164540'>pay</span> <span m='4164750'>for</span> <span m='4164870'>the</span>
  <span m='4164960'>leaves,</span> <span m='4165890'>except</span> <span m='4166279'>we</span>
  <span m='4166399'>kind</span> <span m='4166580'>of</span> <span m='4166640'>messed</span>
  <span m='4166850'>up</span> <span m='4166970'>our</span> <span m='4167080'>query.</span>
  <span m='4167689'>First</span> <span m='4167930'>thing</span> <span m='4168319'>query</span>
  <span m='4168410'>did</span> <span m='4168620'>was</span> <span m='4168800'>at</span>
  <span m='4168950'>the</span> <span m='4169040'>node,</span> <span m='4169340'>follow</span>
  <span m='4169670'>the</span> <span m='4169729'>jump</span> <span m='4169939'>pointer.</span>
  <span m='4171024'>But</span> <span m='4171810'>it's</span> <span m='4171979'>not
  so</span> <span m='4172300'>bad.</span> </p><p><span m='4173870'>Here</span> <span
  m='4174020'>we</span> <span m='4174140'>are</span> <span m='4174200'>at</span> <span
  m='4174319'>x.</span> <span m='4175279'>There's</span> <span m='4175760'>some</span>
  <span m='4176210'>leaves</span> <span m='4176899'>down</span> <span m='4177229'>here,</span>
  <span m='4178649'>and</span> <span m='4178819'>we</span> <span m='4178939'>want</span>
  <span m='4179120'>to</span> <span m='4179180'>jump</span> <span m='4179510'>up</span>
  <span m='4179720'>from</span> <span m='4179960'>here,</span> <span m='4180340'>from</span>
  <span m='4180529'>x.</span> <span m='4181670'>How</span> <span m='4181819'>do</span>
  <span m='4181939'>I</span> <span m='4182000'>jump</span> <span m='4182359'>from</span>
  <span m='4182540'>x?</span> <span m='4183470'>Well,</span> <span m='4183620'>if</span>
  <span m='4183800'>I</span> <span m='4183859'>could</span> <span m='4184010'>somehow</span>
  <span m='4184340'>go</span> <span m='4184520'>from</span> <span m='4184700'>x</span>
  <span m='4185029'>to</span> <span m='4185540'>really,</span> <span m='4185990'>any</span>
  <span m='4186319'>leaf,</span> <span m='4188540'>the</span> <span m='4188750'>ancestors</span>
  <span m='4189260'>of</span> <span m='4189380'>x</span> <span m='4189590'>that</span>
  <span m='4189710'>I</span> <span m='4189800'>care</span> <span m='4190010'>about</span>
  <span m='4190250'>are</span> <span m='4190370'>also</span> <span m='4190700'>ancestors</span>
  <span m='4191180'>of</span> <span m='4191270'>any</span> <span m='4191510'>leaf</span>
  <span m='4191720'>descendant</span> <span m='4192140'>of</span> <span m='4192229'>x.</span>
  <span m='4193010'>So</span> <span m='4193790'>all</span> <span m='4194000'>I</span>
  <span m='4194060'>need</span> <span m='4194240'>to</span> <span m='4194360'>do</span>
  <span m='4195020'>is</span> <span m='4195140'>store</span> <span m='4195410'>for</span>
  <span m='4195560'>each</span> <span m='4195830'>node</span> <span m='4197420'>any</span>
  <span m='4198410'>leaf</span> <span m='4198680'>descendant,</span> <span m='4200900'>single</span>
  <span m='4201170'>pointer--</span> <span m='4201930'>this'll</span> <span m='4202300'>be</span>
  <span m='4202460'>linear--</span> <span m='4206240'>from</span> <span m='4208760'>every</span>
  <span m='4209000'>node.</span> </p><p><span m='4212740'>OK</span> <span m='4213530'>so</span>
  <span m='4214130'>I</span> <span m='4214190'>start at</span> <span m='4214520'>x.</span>
  <span m='4215510'>I</span> <span m='4215600'>jump</span> <span m='4215900'>down</span>
  <span m='4216110'>to</span> <span m='4216200'>an</span> <span m='4216290'>arbitrary</span>
  <span m='4216770'>leaf,</span> <span m='4217040'>say</span> <span m='4217240'>this</span>
  <span m='4217400'>one.</span> <span m='4218670'>And</span> <span m='4218850'>now</span>
  <span m='4221910'>I</span> <span m='4222020'>have</span> <span m='4222170'>to</span>
  <span m='4222240'>do</span> <span m='4222440'>a</span> <span m='4222500'>query.</span>
  <span m='4225800'>Jump</span> <span m='4226010'>down,</span> <span m='4229280'>and</span>
  <span m='4230330'>let's</span> <span m='4230510'>say</span> <span m='4230660'>I</span>
  <span m='4230750'>jumped</span> <span m='4231020'>down</span> <span m='4231410'>by</span>
  <span m='4232310'>d.</span> <span m='4233540'>Then</span> <span m='4234440'>my</span>
  <span m='4236000'>k</span> <span m='4237500'>becomes</span> <span m='4238130'>k</span>
  <span m='4238550'>plus</span> <span m='4239090'>d,</span> <span m='4240350'>right.</span>
  <span m='4240770'>If</span> <span m='4240920'>I</span> <span m='4240980'>went</span>
  <span m='4241160'>down</span> <span m='4241370'>by</span> <span m='4241490'>d,</span>
  <span m='4242190'>and</span> <span m='4242360'>I</span> <span m='4242420'>want</span>
  <span m='4242600'>to</span> <span m='4242660'>go</span> <span m='4242780'>up</span>
  <span m='4242960'>by</span> <span m='4243140'>k</span> <span m='4243470'>from</span>
  <span m='4243650'>my</span> <span m='4243770'>original</span> <span m='4244070'>point,</span>
  <span m='4244280'>now</span> <span m='4244430'>I</span> <span m='4244490'>have</span>
  <span m='4244640'>to</span> <span m='4244730'>go</span> <span m='4244880'>up</span>
  <span m='4245090'>by</span> <span m='4245270'>k plus</span> <span m='4245720'>d.</span>
  </p><p><span m='4246440'>But</span> <span m='4246560'>hey,</span> <span m='4247550'>we</span>
  <span m='4247730'>know</span> <span m='4247850'>how</span> <span m='4247970'>to</span>
  <span m='4248090'>go</span> <span m='4248220'>up</span> <span m='4248320'>from</span>
  <span m='4248480'>any</span> <span m='4248660'>node</span> <span m='4249890'>that</span>
  <span m='4250010'>has</span> <span m='4250250'>jump</span> <span m='4250460'>pointers.</span>
  <span m='4251010'>So</span> <span m='4251090'>now</span> <span m='4251330'>we</span>
  <span m='4251450'>have</span> <span m='4251630'>a</span> <span m='4251690'>new</span>
  <span m='4252470'>node,</span> <span m='4254650'>a leaf.</span> <span m='4255800'>So</span>
  <span m='4255950'>it</span> <span m='4256010'>has</span> <span m='4256250'>a</span>
  <span m='4256310'>jump</span> <span m='4256520'>pointer,</span> <span m='4257730'>has</span>
  <span m='4258030'>jump</span> <span m='4258260'>pointers,</span> <span m='4259700'>upward.</span>
  <span m='4261020'>So</span> <span m='4261590'>we</span> <span m='4261800'>follow</span>
  <span m='4262220'>that</span> <span m='4262750'>one</span> <span m='4263070'>jump</span>
  <span m='4263280'>pointer</span> <span m='4263660'>to</span> <span m='4263810'>get</span>
  <span m='4263960'>us</span> <span m='4264080'>halfway</span> <span m='4264440'>there</span>
  <span m='4264890'>from</span> <span m='4265220'>our</span> <span m='4265370'>new</span>
  <span m='4265730'>starting</span> <span m='4266120'>point.</span> </p><p><span m='4266660'>We</span>
  <span m='4266750'>follow</span> <span m='4267080'>one</span> <span m='4267290'>ladder</span>
  <span m='4267560'>thing,</span> <span m='4268070'>and</span> <span m='4268190'>we</span>
  <span m='4268340'>can</span> <span m='4268520'>get</span> <span m='4268730'>to</span>
  <span m='4269450'>the</span> <span m='4269540'>level</span> <span m='4269810'>ancestor</span>
  <span m='4270770'>k</span> <span m='4270980'>plus</span> <span m='4271220'>d</span>
  <span m='4272900'>from</span> <span m='4273140'>the</span> <span m='4273230'>leaf,</span>
  <span m='4273530'>and</span> <span m='4273650'>that's</span> <span m='4273890'>the</span>
  <span m='4273980'>level</span> <span m='4274220'>ancestor</span> <span m='4274640'>k</span>
  <span m='4274940'>from</span> <span m='4275150'>x.</span> <span m='4276270'>OK,</span>
  <span m='4276380'>this</span> <span m='4276560'>is</span> <span m='4276650'>like</span>
  <span m='4276800'>a</span> <span m='4276860'>reduction</span> <span m='4277460'>to</span>
  <span m='4278180'>the</span> <span m='4278270'>leaf</span> <span m='4278520'>situation.</span>
  <span m='4279260'>We</span> <span m='4279380'>really</span> <span m='4279590'>don't</span>
  <span m='4279740'>have</span> <span m='4279890'>to</span> <span m='4280010'>support</span>
  <span m='4280340'>queries</span> <span m='4280640'>from</span> <span m='4280790'>arbitrary</span>
  <span m='4281150'>nodes.</span> <span m='4281610'>Just</span> <span m='4282020'>go</span>
  <span m='4282140'>down</span> <span m='4282320'>to</span> <span m='4282380'>a</span>
  <span m='4282410'>leaf</span> <span m='4283220'>and</span> <span m='4283340'>then</span>
  <span m='4283460'>solve</span> <span m='4283670'>the</span> <span m='4283760'>problem</span>
  <span m='4284030'>from</span> <span m='4284180'>the</span> <span m='4284270'>leaf.</span>
  <span m='4286040'>OK.</span> </p><p><span m='4289350'>OK,</span> <span m='4289640'>so</span>
  <span m='4289820'>now,</span> <span m='4290240'>if</span> <span m='4290360'>the</span>
  <span m='4290450'>number</span> <span m='4290720'>leaves</span> <span m='4291050'>is</span>
  <span m='4291140'>small,</span> <span m='4291840'>my</span> <span m='4292040'>space</span>
  <span m='4292400'>will</span> <span m='4292490'>get</span> <span m='4292610'>small.</span>
  <span m='4292880'>How</span> <span m='4293090'>small</span> <span m='4293420'>does</span>
  <span m='4293570'>l</span> <span m='4293720'>have</span> <span m='4293900'>to</span>
  <span m='4293990'>be?</span> <span m='4294540'>n</span> <span m='4294770'>divided</span>
  <span m='4295100'>by</span> <span m='4295260'>log n.</span> <span m='4296310'>Interesting.</span>
  <span m='4299180'>If</span> <span m='4299360'>I</span> <span m='4299510'>could</span>
  <span m='4299660'>get</span> <span m='4300110'>the</span> <span m='4300290'>top</span>
  <span m='4300680'>structure</span> <span m='4301640'>to</span> <span m='4301760'>not</span>
  <span m='4301970'>have</span> <span m='4302210'>n</span> <span m='4302390'>over</span>
  <span m='4302600'>log</span> <span m='4302840'>n</span> <span m='4302960'>nodes,</span>
  <span m='4303260'>that's</span> <span m='4303500'>not</span> <span m='4303650'>possible.</span>
  <span m='4304250'>I</span> <span m='4304370'>can,</span> <span m='4304670'>at</span>
  <span m='4304820'>best,</span> <span m='4305060'>get</span> <span m='4305240'>to</span>
  <span m='4305390'>n</span> <span m='4305570'>minus</span> <span m='4305940'>log
  n</span> <span m='4306290'>nodes.</span> <span m='4307070'>But if</span> <span m='4307250'>I</span>
  <span m='4307370'>could</span> <span m='4307520'>get</span> <span m='4307670'>it</span>
  <span m='4307730'>down</span> <span m='4307970'>to</span> <span m='4308120'>n</span>
  <span m='4308330'>over</span> <span m='4308570'>log</span> <span m='4308840'>n</span>
  <span m='4309000'>leaves,</span> <span m='4310490'>that</span> <span m='4310700'>would</span>
  <span m='4310850'>be</span> <span m='4310970'>enough</span> <span m='4311210'>to</span>
  <span m='4311330'>make</span> <span m='4311510'>this</span> <span m='4311690'>linear</span>
  <span m='4311990'>space,</span> <span m='4312500'>and</span> <span m='4312680'>indeed,</span>
  <span m='4313250'>I</span> <span m='4313370'>can.</span> </p><p><span m='4314930'>This</span>
  <span m='4315170'>is</span> <span m='4315470'>a</span> <span m='4315560'>technique</span>
  <span m='4316040'>called</span> <span m='4317210'>tree</span> <span m='4317510'>trimming,</span>
  <span m='4318410'>or</span> <span m='4318560'>I</span> <span m='4318680'>call</span>
  <span m='4318920'>it</span> <span m='4319040'>that.</span> <span m='4319340'>I</span>
  <span m='4319430'>don't</span> <span m='4319610'>know</span> <span m='4319730'>if</span>
  <span m='4319850'>anyone</span> <span m='4320090'>else</span> <span m='4320300'>does.</span>
  <span m='4321540'>But</span> <span m='4322730'>I</span> <span m='4322820'>think</span>
  <span m='4323120'>I've</span> <span m='4323240'>called</span> <span m='4323480'>it</span>
  <span m='4323570'>that</span> <span m='4323760'>in</span> <span m='4323960'>enough</span>
  <span m='4324200'>papers</span> <span m='4324650'>that</span> <span m='4325010'>we're</span>
  <span m='4325160'>allowed</span> <span m='4325430'>to</span> <span m='4325520'>call</span>
  <span m='4325700'>it</span> <span m='4325790'>that.</span> <span m='4333460'>Originally</span>
  <span m='4333790'>invented</span> <span m='4334120'>by</span> <span m='4334270'>[?
  Al ?]</span> <span m='4334450'>[? Strip ?]</span> <span m='4334730'>and</span> <span
  m='4334840'>others</span> <span m='4335670'>for a</span> <span m='4335800'>particular</span>
  <span m='4336250'>data</span> <span m='4336430'>structure.</span> </p><p><span m='4338620'>There's</span>
  <span m='4338890'>many</span> <span m='4339190'>versions</span> <span m='4339580'>of</span>
  <span m='4339700'>it.</span> <span m='4339820'>We</span> <span m='4339940'>will</span>
  <span m='4340090'>see</span> <span m='4340300'>other</span> <span m='4340480'>versions</span>
  <span m='4340900'>in</span> <span m='4341050'>future</span> <span m='4341380'>lectures,</span>
  <span m='4341830'>but</span> <span m='4342670'>here's</span> <span m='4342940'>the</span>
  <span m='4343000'>version</span> <span m='4343390'>you</span> <span m='4343570'>need</span>
  <span m='4348460'>for</span> <span m='4348930'>this</span> <span m='4349070'>problem.</span>
  <span m='4367920'>OK,</span> <span m='4368890'>here's</span> <span m='4369090'>the</span>
  <span m='4369180'>plan.</span> <span m='4370470'>I</span> <span m='4370560'>have</span>
  <span m='4372390'>a</span> <span m='4372540'>tree</span> <span m='4378530'>and</span>
  <span m='4378740'>I</span> <span m='4378860'>want</span> <span m='4379070'>to</span>
  <span m='4379160'>identify</span> <span m='4379820'>all</span> <span m='4380030'>the</span>
  <span m='4380150'>maximally</span> <span m='4380780'>deep</span> <span m='4381050'>nodes</span>
  <span m='4383240'>that</span> <span m='4383480'>have</span> <span m='4383810'>at</span>
  <span m='4383900'>least</span> <span m='4384230'>log</span> <span m='4384560'>n</span>
  <span m='4384890'>nodes</span> <span m='4385160'>below</span> <span m='4385550'>them.</span>
  <span m='4386632'>This</span> <span m='4387070'>will</span> <span m='4387170'>seem</span>
  <span m='4387380'>weird,</span> <span m='4387650'>because</span> <span m='4387830'>we</span>
  <span m='4387920'>really</span> <span m='4388130'>care</span> <span m='4388280'>about</span>
  <span m='4388460'>leaves,</span> <span m='4388790'>and</span> <span m='4388880'>so</span>
  <span m='4389090'>on.</span> <span m='4389670'>So</span> <span m='4391820'>there's</span>
  <span m='4392180'>stuff</span> <span m='4392540'>hanging</span> <span m='4392870'>off</span>
  <span m='4393080'>here,</span> <span m='4393990'>whatever.</span> <span m='4395240'>I</span>
  <span m='4395330'>guess</span> <span m='4395540'>I'm</span> <span m='4395660'>thinking
  of</span> <span m='4396050'>that</span> <span m='4396230'>as</span> <span m='4396350'>one</span>
  <span m='4396530'>big</span> <span m='4396710'>tree.</span> <span m='4398220'>No,</span>
  <span m='4398510'>actually</span> <span m='4398870'>I'm not.</span> <span m='4401180'>I</span>
  <span m='4401300'>do</span> <span m='4401480'>need</span> <span m='4401630'>to</span>
  <span m='4401840'>separate</span> <span m='4402320'>these</span> <span m='4402500'>out.</span>
  </p><p><span m='4405470'>But</span> <span m='4406080'>one</span> <span m='4406250'>of</span>
  <span m='4406310'>these</span> <span m='4406430'>nodes</span> <span m='4406640'>could</span>
  <span m='4406790'>have</span> <span m='4407150'>arbitrarily</span> <span m='4407690'>many</span>
  <span m='4407840'>children.</span> <span m='4408230'>We</span> <span m='4408320'>have</span>
  <span m='4408440'>no</span> <span m='4408590'>idea.</span> <span m='4409920'>It's</span>
  <span m='4410090'>a</span> <span m='4410360'>arbitrary</span> <span m='4410830'>tree.</span>
  <span m='4414740'>OK,</span> <span m='4415100'>and</span> <span m='4415220'>what</span>
  <span m='4415400'>I</span> <span m='4415490'>know</span> <span m='4416360'>is</span>
  <span m='4416540'>that</span> <span m='4416660'>each</span> <span m='4416900'>of</span>
  <span m='4416960'>these</span> <span m='4417170'>triangles</span> <span m='4418310'>has</span>
  <span m='4418520'>size</span> <span m='4419360'>less</span> <span m='4419870'>than</span>
  <span m='4420370'>1/4</span> <span m='4420840'>log n.</span> <span m='4422750'>Because</span>
  <span m='4423050'>otherwise,</span> <span m='4423500'>this</span> <span m='4423680'>node</span>
  <span m='4423890'>was</span> <span m='4424010'>not</span> <span m='4424190'>maximally</span>
  <span m='4424640'>deep.</span> <span m='4426020'>So</span> <span m='4426950'>if</span>
  <span m='4432290'>this</span> <span m='4432440'>had</span> <span m='4432590'>size</span>
  <span m='4432980'>greater</span> <span m='4433190'>or</span> <span m='4433260'>equal
  than</span> <span m='4433580'>1/4</span> <span m='4433820'>log</span> <span m='4434030'>n,</span>
  <span m='4434150'>then</span> <span m='4434300'>that</span> <span m='4434510'>would</span>
  <span m='4434660'>have</span> <span m='4434750'>been</span> <span m='4434900'>the</span>
  <span m='4434990'>node</span> <span m='4435230'>where</span> <span m='4435340'>I</span>
  <span m='4435430'>cut,</span> <span m='4435650'>not</span> <span m='4435860'>this</span>
  <span m='4436040'>one.</span> <span m='4436460'>So</span> <span m='4436610'>I'm</span>
  <span m='4436730'>circling</span> <span m='4437180'>the</span> <span m='4437240'>nodes</span>
  <span m='4437510'>that</span> <span m='4438170'>I</span> <span m='4438260'>cut</span>
  <span m='4438530'>below,</span> <span m='4438920'>so</span> <span m='4439260'>meaning</span>
  <span m='4439430'>I</span> <span m='4439490'>cut</span> <span m='4439760'>these</span>
  <span m='4439970'>edges.</span> </p><p><span m='4443050'>OK,</span> <span m='4443750'>so</span>
  <span m='4443930'>these</span> <span m='4444140'>things</span> <span m='4444350'>have</span>
  <span m='4444450'>size</span> <span m='4444710'>less</span> <span m='4444950'>than</span>
  <span m='4445040'>1/4</span> <span m='4445340'>log</span> <span m='4445550'>n,</span>
  <span m='4445830'>but</span> <span m='4446090'>these</span> <span m='4446330'>nodes</span>
  <span m='4447230'>have</span> <span m='4448010'>at</span> <span m='4448130'>least</span>
  <span m='4448490'>1/4</span> <span m='4448970'>log</span> <span m='4449270'>n</span>
  <span m='4449570'>nodes</span> <span m='4449870'>below</span> <span m='4450170'>them.</span>
  <span m='4451880'>So</span> <span m='4452180'>how</span> <span m='4452480'>many</span>
  <span m='4452720'>of</span> <span m='4452810'>these</span> <span m='4452960'>circle</span>
  <span m='4453380'>nodes</span> <span m='4453650'>are</span> <span m='4453800'>there?</span>
  <span m='4455510'>Well,</span> <span m='4460470'>at</span> <span m='4460700'>most,</span>
  <span m='4462020'>4</span> <span m='4462530'>n</span> <span m='4462710'>over</span>
  <span m='4462890'>log</span> <span m='4463200'>n</span> <span m='4465020'>such</span>
  <span m='4465380'>nodes,</span> <span m='4469940'>right,</span> <span m='4470120'>because</span>
  <span m='4470300'>I</span> <span m='4470390'>can</span> <span m='4470540'>charge</span>
  <span m='4470900'>this</span> <span m='4471080'>node</span> <span m='4471920'>to</span>
  <span m='4472490'>at</span> <span m='4472580'>least</span> <span m='4472820'>1/4</span>
  <span m='4473300'>log</span> <span m='4473630'>n</span> <span m='4473810'>nodes</span>
  <span m='4474620'>that</span> <span m='4474800'>disappear</span> <span m='4475430'>in</span>
  <span m='4475520'>the</span> <span m='4475610'>top</span> <span m='4475850'>structure.</span>
  <span m='4480010'>But</span> <span m='4480170'>these</span> <span m='4480500'>things</span>
  <span m='4481370'>become</span> <span m='4481940'>the</span> <span m='4482060'>leaves,</span>
  <span m='4483360'>right.</span> <span m='4483650'>If</span> <span m='4483770'>I</span>
  <span m='4483830'>cut</span> <span m='4484130'>all</span> <span m='4484370'>the</span>
  <span m='4484610'>edges</span> <span m='4484970'>going</span> <span m='4485240'>down</span>
  <span m='4485510'>from</span> <span m='4485660'>there,</span> <span m='4485930'>that</span>
  <span m='4486170'>makes</span> <span m='4486390'>it a</span> <span m='4486490'>leaf.</span>
  <span m='4487880'>And</span> <span m='4488000'>they're</span> <span m='4488150'>the</span>
  <span m='4488270'>only</span> <span m='4488570'>leaves.</span> <span m='4490720'>Are
  they the</span> <span m='4490940'>only</span> <span m='4491210'>leaves?</span> <span
  m='4492090'>Yeah.</span> </p><p><span m='4493730'>If</span> <span m='4493880'>you</span>
  <span m='4493970'>look</span> <span m='4494150'>at</span> <span m='4494210'>a</span>
  <span m='4494270'>leaf,</span> <span m='4494750'>then</span> <span m='4494990'>it</span>
  <span m='4495110'>has</span> <span m='4495280'>size</span> <span m='4495890'>less</span>
  <span m='4496190'>than</span> <span m='4496360'>1/4</span> <span m='4496670'>log</span>
  <span m='4496850'>n.</span> <span m='4497000'>So</span> <span m='4497120'>you</span>
  <span m='4497300'>will</span> <span m='4497390'>cut</span> <span m='4497630'>above</span>
  <span m='4497960'>it</span> <span m='4498080'>somewhere.</span> <span m='4499050'>So</span>
  <span m='4499100'>every</span> <span m='4499370'>old</span> <span m='4499610'>leaf</span>
  <span m='4499970'>will</span> <span m='4500120'>be</span> <span m='4500240'>down</span>
  <span m='4500480'>here,</span> <span m='4501540'>and</span> <span m='4502250'>the</span>
  <span m='4502370'>only</span> <span m='4502610'>new</span> <span m='4502760'>leaves</span>
  <span m='4503180'>will</span> <span m='4503330'>be</span> <span m='4503570'>the</span>
  <span m='4503750'>cut nodes.</span> <span m='4505270'>OK.</span> <span m='4505820'>So</span>
  <span m='4506090'>we</span> <span m='4506240'>have</span> <span m='4507590'>order</span>
  <span m='4507890'>n</span> <span m='4508370'>over</span> <span m='4508720'>log</span>
  <span m='4508990'>n</span> <span m='4510370'>leaves.</span> <span m='4512330'>Yes,</span>
  <span m='4513230'>good.</span> </p><p><span m='4514220'>So it's</span> <span m='4514400'>funny.</span>
  <span m='4514640'>We're</span> <span m='4514760'>cutting</span> <span m='4515180'>according</span>
  <span m='4515570'>to</span> <span m='4515690'>counting</span> <span m='4516590'>nodes,</span>
  <span m='4517070'>descendants,</span> <span m='4517970'>not</span> <span m='4518240'>leaves.</span>
  <span m='4518660'>Won't</span> <span m='4518840'>work</span> <span m='4519050'>if</span>
  <span m='4519140'>you</span> <span m='4519230'>cut</span> <span m='4519380'>with</span>
  <span m='4519500'>leaves--</span> <span m='4520870'>cut</span> <span m='4521060'>with</span>
  <span m='4521180'>nodes.</span> <span m='4521630'>But</span> <span m='4521810'>then</span>
  <span m='4521990'>the</span> <span m='4522230'>thing</span> <span m='4522470'>that</span>
  <span m='4522590'>we</span> <span m='4522740'>care</span> <span m='4522920'>about</span>
  <span m='4523190'>is</span> <span m='4523280'>the</span> <span m='4523370'>number</span>
  <span m='4523550'>of</span> <span m='4523610'>leaves</span> <span m='4523880'>went</span>
  <span m='4524060'>down.</span> <span m='4525660'>That</span> <span m='4525710'>will</span>
  <span m='4525800'>be</span> <span m='4526190'>enough.</span> <span m='4528530'>Great.</span>
  <span m='4529880'>So</span> <span m='4530990'>up</span> <span m='4531230'>here,</span>
  <span m='4532730'>we</span> <span m='4532880'>can</span> <span m='4533030'>afford</span>
  <span m='4533420'>to</span> <span m='4533600'>use</span> <span m='4534900'>5,</span>
  <span m='4535680'>the</span> <span m='4536120'>tuned</span> <span m='4536690'>jump</span>
  <span m='4537020'>pointer,</span> <span m='4538100'>combined</span> <span m='4538790'>with</span>
  <span m='4539490'>ladder</span> <span m='4540230'>structure.</span> <span m='4541730'>Because</span>
  <span m='4542420'>this</span> <span m='4542660'>only</span> <span m='4542930'>costs</span>
  <span m='4543310'>l</span> <span m='4543520'>log</span> <span m='4543870'>n.</span>
  <span m='4545310'>l</span> <span m='4545600'>is</span> <span m='4545780'>now</span>
  <span m='4546070'>n</span> <span m='4546260'>over log</span> <span m='4546650'>n,</span>
  <span m='4547220'>so</span> <span m='4547370'>the</span> <span m='4547580'>log n's</span>
  <span m='4548030'>cancel.</span> <span m='4548930'>So</span> <span m='4549080'>linear</span>
  <span m='4549470'>space</span> <span m='4549860'>to</span> <span m='4549950'>store</span>
  <span m='4550190'>the</span> <span m='4550280'>jump</span> <span m='4550520'>pointers</span>
  <span m='4551720'>from</span> <span m='4552050'>these</span> <span m='4552310'>circled</span>
  <span m='4552710'>nodes.</span> </p><p><span m='4553910'>So</span> <span m='4554090'>if</span>
  <span m='4554270'>our</span> <span m='4554340'>query is</span> <span m='4554780'>anywhere</span>
  <span m='4555170'>up</span> <span m='4555350'>here,</span> <span m='4556370'>then</span>
  <span m='4556550'>we</span> <span m='4556640'>go</span> <span m='4556850'>to</span>
  <span m='4556970'>a</span> <span m='4557000'>descendant</span> <span m='4557420'>leaf</span>
  <span m='4557870'>in</span> <span m='4557990'>the</span> <span m='4558080'>top</span>
  <span m='4558290'>structure.</span> <span m='4558840'>And</span> <span m='4559190'>we</span>
  <span m='4559280'>can</span> <span m='4559370'>go</span> <span m='4559550'>wherever</span>
  <span m='4559820'>we</span> <span m='4559910'>need</span> <span m='4560060'>to</span>
  <span m='4560150'>go.</span> <span m='4563300'>If</span> <span m='4563510'>our</span>
  <span m='4563600'>query</span> <span m='4564000'>is</span> <span m='4564080'>in</span>
  <span m='4564230'>one</span> <span m='4564380'>of</span> <span m='4564470'>the</span>
  <span m='4564620'>little</span> <span m='4565430'>trees</span> <span m='4565700'>at</span>
  <span m='4565790'>the</span> <span m='4565880'>bottom,</span> <span m='4566270'>which</span>
  <span m='4566450'>are</span> <span m='4566570'>small,</span> <span m='4567050'>they're</span>
  <span m='4567200'>only</span> <span m='4567420'>1/4</span> <span m='4567440'>quarter</span>
  <span m='4567710'>log</span> <span m='4567950'>n,</span> <span m='4568130'>so</span>
  <span m='4568280'>we're</span> <span m='4568340'>going</span> <span m='4568450'>to</span>
  <span m='4568550'>use</span> <span m='4568730'>a</span> <span m='4568760'>lookup</span>
  <span m='4569060'>table.</span> <span m='4570770'>Either</span> <span m='4571190'>answer</span>
  <span m='4571550'>is</span> <span m='4571730'>inside</span> <span m='4572330'>the</span>
  <span m='4572450'>triangle,</span> <span m='4572845'>in</span> <span m='4573240'>which</span>
  <span m='4573320'>case,</span> <span m='4573630'>we</span> <span m='4573680'>really</span>
  <span m='4573890'>need</span> <span m='4574040'>to</span> <span m='4574100'>query</span>
  <span m='4574340'>that</span> <span m='4574490'>structure.</span> <span m='4575510'>Or</span>
  <span m='4576800'>it's</span> <span m='4577170'>up</span> <span m='4577290'>here.</span>
  <span m='4578300'>If</span> <span m='4578450'>it's</span> <span m='4578600'>up</span>
  <span m='4578720'>here,</span> <span m='4579660'>we</span> <span m='4579680'>just</span>
  <span m='4579860'>need</span> <span m='4580040'>to</span> <span m='4580190'>know,</span>
  <span m='4581000'>basically,</span> <span m='4581690'>if</span> <span m='4581870'>every</span>
  <span m='4582140'>node</span> <span m='4582320'>down</span> <span m='4582560'>here</span>
  <span m='4582740'>stores</span> <span m='4583040'>a</span> <span m='4583100'>pointer</span>
  <span m='4583430'>to</span> <span m='4583610'>the</span> <span m='4584210'>dot</span>
  <span m='4584480'>above</span> <span m='4584810'>it.</span> </p><p><span m='4585660'>Then</span>
  <span m='4585740'>we</span> <span m='4585860'>can</span> <span m='4586070'>first</span>
  <span m='4586340'>go</span> <span m='4586520'>there</span> <span m='4586700'>and
  see,</span> <span m='4587110'>is</span> <span m='4587300'>that</span> <span m='4587480'>too</span>
  <span m='4587690'>high?</span> <span m='4588070'>If</span> <span m='4588140'>it's</span>
  <span m='4588290'>too</span> <span m='4588440'>high,</span> <span m='4588810'>then</span>
  <span m='4588860'>our</span> <span m='4588980'>answer is</span> <span m='4589370'>in</span>
  <span m='4589490'>here.</span> <span m='4590210'>If</span> <span m='4590330'>it's</span>
  <span m='4590450'>not</span> <span m='4590630'>too</span> <span m='4590810'>high,</span>
  <span m='4591360'>then</span> <span m='4591440'>we</span> <span m='4591530'>just</span>
  <span m='4591680'>do</span> <span m='4591800'>the</span> <span m='4591920'>corresponding</span>
  <span m='4592400'>query</span> <span m='4592790'>in</span> <span m='4592880'>structure</span>
  <span m='4593200'>5.</span> </p><p><span m='4594330'>OK,</span> <span m='4594650'>so</span>
  <span m='4595310'>the</span> <span m='4595520'>last</span> <span m='4595910'>remaining</span>
  <span m='4596240'>thing</span> <span m='4596510'>is</span> <span m='4596630'>to</span>
  <span m='4596750'>solve</span> <span m='4597170'>a</span> <span m='4597230'>query</span>
  <span m='4597590'>that</span> <span m='4597770'>stays</span> <span m='4598250'>entirely</span>
  <span m='4598730'>within</span> <span m='4598970'>a</span> <span m='4599030'>triangle,</span>
  <span m='4600200'>so</span> <span m='4600240'>a</span> <span m='4600680'>bottom</span>
  <span m='4601130'>structure,</span> <span m='4602960'>and</span> <span m='4603420'>that's</span>
  <span m='4603620'>where</span> <span m='4603770'>we</span> <span m='4603890'>use</span>
  <span m='4605000'>lookup</span> <span m='4605300'>tables.</span> <span m='4616740'>Again,</span>
  <span m='4617140'>things</span> <span m='4617370'>are</span> <span m='4617730'>going</span>
  <span m='4617880'>to</span> <span m='4617940'>be</span> <span m='4618030'>similar</span>
  <span m='4618360'>to</span> <span m='4618450'>last</span> <span m='4618720'>time</span>
  <span m='4620026'>except</span> <span m='4620410'>for</span> <span m='4620600'>now,</span>
  <span m='4620880'>to</span> <span m='4620970'>step</span> <span m='4621300'>7.</span>
  <span m='4624780'>But</span> <span m='4625080'>it's</span> <span m='4625260'>a</span>
  <span m='4625290'>little</span> <span m='4625560'>bit</span> <span m='4625680'>messier</span>
  <span m='4626070'>because</span> <span m='4626340'>instead</span> <span m='4626640'>of</span>
  <span m='4626880'>arrays,</span> <span m='4628410'>we</span> <span m='4628560'>have</span>
  <span m='4628800'>trees.</span> <span m='4629760'>And</span> <span m='4629910'>here</span>
  <span m='4630090'>it's</span> <span m='4630300'>like</span> <span m='4631410'>we</span>
  <span m='4631620'>graduate</span> <span m='4632190'>from</span> <span m='4632400'>baby</span>
  <span m='4632730'>[INAUDIBLE]</span> <span m='4633480'>which</span> <span m='4633690'>is</span>
  <span m='4633870'>how</span> <span m='4634110'>many</span> <span m='4634350'>plus</span>
  <span m='4634620'>or</span> <span m='4634680'>minus</span> <span m='4634920'>1</span>
  <span m='4635130'>strings</span> <span m='4635430'>there</span> <span m='4635510'>are--</span>
  <span m='4636090'>power of</span> <span m='4636510'>2--</span> <span m='4637230'>to</span>
  <span m='4637710'>how</span> <span m='4637890'>many</span> <span m='4638100'>trees</span>
  <span m='4638670'>are</span> <span m='4638880'>there.</span> </p><p><span m='4640050'>Anyone</span>
  <span m='4640260'>know</span> <span m='4640470'>how</span> <span m='4640590'>many</span>
  <span m='4640770'>trees</span> <span m='4641160'>on</span> <span m='4641280'>n</span>
  <span m='4641430'>nodes</span> <span m='4641700'>there</span> <span m='4641880'>are?</span>
  <span m='4643890'>One</span> <span m='4644130'>word</span> <span m='4644310'>answer.</span>
  <span m='4648220'>No.</span> <span m='4649436'>Nice.</span> <span m='4650660'>That</span>
  <span m='4651000'>is</span> <span m='4651240'>a</span> <span m='4651330'>correct</span>
  <span m='4651720'>one</span> <span m='4651930'>word</span> <span m='4652080'>answer.</span>
  <span m='4652710'>Very</span> <span m='4652920'>good.</span> <span m='4654150'>Not</span>
  <span m='4654210'>the one</span> <span m='4654370'>I</span> <span m='4654540'>had</span>
  <span m='4654690'>in</span> <span m='4654750'>mind,</span> <span m='4655200'>but</span>
  <span m='4657520'>anyone</span> <span m='4658200'>else?</span> <span m='4674630'>Nope.</span>
  <span m='4675610'>You're</span> <span m='4675820'>thinking</span> <span m='4676120'>end</span>
  <span m='4676260'>to</span> <span m='4676350'>the</span> <span m='4676410'>end.</span>
  <span m='4676630'>That</span> <span m='4677500'>would</span> <span m='4677590'>be</span>
  <span m='4677710'>bad.</span> <span m='4678010'>We</span> <span m='4678410'>could</span>
  <span m='4678550'>not</span> <span m='4678700'>afford</span> <span m='4678970'>that,</span>
  <span m='4679210'>because</span> <span m='4679360'>log</span> <span m='4679600'>n</span>
  <span m='4679780'>to</span> <span m='4679840'>log</span> <span m='4680080'>n</span>
  <span m='4680200'>is</span> <span m='4680260'>super</span> <span m='4680590'>polynomial.</span>
  <span m='4682270'>Fortunately</span> <span m='4682630'>it's</span> <span m='4682720'>not</span>
  <span m='4682900'>that</span> <span m='4683080'>big.</span> <span m='4683350'>Hmm?</span>
  </p><p><span m='4683770'>AUDIENCE:</span> </p><p><span m='4684610'>PROFESSOR:</span>
  <span m='4684640'>It's</span> <span m='4684670'>roughly</span> <span m='4685000'>4</span>
  <span m='4685210'>to</span> <span m='4685270'>the</span> <span m='4685420'>n.</span>
  <span m='4686050'>The</span> <span m='4686230'>correct</span> <span m='4686740'>answer--</span>
  <span m='4687000'>I</span> <span m='4687070'>mean</span> <span m='4687160'>the</span>
  <span m='4687220'>exact</span> <span m='4687640'>answer--</span> <span m='4687910'>is</span>
  <span m='4688060'>called</span> <span m='4688260'>the</span> <span m='4688600'>Catalan</span>
  <span m='4689080'>number,</span> <span m='4689830'>which</span> <span m='4690400'>didn't</span>
  <span m='4690610'>tell</span> <span m='4690820'>you</span> <span m='4690940'>much.</span>
  <span m='4692080'>I</span> <span m='4692200'>didn't</span> <span m='4692380'>write</span>
  <span m='4692560'>it</span> <span m='4692620'>down,</span> <span m='4692830'>but</span>
  <span m='4692950'>I'm</span> <span m='4693010'>pretty</span> <span m='4693220'>sure</span>
  <span m='4693490'>it</span> <span m='4693610'>is</span> <span m='4694160'>2</span>
  <span m='4694460'>n prime</span> <span m='4695330'>choose</span> <span m='4695770'>n</span>
  <span m='4696010'>prime</span> <span m='4698260'>1</span> <span m='4698440'>over</span>
  <span m='4698950'>n</span> <span m='4699220'>prime</span> <span m='4700500'>plus</span>
  <span m='4700780'>1</span> <span m='4701770'>ish?</span> <span m='4704380'>Don't</span>
  <span m='4704590'>quote</span> <span m='4704800'>me</span> <span m='4704920'>on</span>
  <span m='4705010'>that.</span> <span m='4705370'>It's roughly</span> <span m='4705700'>that.</span>
  <span m='4707380'>Might</span> <span m='4707560'>be</span> <span m='4707650'>exactly</span>
  <span m='4708070'>that.</span> <span m='4708370'>Someone</span> <span m='4708730'>with</span>
  <span m='4708880'>internet</span> <span m='4709210'>can</span> <span m='4709570'>check.</span>
  <span m='4710970'>But</span> <span m='4711160'>it</span> <span m='4711280'>is</span>
  <span m='4711430'>at</span> <span m='4711550'>most</span> <span m='4712110'>4</span>
  <span m='4712400'>to</span> <span m='4712470'>the</span> <span m='4712570'>n prime.</span>
  <span m='4713470'>The</span> <span m='4713590'>computer</span> <span m='4713860'>science</span>
  <span m='4714220'>answer is</span> <span m='4714600'>4</span> <span m='4714760'>to</span>
  <span m='4714850'>the</span> <span m='4714980'>n.</span> <span m='4715210'>Indeed.</span>
  </p><p><span m='4717460'>It's</span> <span m='4717640'>just</span> <span m='4717790'>some</span>
  <span m='4717970'>asymptotics</span> <span m='4718570'>here.</span> <span m='4719260'>Why</span>
  <span m='4719470'>is</span> <span m='4719590'>it</span> <span m='4719690'>4 to the</span>
  <span m='4720040'>n?</span> <span m='4720220'>4 to the</span> <span m='4720570'>n</span>
  <span m='4720760'>you</span> <span m='4720880'>could</span> <span m='4721030'>also</span>
  <span m='4721270'>write</span> <span m='4721450'>as</span> <span m='4721570'>2 to
  the</span> <span m='4722050'>2 n</span> <span m='4722440'>prime,</span> <span m='4724580'>which</span>
  <span m='4724690'>is--</span> <span m='4725200'>first,</span> <span m='4725440'>let's</span>
  <span m='4725620'>check</span> <span m='4725830'>this</span> <span m='4725980'>is</span>
  <span m='4726070'>good,</span> <span m='4726310'>and</span> <span m='4726390'>then
  I'll</span> <span m='4726670'>explain</span> <span m='4727030'>why</span> <span
  m='4727180'>this</span> <span m='4727300'>is</span> <span m='4727420'>true</span>
  <span m='4728680'>in</span> <span m='4728830'>a</span> <span m='4728890'>computer</span>
  <span m='4729190'>science</span> <span m='4729520'>way.</span> <span m='4730060'>So</span>
  <span m='4730240'>we</span> <span m='4730300'>got</span> <span m='4730480'>1/4</span>
  <span m='4730930'>log</span> <span m='4731230'>n</span> <span m='4731410'>up</span>
  <span m='4731590'>here.</span> <span m='4731930'>So</span> <span m='4732130'>the</span>
  <span m='4732640'>one</span> <span m='4732880'>2</span> <span m='4733090'>cancels</span>
  <span m='4733600'>with</span> <span m='4734490'>one</span> <span m='4734830'>2</span>
  <span m='4735030'>up</span> <span m='4735190'>here.</span> <span m='4735910'>So</span>
  <span m='4736000'>we</span> <span m='4736060'>have</span> <span m='4736190'>2</span>
  <span m='4736390'>to</span> <span m='4736480'>the</span> <span m='4736600'>1/2</span>
  <span m='4736900'>log</span> <span m='4737120'>n.</span> <span m='4737850'>This</span>
  <span m='4738070'>is</span> <span m='4738340'>our</span> <span m='4738460'>good</span>
  <span m='4738670'>friend</span> <span m='4739350'>root</span> <span m='4739570'>n.</span>
  <span m='4740095'>Root</span> <span m='4740380'>n</span> <span m='4740630'>is</span>
  <span m='4740710'>just</span> <span m='4741010'>something</span> <span m='4741610'>that's</span>
  <span m='4741910'>n to</span> <span m='4742170'>the</span> <span m='4742300'>something,</span>
  <span m='4742750'>but</span> <span m='4742870'>is</span> <span m='4743800'>n</span>
  <span m='4743950'>to</span> <span m='4744040'>the</span> <span m='4744160'>something</span>
  <span m='4744460'>less</span> <span m='4744640'>than</span> <span m='4744790'>1.</span>
  <span m='4745700'>So</span> <span m='4745810'>we</span> <span m='4745990'>can</span>
  <span m='4746140'>afford</span> <span m='4746470'>some</span> <span m='4746650'>log</span>
  <span m='4746890'>factors.</span> </p><p><span m='4750370'>Why</span> <span m='4750670'>are</span>
  <span m='4750730'>there</span> <span m='4750880'>only</span> <span m='4751210'>2
  to</span> <span m='4751563'>the</span> <span m='4751916'>2 n</span> <span m='4752270'>prime</span>
  <span m='4753190'>trees?</span> <span m='4753970'>One</span> <span m='4754150'>way</span>
  <span m='4754240'>to</span> <span m='4754330'>see</span> <span m='4754510'>that</span>
  <span m='4754750'>is</span> <span m='4754900'>you</span> <span m='4755020'>can</span>
  <span m='4755140'>encode</span> <span m='4755500'>a</span> <span m='4755560'>tree</span>
  <span m='4756160'>using</span> <span m='4756520'>2n</span> <span m='4756940'>bits.</span>
  <span m='4757630'>If I have</span> <span m='4757770'>an</span> <span m='4757870'>n</span>
  <span m='4758050'>node</span> <span m='4758230'>tree,</span> <span m='4758490'>I</span>
  <span m='4758640'>can</span> <span m='4758770'>encode</span> <span m='4759040'>it</span>
  <span m='4759160'>with</span> <span m='4759370'>2n</span> <span m='4759670'>bits.</span>
  <span m='4760360'>How?</span> <span m='4761710'>Do</span> <span m='4761920'>an</span>
  <span m='4761980'>Euler</span> <span m='4762260'>tour.</span> <span m='4763720'>And</span>
  <span m='4764410'>all</span> <span m='4764620'>you</span> <span m='4764710'>really</span>
  <span m='4764920'>need</span> <span m='4765070'>to know</span> <span m='4765130'>from</span>
  <span m='4765490'>an</span> <span m='4765570'>Euler</span> <span m='4766360'>tour</span>
  <span m='4766660'>to</span> <span m='4766780'>reconstruct</span> <span m='4767290'>the</span>
  <span m='4767380'>tree</span> <span m='4767710'>is</span> <span m='4767960'>at</span>
  <span m='4768130'>each</span> <span m='4768310'>step,</span> <span m='4768970'>did</span>
  <span m='4769150'>I</span> <span m='4769210'>go</span> <span m='4769360'>down</span>
  <span m='4769690'>or</span> <span m='4769780'>did</span> <span m='4769930'>I</span>
  <span m='4769990'>go</span> <span m='4770200'>up?</span> </p><p><span m='4770470'>Those</span>
  <span m='4770650'>are</span> <span m='4770680'>the</span> <span m='4770800'>only</span>
  <span m='4771010'>things</span> <span m='4771190'>you</span> <span m='4771310'>can</span>
  <span m='4771430'>do.</span> <span m='4771550'>If</span> <span m='4771640'>you</span>
  <span m='4771730'>went</span> <span m='4771880'>down, it's</span> <span m='4772360'>to</span>
  <span m='4772510'>a</span> <span m='4772570'>new</span> <span m='4772810'>child.</span>
  <span m='4773530'>If</span> <span m='4773680'>you</span> <span m='4773740'>went</span>
  <span m='4773920'>up, it's</span> <span m='4774340'>to</span> <span m='4774490'>an</span>
  <span m='4774580'>old</span> <span m='4774940'>node.</span> <span m='4775850'>So</span>
  <span m='4775900'>if</span> <span m='4775990'>I</span> <span m='4776080'>told</span>
  <span m='4776410'>you</span> <span m='4777010'>a</span> <span m='4777260'>sequence</span>
  <span m='4777700'>of</span> <span m='4777760'>bits</span> <span m='4778630'>for</span>
  <span m='4778750'>every</span> <span m='4778990'>step</span> <span m='4779230'>in</span>
  <span m='4779290'>the</span> <span m='4779350'>Euler</span> <span m='4779590'>tour,</span>
  <span m='4779830'>did</span> <span m='4780010'>I</span> <span m='4780130'>go</span>
  <span m='4780280'>down</span> <span m='4780520'>or</span> <span m='4780580'>did</span>
  <span m='4780760'>I</span> <span m='4780820'>go</span> <span m='4781030'>up,</span>
  <span m='4781810'>you</span> <span m='4781960'>can</span> <span m='4782080'>reconstruct</span>
  <span m='4782590'>the</span> <span m='4782680'>tree.</span> <span m='4783950'>Now</span>
  <span m='4784000'>how</span> <span m='4784180'>many</span> <span m='4784390'>bits</span>
  <span m='4784600'>do</span> <span m='4784720'>I</span> <span m='4784780'>have</span>
  <span m='4784990'>to</span> <span m='4785110'>do?</span> <span m='4785450'>Well,</span>
  <span m='4785950'>twice</span> <span m='4786280'>the</span> <span m='4786370'>number</span>
  <span m='4786580'>of</span> <span m='4786670'>edges</span> <span m='4787000'>in</span>
  <span m='4787060'>the</span> <span m='4787180'>tree,</span> <span m='4788080'>because</span>
  <span m='4788500'>the</span> <span m='4788620'>length</span> <span m='4788860'>of</span>
  <span m='4788920'>an</span> <span m='4789010'>Euler</span> <span m='4789250'>tour</span>
  <span m='4789610'>is</span> <span m='4789970'>twice</span> <span m='4790240'>the</span>
  <span m='4790300'>number</span> <span m='4790480'>of</span> <span m='4790540'>edges</span>
  <span m='4790780'>in</span> <span m='4790840'>the</span> <span m='4790930'>tree.</span>
  <span m='4791170'>So</span> <span m='4791800'>2</span> <span m='4791950'>n</span>
  <span m='4792100'>bits</span> <span m='4792790'>are</span> <span m='4792880'>enough</span>
  <span m='4793120'>to</span> <span m='4793180'>encode</span> <span m='4793420'>any</span>
  <span m='4793590'>tree.</span> <span m='4793810'>That's</span> <span m='4794050'>the</span>
  <span m='4794170'>computer</span> <span m='4794470'>science</span> <span m='4795280'>information</span>
  <span m='4795790'>theoretic</span> <span m='4796210'>way</span> <span m='4796330'>to</span>
  <span m='4796420'>prove</span> <span m='4796690'>it.</span> </p><p><span m='4797560'>You</span>
  <span m='4797860'>could</span> <span m='4797980'>also</span> <span m='4798220'>do</span>
  <span m='4798340'>it</span> <span m='4798400'>from</span> <span m='4798550'>this</span>
  <span m='4798670'>formula,</span> <span m='4799190'>but</span> <span m='4799210'>then</span>
  <span m='4799390'>you'd</span> <span m='4799510'>have</span> <span m='4799630'>to</span>
  <span m='4799690'>know</span> <span m='4799870'>why</span> <span m='4800020'>the</span>
  <span m='4800110'>formula's</span> <span m='4800500'>correct,</span> <span m='4800890'>and</span>
  <span m='4800980'>that's</span> <span m='4801460'>messier.</span> <span m='4803760'>Cool.</span>
  <span m='4806150'>So we're</span> <span m='4806500'>almost</span> <span m='4806820'>done.</span>
  <span m='4807890'>We</span> <span m='4808010'>have</span> <span m='4808310'>root</span>
  <span m='4808630'>n</span> <span m='4809390'>possible</span> <span m='4810050'>different</span>
  <span m='4810590'>structures</span> <span m='4811220'>down</span> <span m='4811490'>here.</span>
  <span m='4812480'>We've</span> <span m='4812570'>got</span> <span m='4812720'>n</span>
  <span m='4812870'>over</span> <span m='4813110'>log</span> <span m='4813360'>n</span>
  <span m='4813450'>of</span> <span m='4813570'>them</span> <span m='4813770'>or--</span>
  <span m='4814610'>maybe.</span> <span m='4815530'>It's</span> <span m='4815750'>a</span>
  <span m='4815810'>little</span> <span m='4816020'>harder</span> <span m='4816230'>to</span>
  <span m='4816350'>know</span> <span m='4816440'>exactly</span> <span m='4816800'>how</span>
  <span m='4816920'>many</span> <span m='4817130'>of</span> <span m='4817190'>them</span>
  <span m='4817340'>there</span> <span m='4817490'>are,</span> <span m='4818090'>but</span>
  <span m='4818240'>I</span> <span m='4818300'>don't</span> <span m='4818420'>care.</span>
  </p><p><span m='4819440'>There's</span> <span m='4819680'>only root</span> <span
  m='4819990'>n</span> <span m='4820160'>different</span> <span m='4820430'>types,</span>
  <span m='4821310'>and</span> <span m='4821390'>so</span> <span m='4821540'>I only</span>
  <span m='4821700'>need</span> <span m='4821930'>to</span> <span m='4822020'>store</span>
  <span m='4822230'>a</span> <span m='4822260'>lookup</span> <span m='4822590'>table</span>
  <span m='4823190'>for</span> <span m='4823370'>each</span> <span m='4823580'>type.</span>
  <span m='4824490'>The</span> <span m='4824660'>number</span> <span m='4824870'>of</span>
  <span m='4824960'>queries</span> <span m='4826790'>is</span> <span m='4829010'>order</span>
  <span m='4829620'>log</span> <span m='4829880'>squared</span> <span m='4830250'>n</span>
  <span m='4830330'>again,</span> <span m='4832250'>because</span> <span m='4832790'>our</span>
  <span m='4832940'>structures</span> <span m='4833450'>are</span> <span m='4833540'>of</span>
  <span m='4833630'>size</span> <span m='4835250'>order</span> <span m='4835520'>log</span>
  <span m='4835760'>n,</span> <span m='4836960'>and</span> <span m='4837110'>the</span>
  <span m='4837200'>answer</span> <span m='4837500'>to</span> <span m='4837650'>a</span>
  <span m='4837680'>query</span> <span m='4838910'>is</span> <span m='4839060'>again,</span>
  <span m='4839470'>order</span> <span m='4839850'>log</span> <span m='4840110'>log</span>
  <span m='4840290'>n</span> <span m='4841160'>bits,</span> <span m='4843860'>because</span>
  <span m='4844010'>there's</span> <span m='4844160'>only</span> <span m='4844370'>log</span>
  <span m='4844620'>n</span> <span m='4844790'>different</span> <span m='4845090'>nodes</span>
  <span m='4845270'>to</span> <span m='4845390'>point</span> <span m='4845600'>to.</span>
  </p><p><span m='4847730'>And</span> <span m='4847880'>so</span> <span m='4848150'>the</span>
  <span m='4848240'>total</span> <span m='4848540'>space</span> <span m='4852200'>is</span>
  <span m='4853370'>order</span> <span m='4854350'>root n</span> <span m='4855830'>log</span>
  <span m='4856220'>n</span> <span m='4857210'>squared,</span> <span m='4858260'>log</span>
  <span m='4858590'>log n</span> <span m='4859850'>for</span> <span m='4860030'>the</span>
  <span m='4860120'>lookup</span> <span m='4860510'>table.</span> <span m='4861650'>And</span>
  <span m='4861860'>then</span> <span m='4862100'>each</span> <span m='4862340'>of</span>
  <span m='4862430'>these</span> <span m='4863900'>triangles</span> <span m='4864620'>stores</span>
  <span m='4864950'>a</span> <span m='4865040'>pointer,</span> <span m='4865800'>or</span>
  <span m='4865940'>I</span> <span m='4865970'>guess,</span> <span m='4866150'>every</span>
  <span m='4866450'>node</span> <span m='4866780'>in</span> <span m='4866870'>here</span>
  <span m='4867450'>stores</span> <span m='4867560'>a</span> <span m='4867620'>pointer</span>
  <span m='4868010'>to</span> <span m='4870110'>what</span> <span m='4871430'>tree</span>
  <span m='4871700'>we're</span> <span m='4871880'>in,</span> <span m='4872600'>or</span>
  <span m='4872750'>what</span> <span m='4872930'>type</span> <span m='4873230'>of</span>
  <span m='4873320'>tree</span> <span m='4873530'>we</span> <span m='4873650'>have,</span>
  <span m='4874490'>and</span> <span m='4874610'>also</span> <span m='4874910'>what</span>
  <span m='4875150'>node</span> <span m='4875450'>in</span> <span m='4875570'>that</span>
  <span m='4875720'>tree</span> <span m='4876530'>we</span> <span m='4876650'>are</span>
  <span m='4876770'>in.</span> </p><p><span m='4877250'>So</span> <span m='4878090'>every</span>
  <span m='4878330'>guy</span> <span m='4878570'>in</span> <span m='4878690'>here--</span>
  <span m='4879340'>because</span> <span m='4879530'>that's</span> <span m='4879710'>not</span>
  <span m='4879860'>part</span> <span m='4880070'>of</span> <span m='4880130'>the</span>
  <span m='4880220'>query--</span> <span m='4880940'>has</span> <span m='4881180'>to</span>
  <span m='4881300'>store,</span> <span m='4881810'>not</span> <span m='4882020'>only</span>
  <span m='4882590'>a</span> <span m='4882650'>little</span> <span m='4882890'>bit</span>
  <span m='4883010'>more</span> <span m='4883190'>specific</span> <span m='4883670'>pointer</span>
  <span m='4883970'>into</span> <span m='4884150'>this</span> <span m='4884330'>table.</span>
  <span m='4885260'>It</span> <span m='4885320'>actually</span> <span m='4885590'>tells</span>
  <span m='4885890'>you</span> <span m='4886040'>what</span> <span m='4886280'>the</span>
  <span m='4886400'>query</span> <span m='4886790'>part</span> <span m='4887090'>is,</span>
  <span m='4887870'>or</span> <span m='4888030'>the</span> <span m='4888290'>first</span>
  <span m='4888500'>part</span> <span m='4888650'>of</span> <span m='4888710'>the</span>
  <span m='4888770'>query,</span> <span m='4889080'>the</span> <span m='4889100'>node</span>
  <span m='4889340'>x.</span> <span m='4890390'>Then</span> <span m='4890960'>the</span>
  <span m='4891110'>table</span> <span m='4891470'>also</span> <span m='4891740'>is</span>
  <span m='4891890'>parameterized</span> <span m='4892490'>by</span> <span m='4893280'>k,</span>
  <span m='4893780'>so</span> <span m='4893990'>one</span> <span m='4894140'>of</span>
  <span m='4894200'>these</span> <span m='4894380'>logs</span> <span m='4895760'>is</span>
  <span m='4896120'>which</span> <span m='4896330'>node</span> <span m='4896540'>you're</span>
  <span m='4896630'>querying.</span> </p><p><span m='4897350'>The</span> <span m='4897470'>other</span>
  <span m='4897710'>log</span> <span m='4898070'>is</span> <span m='4898190'>now</span>
  <span m='4898550'>the</span> <span m='4898640'>value</span> <span m='4898960'>k,</span>
  <span m='4899300'>but</span> <span m='4899420'>again,</span> <span m='4899660'>you</span>
  <span m='4899780'>never</span> <span m='4900050'>go</span> <span m='4900260'>up</span>
  <span m='4900410'>higher</span> <span m='4900710'>than</span> <span m='4900890'>log</span>
  <span m='4901040'>n.</span> <span m='4901950'>If</span> <span m='4902050'>you</span>
  <span m='4902150'>went</span> <span m='4902250'>up</span> <span m='4902300'>higher</span>
  <span m='4902540'>than</span> <span m='4902650'>log</span> <span m='4902900'>n,</span>
  <span m='4903050'>then</span> <span m='4903200'>you'd</span> <span m='4903320'>be</span>
  <span m='4903560'>in</span> <span m='4903680'>the</span> <span m='4903800'>5</span>
  <span m='4904070'>structure,</span> <span m='4904610'>so</span> <span m='4904940'>if
  you</span> <span m='4905000'>just</span> <span m='4905310'>do</span> <span m='4905480'>a</span>
  <span m='4905560'>query</span> <span m='4905750'>up</span> <span m='4905870'>there,</span>
  <span m='4906050'>you</span> <span m='4906110'>don't</span> <span m='4906290'>need</span>
  <span m='4906440'>a</span> <span m='4906470'>query</span> <span m='4906660'>in</span>
  <span m='4906740'>the</span> <span m='4906830'>bottom.</span> <span m='4908430'>OK.</span>
  <span m='4908990'>So</span> <span m='4909140'>there's</span> <span m='4909290'>only</span>
  <span m='4909530'>that</span> <span m='4909680'>many</span> <span m='4909890'>queries,</span>
  <span m='4910760'>and</span> <span m='4910910'>so</span> <span m='4911600'>space</span>
  <span m='4911960'>for</span> <span m='4912020'>this</span> <span m='4912170'>lookup</span>
  <span m='4912410'>table</span> <span m='4912830'>is</span> <span m='4913070'>little
  o of</span> <span m='4913540'>n</span> <span m='4913730'>again.</span> <span m='4915550'>And</span>
  <span m='4915710'>so</span> <span m='4915890'>we're</span> <span m='4915980'>dominated</span>
  <span m='4916550'>by</span> <span m='4917020'>space</span> <span m='4917330'>for</span>
  <span m='4917420'>these</span> <span m='4917570'>pointers</span> <span m='4918490'>and</span>
  <span m='4918650'>for</span> <span m='4918740'>the</span> <span m='4918800'>space</span>
  <span m='4919100'>up here,</span> <span m='4919460'>which</span> <span m='4919640'>is</span>
  <span m='4919700'>linear.</span> <span m='4920530'>So</span> <span m='4920720'>linear</span>
  <span m='4921080'>space,</span> <span m='4922130'>constant</span> <span m='4922550'>query.</span>
  <span m='4924020'>Boom.</span> <span m='4926398'>Any questions?</span> </p><p><span
  m='4933150'>I</span> <span m='4933240'>have</span> <span m='4933420'>an</span> <span
  m='4933480'>open</span> <span m='4933720'>question,</span> <span m='4934650'>maybe.</span>
  <span m='4935190'>I</span> <span m='4935250'>think</span> <span m='4935460'>it's</span>
  <span m='4935580'>open.</span> <span m='4937460'>So</span> <span m='4939000'>what</span>
  <span m='4939210'>if</span> <span m='4939330'>you</span> <span m='4939420'>want</span>
  <span m='4939600'>to</span> <span m='4939720'>do</span> <span m='4939840'>dynamic,</span>
  <span m='4941350'>30</span> <span m='4941580'>seconds</span> <span m='4941970'>of</span>
  <span m='4942090'>dynamic?</span> <span m='4942900'>For</span> <span m='4943050'>LCA,</span>
  <span m='4945030'>it's</span> <span m='4945210'>known</span> <span m='4945450'>how</span>
  <span m='4945540'>to</span> <span m='4945630'>do</span> <span m='4945750'>dynamic</span>
  <span m='4946170'>LCA</span> <span m='4946590'>constant</span> <span m='4947520'>operations.</span>
  <span m='4948570'>The</span> <span m='4948690'>operations</span> <span m='4949170'>are</span>
  <span m='4949650'>add</span> <span m='4949860'>a</span> <span m='4949890'>leaf--</span>
  <span m='4950890'>we can</span> <span m='4951040'>add</span> <span m='4951190'>another</span>
  <span m='4951410'>leaf--</span> <span m='4952530'>given</span> <span m='4953220'>an</span>
  <span m='4953400'>edge.</span> <span m='4954330'>Subdivide</span> <span m='4954960'>that</span>
  <span m='4955170'>edge</span> <span m='4955470'>into</span> <span m='4956670'>that,</span>
  <span m='4957450'>and</span> <span m='4957600'>also</span> <span m='4957810'>the</span>
  <span m='4957900'>reverse.</span> </p><p><span m='4958270'>So</span> <span m='4958400'>I</span>
  <span m='4958470'>can</span> <span m='4958680'>erase</span> <span m='4959680'>a</span>
  <span m='4959770'>guy,</span> <span m='4960210'>put</span> <span m='4960390'>the</span>
  <span m='4960510'>edge</span> <span m='4960660'>back,</span> <span m='4961470'>delete</span>
  <span m='4961750'>a</span> <span m='4961790'>leaf,</span> <span m='4962850'>those</span>
  <span m='4962940'>sorts</span> <span m='4963180'>of</span> <span m='4963270'>things.</span>
  <span m='4964230'>Those</span> <span m='4964470'>operations</span> <span m='4964950'>can</span>
  <span m='4965070'>all</span> <span m='4965160'>be</span> <span m='4965280'>done</span>
  <span m='4965400'>in</span> <span m='4965490'>constant</span> <span m='4965860'>time</span>
  <span m='4966750'>for</span> <span m='4966870'>LCA.</span> <span m='4967500'>What</span>
  <span m='4967740'>about</span> <span m='4968490'>level</span> <span m='4968790'>ancestor?</span>
  <span m='4969510'>I</span> <span m='4969540'>have</span> <span m='4969660'>no</span>
  <span m='4969840'>idea.</span> <span m='4970570'>Maye</span> <span m='4970840'>we'll</span>
  <span m='4971080'>work</span> <span m='4971300'>on</span> <span m='4971460'>it</span>
  <span m='4971850'>today.</span> <span m='4973050'>That's</span> <span m='4973350'>it.</span>
  </p>
type: course
uid: e09d39d87a1afddd42efb910e76b2d85

---
None