---
about_this_resource_text: '<p><strong>Description:</strong> Memory hierarchy: Distribution
  sweeping via lazy funnelsort; cache-oblivious orthogonal 2D range searching: Batched
  and online.</p> <p><strong>Speaker:</strong> Prof. Erik Demaine</p>'
course_id: 6-851-advanced-data-structures-spring-2012
embedded_media:
- id: Video-YouTube-Stream
  media_location: Fs4-E4Nj1Ks
  parent_uid: 9903f5d93cb683be10f5349809d8827c
  title: Video-YouTube-Stream
  type: Video
  uid: 03bc835b697715722bde8c60906c96c3
- id: Video-iTunesU-MP4
  media_location: https://itunes.apple.com/us/itunes-u/session-9-cache-oblivious/id735348884?i=199434713
  parent_uid: 9903f5d93cb683be10f5349809d8827c
  title: Video-iTunes U-MP4
  type: Video
  uid: 82b19e5aef0f8510a9f47c99b5f708ce
- id: Video-InternetArchive-MP4
  media_location: http://www.archive.org/download/MIT6.851S12/MIT6_851S12_lec09_300k.mp4
  parent_uid: 9903f5d93cb683be10f5349809d8827c
  title: Video-Internet Archive-MP4
  type: Video
  uid: e95b687fb1d06792494bc4c2f8b9769e
- id: Thumbnail-YouTube-JPG
  media_location: https://img.youtube.com/vi/Fs4-E4Nj1Ks/default.jpg
  parent_uid: 9903f5d93cb683be10f5349809d8827c
  title: Thumbnail-YouTube-JPG
  type: Thumbnail
  uid: d2884137cf567ad4b239a08b3fa2a804
- id: 3Play-3PlayYouTubeid-MP4
  media_location: Fs4-E4Nj1Ks
  parent_uid: 9903f5d93cb683be10f5349809d8827c
  title: 3Play-3Play YouTube id
  type: 3Play
  uid: 91bb883ec87cabf6f6af3efffea15bd1
- id: Fs4-E4Nj1Ks.srt
  parent_uid: 9903f5d93cb683be10f5349809d8827c
  technical_location: https://ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-851-advanced-data-structures-spring-2012/lecture-videos/session-9-cache-oblivious-structures-ii/Fs4-E4Nj1Ks.srt
  title: 3play caption file
  type: null
  uid: 988fdf396f384601556eaa0b987e4056
- id: Fs4-E4Nj1Ks.pdf
  parent_uid: 9903f5d93cb683be10f5349809d8827c
  technical_location: https://ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-851-advanced-data-structures-spring-2012/lecture-videos/session-9-cache-oblivious-structures-ii/Fs4-E4Nj1Ks.pdf
  title: 3play pdf file
  type: null
  uid: b11aca198394313df597fa6d4c0af1c2
- id: Caption-3Play YouTube id-SRT
  parent_uid: 9903f5d93cb683be10f5349809d8827c
  title: Caption-3Play YouTube id-SRT-English - US
  type: Caption
  uid: 73d56f43efdb70f5b48893e06970d44f
- id: Transcript-3Play YouTube id-PDF
  parent_uid: 9903f5d93cb683be10f5349809d8827c
  title: Transcript-3Play YouTube id-PDF-English - US
  type: Transcript
  uid: 3258589e6f3b32e1df20637b918d6992
inline_embed_id: 83057495session9:cache-obliviousstructuresii21786561
layout: video
order_index: null
parent_uid: b66cbbb7b35e74ff17cdbf44e5fb6b1d
related_resources_text: ''
short_url: session-9-cache-oblivious-structures-ii
technical_location: https://ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-851-advanced-data-structures-spring-2012/lecture-videos/session-9-cache-oblivious-structures-ii
template_type: Tabbed
title: 'Session 9: Cache-Oblivious Structures II'
transcript: <p><span m='90'>The</span> <span m='180'>following</span> <span m='630'>content</span>
  <span m='1200'>is</span> <span m='1320'>provided</span> <span m='1770'>under</span>
  <span m='2009'>a</span> <span m='2070'>Creative</span> <span m='2490'>Commons</span>
  <span m='2910'>license.</span> <span m='4030'>Your</span> <span m='4200'>support</span>
  <span m='4710'>will</span> <span m='4860'>help</span> <span m='5100'>MIT</span>
  <span m='5550'>OpenCourseWare</span> <span m='6360'>continue</span> <span m='6870'>to</span>
  <span m='6960'>offer</span> <span m='7380'>high</span> <span m='7620'>quality</span>
  <span m='8100'>educational</span> <span m='8730'>resources</span> <span m='9360'>for</span>
  <span m='9540'>free.</span> <span m='10720'>To</span> <span m='10740'>make</span>
  <span m='10920'>a</span> <span m='10980'>donation</span> <span m='11730'>or</span>
  <span m='11940'>view</span> <span m='12390'>additional</span> <span m='12810'>materials</span>
  <span m='13320'>from</span> <span m='13500'>hundreds</span> <span m='13920'>of</span>
  <span m='14040'>MIT</span> <span m='14460'>courses,</span> <span m='15550'>visit</span>
  <span m='15780'>MIT</span> <span m='16200'>OpenCourseWare</span> <span m='17280'>at</span>
  <span m='17430'>ocw.mit.edu.</span> </p><p><span m='21030'>ERIK DEMAINE:</span>
  <span m='21065'>All</span> <span m='21100'>right,</span> <span m='21220'>today</span>
  <span m='21520'>we're</span> <span m='21640'>going</span> <span m='21760'>to</span>
  <span m='21820'>do</span> <span m='21970'>some</span> <span m='22390'>crossover</span>
  <span m='23230'>between</span> <span m='23680'>two</span> <span m='24670'>kinds</span>
  <span m='25090'>of</span> <span m='25180'>data</span> <span m='25420'>structures,</span>
  <span m='26020'>memory</span> <span m='26410'>hierarchy</span> <span m='26830'>data</span>
  <span m='27070'>structures</span> <span m='27610'>and</span> <span m='27730'>geometric</span>
  <span m='28300'>data</span> <span m='28570'>structures.</span> <span m='29380'>And</span>
  <span m='29530'>this</span> <span m='29710'>will</span> <span m='29800'>be</span>
  <span m='29950'>the</span> <span m='30070'>final</span> <span m='31090'>lecture</span>
  <span m='31420'>in</span> <span m='31510'>the</span> <span m='31600'>memory</span>
  <span m='31900'>hierarchy</span> <span m='32290'>series,</span> <span m='32710'>so</span>
  <span m='32770'>the</span> <span m='32890'>end</span> <span m='33190'>of</span>
  <span m='33370'>cache</span> <span m='33640'>oblivious.</span> </p><p><span m='35890'>So</span>
  <span m='36100'>we're</span> <span m='36190'>going</span> <span m='36310'>to</span>
  <span m='36370'>look</span> <span m='36640'>at</span> <span m='36910'>two-dimensional</span>
  <span m='37900'>geometric</span> <span m='38620'>data</span> <span m='38860'>structure</span>
  <span m='39220'>problems,</span> <span m='40840'>both</span> <span m='41110'>offline</span>
  <span m='41500'>and</span> <span m='41620'>online.</span> <span m='43120'>So</span>
  <span m='43270'>our</span> <span m='43390'>good</span> <span m='43570'>friend,</span>
  <span m='44050'>orthogonal</span> <span m='44620'>2D</span> <span m='44950'>range</span>
  <span m='45250'>searching,</span> <span m='45800'>which</span> <span m='45850'>we</span>
  <span m='45970'>spent</span> <span m='46240'>a</span> <span m='46300'>lot</span>
  <span m='46450'>of</span> <span m='46540'>time</span> <span m='46810'>in</span>
  <span m='47780'>a</span> <span m='47890'>few</span> <span m='48310'>years</span>
  <span m='48490'>ago,</span> <span m='49690'>we</span> <span m='49930'>will</span>
  <span m='50080'>come</span> <span m='50320'>back</span> <span m='50590'>to,</span>
  <span m='50830'>and</span> <span m='50950'>try</span> <span m='51130'>to</span>
  <span m='51250'>get</span> <span m='51430'>our</span> <span m='51520'>bounds</span>
  <span m='51910'>good,</span> <span m='52360'>even</span> <span m='52930'>cache</span>
  <span m='53230'>obliviously.</span> </p><p><span m='56790'>So</span> <span m='56950'>instead</span>
  <span m='57190'>of</span> <span m='57280'>log</span> <span m='57730'>n,</span> <span
  m='57820'>we want</span> <span m='58000'>log</span> <span m='58210'>base</span>
  <span m='58440'>b</span> <span m='58600'>of n</span> <span m='58900'>to</span> <span
  m='59200'>make</span> <span m='59380'>things</span> <span m='59560'>interesting.</span>
  <span m='60490'>And</span> <span m='60580'>the</span> <span m='60670'>batch</span>
  <span m='61030'>version</span> <span m='61390'>is</span> <span m='61510'>where</span>
  <span m='61660'>you're</span> <span m='61810'>given</span> <span m='62170'>a</span>
  <span m='62230'>whole</span> <span m='62440'>bunch</span> <span m='62680'>of</span>
  <span m='62770'>rectangles,</span> <span m='63250'>and</span> <span m='63340'>a</span>
  <span m='63370'>whole</span> <span m='63490'>bunch</span> <span m='63670'>of</span>
  <span m='63760'>points</span> <span m='64220'>up front,</span> <span m='65410'>and</span>
  <span m='65710'>you</span> <span m='65800'>want</span> <span m='66040'>to</span>
  <span m='67120'>find</span> <span m='67420'>all</span> <span m='67540'>the</span>
  <span m='67630'>points</span> <span m='67930'>that</span> <span m='68020'>live</span>
  <span m='68200'>in</span> <span m='68290'>all</span> <span m='68410'>the</span>
  <span m='68500'>rectangles.</span> <span m='69890'>So</span> <span m='69940'>that's</span>
  <span m='70240'>an</span> <span m='70360'>easier</span> <span m='70720'>version</span>
  <span m='70960'>of</span> <span m='71020'>the</span> <span m='71080'>problem.</span>
  </p><p><span m='72640'>We'll</span> <span m='72730'>start</span> <span m='72940'>with</span>
  <span m='73060'>that</span> <span m='73400'>and</span> <span m='73420'>then</span>
  <span m='73510'>we'll</span> <span m='73630'>go</span> <span m='73750'>to</span>
  <span m='75390'>the</span> <span m='75460'>usual</span> <span m='75760'>online</span>
  <span m='76150'>version,</span> <span m='76540'>where</span> <span m='76690'>you</span>
  <span m='77110'>have</span> <span m='77290'>queries</span> <span m='77710'>coming</span>
  <span m='78280'>one</span> <span m='78460'>at</span> <span m='78550'>a</span> <span
  m='78610'>time,</span> <span m='79480'>rectangles</span> <span m='80050'>coming</span>
  <span m='80350'>one</span> <span m='80500'>at</span> <span m='80590'>a</span> <span
  m='80650'>time.</span> <span m='80910'>The</span> <span m='81060'>points</span>
  <span m='81460'>are</span> <span m='81520'>pre-processed,</span> <span m='83140'>it
  will</span> <span m='83230'>be</span> <span m='83350'>static.</span> <span m='85430'>And
  to</span> <span m='85600'>do</span> <span m='85750'>the</span> <span m='85870'>batched,</span>
  <span m='86440'>we're</span> <span m='86620'>going</span> <span m='86920'>to</span>
  <span m='87760'>introduce</span> <span m='88150'>a</span> <span m='88210'>new</span>
  <span m='88330'>technique</span> <span m='88660'>called</span> <span m='88870'>distribution</span>
  <span m='89560'>sweep,</span> <span m='90740'>which</span> <span m='90850'>is</span>
  <span m='90940'>a</span> <span m='91000'>combination</span> <span m='91600'>of</span>
  <span m='91720'>the</span> <span m='91840'>sweep</span> <span m='92170'>line</span>
  <span m='92410'>technique</span> <span m='92800'>we</span> <span m='92890'>saw</span>
  <span m='93130'>back</span> <span m='93490'>as</span> <span m='94420'>we</span>
  <span m='94570'>used</span> <span m='94750'>persistence</span> <span m='95440'>to</span>
  <span m='95680'>make</span> <span m='95980'>sweep</span> <span m='96240'>line</span>
  <span m='96580'>thing</span> <span m='96820'>into</span> <span m='97150'>a</span>
  <span m='97240'>data</span> <span m='97450'>structure</span> <span m='97810'>thing.</span>
  </p><p><span m='98920'>But</span> <span m='99280'>we're</span> <span m='99400'>just</span>
  <span m='99580'>going</span> <span m='99700'>to</span> <span m='99760'>use</span>
  <span m='99850'>the</span> <span m='99970'>algorithmic</span> <span m='100450'>version</span>
  <span m='100720'>of</span> <span m='100810'>that</span> <span m='101440'>plus</span>
  <span m='102370'>a</span> <span m='102550'>cache</span> <span m='102950'>oblivious</span>
  <span m='103300'>sorting</span> <span m='103780'>algorithm.</span> <span m='104500'>So
  we'll</span> <span m='104710'>finally</span> <span m='105070'>do</span> <span m='105220'>cache</span>
  <span m='105570'>oblivious</span> <span m='105800'>sorting</span> <span m='106270'>and</span>
  <span m='106390'>optimal</span> <span m='106930'>N/B</span> <span m='107470'>log</span>
  <span m='107710'>base</span> <span m='107920'>M/B</span> <span m='108070'>/</span>
  <span m='108390'>of</span> <span m='108510'>N/B</span> <span m='110260'>using</span>
  <span m='110620'>a</span> <span m='110680'>particular</span> <span m='111160'>algorithm</span>
  <span m='111490'>called</span> <span m='111775'>lazy</span> <span m='112060'>funnel</span>
  <span m='112420'>sort,</span> <span m='114550'>which</span> <span m='114730'>you</span>
  <span m='114850'>can</span> <span m='114970'>actually</span> <span m='115210'>also</span>
  <span m='115450'>use</span> <span m='115630'>to</span> <span m='115780'>make</span>
  <span m='115960'>another</span> <span m='116320'>kind</span> <span m='116590'>of</span>
  <span m='116740'>cache</span> <span m='117010'>oblivious</span> <span m='117340'>priority</span>
  <span m='117780'>queue,</span> <span m='118400'>but</span> <span m='118450'>we</span>
  <span m='118570'>won't</span> <span m='118750'>get</span> <span m='118870'>into</span>
  <span m='119080'>that.</span> </p><p><span m='120040'>And</span> <span m='120160'>so</span>
  <span m='120340'>by</span> <span m='120490'>combining</span> <span m='120940'>those</span>
  <span m='121120'>two</span> <span m='121270'>things,</span> <span m='121510'>we'll</span>
  <span m='121660'>get</span> <span m='121870'>a</span> <span m='122350'>divide</span>
  <span m='122680'>and</span> <span m='122770'>conquer</span> <span m='123160'>technique</span>
  <span m='123580'>for</span> <span m='123760'>geometric</span> <span m='124390'>problems</span>
  <span m='125320'>that</span> <span m='125440'>lets</span> <span m='125650'>us</span>
  <span m='125710'>solve</span> <span m='126010'>the</span> <span m='126100'>batched</span>
  <span m='126520'>thing,</span> <span m='127360'>and</span> <span m='127450'>then</span>
  <span m='127600'>we'll</span> <span m='127840'>use</span> <span m='128139'>completely</span>
  <span m='128500'>different</span> <span m='128770'>techniques</span> <span m='129160'>for</span>
  <span m='129280'>the</span> <span m='129370'>online</span> <span m='129759'>thing.</span>
  <span m='130960'>So</span> <span m='131200'>for</span> <span m='131380'>starters,</span>
  <span m='131870'>let's</span> <span m='132040'>finally</span> <span m='133120'>do</span>
  <span m='133900'>cache</span> <span m='134230'>oblivious</span> <span m='134830'>optimal</span>
  <span m='135310'>sorting.</span> </p><p><span m='137020'>I'm</span> <span m='137230'>not</span>
  <span m='137470'>going</span> <span m='137710'>to</span> <span m='137830'>analyze</span>
  <span m='138820'>this</span> <span m='139480'>algorithm</span> <span m='140180'>because</span>
  <span m='141550'>it's</span> <span m='141700'>just</span> <span m='142000'>an</span>
  <span m='142120'>algorithm,</span> <span m='142600'>not</span> <span m='142780'>a</span>
  <span m='142840'>data</span> <span m='143020'>structure,</span> <span m='144730'>and</span>
  <span m='145030'>also</span> <span m='145300'>because</span> <span m='145600'>the</span>
  <span m='145690'>analysis</span> <span m='146260'>is</span> <span m='146440'>pretty</span>
  <span m='146710'>close</span> <span m='147130'>to</span> <span m='148290'>the</span>
  <span m='152110'>analysis</span> <span m='152500'>for</span> <span m='152650'>priority</span>
  <span m='153100'>queues</span> <span m='153340'>we</span> <span m='153430'>did</span>
  <span m='153580'>last</span> <span m='154210'>class.</span> <span m='158410'>So</span>
  <span m='158650'>funnel</span> <span m='159060'>sort</span> <span m='160840'>is</span>
  <span m='160960'>basically a</span> <span m='161410'>merge</span> <span m='161800'>sort.</span>
  </p><p><span m='163810'>I</span> <span m='163900'>mentioned</span> <span m='164290'>last</span>
  <span m='164560'>time</span> <span m='164950'>that</span> <span m='165220'>in</span>
  <span m='165400'>external</span> <span m='165790'>memory,</span> <span m='166720'>the</span>
  <span m='166840'>right</span> <span m='167080'>way</span> <span m='167290'>to</span>
  <span m='167440'>do,</span> <span m='169020'>or</span> <span m='169240'>a</span>
  <span m='169420'>right</span> <span m='169690'>way</span> <span m='169900'>to</span>
  <span m='170080'>do</span> <span m='170890'>optimal</span> <span m='171580'>external</span>
  <span m='171940'>memory</span> <span m='172270'>sorting</span> <span m='172780'>is</span>
  <span m='172930'>an</span> <span m='173050'>m</span> <span m='173300'>over</span>
  <span m='173540'>B-way</span> <span m='174100'>merge</span> <span m='174400'>sort.</span>
  <span m='175462'>In</span> <span m='175830'>cache</span> <span m='176260'>obliviously,</span>
  <span m='176800'>you</span> <span m='176950'>don't</span> <span m='177130'>know</span>
  <span m='177370'>what</span> <span m='177520'>m</span> <span m='177700'>and</span>
  <span m='177820'>b</span> <span m='178060'>are,</span> <span m='178270'>so</span>
  <span m='178420'>it's</span> <span m='178540'>hard</span> <span m='178720'>to</span>
  <span m='178780'>do</span> <span m='178930'>m over</span> <span m='179070'>B-way</span>
  <span m='179680'>merge.</span> <span m='180460'>So</span> <span m='180550'>instead,</span>
  <span m='180940'>you</span> <span m='181000'>basically</span> <span m='181420'>do</span>
  <span m='182225'>a</span> <span m='182610'>N-way</span> <span m='183090'>merge.</span>
  <span m='183820'>Not</span> <span m='184020'>quite</span> <span m='184320'>N-way,</span>
  <span m='184650'>I</span> <span m='184780'>can't</span> <span m='185020'>afford</span>
  <span m='185290'>that,</span> <span m='185530'>but</span> <span m='186100'>it's</span>
  <span m='186190'>going</span> <span m='186310'>to</span> <span m='186400'>be</span>
  <span m='186550'>n</span> <span m='186730'>to</span> <span m='186880'>the</span>
  <span m='187000'>1/3</span> <span m='188320'>way</span> <span m='188950'>merge</span>
  <span m='189220'>sort.</span> </p><p><span m='190090'>And</span> <span m='190750'>the</span>
  <span m='190840'>big</span> <span m='190990'>question</span> <span m='191320'>then</span>
  <span m='191470'>becomes,</span> <span m='191930'>how</span> <span m='192040'>do</span>
  <span m='192130'>you</span> <span m='192250'>do</span> <span m='192400'>emerge?</span>
  <span m='193280'>And</span> <span m='193380'>the</span> <span m='193480'>answer</span>
  <span m='193780'>is</span> <span m='193930'>with</span> <span m='194110'>a</span>
  <span m='194170'>funnel.</span> <span m='195340'>And so the</span> <span m='195460'>heart</span>
  <span m='195670'>of</span> <span m='195760'>the</span> <span m='195910'>algorithm</span>
  <span m='196360'>is</span> <span m='196570'>a</span> <span m='196630'>funnel.</span>
  <span m='200990'>So</span> <span m='201070'>if</span> <span m='201160'>you</span>
  <span m='201220'>have</span> <span m='201330'>K-sorted</span> <span m='201970'>lists</span>
  <span m='203440'>that</span> <span m='203680'>are</span> <span m='203890'>big,</span>
  <span m='205270'>sized</span> <span m='205630'>K cubed,</span> <span m='207910'>then</span>
  <span m='209590'>you</span> <span m='209830'>can</span> <span m='210040'>merge</span>
  <span m='210460'>them</span> <span m='213490'>in,</span> <span m='213790'>basically,</span>
  <span m='214150'>the</span> <span m='214300'>optimal</span> <span m='214910'>bound.</span>
  </p><p><span m='226650'>So</span> <span m='227040'>K-funnel,</span> <span m='228090'>K-sorted</span>
  <span m='228960'>lists,</span> <span m='229740'>total</span> <span m='230040'>size</span>
  <span m='231150'>K cubed.</span> <span m='233490'>Number of</span> <span m='233800'>memory</span>
  <span m='234090'>transfers</span> <span m='234570'>to</span> <span m='234690'>merge</span>
  <span m='234960'>them</span> <span m='235290'>is</span> <span m='235680'>K cubed</span>
  <span m='236190'>over</span> <span m='236360'>B</span> <span m='236820'>times</span>
  <span m='237120'>log</span> <span m='237360'>base</span> <span m='237570'>M/B</span>
  <span m='238230'>of</span> <span m='238470'>K</span> <span m='238670'>cubed</span>
  <span m='238870'>over</span> <span m='239100'>B.</span> <span m='240120'>There's</span>
  <span m='240300'>a</span> <span m='240360'>plus</span> <span m='240660'>K</span>
  <span m='240960'>term</span> <span m='242680'>and</span> <span m='243300'>when</span>
  <span m='243570'>you</span> <span m='244140'>plug</span> <span m='244440'>this</span>
  <span m='244590'>into</span> <span m='244800'>an</span> <span m='244890'>actual</span>
  <span m='245160'>sorting</span> <span m='245490'>algorithm,</span> <span m='245880'>you</span>
  <span m='246000'>need</span> <span m='246150'>to</span> <span m='246240'>think</span>
  <span m='246420'>about</span> <span m='246660'>that,</span> <span m='246960'>but</span>
  <span m='248200'>that's</span> <span m='248640'>not</span> <span m='248850'>a</span>
  <span m='248910'>big</span> <span m='249120'>deal.</span> <span m='249900'>Usually</span>
  <span m='250200'>this</span> <span m='250380'>term</span> <span m='250560'>will</span>
  <span m='250680'>dominate.</span> </p><p><span m='254100'>OK,</span> <span m='255150'>so</span>
  <span m='256140'>let</span> <span m='256260'>me</span> <span m='256380'>show</span>
  <span m='256560'>you</span> <span m='256740'>how</span> <span m='256920'>funnel</span>
  <span m='257220'>works.</span> <span m='258480'>We're</span> <span m='258540'>just</span>
  <span m='258690'>going</span> <span m='258839'>to</span> <span m='258899'>go</span>
  <span m='259019'>through</span> <span m='259170'>the</span> <span m='259290'>algorithmic</span>
  <span m='259740'>part</span> <span m='260019'>and</span> <span m='260550'>I</span>
  <span m='260610'>won't</span> <span m='260839'>analyze</span> <span m='261390'>the</span>
  <span m='261480'>number</span> <span m='261690'>of</span> <span m='261750'>memory</span>
  <span m='262029'>transfers.</span> <span m='272330'>Maybe</span> <span m='272814'>I'll</span>
  <span m='273300'>draw this</span> <span m='273760'>here.</span> <span m='279600'>So</span>
  <span m='279810'>we're</span> <span m='279870'>going</span> <span m='279990'>to</span>
  <span m='280050'>have</span> <span m='280170'>the</span> <span m='280260'>inputs</span>
  <span m='280710'>down</span> <span m='280980'>at</span> <span m='281070'>the</span>
  <span m='281160'>bottom</span> <span m='283260'>of</span> <span m='283380'>this</span>
  <span m='283560'>funnel.</span> <span m='285630'>It's</span> <span m='285880'>going
  to have</span> <span m='286050'>some</span> <span m='286260'>data</span> <span m='286500'>in</span>
  <span m='286650'>them.</span> </p><p><span m='292580'>Those</span> <span m='292870'>k</span>
  <span m='293440'>inputs</span> <span m='293790'>down</span> <span m='294000'>here,</span>
  <span m='295260'>total</span> <span m='295620'>size,</span> <span m='297710'>all</span>
  <span m='297900'>these</span> <span m='298480'>is</span> <span m='299100'>theta</span>
  <span m='299480'>K</span> <span m='300110'>cubed.</span> <span m='305970'>And</span>
  <span m='306210'>then</span> <span m='306450'>at</span> <span m='306850'>the</span>
  <span m='309420'>top</span> <span m='309750'>here,</span> <span m='309990'>we</span>
  <span m='310140'>have</span> <span m='310470'>our</span> <span m='310620'>output</span>
  <span m='311010'>buffer.</span> <span m='313320'>This</span> <span m='313410'>is</span>
  <span m='313530'>where</span> <span m='313710'>we're</span> <span m='313830'>going</span>
  <span m='313980'>to</span> <span m='314040'>put</span> <span m='314280'>the</span>
  <span m='314370'>results</span> <span m='317340'>and</span> <span m='317490'>this</span>
  <span m='317700'>will</span> <span m='317790'>have</span> <span m='318060'>size</span>
  <span m='319490'>K cubed.</span> <span m='322990'>Maybe</span> <span m='324120'>we've</span>
  <span m='324300'>already</span> <span m='324510'>done</span> <span m='324690'>some</span>
  <span m='324900'>work</span> <span m='325140'>and</span> <span m='325230'>we've</span>
  <span m='325320'>filled</span> <span m='325590'>some</span> <span m='325770'>of</span>
  <span m='325890'>it.</span> </p><p><span m='327470'>OK,</span> <span m='328350'>the</span>
  <span m='328440'>question</span> <span m='328710'>is</span> <span m='328860'>what</span>
  <span m='329010'>do</span> <span m='329070'>you</span> <span m='329190'>put</span>
  <span m='329400'>in</span> <span m='329490'>this</span> <span m='329640'>triangle</span>
  <span m='330300'>to</span> <span m='330510'>do</span> <span m='330690'>the</span>
  <span m='330810'>merge?</span> <span m='332010'>And</span> <span m='332130'>the</span>
  <span m='332220'>obvious</span> <span m='332520'>thing</span> <span m='332730'>is</span>
  <span m='333540'>recursive</span> <span m='334170'>triangles.</span> <span m='335940'>Recursion</span>
  <span m='336540'>is</span> <span m='336720'>like</span> <span m='336960'>the</span>
  <span m='337080'>one</span> <span m='337350'>technique</span> <span m='337770'>we</span>
  <span m='337860'>know</span> <span m='338580'>in</span> <span m='338700'>cache</span>
  <span m='338970'>oblivious</span> <span m='340170'>data</span> <span m='340380'>structures.</span>
  <span m='341370'>So</span> <span m='342120'>we're</span> <span m='342220'>going</span>
  <span m='342360'>to</span> <span m='342420'>take</span> <span m='342840'>square</span>
  <span m='343340'>root</span> <span m='343490'>of</span> <span m='344130'>K-funnels</span>
  <span m='348660'>and</span> <span m='348870'>just</span> <span m='349140'>join</span>
  <span m='349500'>them</span> <span m='349650'>together</span> <span m='350130'>in</span>
  <span m='350220'>the</span> <span m='350370'>obvious</span> <span m='350700'>way.</span>
  </p><p><span m='351780'>So just</span> <span m='352020'>like</span> <span m='352290'>[INAUDIBLE]</span>
  <span m='352630'>layout,</span> <span m='370710'>except--</span> <span m='371370'>I
  didn't</span> <span m='372390'>quite</span> <span m='372610'>leave</span> <span
  m='372810'>enough</span> <span m='373050'>room</span> <span m='373290'>here--</span>
  <span m='374740'>in between</span> <span m='375420'>the</span> <span m='375510'>levels</span>
  <span m='377250'>are</span> <span m='377370'>buffers.</span> <span m='379780'>There's</span>
  <span m='379980'>a</span> <span m='380040'>buffer</span> <span m='380430'>here</span>
  <span m='383610'>two</span> <span m='384660'>between</span> <span m='384990'>the</span>
  <span m='385080'>nodes</span> <span m='385530'>of</span> <span m='385680'>this</span>
  <span m='385920'>funnel</span> <span m='386820'>and</span> <span m='386970'>the</span>
  <span m='387060'>nodes</span> <span m='387300'>of</span> <span m='387390'>this</span>
  <span m='387570'>funnel.</span> <span m='393130'>OK,</span> <span m='393450'>these</span>
  <span m='393620'>buffers</span> <span m='394130'>may</span> <span m='394340'>have</span>
  <span m='394580'>some</span> <span m='394730'>stuff</span> <span m='395060'>in</span>
  <span m='395150'>them</span> <span m='396970'>at</span> <span m='397220'>any</span>
  <span m='397430'>moment.</span> </p><p><span m='399940'>OK,</span> <span m='400070'>and
  the</span> <span m='400160'>big</span> <span m='400280'>question</span> <span m='400580'>is</span>
  <span m='400800'>how</span> <span m='400820'>do</span> <span m='400910'>you</span>
  <span m='401000'>set</span> <span m='401240'>the</span> <span m='401420'>buffer</span>
  <span m='401810'>size?</span> <span m='402320'>This</span> <span m='402500'>is</span>
  <span m='402650'>the</span> <span m='402770'>key</span> <span m='403040'>step.</span>
  <span m='404270'>And</span> <span m='404360'>the</span> <span m='404450'>claim</span>
  <span m='404750'>is</span> <span m='404960'>each</span> <span m='405290'>buffer,</span>
  <span m='405920'>we</span> <span m='406100'>set</span> <span m='406370'>to</span>
  <span m='406550'>a</span> <span m='406610'>size</span> <span m='407090'>of</span>
  <span m='407360'>K</span> <span m='407930'>to</span> <span m='408140'>the</span>
  <span m='408320'>3/2</span> <span m='410450'>because</span> <span m='411050'>the</span>
  <span m='411200'>number</span> <span m='411890'>of</span> <span m='412010'>buffers</span>
  <span m='412580'>is</span> <span m='412700'>about</span> <span m='413000'>square</span>
  <span m='413275'>root</span> <span m='413550'>of</span> <span m='413720'>K</span>
  <span m='414230'>because</span> <span m='414410'>there's</span> <span m='414620'>one</span>
  <span m='414920'>per</span> <span m='415760'>leaf</span> <span m='416240'>of</span>
  <span m='416390'>this</span> <span m='416600'>funnel.</span> <span m='418130'>And</span>
  <span m='418220'>a</span> <span m='418250'>K-funnel</span> <span m='418820'>has</span>
  <span m='419000'>K</span> <span m='419240'>inputs,</span> <span m='419760'>so a
  root</span> <span m='420020'>K</span> <span m='420230'>funnel</span> <span m='420400'>is</span>
  <span m='420590'>going</span> <span m='420760'>to</span> <span m='420800'>have</span>
  <span m='421010'>root</span> <span m='421120'>K inputs</span> <span m='421760'>here.</span>
  </p><p><span m='423380'>And</span> <span m='423530'>so</span> <span m='423740'>the</span>
  <span m='423860'>total</span> <span m='424250'>size</span> <span m='425840'>of</span>
  <span m='426080'>all</span> <span m='426200'>the</span> <span m='426320'>buffers</span>
  <span m='427640'>is</span> <span m='428720'>K</span> <span m='429170'>squared,</span>
  <span m='433370'>which</span> <span m='433600'>is</span> <span m='434500'>not</span>
  <span m='434770'>too</span> <span m='434980'>big.</span> <span m='435600'>I'm</span>
  <span m='435670'>not</span> <span m='435820'>going</span> <span m='435940'>to</span>
  <span m='436000'>go</span> <span m='436120'>through</span> <span m='436240'>the</span>
  <span m='436360'>recurrence,</span> <span m='436990'>but</span> <span m='437140'>if</span>
  <span m='437260'>you</span> <span m='437380'>add</span> <span m='437590'>up</span>
  <span m='437740'>the</span> <span m='437830'>total</span> <span m='438190'>size</span>
  <span m='438520'>of</span> <span m='438610'>this</span> <span m='438790'>thing,</span>
  <span m='439600'>it</span> <span m='439750'>is</span> <span m='440110'>linear</span>
  <span m='440530'>size</span> <span m='441150'>in</span> <span m='441370'>the</span>
  <span m='442000'>output,</span> <span m='442440'>K</span> <span m='442780'>cubed.</span>
  <span m='445210'>I</span> <span m='445270'>think</span> <span m='445630'>also</span>
  <span m='445870'>if</span> <span m='445990'>you</span> <span m='446080'>don't</span>
  <span m='446320'>count</span> <span m='446650'>the</span> <span m='446800'>output</span>
  <span m='447160'>buffer,</span> <span m='447520'>it's</span> <span m='447670'>linear</span>
  <span m='448000'>and</span> <span m='448120'>K</span> <span m='448300'>squared.</span>
  <span m='449740'>If I</span> <span m='449830'>recall</span> <span m='450160'>correctly.</span>
  </p><p><span m='452860'>We're</span> <span m='452950'>not</span> <span m='453070'>too</span>
  <span m='453220'>concerned</span> <span m='453550'>with</span> <span m='453640'>that</span>
  <span m='454240'>here,</span> <span m='454990'>just</span> <span m='455260'>overall.</span>
  <span m='458410'>Once</span> <span m='458590'>we</span> <span m='458680'>have</span>
  <span m='458890'>K-funnels,</span> <span m='460760'>funnel</span> <span m='461120'>sort</span>
  <span m='464920'>is</span> <span m='465130'>just</span> <span m='465340'>going</span>
  <span m='465580'>to</span> <span m='465670'>be</span> <span m='466380'>N</span>
  <span m='466830'>to</span> <span m='467140'>the</span> <span m='467260'>1/3</span>
  <span m='468640'>way</span> <span m='469120'>merge</span> <span m='469420'>sort</span>
  <span m='475090'>with</span> <span m='479850'>an</span> <span m='480020'>N</span>
  <span m='480170'>to</span> <span m='480290'>the</span> <span m='480410'>1/3</span>
  <span m='480860'>funnel</span> <span m='486250'>as</span> <span m='486700'>the</span>
  <span m='486760'>merger.</span> </p><p><span m='492980'>We</span> <span m='493130'>can</span>
  <span m='493280'>only</span> <span m='493490'>up</span> <span m='493850'>to</span>
  <span m='493940'>n</span> <span m='494150'>the</span> <span m='494270'>1/3</span>
  <span m='494690'>because</span> <span m='494990'>of</span> <span m='495050'>this</span>
  <span m='495650'>cubic</span> <span m='496520'>thing.</span> <span m='496790'>We</span>
  <span m='496880'>can</span> <span m='497030'>only</span> <span m='498260'>merge--</span>
  <span m='499250'>if</span> <span m='499430'>we</span> <span m='499490'>want</span>
  <span m='500255'>the</span> <span m='500720'>sorting</span> <span m='501050'>bound</span>
  <span m='501290'>N/B</span> <span m='501920'>log base</span> <span m='502490'>M/B</span>
  <span m='502760'>of N/B</span> <span m='503870'>we</span> <span m='504020'>can</span>
  <span m='504140'>only</span> <span m='504350'>afford</span> <span m='505250'>K</span>
  <span m='505520'>being</span> <span m='505760'>up</span> <span m='505880'>to</span>
  <span m='505970'>n</span> <span m='506080'>to</span> <span m='506180'>the</span>
  <span m='506270'>1/3.</span> <span m='506690'>So</span> <span m='506840'>that's</span>
  <span m='507050'>the</span> <span m='507140'>biggest</span> <span m='507410'>we</span>
  <span m='507500'>can</span> <span m='507650'>do.</span> <span m='509480'>So</span>
  <span m='509720'>it's</span> <span m='509900'>a</span> <span m='509960'>recursive</span>
  <span m='510830'>algorithm</span> <span m='511480'>where</span> <span m='511760'>each</span>
  <span m='511970'>of</span> <span m='512059'>the</span> <span m='512150'>merging</span>
  <span m='513020'>steps</span> <span m='513620'>is</span> <span m='514520'>this</span>
  <span m='514730'>recursive</span> <span m='515240'>data</span> <span m='515510'>structure.</span>
  </p><p><span m='516470'>Now,</span> <span m='516620'>this</span> <span m='516799'>is</span>
  <span m='516919'>really</span> <span m='517159'>just</span> <span m='517340'>about</span>
  <span m='517610'>layout.</span> <span m='518539'>I</span> <span m='518600'>haven't</span>
  <span m='518870'>told</span> <span m='519080'>you</span> <span m='519169'>what</span>
  <span m='519289'>the</span> <span m='519380'>actual</span> <span m='519650'>algorithm</span>
  <span m='520100'>is</span> <span m='520250'>yet,</span> <span m='522210'>but</span>
  <span m='522260'>it's</span> <span m='522409'>a</span> <span m='522440'>recursive</span>
  <span m='522890'>layout.</span> <span m='523419'>You</span> <span m='523520'>store</span>
  <span m='523820'>the</span> <span m='523940'>entire</span> <span m='524510'>upper</span>
  <span m='524750'>triangle,</span> <span m='526130'>then</span> <span m='526880'>each</span>
  <span m='527090'>of</span> <span m='527150'>the</span> <span m='527270'>triangles,</span>
  <span m='527840'>somewhere</span> <span m='528140'>you</span> <span m='528260'>put</span>
  <span m='528410'>the</span> <span m='528500'>buffers.</span> <span m='528755'>It</span>
  <span m='529010'>doesn't</span> <span m='529220'>really</span> <span m='529430'>matter</span>
  <span m='529640'>where</span> <span m='529730'>the</span> <span m='529850'>buffers</span>
  <span m='530150'>are</span> <span m='530270'>as</span> <span m='530360'>long</span>
  <span m='530600'>as</span> <span m='530690'>each</span> <span m='530930'>triangle</span>
  <span m='531530'>is</span> <span m='531590'>stored.</span> <span m='531860'>As</span>
  <span m='531980'>a</span> <span m='532040'>consecutive</span> <span m='532820'>array</span>
  <span m='533120'>of</span> <span m='533240'>memory,</span> <span m='534200'>we'll</span>
  <span m='534380'>be</span> <span m='534560'>OK.</span> </p><p><span m='537230'>And</span>
  <span m='538280'>now</span> <span m='538490'>let</span> <span m='538580'>me</span>
  <span m='538700'>tell</span> <span m='538880'>you</span> <span m='538970'>about</span>
  <span m='539300'>the</span> <span m='540680'>actual</span> <span m='540980'>algorithm</span>
  <span m='541430'>to</span> <span m='541550'>do</span> <span m='541670'>this.</span>
  <span m='542430'>It's</span> <span m='542600'>a</span> <span m='542810'>very</span>
  <span m='543110'>simple</span> <span m='544070'>lazy</span> <span m='545090'>algorithm.</span>
  <span m='550880'>So</span> <span m='550940'>there's</span> <span m='551090'>a</span>
  <span m='551120'>whole</span> <span m='551270'>bunch</span> <span m='551480'>of</span>
  <span m='551540'>buffers.</span> <span m='552170'>If</span> <span m='552350'>you</span>
  <span m='552440'>want</span> <span m='552710'>to</span> <span m='554120'>do</span>
  <span m='554300'>this</span> <span m='554480'>merge,</span> <span m='555110'>really</span>
  <span m='555380'>what</span> <span m='555500'>you'd</span> <span m='555590'>like</span>
  <span m='555770'>to</span> <span m='555830'>do</span> <span m='555920'>is</span>
  <span m='556040'>fill</span> <span m='556310'>this</span> <span m='556640'>output</span>
  <span m='557000'>buffer.</span> <span m='558680'>So</span> <span m='558980'>you</span>
  <span m='559100'>call</span> <span m='559640'>this</span> <span m='559800'>subroutine</span>
  <span m='560360'>called</span> <span m='560600'>fill</span> <span m='561620'>on</span>
  <span m='561890'>the</span> <span m='562010'>output</span> <span m='562310'>buffer</span>
  <span m='562580'>and</span> <span m='562670'>say,</span> <span m='563180'>I</span>
  <span m='563330'>would</span> <span m='563540'>like</span> <span m='563720'>to</span>
  <span m='563870'>fill</span> <span m='564410'>this</span> <span m='564620'>entire</span>
  <span m='565310'>buffer</span> <span m='566120'>with</span> <span m='566330'>elements.</span>
  </p><p><span m='567940'>Precondition,</span> <span m='568560'>if</span> <span m='568730'>you're</span>
  <span m='568850'>going</span> <span m='568970'>to</span> <span m='569060'>do</span>
  <span m='569240'>a</span> <span m='569300'>fill,</span> <span m='570110'>right</span>
  <span m='570290'>now</span> <span m='570440'>the</span> <span m='570560'>buffer</span>
  <span m='570890'>is</span> <span m='571010'>empty,</span> <span m='572330'>and</span>
  <span m='572480'>then</span> <span m='572600'>at</span> <span m='572720'>the</span>
  <span m='572840'>end</span> <span m='572960'>of</span> <span m='573020'>the</span>
  <span m='573140'>fill</span> <span m='573800'>you'd</span> <span m='573950'>like</span>
  <span m='574220'>this</span> <span m='574430'>to</span> <span m='574580'>be</span>
  <span m='574760'>completely</span> <span m='575330'>full.</span> <span m='577080'>And</span>
  <span m='577130'>how</span> <span m='577250'>do</span> <span m='577310'>you</span>
  <span m='577430'>do</span> <span m='577610'>it?</span> <span m='578640'>Well,</span>
  <span m='579110'>if</span> <span m='579260'>you</span> <span m='579350'>look</span>
  <span m='579560'>at</span> <span m='579680'>any</span> <span m='579950'>buffer--</span>
  <span m='583340'>partially</span> <span m='583790'>filled,</span> <span m='584060'>whatever--</span>
  <span m='584540'>and</span> <span m='584870'>you</span> <span m='584990'>look</span>
  <span m='585200'>right</span> <span m='585380'>below</span> <span m='585710'>it,</span>
  <span m='586010'>there's</span> <span m='586220'>a</span> <span m='586280'>node</span>
  <span m='587090'>in</span> <span m='587270'>this</span> <span m='587510'>tree.</span>
  <span m='589040'>You</span> <span m='589250'>recurse</span> <span m='589580'>all</span>
  <span m='589730'>the</span> <span m='589820'>way</span> <span m='589940'>down.</span>
  <span m='590570'>In</span> <span m='590690'>the</span> <span m='590780'>end,</span>
  <span m='590900'>this</span> <span m='591080'>is</span> <span m='591140'>just</span>
  <span m='591320'>a</span> <span m='591380'>binary</span> <span m='591860'>tree</span>
  <span m='592970'>with</span> <span m='593150'>buffers</span> <span m='593510'>in</span>
  <span m='593630'>it.</span> </p><p><span m='595370'>So</span> <span m='595670'>it's</span>
  <span m='595880'>going</span> <span m='596060'>to</span> <span m='596120'>be</span>
  <span m='596270'>there's</span> <span m='596480'>a</span> <span m='596540'>buffer,</span>
  <span m='597170'>then</span> <span m='597290'>there's</span> <span m='597470'>a</span>
  <span m='597500'>node,</span> <span m='598130'>then</span> <span m='598280'>there's</span>
  <span m='598430'>two</span> <span m='598610'>children,</span> <span m='599090'>each</span>
  <span m='599300'>of</span> <span m='599390'>which</span> <span m='599570'>is</span>
  <span m='599680'>a</span> <span m='599750'>buffer,</span> <span m='601100'>and</span>
  <span m='601220'>then</span> <span m='601370'>there's</span> <span m='601520'>a</span>
  <span m='601580'>node</span> <span m='601790'>below</span> <span m='602090'>that.</span>
  <span m='606920'>OK,</span> <span m='607190'>so</span> <span m='607400'>how</span>
  <span m='607580'>do</span> <span m='607760'>I</span> <span m='608060'>fill</span>
  <span m='608390'>this</span> <span m='608960'>thing?</span> <span m='609890'>I</span>
  <span m='609980'>just</span> <span m='610160'>read</span> <span m='610940'>the</span>
  <span m='611180'>first</span> <span m='611780'>item,</span> <span m='612890'>the</span>
  <span m='613640'>beginning,</span> <span m='615090'>the</span> <span m='615380'>smallest</span>
  <span m='615830'>item</span> <span m='616010'>for</span> <span m='616130'>each</span>
  <span m='616280'>of</span> <span m='616340'>these,</span> <span m='617120'>compare</span>
  <span m='617510'>them.</span> <span m='617810'>Whichever</span> <span m='618200'>smaller,</span>
  <span m='619070'>I</span> <span m='619160'>stick</span> <span m='619430'>at</span>
  <span m='619490'>here.</span> <span m='620600'>It's</span> <span m='620750'>just</span>
  <span m='620930'>a</span> <span m='620990'>regular</span> <span m='621440'>binary</span>
  <span m='621970'>merge</span> <span m='623210'>which</span> <span m='623390'>is
  kind of</span> <span m='623480'>cool.</span> </p><p><span m='623690'>You've</span>
  <span m='623810'>got</span> <span m='623960'>two</span> <span m='624200'>arrays.</span>
  <span m='625100'>You</span> <span m='625220'>want</span> <span m='625340'>to</span>
  <span m='625400'>merge</span> <span m='625670'>them.</span> <span m='625940'>Stick</span>
  <span m='626270'>the</span> <span m='626330'>results</span> <span m='626750'>here.</span>
  <span m='629220'>So</span> <span m='629300'>that's</span> <span m='629540'>how</span>
  <span m='629660'>we</span> <span m='629780'>do</span> <span m='629980'>fill.</span>
  <span m='638250'>Binary</span> <span m='638670'>merge</span> <span m='641540'>of</span>
  <span m='642090'>the</span> <span m='642210'>two</span> <span m='643740'>children</span>
  <span m='644230'>buffers</span> <span m='651650'>until</span> <span m='653310'>we're</span>
  <span m='654420'>full.</span> <span m='655580'>But</span> <span m='655760'>there's</span>
  <span m='655940'>one</span> <span m='656120'>thing</span> <span m='656270'>that</span>
  <span m='656360'>can</span> <span m='656480'>happen,</span> <span m='657420'>which</span>
  <span m='657500'>is</span> <span m='657620'>that</span> <span m='657740'>one</span>
  <span m='657890'>of</span> <span m='657950'>the</span> <span m='658040'>child</span>
  <span m='658340'>buffers</span> <span m='658730'>might</span> <span m='658940'>empty.</span>
  <span m='668320'>What</span> <span m='668460'>do</span> <span m='668560'>we</span>
  <span m='668650'>do</span> <span m='668770'>then?</span> <span m='670390'>Recursively</span>
  <span m='670960'>fill</span> <span m='671170'>it.</span> </p><p><span m='680050'>That's</span>
  <span m='680230'>the</span> <span m='680350'>algorithm.</span> <span m='681400'>Very</span>
  <span m='681670'>simple.</span> <span m='682540'>The</span> <span m='682690'>obvious</span>
  <span m='683020'>lazy</span> <span m='683320'>thing</span> <span m='683500'>to</span>
  <span m='683590'>do.</span> <span m='684940'>Do</span> <span m='685140'>a</span>
  <span m='685180'>binary</span> <span m='685540'>merge.</span> <span m='686050'>This</span>
  <span m='686260'>is</span> <span m='686350'>going</span> <span m='686480'>to</span>
  <span m='686560'>be</span> <span m='686710'>nice</span> <span m='686980'>because</span>
  <span m='687190'>it's</span> <span m='687310'>like</span> <span m='687490'>two</span>
  <span m='687670'>scans,</span> <span m='689410'>until</span> <span m='689740'>one</span>
  <span m='689890'>of</span> <span m='689980'>these</span> <span m='690130'>guys</span>
  <span m='690370'>empties,</span> <span m='691300'>and</span> <span m='691420'>then</span>
  <span m='691540'>you</span> <span m='691660'>pause</span> <span m='692260'>this</span>
  <span m='692440'>merge,</span> <span m='693550'>and</span> <span m='693670'>then</span>
  <span m='693790'>say</span> <span m='693910'>OK,</span> <span m='694240'>I'm</span>
  <span m='694300'>going</span> <span m='694420'>to</span> <span m='694480'>fill</span>
  <span m='694720'>this</span> <span m='694900'>entire</span> <span m='695350'>buffer,</span>
  <span m='696265'>which</span> <span m='696700'>will</span> <span m='697060'>recursively</span>
  <span m='697660'>do</span> <span m='697840'>stuff</span> <span m='699170'>until</span>
  <span m='699310'>it's</span> <span m='699430'>completely</span> <span m='699880'>full</span>
  <span m='701260'>or</span> <span m='701380'>I</span> <span m='701530'>run</span>
  <span m='701740'>out</span> <span m='701860'>of</span> <span m='701980'>input</span>
  <span m='702220'>elements,</span> <span m='703210'>whichever</span> <span m='703810'>comes</span>
  <span m='704020'>first,</span> <span m='704980'>and</span> <span m='705100'>then</span>
  <span m='706000'>resume</span> <span m='706360'>this</span> <span m='706540'>merge.</span>
  <span m='707530'>Question?</span> </p><p><span m='707890'>AUDIENCE:</span> <span
  m='708122'>Aren't</span> <span m='708355'>there more</span> <span m='708820'>than
  two</span> <span m='709285'>child</span> <span m='709750'>buffers?</span> </p><p><span
  m='710680'>ERIK DEMAINE:</span> <span m='710890'>Should</span> <span m='711100'>only</span>
  <span m='711550'>be</span> <span m='711790'>two</span> <span m='712330'>children</span>
  <span m='712780'>buffers.</span> <span m='714970'>The</span> <span m='715210'>question</span>
  <span m='715510'>is,</span> <span m='715630'>are</span> <span m='715780'>there</span>
  <span m='715930'>more</span> <span m='716110'>than</span> <span m='716260'>two?</span>
  <span m='718540'>This</span> <span m='718930'>recursion</span> <span m='719560'>of</span>
  <span m='719650'>the</span> <span m='719770'>root</span> <span m='719950'>k</span>
  <span m='720760'>and</span> <span m='721120'>root</span> <span m='721330'>k</span>
  <span m='721960'>child</span> <span m='722560'>triangles</span> <span m='723220'>of</span>
  <span m='723280'>size</span> <span m='723580'>root</span> <span m='723760'>k</span>
  <span m='724420'>is</span> <span m='724570'>exactly</span> <span m='724930'>the</span>
  <span m='725050'>recursion</span> <span m='725510'>we</span> <span m='725610'>did</span>
  <span m='725640'>on</span> <span m='725770'>a</span> <span m='725860'>binary</span>
  <span m='726280'>tree.</span> </p><p><span m='726730'>I</span> <span m='726790'>didn't</span>
  <span m='726970'>say,</span> <span m='727270'>but</span> <span m='727420'>underlying</span>
  <span m='727900'>this</span> <span m='728080'>is</span> <span m='728230'>a</span>
  <span m='728290'>binary</span> <span m='728650'>tree.</span> <span m='729340'>The</span>
  <span m='729460'>only</span> <span m='729730'>difference</span> <span m='730060'>between</span>
  <span m='730300'>this</span> <span m='730450'>and</span> <span m='730550'>a</span>
  <span m='730870'>[INAUDIBLE]</span> <span m='730960'>layout</span> <span m='731380'>is</span>
  <span m='731530'>we're</span> <span m='731620'>adding</span> <span m='731920'>these</span>
  <span m='732070'>buffers.</span> <span m='733990'>I</span> <span m='734080'>intended</span>
  <span m='734470'>to</span> <span m='734560'>draw</span> <span m='734770'>this</span>
  <span m='734950'>as</span> <span m='735070'>binary.</span> <span m='736150'>It's</span>
  <span m='736240'>a</span> <span m='736300'>little</span> <span m='736480'>hard</span>
  <span m='736660'>to</span> <span m='736750'>tell</span> <span m='736930'>because</span>
  <span m='737140'>I</span> <span m='737200'>didn't</span> <span m='737800'>draw</span>
  <span m='737980'>the</span> <span m='738070'>base</span> <span m='738310'>case,</span>
  <span m='739070'>but</span> <span m='739900'>it</span> <span m='740020'>is</span>
  <span m='740110'>indeed</span> <span m='740800'>a</span> <span m='741070'>binary</span>
  <span m='741520'>tree</span> <span m='741790'>in</span> <span m='741880'>the</span>
  <span m='742000'>end.</span> </p><p><span m='744980'>OK,</span> <span m='745570'>other</span>
  <span m='745720'>questions?</span> <span m='747850'>So</span> <span m='748060'>that's</span>
  <span m='748240'>the</span> <span m='748360'>algorithm</span> <span m='748720'>and</span>
  <span m='748810'>as</span> <span m='748960'>I</span> <span m='749020'>said,</span>
  <span m='749230'>I'm</span> <span m='749290'>not</span> <span m='749470'>going</span>
  <span m='749680'>to</span> <span m='749770'>analyze</span> <span m='750250'>it,</span>
  <span m='750500'>but</span> <span m='750610'>it's</span> <span m='750790'>the</span>
  <span m='750880'>same</span> <span m='751330'>kind</span> <span m='751780'>of</span>
  <span m='751870'>analysis.</span> <span m='753370'>You</span> <span m='754420'>look</span>
  <span m='754630'>at</span> <span m='754690'>the</span> <span m='754750'>threshold</span>
  <span m='755260'>where</span> <span m='755350'>things</span> <span m='755620'>fit</span>
  <span m='755830'>in</span> <span m='755950'>cache</span> <span m='756310'>or</span>
  <span m='756400'>don't</span> <span m='758170'>and</span> <span m='758590'>argue</span>
  <span m='759010'>accordingly.</span> <span m='763080'>It's</span> <span m='763210'>pretty</span>
  <span m='763420'>hand-wavy.</span> <span m='765880'>What</span> <span m='766280'>I</span>
  <span m='766390'>want</span> <span m='766540'>to</span> <span m='766630'>get</span>
  <span m='766810'>to</span> <span m='767050'>is</span> <span m='767200'>how</span>
  <span m='767410'>we</span> <span m='767530'>use</span> <span m='767800'>this</span>
  <span m='768490'>to</span> <span m='768610'>solve</span> <span m='769240'>more</span>
  <span m='769420'>interesting</span> <span m='769810'>problems</span> <span m='770170'>than</span>
  <span m='770380'>sorting.</span> </p><p><span m='770950'>Sorting</span> <span m='771370'>is</span>
  <span m='771490'>a</span> <span m='771520'>little</span> <span m='771700'>bit</span>
  <span m='771880'>boring.</span> <span m='773870'>So</span> <span m='774670'>let's</span>
  <span m='774970'>go</span> <span m='775210'>to</span> <span m='775690'>batched</span>
  <span m='776530'>orthogonal</span> <span m='777190'>range</span> <span m='777460'>searching.</span>
  <span m='800890'>And</span> <span m='801070'>in</span> <span m='801190'>general,</span>
  <span m='802660'>this</span> <span m='802840'>technique</span> <span m='803290'>called</span>
  <span m='804100'>distribution</span> <span m='804820'>sweep.</span> <span m='809235'>The</span>
  <span m='809500'>idea</span> <span m='809770'>with</span> <span m='809860'>distribution</span>
  <span m='810460'>sweep</span> <span m='811750'>is</span> <span m='811990'>that</span>
  <span m='813730'>not</span> <span m='814030'>only</span> <span m='814300'>can</span>
  <span m='814480'>we</span> <span m='814570'>use</span> <span m='815230'>this</span>
  <span m='815740'>cool</span> <span m='816040'>funnel</span> <span m='816340'>sort</span>
  <span m='816580'>algorithm</span> <span m='817060'>to</span> <span m='817190'>sort,</span>
  <span m='818130'>but</span> <span m='818320'>we</span> <span m='818440'>can</span>
  <span m='818560'>think</span> <span m='818770'>of</span> <span m='818890'>it</span>
  <span m='819040'>as</span> <span m='819220'>doing</span> <span m='819490'>a</span>
  <span m='819580'>divide</span> <span m='820030'>and</span> <span m='820150'>conquer</span>
  <span m='821500'>on</span> <span m='821770'>the</span> <span m='821890'>key</span>
  <span m='822160'>value.</span> </p><p></p><p><span m='853010'>And</span> <span m='853180'>in</span>
  <span m='853330'>this</span> <span m='853510'>case,</span> <span m='853870'>we</span>
  <span m='853990'>have</span> <span m='854140'>two</span> <span m='854290'>coordinates.</span>
  <span m='854900'>We're</span> <span m='855000'>going</span> <span m='855020'>to</span>
  <span m='855100'>use</span> <span m='855400'>the</span> <span m='855550'>divide</span>
  <span m='855850'>and</span> <span m='855940'>conquer</span> <span m='856300'>on</span>
  <span m='856390'>one</span> <span m='856570'>of</span> <span m='856630'>the</span>
  <span m='856750'>coordinates.</span> <span m='859360'>And</span> <span m='861550'>where</span>
  <span m='861790'>we</span> <span m='861940'>have</span> <span m='862120'>some</span>
  <span m='862270'>flexibility</span> <span m='863700'>is</span> <span m='863920'>in</span>
  <span m='864070'>this</span> <span m='864220'>binary</span> <span m='864700'>merge</span>
  <span m='865060'>step.</span> <span m='866010'>We're</span> <span m='866110'>doing</span>
  <span m='866350'>this</span> <span m='866470'>binary</span> <span m='866760'>merge,</span>
  <span m='867090'>and</span> <span m='867190'>normally</span> <span m='867610'>it's
  just</span> <span m='867850'>you</span> <span m='867940'>take</span> <span m='868150'>the</span>
  <span m='868270'>min,</span> <span m='868460'>you</span> <span m='868600'>spit</span>
  <span m='868870'>it</span> <span m='868960'>out</span> <span m='869110'>here,</span>
  <span m='869290'>you</span> <span m='869410'>take</span> <span m='869650'>the</span>
  <span m='869740'>min,</span> <span m='870040'>you spit</span> <span m='870280'>it</span>
  <span m='870370'>out</span> <span m='870490'>here.</span> </p><p><span m='873100'>That's</span>
  <span m='873220'>the min</span> <span m='873490'>of</span> <span m='873850'>one</span>
  <span m='874120'>particular</span> <span m='874600'>coordinate.</span> <span m='875420'>Now</span>
  <span m='875590'>you've</span> <span m='875680'>got</span> <span m='875800'>to</span>
  <span m='875860'>deal</span> <span m='876130'>with</span> <span m='876250'>some</span>
  <span m='876520'>auxiliary</span> <span m='877000'>information</span> <span m='877480'>about</span>
  <span m='877630'>the</span> <span m='877720'>other</span> <span m='877900'>coordinates.</span>
  <span m='878430'>So</span> <span m='878950'>in</span> <span m='879010'>general,</span>
  <span m='879280'>you're</span> <span m='879430'>merging</span> <span m='879910'>two</span>
  <span m='880300'>sorted</span> <span m='880720'>things.</span> <span m='882200'>If</span>
  <span m='882460'>there's</span> <span m='882670'>other</span> <span m='882940'>geometric</span>
  <span m='883450'>information,</span> <span m='883990'>you</span> <span m='884080'>can</span>
  <span m='884200'>try</span> <span m='884350'>to</span> <span m='884440'>preserve</span>
  <span m='884950'>it</span> <span m='885070'>during</span> <span m='885430'>the</span>
  <span m='885520'>merge.</span> <span m='886060'>As</span> <span m='886210'>long</span>
  <span m='886450'>as</span> <span m='886540'>you</span> <span m='886630'>can</span>
  <span m='886780'>do</span> <span m='886960'>that,</span> <span m='887320'>this</span>
  <span m='887530'>is</span> <span m='887860'>the</span> <span m='888370'>conqueror</span>
  <span m='888790'>part</span> <span m='889360'>or</span> <span m='889510'>that</span>
  <span m='889630'>combine</span> <span m='890090'>step</span> <span m='890410'>of</span>
  <span m='890520'>divide</span> <span m='890770'>and</span> <span m='890860'>conquer.</span>
  </p><p><span m='891940'>You</span> <span m='892060'>can</span> <span m='892180'>do</span>
  <span m='892300'>a</span> <span m='892330'>lot.</span> <span m='893490'>There's</span>
  <span m='893710'>a</span> <span m='893770'>powerful</span> <span m='894310'>technique,</span>
  <span m='894790'>it</span> <span m='895120'>turns</span> <span m='895360'>out.</span>
  <span m='897610'>It's</span> <span m='897760'>by</span> <span m='900130'>Brodal</span>
  <span m='900610'>and</span> <span m='900730'>Fagerberg.</span> <span m='901740'>It's</span>
  <span m='901980'>in</span> <span m='902120'>their</span> <span m='902560'>early</span>
  <span m='902830'>days</span> <span m='903130'>of</span> <span m='903400'>cache</span>
  <span m='903670'>oblivious.</span> <span m='904750'>It</span> <span m='904870'>was
  the</span> <span m='904990'>first</span> <span m='905260'>geometric</span> <span
  m='905740'>paper.</span> <span m='909430'>Fine,</span> <span m='910790'>so</span>
  <span m='911260'>replace</span> <span m='912280'>or</span> <span m='913360'>say</span>
  <span m='913570'>augment</span> <span m='915520'>the</span> <span m='915850'>binary</span>
  <span m='916250'>merge,</span> <span m='922420'>which</span> <span m='922630'>is,</span>
  <span m='922750'>in</span> <span m='922870'>the</span> <span m='922990'>end,</span>
  <span m='923290'>the</span> <span m='923440'>only</span> <span m='924100'>part</span>
  <span m='924430'>of</span> <span m='924550'>the</span> <span m='924700'>algorithm</span>
  <span m='925120'>other</span> <span m='925300'>than</span> <span m='925480'>the</span>
  <span m='925570'>recursion.</span> <span m='927230'>So</span> <span m='927370'>it's</span>
  <span m='927880'>the</span> <span m='928000'>only</span> <span m='928270'>thing</span>
  <span m='928450'>you</span> <span m='928510'>need</span> <span m='928660'>to</span>
  <span m='928780'>do</span> <span m='930520'>to</span> <span m='931240'>maintain</span>
  <span m='934600'>auxiliary</span> <span m='935200'>information.</span> </p><p><span
  m='936970'>That's</span> <span m='937210'>the</span> <span m='937660'>generic</span>
  <span m='938350'>idea</span> <span m='938740'>of</span> <span m='938800'>distribution</span>
  <span m='939430'>sweep.</span> <span m='940450'>And</span> <span m='940690'>distribution</span>
  <span m='941140'>sweep</span> <span m='941380'>has</span> <span m='941470'>been</span>
  <span m='941620'>applied</span> <span m='941950'>to</span> <span m='942040'>solve</span>
  <span m='942280'>lots</span> <span m='942550'>of</span> <span m='942610'>different</span>
  <span m='942880'>problems.</span> <span m='943620'>Batched</span> <span m='943880'>orthogonal</span>
  <span m='944290'>range</span> <span m='944500'>queries</span> <span m='944770'>is</span>
  <span m='944860'>one</span> <span m='945040'>of</span> <span m='945100'>them.</span>
  <span m='947620'>Generally,</span> <span m='947950'>you've</span> <span m='948100'>got</span>
  <span m='948250'>a</span> <span m='948310'>bunch</span> <span m='948580'>of</span>
  <span m='949180'>orthogonal</span> <span m='949720'>segments,</span> <span m='950200'>rectangles,</span>
  <span m='950770'>points,</span> <span m='951190'>and you</span> <span m='951310'>want</span>
  <span m='951490'>to</span> <span m='951550'>compute</span> <span m='951880'>how</span>
  <span m='952060'>they</span> <span m='952210'>intersect.</span> <span m='953330'>Those</span>
  <span m='953450'>sorts</span> <span m='953680'>of</span> <span m='953770'>problems</span>
  <span m='954130'>that</span> <span m='954280'>can</span> <span m='954490'>be</span>
  <span m='954610'>solved</span> <span m='955350'>here.</span> </p><p><span m='957160'>Also</span>
  <span m='957460'>weird</span> <span m='957670'>things</span> <span m='957940'>like</span>
  <span m='958330'>I</span> <span m='958390'>give</span> <span m='958570'>you</span>
  <span m='958640'>a</span> <span m='958660'>bunch</span> <span m='958870'>of</span>
  <span m='958930'>points</span> <span m='959320'>and</span> <span m='959530'>I</span>
  <span m='959620'>want</span> <span m='959800'>to</span> <span m='959860'>know</span>
  <span m='959980'>for</span> <span m='960100'>every</span> <span m='960370'>point</span>
  <span m='960680'>what's</span> <span m='960880'>its</span> <span m='961090'>nearest</span>
  <span m='961750'>neighbor.</span> <span m='963340'>In</span> <span m='963490'>Euclidean</span>
  <span m='964060'>sense,</span> <span m='964390'>that</span> <span m='964540'>can</span>
  <span m='964660'>be</span> <span m='964780'>solved.</span> <span m='965920'>But</span>
  <span m='966280'>I</span> <span m='966460'>like</span> <span m='966670'>orthogonal</span>
  <span m='967060'>range</span> <span m='967630'>searching</span> <span m='968020'>because</span>
  <span m='968200'>it's</span> <span m='968380'>the</span> <span m='968470'>closest</span>
  <span m='968890'>to</span> <span m='969150'>our</span> <span m='969290'>data</span>
  <span m='969670'>structure</span> <span m='970040'>problem</span> <span m='970360'>and</span>
  <span m='970610'>that's</span> <span m='970800'>a</span> <span m='970840'>problem</span>
  <span m='971110'>we've</span> <span m='971230'>seen.</span> </p><p><span m='972850'>So</span>
  <span m='973000'>the</span> <span m='973120'>actual</span> <span m='973600'>batched</span>
  <span m='974320'>orthogonal</span> <span m='974890'>range</span> <span m='975130'>searching</span>
  <span m='976120'>is</span> <span m='976590'>your</span> <span m='976750'>given</span>
  <span m='978850'>N</span> <span m='980110'>points,</span> <span m='983120'>and</span>
  <span m='983570'>N</span> <span m='983880'>rectangles,</span> <span m='987470'>and</span>
  <span m='987600'>you</span> <span m='987720'>want</span> <span m='987900'>to</span>
  <span m='987960'>know</span> <span m='989070'>which</span> <span m='989280'>points</span>
  <span m='989880'>are</span> <span m='990030'>in</span> <span m='990150'>which</span>
  <span m='990360'>rectangles.</span> <span m='992190'>That's</span> <span m='992400'>the</span>
  <span m='992520'>general</span> <span m='992790'>problem.</span> <span m='993150'>So</span>
  <span m='993960'>normally,</span> <span m='994500'>we're</span> <span m='994680'>given</span>
  <span m='994950'>the</span> <span m='995040'>points</span> <span m='996420'>first,</span>
  <span m='997410'>and</span> <span m='997500'>then</span> <span m='997620'>we're</span>
  <span m='997710'>given</span> <span m='998030'>the</span> <span m='998220'>rectangles</span>
  <span m='998760'>one</span> <span m='998910'>at</span> <span m='999000'>a</span>
  <span m='999060'>time.</span> <span m='999550'>That's</span> <span m='999630'>what</span>
  <span m='999750'>we've</span> <span m='999830'>solved</span> <span m='1000110'>in</span>
  <span m='1000200'>the</span> <span m='1000290'>past.</span> <span m='1001000'>That's</span>
  <span m='1001100'>what</span> <span m='1001190'>we</span> <span m='1001310'>will</span>
  <span m='1001490'>solve</span> <span m='1001760'>later.</span> <span m='1002120'>That's</span>
  <span m='1002330'>the</span> <span m='1002450'>online</span> <span m='1002870'>version.</span>
  </p><p><span m='1003740'>The</span> <span m='1003860'>batched</span> <span m='1004130'>version</span>
  <span m='1004430'>is</span> <span m='1004550'>I</span> <span m='1004610'>give</span>
  <span m='1004760'>you</span> <span m='1004820'>a</span> <span m='1004850'>whole</span>
  <span m='1005090'>bunch</span> <span m='1005330'>of</span> <span m='1005390'>queries</span>
  <span m='1005810'>I</span> <span m='1005900'>want</span> <span m='1006080'>to</span>
  <span m='1006140'>simultaneously</span> <span m='1008270'>and</span> <span m='1008600'>we're</span>
  <span m='1008810'>going</span> <span m='1009110'>to</span> <span m='1009260'>achieve</span>
  <span m='1011230'>the</span> <span m='1011330'>sorting</span> <span m='1011760'>bound</span>
  <span m='1013020'>N/B</span> <span m='1014090'>log</span> <span m='1014600'>base</span>
  <span m='1015170'>M/B</span> <span m='1016850'>of</span> <span m='1016970'>N/B</span>
  <span m='1018200'>plus</span> <span m='1019130'>the</span> <span m='1019400'>size</span>
  <span m='1019760'>of</span> <span m='1019820'>the</span> <span m='1019940'>output</span>
  <span m='1020990'>over</span> <span m='1021350'>B.</span> <span m='1022790'>And</span>
  <span m='1022860'>this</span> <span m='1023090'>is</span> <span m='1023240'>generally</span>
  <span m='1023870'>the</span> <span m='1024200'>optimal</span> <span m='1024950'>bound</span>
  <span m='1025310'>you</span> <span m='1025400'>could</span> <span m='1025550'>hope</span>
  <span m='1025730'>for.</span> <span m='1026940'>It's</span> <span m='1027040'>not</span>
  <span m='1027109'>obvious</span> <span m='1027560'>you</span> <span m='1027619'>need</span>
  <span m='1027829'>the</span> <span m='1027920'>log,</span> <span m='1028400'>but</span>
  <span m='1028609'>I</span> <span m='1028700'>think</span> <span m='1028910'>for</span>
  <span m='1029630'>most</span> <span m='1029930'>problems</span> <span m='1030319'>in</span>
  <span m='1030410'>external</span> <span m='1030770'>memory</span> <span m='1031069'>you</span>
  <span m='1031160'>need</span> <span m='1031369'>this</span> <span m='1031520'>log.</span>
  </p><p><span m='1032569'>It's</span> <span m='1032660'>hard</span> <span m='1032839'>to</span>
  <span m='1032960'>beat</span> <span m='1033109'>the</span> <span m='1033230'>sorting</span>
  <span m='1033530'>bound,</span> <span m='1034490'>and</span> <span m='1034609'>then</span>
  <span m='1034700'>once</span> <span m='1034940'>you</span> <span m='1035420'>pay</span>
  <span m='1035599'>the</span> <span m='1035690'>sorting</span> <span m='1035990'>bound,</span>
  <span m='1036200'>this</span> <span m='1036349'>is</span> <span m='1036530'>the</span>
  <span m='1036740'>optimal</span> <span m='1037130'>linear</span> <span m='1037460'>time</span>
  <span m='1037730'>to</span> <span m='1037819'>just</span> <span m='1038000'>write</span>
  <span m='1038180'>down</span> <span m='1038390'>the</span> <span m='1038510'>output.</span>
  <span m='1040560'>Now,</span> <span m='1041089'>this</span> <span m='1041329'>problem</span>
  <span m='1041720'>can</span> <span m='1041990'>be</span> <span m='1042079'>solved.</span>
  <span m='1043069'>Give</span> <span m='1043250'>me</span> <span m='1044060'>all</span>
  <span m='1044270'>the</span> <span m='1044390'>point</span> <span m='1044660'>rectangle</span>
  <span m='1045140'>pairs</span> <span m='1046859'>that</span> <span m='1047510'>result.</span>
  <span m='1048650'>I'm</span> <span m='1048800'>not</span> <span m='1048920'>going</span>
  <span m='1049040'>to</span> <span m='1049130'>solve</span> <span m='1049400'>it</span>
  <span m='1049520'>here</span> <span m='1050510'>exactly.</span> <span m='1052505'>We're</span>
  <span m='1052790'>going to</span> <span m='1052970'>solve a</span> <span m='1053030'>slightly</span>
  <span m='1053420'>different</span> <span m='1054350'>version,</span> <span m='1054960'>or</span>
  <span m='1055040'>in</span> <span m='1055130'>general--</span> <span m='1057020'>whatever.</span>
  </p><p><span m='1059420'>Let</span> <span m='1059510'>me</span> <span m='1059630'>tell</span>
  <span m='1059750'>you</span> <span m='1059900'>about</span> <span m='1060290'>another</span>
  <span m='1060560'>version</span> <span m='1060800'>of</span> <span m='1060860'>this</span>
  <span m='1061010'>problem,</span> <span m='1061355'>which</span> <span m='1061700'>is</span>
  <span m='1061820'>a</span> <span m='1061850'>little</span> <span m='1062060'>bit</span>
  <span m='1062210'>easier.</span> <span m='1063270'>Then</span> <span m='1063980'>I'll</span>
  <span m='1064070'>sketch</span> <span m='1064520'>how</span> <span m='1065300'>you</span>
  <span m='1065390'>solve</span> <span m='1065750'>that</span> <span m='1065900'>problem.</span>
  <span m='1071040'>So</span> <span m='1071150'>remember,</span> <span m='1071520'>we've</span>
  <span m='1071570'>talked</span> <span m='1071810'>about</span> <span m='1072020'>range</span>
  <span m='1072260'>reporting</span> <span m='1073070'>and</span> <span m='1073310'>also</span>
  <span m='1074600'>range</span> <span m='1074990'>counting,</span> <span m='1078100'>which
  is</span> <span m='1078170'>you just</span> <span m='1078350'>want</span> <span
  m='1078490'>to</span> <span m='1078560'>know</span> <span m='1078710'>the</span>
  <span m='1078830'>number</span> <span m='1079280'>of</span> <span m='1079400'>answers.</span>
  </p><p><span m='1080910'>Here's</span> <span m='1081350'>something</span> <span
  m='1081740'>in</span> <span m='1081830'>between.</span> <span m='1083000'>You</span>
  <span m='1083090'>want</span> <span m='1083240'>to</span> <span m='1083300'>know</span>
  <span m='1083510'>for</span> <span m='1083690'>every</span> <span m='1083990'>point,</span>
  <span m='1086300'>how</span> <span m='1086510'>many</span> <span m='1086750'>rectangles</span>
  <span m='1087350'>contain</span> <span m='1087830'>it?</span> <span m='1089960'>And</span>
  <span m='1090310'>particularly,</span> <span m='1090740'>this</span> <span m='1090860'>will</span>
  <span m='1090970'>tell</span> <span m='1091160'>you</span> <span m='1091250'>for</span>
  <span m='1091400'>each</span> <span m='1091550'>point,</span> <span m='1091850'>does</span>
  <span m='1092030'>it</span> <span m='1092090'>appear</span> <span m='1092330'>in</span>
  <span m='1092420'>any</span> <span m='1092630'>of</span> <span m='1092680'>the</span>
  <span m='1092780'>rectangles</span> <span m='1093320'>in</span> <span m='1093440'>the</span>
  <span m='1093500'>set?</span> <span m='1095790'>It</span> <span m='1096000'>will</span>
  <span m='1096080'>tell</span> <span m='1096230'>you</span> <span m='1096350'>how</span>
  <span m='1096530'>many</span> <span m='1096890'>and</span> <span m='1096980'>this</span>
  <span m='1097130'>is</span> <span m='1097250'>actually</span> <span m='1097520'>necessary</span>
  <span m='1098000'>as</span> <span m='1098120'>a</span> <span m='1098180'>first</span>
  <span m='1098450'>step</span> <span m='1098750'>because</span> <span m='1098990'>one</span>
  <span m='1099230'>of</span> <span m='1099320'>the</span> <span m='1099410'>hard</span>
  <span m='1099710'>parts</span> <span m='1100280'>in</span> <span m='1101120'>solving</span>
  <span m='1101660'>these</span> <span m='1101840'>kinds</span> <span m='1102140'>of</span>
  <span m='1102230'>problems</span> <span m='1102760'>or</span> <span m='1102800'>reporting</span>
  <span m='1103280'>problems,</span> <span m='1104390'>is</span> <span m='1104570'>that</span>
  <span m='1104720'>the</span> <span m='1104870'>output</span> <span m='1105320'>could</span>
  <span m='1105530'>be</span> <span m='1105680'>big.</span> </p><p><span m='1106370'>We</span>
  <span m='1106520'>know</span> <span m='1106670'>that's</span> <span m='1106880'>always</span>
  <span m='1107120'>an</span> <span m='1107210'>issue,</span> <span m='1108030'>but</span>
  <span m='1108530'>with</span> <span m='1108680'>cache</span> <span m='1108950'>oblivious,</span>
  <span m='1109360'>it's</span> <span m='1109580'>a</span> <span m='1109640'>big</span>
  <span m='1109970'>issue,</span> <span m='1110930'>literally,</span> <span m='1112130'>because</span>
  <span m='1113180'>space</span> <span m='1113900'>is</span> <span m='1114380'>important.</span>
  <span m='1115370'>You</span> <span m='1115490'>can't</span> <span m='1115760'>afford</span>
  <span m='1116180'>to</span> <span m='1117080'>put</span> <span m='1117290'>space</span>
  <span m='1117620'>anywhere.</span> <span m='1121610'>If</span> <span m='1121760'>these</span>
  <span m='1121910'>buffers</span> <span m='1122300'>have</span> <span m='1122480'>to</span>
  <span m='1122570'>get</span> <span m='1122690'>much</span> <span m='1122990'>bigger</span>
  <span m='1123830'>in</span> <span m='1123950'>order</span> <span m='1124130'>to</span>
  <span m='1124250'>store</span> <span m='1124610'>those</span> <span m='1124850'>answers,</span>
  <span m='1126140'>then</span> <span m='1126740'>life</span> <span m='1127010'>is</span>
  <span m='1127130'>kind</span> <span m='1127340'>of</span> <span m='1127430'>tough</span>
  <span m='1127790'>because</span> <span m='1128990'>then</span> <span m='1129200'>this</span>
  <span m='1129410'>data</span> <span m='1129710'>structure</span> <span m='1130040'>gets</span>
  <span m='1130250'>too</span> <span m='1130400'>big,</span> <span m='1131150'>and</span>
  <span m='1131240'>then</span> <span m='1131360'>my</span> <span m='1131540'>analysis</span>
  <span m='1132140'>goes</span> <span m='1132350'>out</span> <span m='1132500'>the</span>
  <span m='1132590'>window</span> <span m='1132830'>because</span> <span m='1133160'>things</span>
  <span m='1133370'>that</span> <span m='1133490'>used</span> <span m='1133700'>to</span>
  <span m='1133790'>fit</span> <span m='1133970'>in</span> <span m='1134060'>cache,</span>
  <span m='1134390'>no</span> <span m='1134510'>longer</span> <span m='1134750'>fit</span>
  <span m='1134930'>in</span> <span m='1135020'>cache.</span> <span m='1136580'>The</span>
  <span m='1136670'>analysis</span> <span m='1137120'>I</span> <span m='1137180'>didn't</span>
  <span m='1137420'>show</span> <span m='1137600'>you.</span> </p><p><span m='1138330'>So</span>
  <span m='1139550'>it's</span> <span m='1139730'>an</span> <span m='1139820'>issue.</span>
  <span m='1142040'>So</span> <span m='1142190'>the</span> <span m='1142310'>first</span>
  <span m='1142730'>step</span> <span m='1143150'>of</span> <span m='1143360'>this</span>
  <span m='1143720'>algorithm</span> <span m='1145340'>is</span> <span m='1145490'>to</span>
  <span m='1145610'>first</span> <span m='1145850'>figure</span> <span m='1146180'>out</span>
  <span m='1146270'>how</span> <span m='1146600'>big</span> <span m='1146810'>those</span>
  <span m='1147020'>buffers</span> <span m='1147380'>have</span> <span m='1147620'>to</span>
  <span m='1147740'>be</span> <span m='1148370'>so</span> <span m='1148520'>that</span>
  <span m='1148640'>we</span> <span m='1148760'>don't</span> <span m='1149000'>have</span>
  <span m='1149150'>to</span> <span m='1149210'>allocate</span> <span m='1149630'>them</span>
  <span m='1149780'>too</span> <span m='1149990'>large.</span> <span m='1151160'>And</span>
  <span m='1151310'>to</span> <span m='1151400'>do</span> <span m='1151550'>that,</span>
  <span m='1151760'>we</span> <span m='1151850'>need</span> <span m='1151970'>to</span>
  <span m='1152150'>basically</span> <span m='1152510'>count</span> <span m='1152810'>how</span>
  <span m='1152930'>many</span> <span m='1153140'>answers</span> <span m='1153500'>there</span>
  <span m='1153650'>are,</span> <span m='1154220'>and</span> <span m='1154670'>this</span>
  <span m='1154850'>is</span> <span m='1155000'>what</span> <span m='1155180'>we'll</span>
  <span m='1155330'>do.</span> <span m='1158000'>To</span> <span m='1158180'>compute</span>
  <span m='1158510'>these</span> <span m='1158720'>values,</span> <span m='1159200'>the</span>
  <span m='1159290'>answers</span> <span m='1159650'>aren't</span> <span m='1159800'>very</span>
  <span m='1160010'>big.</span> <span m='1160610'>These</span> <span m='1161000'>answers</span>
  <span m='1161360'>are</span> <span m='1161420'>just</span> <span m='1161570'>single</span>
  <span m='1161810'>numbers</span> <span m='1162680'>per</span> <span m='1162860'>point,</span>
  <span m='1163220'>so</span> <span m='1163520'>it's</span> <span m='1163640'>no</span>
  <span m='1163790'>big</span> <span m='1163940'>deal.</span> </p><p><span m='1166590'>OK,</span>
  <span m='1167570'>so</span> <span m='1167810'>here's</span> <span m='1168020'>what</span>
  <span m='1168140'>we</span> <span m='1168260'>do.</span> <span m='1170300'>Sort</span>
  <span m='1170600'>the</span> <span m='1170690'>points</span> <span m='1174380'>and</span>
  <span m='1174620'>the</span> <span m='1174740'>corners</span> <span m='1175250'>of</span>
  <span m='1175310'>the</span> <span m='1175430'>rectangles</span> <span m='1178430'>by</span>
  <span m='1178910'>x-coordinate</span> <span m='1182330'>using</span> <span m='1183110'>lazy</span>
  <span m='1183380'>final</span> <span m='1183620'>sort.</span> <span m='1184010'>Nothing</span>
  <span m='1184310'>fancy</span> <span m='1184640'>here.</span> <span m='1185150'>No</span>
  <span m='1185330'>augmentation,</span> <span m='1186410'>regular</span> <span m='1186830'>old</span>
  <span m='1187010'>sort.</span> <span m='1188570'>Then--</span> <span m='1189860'>this</span>
  <span m='1190010'>will</span> <span m='1190130'>be</span> <span m='1190250'>useful</span>
  <span m='1190550'>later--</span> <span m='1191810'>then</span> <span m='1192020'>we're</span>
  <span m='1192110'>going</span> <span m='1192280'>to</span> <span m='1192320'>divide</span>
  <span m='1192650'>and</span> <span m='1192740'>conquer</span> <span m='1194050'>on</span>
  <span m='1194270'>y</span> <span m='1200850'>via a</span> <span m='1201350'>distribution</span>
  <span m='1201930'>sweep.</span> </p><p><span m='1207240'>And</span> <span m='1208620'>here,</span>
  <span m='1210320'>our</span> <span m='1210450'>binary</span> <span m='1210930'>merger</span>
  <span m='1214410'>is</span> <span m='1214560'>going</span> <span m='1214830'>to</span>
  <span m='1214950'>be</span> <span m='1215220'>an</span> <span m='1215430'>upward</span>
  <span m='1216990'>sweep</span> <span m='1217320'>line</span> <span m='1217500'>algorithm.</span>
  <span m='1229880'>So let's</span> <span m='1230300'>talk</span> <span m='1230600'>about</span>
  <span m='1230810'>that</span> <span m='1231020'>sweep</span> <span m='1231250'>line</span>
  <span m='1231500'>algorithm.</span> <span m='1237190'>We</span> <span m='1237420'>presorted
  our</span> <span m='1237920'>points</span> <span m='1238250'>by</span> <span m='1238900'>x.</span>
  <span m='1241310'>If</span> <span m='1241490'>you</span> <span m='1241550'>think</span>
  <span m='1241730'>about</span> <span m='1242140'>the</span> <span m='1242270'>merging</span>
  <span m='1242780'>step,</span> <span m='1244740'>what</span> <span m='1244820'>this</span>
  <span m='1245060'>means--</span> <span m='1250020'>it's confusing.</span> </p><p><span
  m='1251770'>We're</span> <span m='1251890'>trying</span> <span m='1252460'>to</span>
  <span m='1252610'>sort</span> <span m='1252910'>by</span> <span m='1253180'>y,</span>
  <span m='1254410'>we</span> <span m='1254650'>were</span> <span m='1255220'>in</span>
  <span m='1255780'>a</span> <span m='1255830'>certain</span> <span m='1256210'>sense,</span>
  <span m='1257500'>but</span> <span m='1258340'>we're</span> <span m='1258550'>always</span>
  <span m='1258850'>going</span> <span m='1259000'>to</span> <span m='1259090'>be</span>
  <span m='1259210'>sorted</span> <span m='1259600'>by</span> <span m='1259840'>x</span>
  <span m='1260470'>because</span> <span m='1260740'>we</span> <span m='1260860'>did</span>
  <span m='1261040'>that up</span> <span m='1261340'>front.</span> <span m='1262730'>So</span>
  <span m='1264550'>the</span> <span m='1264640'>picture</span> <span m='1265030'>is</span>
  <span m='1265120'>going</span> <span m='1265240'>to</span> <span m='1265330'>be</span>
  <span m='1265480'>something</span> <span m='1265870'>like</span> <span m='1266080'>this.</span>
  <span m='1266810'>We're</span> <span m='1267020'>in</span> <span m='1267220'>a</span>
  <span m='1267280'>slab.</span> <span m='1268090'>There's</span> <span m='1268240'>going</span>
  <span m='1268420'>to</span> <span m='1268510'>be</span> <span m='1269380'>the</span>
  <span m='1269470'>left</span> <span m='1269770'>slab.</span> <span m='1270730'>So</span>
  <span m='1270940'>here's</span> <span m='1272920'>the</span> <span m='1273100'>binary</span>
  <span m='1273400'>merger.</span> <span m='1277440'>Here's</span> <span m='1277800'>the
  L</span> <span m='1278040'>points</span> <span m='1278370'>and</span> <span m='1278800'>the</span>
  <span m='1278890'>R</span> <span m='1279100'>points.</span> </p><p><span m='1280000'>The</span>
  <span m='1280270'>L points</span> <span m='1280630'>are</span> <span m='1280690'>going</span>
  <span m='1280900'>to</span> <span m='1280990'>be</span> <span m='1281200'>in</span>
  <span m='1281320'>a</span> <span m='1281380'>particular</span> <span m='1282100'>x</span>
  <span m='1282340'>interval.</span> <span m='1283230'>The</span> <span m='1283380'>R</span>
  <span m='1283630'>points</span> <span m='1284110'>are</span> <span m='1284200'>going</span>
  <span m='1284320'>to</span> <span m='1284440'>be</span> <span m='1285770'>in an</span>
  <span m='1286240'>adjacent</span> <span m='1287140'>x</span> <span m='1287350'>interval</span>
  <span m='1288070'>corresponding</span> <span m='1288670'>to</span> <span m='1288760'>this</span>
  <span m='1288960'>tree</span> <span m='1289210'>picture.</span> <span m='1291910'>And</span>
  <span m='1292060'>then</span> <span m='1294160'>we</span> <span m='1294310'>have</span>
  <span m='1294490'>these</span> <span m='1294670'>points,</span> <span m='1296350'>which</span>
  <span m='1298040'>they</span> <span m='1298840'>overlap</span> <span m='1299350'>and</span>
  <span m='1299440'>why?</span> <span m='1299680'>Because</span> <span m='1299830'>the</span>
  <span m='1299920'>whole</span> <span m='1300070'>point</span> <span m='1300250'>is</span>
  <span m='1300310'>we're</span> <span m='1300400'>trying</span> <span m='1300640'>to</span>
  <span m='1300730'>merge</span> <span m='1301710'>by</span> <span m='1302010'>y.</span>
  </p><p><span m='1304120'>OK,</span> <span m='1304440'>we</span> <span m='1304540'>also</span>
  <span m='1304810'>have</span> <span m='1305020'>some</span> <span m='1305320'>rectangles,</span>
  <span m='1309360'>and</span> <span m='1309600'>their</span> <span m='1309750'>corners</span>
  <span m='1310800'>are</span> <span m='1311340'>what</span> <span m='1311640'>we</span>
  <span m='1311790'>have</span> <span m='1312000'>represented.</span> <span m='1318760'>I
  probably</span> <span m='1318980'>should have</span> <span m='1319130'>used</span>
  <span m='1319370'>colors</span> <span m='1319940'>here.</span> <span m='1329390'>Something</span>
  <span m='1330450'>like</span> <span m='1330770'>this.</span> <span m='1337790'>So</span>
  <span m='1338090'>we're</span> <span m='1338210'>given,</span> <span m='1338630'>essentially--</span>
  <span m='1339660'>we</span> <span m='1339830'>have</span> <span m='1340190'>whatever</span>
  <span m='1340580'>we</span> <span m='1340760'>want</span> <span m='1341060'>on</span>
  <span m='1341300'>the</span> <span m='1341390'>points</span> <span m='1341930'>and</span>
  <span m='1342410'>corners</span> <span m='1342860'>in</span> <span m='1342980'>here.</span>
  <span m='1343520'>We</span> <span m='1343610'>have</span> <span m='1343700'>whatever</span>
  <span m='1344030'>we</span> <span m='1344150'>want</span> <span m='1344370'>in</span>
  <span m='1344410'>the</span> <span m='1344480'>points</span> <span m='1344780'>and</span>
  <span m='1344870'>corners</span> <span m='1345230'>in</span> <span m='1345410'>this</span>
  <span m='1345560'>slab.</span> </p><p><span m='1346700'>Let</span> <span m='1346790'>me</span>
  <span m='1346970'>add</span> <span m='1347300'>a</span> <span m='1347330'>little</span>
  <span m='1347540'>bit</span> <span m='1347630'>of</span> <span m='1347720'>color.</span>
  <span m='1350280'>These</span> <span m='1350660'>lines.</span> <span m='1355580'>And</span>
  <span m='1355700'>now</span> <span m='1356720'>we</span> <span m='1356870'>want</span>
  <span m='1357020'>to</span> <span m='1357080'>merge</span> <span m='1357950'>these</span>
  <span m='1358130'>two</span> <span m='1358310'>things</span> <span m='1359810'>and</span>
  <span m='1360380'>merging</span> <span m='1360770'>here</span> <span m='1360950'>is</span>
  <span m='1361040'>all</span> <span m='1361220'>about</span> <span m='1361730'>counting</span>
  <span m='1362450'>how</span> <span m='1362630'>many</span> <span m='1362840'>rectangles</span>
  <span m='1363350'>contain</span> <span m='1363710'>each</span> <span m='1363890'>point.</span>
  <span m='1364800'>Now,</span> <span m='1365600'>we</span> <span m='1365840'>already</span>
  <span m='1366200'>know</span> <span m='1366680'>how</span> <span m='1366920'>many</span>
  <span m='1367160'>points</span> <span m='1367490'>over</span> <span m='1367700'>here</span>
  <span m='1368240'>are</span> <span m='1368360'>contained</span> <span m='1368780'>in</span>
  <span m='1368870'>rectangles</span> <span m='1369500'>that</span> <span m='1369650'>are</span>
  <span m='1369740'>over</span> <span m='1370010'>here.</span> <span m='1371310'>So</span>
  <span m='1371480'>we've</span> <span m='1371750'>presumably</span> <span m='1372260'>already</span>
  <span m='1372650'>found</span> <span m='1373000'>that</span> <span m='1373100'>this</span>
  <span m='1373250'>point</span> <span m='1373580'>lies</span> <span m='1373910'>in</span>
  <span m='1374000'>this</span> <span m='1374180'>rectangle.</span> </p><p><span m='1375930'>We've</span>
  <span m='1376010'>already</span> <span m='1376310'>found--</span> <span m='1377270'>I</span>
  <span m='1377330'>guess</span> <span m='1377480'>there's</span> <span m='1377600'>no</span>
  <span m='1377960'>points</span> <span m='1378350'>here.</span> <span m='1379050'>We've</span>
  <span m='1379120'>already</span> <span m='1379310'>found</span> <span m='1379490'>that</span>
  <span m='1379580'>this</span> <span m='1379760'>point</span> <span m='1380090'>is</span>
  <span m='1380240'>contained</span> <span m='1380600'>in</span> <span m='1380660'>this</span>
  <span m='1380840'>rectangle.</span> <span m='1382200'>OK,</span> <span m='1382490'>because</span>
  <span m='1382820'>these</span> <span m='1383000'>corners</span> <span m='1383600'>were</span>
  <span m='1383720'>in</span> <span m='1383900'>this</span> <span m='1384020'>slab,</span>
  <span m='1385070'>and</span> <span m='1385460'>so</span> <span m='1385850'>let's</span>
  <span m='1386030'>say</span> <span m='1386150'>every</span> <span m='1386420'>corner</span>
  <span m='1386750'>knows</span> <span m='1386990'>the</span> <span m='1387080'>entire</span>
  <span m='1387470'>rectangle.</span> <span m='1388680'>So</span> <span m='1388760'>when</span>
  <span m='1388940'>you were</span> <span m='1389120'>processing</span> <span m='1389690'>R,</span>
  <span m='1390050'>you</span> <span m='1390170'>saw</span> <span m='1390440'>these</span>
  <span m='1390620'>corners,</span> <span m='1391130'>you</span> <span m='1391220'>saw</span>
  <span m='1391430'>this</span> <span m='1391580'>point.</span> <span m='1392060'>Somehow</span>
  <span m='1392480'>you</span> <span m='1392630'>figured</span> <span m='1392930'>that</span>
  <span m='1393110'>out.</span> </p><p><span m='1394040'>What</span> <span m='1394160'>we're</span>
  <span m='1394310'>missing</span> <span m='1396170'>are</span> <span m='1396290'>things</span>
  <span m='1396560'>like</span> <span m='1397040'>this</span> <span m='1397400'>rectangle,</span>
  <span m='1399620'>where</span> <span m='1399830'>none</span> <span m='1400250'>of</span>
  <span m='1400400'>the</span> <span m='1400520'>corners</span> <span m='1401000'>are</span>
  <span m='1401180'>inside</span> <span m='1401730'>R.</span> <span m='1402420'>So</span>
  <span m='1402640'>R</span> <span m='1402870'>knew</span> <span m='1403090'>nothing</span>
  <span m='1403520'>about</span> <span m='1403760'>this</span> <span m='1403940'>rectangle,</span>
  <span m='1404450'>and</span> <span m='1404570'>yet</span> <span m='1404750'>it</span>
  <span m='1404840'>has</span> <span m='1405080'>points</span> <span m='1405470'>that</span>
  <span m='1405590'>are</span> <span m='1405650'>contained</span> <span m='1406040'>in</span>
  <span m='1406160'>it.</span> <span m='1406580'>Similarly,</span> <span m='1407180'>there</span>
  <span m='1407330'>are</span> <span m='1407360'>these</span> <span m='1407600'>rectangles</span>
  <span m='1408890'>that</span> <span m='1409580'>completely</span> <span m='1410210'>span</span>
  <span m='1410630'>L,</span> <span m='1412630'>and</span> <span m='1412850'>so</span>
  <span m='1413030'>therefore</span> <span m='1413570'>none</span> <span m='1413780'>of</span>
  <span m='1413870'>the</span> <span m='1413990'>corners</span> <span m='1414350'>are</span>
  <span m='1414440'>inside</span> <span m='1414860'>L.</span> <span m='1415700'>But</span>
  <span m='1415850'>we</span> <span m='1415970'>need</span> <span m='1416150'>to</span>
  <span m='1416300'>know</span> <span m='1416600'>that</span> <span m='1416750'>these</span>
  <span m='1416930'>points</span> <span m='1417650'>are</span> <span m='1417770'>in</span>
  <span m='1417950'>there.</span> <span m='1418730'>Those</span> <span m='1418940'>are</span>
  <span m='1419000'>the</span> <span m='1419360'>only</span> <span m='1419720'>things</span>
  <span m='1419990'>that</span> <span m='1420110'>will</span> <span m='1420260'>be</span>
  <span m='1421070'>missing</span> <span m='1421490'>at</span> <span m='1421730'>this</span>
  <span m='1421940'>level.</span> </p><p><span m='1425030'>There</span> <span m='1425120'>might</span>
  <span m='1425270'>be</span> <span m='1425420'>other</span> <span m='1425600'>rectangles</span>
  <span m='1426110'>that</span> <span m='1426260'>completely</span> <span m='1426740'>span</span>
  <span m='1427040'>L</span> <span m='1427280'>and</span> <span m='1427520'>R.</span>
  <span m='1428030'>Those</span> <span m='1428240'>will</span> <span m='1428330'>be</span>
  <span m='1428420'>discovered</span> <span m='1428840'>at</span> <span m='1428930'>higher</span>
  <span m='1429230'>levels,</span> <span m='1430060'>now</span> <span m='1430220'>here.</span>
  <span m='1432090'>It's</span> <span m='1432230'>a</span> <span m='1432290'>little</span>
  <span m='1432560'>bit</span> <span m='1433130'>awkward</span> <span m='1433520'>to</span>
  <span m='1433610'>check</span> <span m='1433940'>if this</span> <span m='1434150'>will</span>
  <span m='1434270'>actually</span> <span m='1434600'>find</span> <span m='1434900'>everything,</span>
  <span m='1436040'>but</span> <span m='1436190'>it</span> <span m='1436280'>will.</span>
  <span m='1438200'>So</span> <span m='1440930'>to</span> <span m='1441050'>figure</span>
  <span m='1441350'>this</span> <span m='1441560'>out,</span> <span m='1442280'>when</span>
  <span m='1442490'>we're</span> <span m='1442610'>merging</span> <span m='1442905'>L</span>
  <span m='1443200'>and</span> <span m='1443330'>R--</span> <span m='1443725'>see,</span>
  <span m='1444020'>L knows</span> <span m='1444380'>about</span> <span m='1444650'>this</span>
  <span m='1444830'>rectangle</span> <span m='1445370'>because</span> <span m='1445550'>it</span>
  <span m='1445640'>sees</span> <span m='1445910'>these</span> <span m='1446090'>points.</span>
  <span m='1447050'>We</span> <span m='1447170'>want</span> <span m='1447320'>to</span>
  <span m='1447410'>keep</span> <span m='1447620'>track</span> <span m='1448130'>as</span>
  <span m='1448370'>we</span> <span m='1448550'>sweep</span> <span m='1448970'>upwards.</span>
  </p><p><span m='1449840'>We</span> <span m='1449960'>want</span> <span m='1450140'>to</span>
  <span m='1450200'>realize</span> <span m='1450650'>that</span> <span m='1450770'>these</span>
  <span m='1450950'>points</span> <span m='1451250'>are</span> <span m='1451370'>in</span>
  <span m='1451580'>a</span> <span m='1451640'>big</span> <span m='1451880'>rectangle</span>
  <span m='1452390'>here,</span> <span m='1453230'>whereas</span> <span m='1453530'>they</span>
  <span m='1453680'>weren't</span> <span m='1453860'>discovered</span> <span m='1454260'>in</span>
  <span m='1454370'>L,</span> <span m='1454670'>and they</span> <span m='1454790'>weren't</span>
  <span m='1454970'>discovered</span> <span m='1455420'>in</span> <span m='1455570'>R.</span>
  <span m='1457520'>To</span> <span m='1457640'>do</span> <span m='1457760'>that,</span>
  <span m='1458360'>we</span> <span m='1458570'>maintain</span> <span m='1461260'>a</span>
  <span m='1462260'>number</span> <span m='1463490'>as--</span> <span m='1463940'>we</span>
  <span m='1464030'>have</span> <span m='1464210'>a</span> <span m='1464360'>horizontal</span>
  <span m='1464870'>line,</span> <span m='1465140'>we're</span> <span m='1465200'>sweeping</span>
  <span m='1465620'>up.</span> <span m='1468020'>We</span> <span m='1468170'>want</span>
  <span m='1468350'>to</span> <span m='1468410'>maintain</span> <span m='1468920'>the</span>
  <span m='1469040'>number</span> <span m='1470000'>of</span> <span m='1470450'>active</span>
  <span m='1472100'>rectangles.</span> </p><p><span m='1474170'>Active</span> <span
  m='1474740'>means</span> <span m='1476360'>that</span> <span m='1476600'>it's</span>
  <span m='1476870'>currently</span> <span m='1477380'>being</span> <span m='1477620'>sliced</span>
  <span m='1478190'>by</span> <span m='1478490'>the</span> <span m='1478610'>sweep</span>
  <span m='1478880'>line.</span> <span m='1482450'>That</span> <span m='1482630'>have</span>
  <span m='1484610'>left</span> <span m='1485000'>corners</span> <span m='1488210'>in</span>
  <span m='1488480'>L</span> <span m='1490610'>and</span> <span m='1492410'>completely</span>
  <span m='1493130'>span</span> <span m='1493810'>R.</span> <span m='1495110'>So</span>
  <span m='1495290'>that's</span> <span m='1496350'>these</span> <span m='1496730'>guys.</span>
  <span m='1497870'>So</span> <span m='1498020'>that's</span> <span m='1498200'>easy</span>
  <span m='1498410'>to</span> <span m='1498530'>do.</span> <span m='1499550'>We're</span>
  <span m='1500060'>merging</span> <span m='1500540'>these</span> <span m='1500720'>points.</span>
  <span m='1501350'>So</span> <span m='1501890'>that</span> <span m='1502250'>each</span>
  <span m='1502490'>of</span> <span m='1502550'>them</span> <span m='1502730'>has</span>
  <span m='1502850'>been</span> <span m='1503000'>sorted</span> <span m='1503330'>by</span>
  <span m='1503490'>y.</span> <span m='1504470'>Now</span> <span m='1505400'>we're</span>
  <span m='1505970'>doing</span> <span m='1506240'>a</span> <span m='1506280'>merge,</span>
  <span m='1506600'>so</span> <span m='1506750'>we're</span> <span m='1506870'>considering</span>
  <span m='1507350'>all</span> <span m='1507530'>the</span> <span m='1507650'>corners,</span>
  <span m='1508310'>and</span> <span m='1508400'>all</span> <span m='1508640'>the</span>
  <span m='1508760'>points,</span> <span m='1509540'>and</span> <span m='1509690'>increasing</span>
  <span m='1510035'>the</span> <span m='1510380'>y-coordinate</span> <span m='1511130'>as</span>
  <span m='1511310'>we</span> <span m='1511430'>do</span> <span m='1511550'>that</span>
  <span m='1511760'>binary</span> <span m='1512150'>merge.</span> </p><p><span m='1513740'>So</span>
  <span m='1514070'>whenever</span> <span m='1514490'>we</span> <span m='1514640'>visit</span>
  <span m='1515360'>a</span> <span m='1515420'>left</span> <span m='1515870'>corner</span>
  <span m='1516890'>of</span> <span m='1517040'>a</span> <span m='1517070'>rectangle--</span>
  <span m='1517610'>a</span> <span m='1517670'>lower</span> <span m='1517970'>left</span>
  <span m='1518180'>corner--</span> <span m='1518450'>we</span> <span m='1518540'>say</span>
  <span m='1518720'>oh,</span> <span m='1520040'>does</span> <span m='1520340'>this</span>
  <span m='1520520'>rectangle</span> <span m='1520970'>go</span> <span m='1521120'>all</span>
  <span m='1521240'>the</span> <span m='1521330'>way</span> <span m='1521420'>across?</span>
  <span m='1521870'>This</span> <span m='1522050'>one</span> <span m='1522200'>does</span>
  <span m='1522350'>not.</span> <span m='1523160'>By</span> <span m='1523280'>the</span>
  <span m='1523400'>time</span> <span m='1523730'>we</span> <span m='1523820'>get</span>
  <span m='1524000'>to</span> <span m='1524120'>here,</span> <span m='1525020'>this</span>
  <span m='1525170'>one</span> <span m='1525320'>goes</span> <span m='1525470'>all</span>
  <span m='1525620'>the</span> <span m='1525680'>way</span> <span m='1525800'>cross</span>
  <span m='1526100'>R,</span> <span m='1526820'>and</span> <span m='1526970'>so</span>
  <span m='1527120'>we</span> <span m='1527240'>increment</span> <span m='1527670'>CL.</span>
  <span m='1528620'>And</span> <span m='1528770'>when</span> <span m='1528920'>we</span>
  <span m='1528980'>get</span> <span m='1529130'>to</span> <span m='1529220'>the</span>
  <span m='1529580'>upper</span> <span m='1529850'>left</span> <span m='1530060'>corner,</span>
  <span m='1530900'>we</span> <span m='1531050'>decrement</span> <span m='1531700'>CL.</span>
  <span m='1532670'>Say</span> <span m='1533150'>oh,</span> <span m='1533330'>that
  rectangle's</span> <span m='1533810'>over.</span> </p><p><span m='1534690'>So</span>
  <span m='1534790'>it's</span> <span m='1534830'>very</span> <span m='1534980'>easy</span>
  <span m='1535220'>to</span> <span m='1535310'>do</span> <span m='1537180'>constant</span>
  <span m='1537440'>time,</span> <span m='1538070'>but</span> <span m='1538760'>it's</span>
  <span m='1538880'>only</span> <span m='1539120'>going</span> <span m='1539270'>to</span>
  <span m='1539330'>be</span> <span m='1539600'>1/B</span> <span m='1540290'>memory</span>
  <span m='1540590'>transfers</span> <span m='1541040'>per</span> <span m='1541880'>one</span>
  <span m='1542030'>of</span> <span m='1542090'>these</span> <span m='1542270'>because</span>
  <span m='1542450'>it's</span> <span m='1542570'>a</span> <span m='1542630'>nice,</span>
  <span m='1542900'>cheap</span> <span m='1543800'>merge.</span> <span m='1545870'>And</span>
  <span m='1546020'>then</span> <span m='1546200'>symmetrically,</span> <span m='1548030'>we</span>
  <span m='1548150'>do</span> <span m='1548300'>CR.</span> <span m='1549770'>It's</span>
  <span m='1550790'>the</span> <span m='1550940'>number</span> <span m='1551180'>of</span>
  <span m='1551240'>active</span> <span m='1551510'>rectangles</span> <span m='1552020'>with</span>
  <span m='1552140'>the</span> <span m='1552260'>right</span> <span m='1552560'>corners</span>
  <span m='1553010'>in</span> <span m='1553220'>R</span> <span m='1554050'>that</span>
  <span m='1554240'>span</span> <span m='1554750'>L.</span> <span m='1555410'>So</span>
  <span m='1555560'>that's</span> <span m='1557360'>this</span> <span m='1557590'>guy,</span>
  <span m='1561090'>CR,</span> <span m='1562010'>I</span> <span m='1562070'>guess,</span>
  <span m='1562660'>this</span> <span m='1562860'>guy</span> <span m='1563600'>is</span>
  <span m='1563830'>CL.</span> </p><p><span m='1565440'>In</span> <span m='1565630'>general,</span>
  <span m='1565910'>there</span> <span m='1566000'>might</span> <span m='1566180'>be</span>
  <span m='1566300'>a</span> <span m='1566330'>lot</span> <span m='1566570'>of</span>
  <span m='1566630'>them,</span> <span m='1566820'>so</span> <span m='1566950'>you</span>
  <span m='1567060'>count</span> <span m='1567350'>them.</span> <span m='1569030'>And</span>
  <span m='1569180'>then</span> <span m='1569600'>the</span> <span m='1569810'>only</span>
  <span m='1569990'>thing</span> <span m='1570170'>we</span> <span m='1570260'>need</span>
  <span m='1570380'>to</span> <span m='1570470'>do</span> <span m='1582271'>is</span>
  <span m='1582770'>whenever</span> <span m='1583090'>we</span> <span m='1583360'>encounter</span>
  <span m='1583810'>a</span> <span m='1583870'>point</span> <span m='1584380'>as</span>
  <span m='1584500'>opposed</span> <span m='1584800'>to</span> <span m='1584920'>a</span>
  <span m='1584980'>corner,</span> <span m='1585540'>because</span> <span m='1586090'>we're</span>
  <span m='1586210'>storing</span> <span m='1586510'>them</span> <span m='1586630'>all</span>
  <span m='1586850'>together,</span> <span m='1589390'>we</span> <span m='1589630'>add--</span>
  <span m='1590440'>I</span> <span m='1590500'>got</span> <span m='1590680'>this</span>
  <span m='1590860'>right--</span> <span m='1591470'>CR</span> <span m='1593330'>to</span>
  <span m='1594440'>it's</span> <span m='1594880'>counter.</span> <span m='1596950'>We</span>
  <span m='1597070'>want</span> <span m='1597220'>to</span> <span m='1597280'>know</span>
  <span m='1597430'>how</span> <span m='1597610'>many</span> <span m='1597940'>rectangles</span>
  <span m='1598480'>contain</span> <span m='1598870'>that</span> <span m='1599050'>point.</span>
  </p><p><span m='1600890'>And</span> <span m='1600910'>so</span> <span m='1601330'>for</span>
  <span m='1601450'>example,</span> <span m='1601870'>when</span> <span m='1602080'>we</span>
  <span m='1602200'>see</span> <span m='1602410'>this</span> <span m='1602620'>point,</span>
  <span m='1603400'>and</span> <span m='1603550'>CR</span> <span m='1603960'>is</span>
  <span m='1604090'>currently</span> <span m='1604480'>one,</span> <span m='1605350'>then</span>
  <span m='1605500'>we</span> <span m='1605590'>know</span> <span m='1605920'>that</span>
  <span m='1606070'>this</span> <span m='1606220'>point</span> <span m='1606460'>appeared</span>
  <span m='1606790'>in</span> <span m='1606880'>some</span> <span m='1607090'>rectangle</span>
  <span m='1607660'>that</span> <span m='1607840'>spanned</span> <span m='1608120'>L.</span>
  <span m='1609160'>So</span> <span m='1609340'>we</span> <span m='1609430'>increment</span>
  <span m='1609820'>this</span> <span m='1609970'>points</span> <span m='1610240'>counter.</span>
  <span m='1611050'>Similarly,</span> <span m='1611620'>when</span> <span m='1611770'>we</span>
  <span m='1611860'>see</span> <span m='1611980'>these</span> <span m='1612190'>points,</span>
  <span m='1613060'>CL is</span> <span m='1613300'>positive,</span> <span m='1613810'>so</span>
  <span m='1613960'>we</span> <span m='1614080'>increment</span> <span m='1614500'>these</span>
  <span m='1614650'>guys</span> <span m='1614860'>counters</span> <span m='1615190'>by</span>
  <span m='1615340'>whatever</span> <span m='1615670'>CL is.</span> <span m='1617500'>So</span>
  <span m='1617830'>this is</span> <span m='1618030'>a</span> <span m='1618190'>symmetric</span>
  <span m='1618730'>version</span> <span m='1622420'>in</span> <span m='1622830'>R</span>
  <span m='1623140'>when</span> <span m='1623590'>we</span> <span m='1623770'>add</span>
  <span m='1624000'>CL.</span> </p><p><span m='1625630'>Probably</span> <span m='1625870'>should</span>
  <span m='1626020'>have</span> <span m='1626110'>called</span> <span m='1626260'>them</span>
  <span m='1626680'>the</span> <span m='1626800'>other</span> <span m='1626980'>names,</span>
  <span m='1627370'>but</span> <span m='1627520'>anyway,</span> <span m='1628130'>CL,</span>
  <span m='1628385'>CR,</span> <span m='1628810'>doesn't</span> <span m='1629020'>matter.</span>
  <span m='1630350'>CLRS.</span> <span m='1632950'>Question?</span> </p><p><span m='1633796'>AUDIENCE:</span>
  <span m='1634039'>The</span> <span m='1634282'>bottom is</span> <span m='1634768'>the
  x-axis,</span> <span m='1635254'>right?</span> </p><p><span m='1635740'>ERIK DEMAINE:</span>
  <span m='1635815'>This</span> <span m='1635890'>is</span> <span m='1635980'>the</span>
  <span m='1636130'>x-axis,</span> <span m='1636740'>yeah.</span> </p><p><span m='1636870'>AUDIENCE:</span>
  <span m='1637114'>So</span> <span m='1637358'>are we</span> <span m='1637846'>dividing</span>
  <span m='1638334'>and conquering on x?</span> </p><p><span m='1641270'>ERIK DEMAINE:</span>
  <span m='1641290'>It</span> <span m='1641750'>does</span> <span m='1641910'>look</span>
  <span m='1642090'>like</span> <span m='1642270'>we're</span> <span m='1642360'>dividing</span>
  <span m='1642750'>and</span> <span m='1642840'>conquering</span> <span m='1643230'>on</span>
  <span m='1643350'>x,</span> <span m='1643740'>I</span> <span m='1643770'>think</span>
  <span m='1643980'>you're</span> <span m='1644070'>right.</span> <span m='1645020'>Sorry.</span>
  <span m='1646356'>For</span> <span m='1646830'>some</span> <span m='1647010'>reason</span>
  <span m='1647220'>I</span> <span m='1647280'>thought</span> <span m='1647460'>it</span>
  <span m='1647520'>was</span> <span m='1647640'>y.</span> <span m='1648682'>You're</span>
  <span m='1649060'>right.</span> <span m='1650610'>So it's</span> <span m='1650700'>a</span>
  <span m='1650760'>funny</span> <span m='1651000'>thing.</span> <span m='1651750'>We're</span>
  <span m='1651990'>pre-sorting</span> <span m='1652680'>by</span> <span m='1652860'>x,</span>
  <span m='1653880'>which</span> <span m='1654120'>is</span> <span m='1654210'>what's</span>
  <span m='1654540'>getting</span> <span m='1654930'>us--</span> <span m='1655770'>thank</span>
  <span m='1655980'>you.</span> <span m='1656530'>That's</span> <span m='1656750'>much</span>
  <span m='1656940'>clearer</span> <span m='1657270'>now.</span> <span m='1657960'>In
  my</span> <span m='1658160'>mind I</span> <span m='1658380'>was like</span> <span
  m='1658570'>there's</span> <span m='1658865'>something</span> <span m='1659160'>weird</span>
  <span m='1659460'>here.</span> </p><p><span m='1660540'>We're</span> <span m='1660690'>presorting</span>
  <span m='1661260'>on</span> <span m='1661410'>x</span> <span m='1661710'>and</span>
  <span m='1661800'>then</span> <span m='1661900'>we're</span> <span m='1662010'>just</span>
  <span m='1662190'>sticking</span> <span m='1662550'>these</span> <span m='1662730'>guys</span>
  <span m='1663000'>down</span> <span m='1663330'>here.</span> <span m='1664310'>So</span>
  <span m='1664620'>evenly</span> <span m='1665010'>dividing</span> <span m='1665460'>them</span>
  <span m='1665610'>into</span> <span m='1666410'>lists.</span> <span m='1668760'>Or,</span>
  <span m='1669180'>I</span> <span m='1669270'>guess</span> <span m='1669480'>actually,</span>
  <span m='1669690'>we're</span> <span m='1669810'>doing</span> <span m='1670580'>our</span>
  <span m='1672180'>funnel</span> <span m='1672560'>sort,</span> <span m='1673270'>the</span>
  <span m='1673530'>merge</span> <span m='1673800'>sort.</span> <span m='1674580'>Things</span>
  <span m='1674790'>have</span> <span m='1674910'>already</span> <span m='1675150'>been</span>
  <span m='1675270'>sorted</span> <span m='1675540'>by</span> <span m='1675690'>x,</span>
  <span m='1675930'>but</span> <span m='1676050'>now</span> <span m='1676620'>we're</span>
  <span m='1678120'>merge</span> <span m='1678330'>sorting</span> <span m='1678660'>again,</span>
  <span m='1679740'>and</span> <span m='1679890'>this</span> <span m='1680160'>time</span>
  <span m='1680490'>when</span> <span m='1680640'>we</span> <span m='1680760'>merge,</span>
  <span m='1681120'>we</span> <span m='1681240'>carry</span> <span m='1681630'>along</span>
  <span m='1681990'>this</span> <span m='1682170'>information.</span> <span m='1684190'>So</span>
  <span m='1684330'>they're</span> <span m='1684660'>both</span> <span m='1685020'>in</span>
  <span m='1685140'>terms</span> <span m='1685380'>of</span> <span m='1685500'>x,</span>
  <span m='1686170'>which is</span> <span m='1686340'>kind</span> <span m='1686520'>of</span>
  <span m='1686580'>funny.</span> <span m='1687330'>Is</span> <span m='1687420'>there</span>
  <span m='1687750'>another</span> <span m='1687900'>question?</span> </p><p><span
  m='1690242'>AUDIENCE:</span> <span m='1690488'>Sorry,</span> <span m='1691228'>is
  it</span> <span m='1691721'>important</span> <span m='1692214'>that we</span> <span
  m='1692707'>do the</span> <span m='1693200'>upward sweep</span> <span m='1693693'>[INAUDIBLE]?</span>
  </p><p><span m='1698640'>ERIK DEMAINE:</span> <span m='1698695'>The</span> <span
  m='1699110'>upward</span> <span m='1699500'>sweep.</span> <span m='1701750'>Yeah,</span>
  <span m='1701930'>we</span> <span m='1702080'>have</span> <span m='1702230'>to</span>
  <span m='1702350'>do</span> <span m='1702530'>the</span> <span m='1702620'>points</span>
  <span m='1703040'>in</span> <span m='1703220'>order</span> <span m='1703610'>by</span>
  <span m='1703890'>y.</span> </p><p><span m='1704145'>AUDIENCE:</span> <span m='1704272'>So</span>
  <span m='1704900'>do</span> <span m='1705400'>we</span> <span m='1705900'>want to</span>
  <span m='1706400'>just</span> <span m='1706900'>sort by y,</span> <span m='1707400'>and
  then</span> <span m='1707900'>[INAUDIBLE].</span> </p><p><span m='1709900'>ERIK
  DEMAINE:</span> <span m='1710035'>Ah,</span> <span m='1710102'>so</span> <span m='1710170'>confused</span>
  <span m='1710680'>now.</span> </p><p><span m='1711988'>AUDIENCE:</span> <span m='1712232'>Because</span>
  <span m='1712477'>in the notes,</span> <span m='1712966'>it said</span> <span m='1713455'>x
  and</span> <span m='1713944'>then y.</span> </p><p><span m='1715900'>ERIK DEMAINE:</span>
  <span m='1716065'>Yeah,</span> <span m='1716230'>I</span> <span m='1716350'>know</span>
  <span m='1716650'>in</span> <span m='1716770'>the</span> <span m='1716860'>notes</span>
  <span m='1717070'>it</span> <span m='1717200'>says</span> <span m='1717370'>y.</span>
  <span m='1717790'>It</span> <span m='1717910'>used</span> <span m='1718090'>to</span>
  <span m='1718180'>say</span> <span m='1718390'>x.</span> <span m='1720010'>I</span>
  <span m='1720100'>believe,</span> <span m='1722560'>we're</span> <span m='1722740'>dividing</span>
  <span m='1723190'>and</span> <span m='1723340'>conquering</span> <span m='1723790'>on</span>
  <span m='1723910'>x,</span> <span m='1724480'>but</span> <span m='1724660'>we're</span>
  <span m='1724810'>sorting</span> <span m='1725380'>by</span> <span m='1725590'>y,</span>
  <span m='1726190'>and</span> <span m='1726310'>that's</span> <span m='1726520'>the</span>
  <span m='1726640'>confusion.</span> <span m='1729160'>I'll</span> <span m='1729310'>double</span>
  <span m='1729580'>check</span> <span m='1729850'>this,</span> <span m='1731680'>but</span>
  <span m='1732550'>in</span> <span m='1732670'>order</span> <span m='1732850'>for</span>
  <span m='1732970'>this</span> <span m='1733120'>sweep</span> <span m='1733480'>to</span>
  <span m='1733660'>work--</span> <span m='1734080'>so</span> <span m='1734540'>it's</span>
  <span m='1734960'>like</span> <span m='1735100'>you</span> <span m='1735190'>first</span>
  <span m='1735490'>sort</span> <span m='1735730'>by</span> <span m='1735910'>x.</span>
  <span m='1737290'>You</span> </p><p><span m='1738460'>We</span> <span m='1738640'>are</span>
  <span m='1738880'>in</span> <span m='1738970'>some</span> <span m='1739180'>sense</span>
  <span m='1739360'>doing</span> <span m='1739600'>divide</span> <span m='1739870'>and</span>
  <span m='1739960'>conquer</span> <span m='1740260'>by</span> <span m='1740410'>x</span>
  <span m='1740770'>because</span> <span m='1741280'>we</span> <span m='1741400'>did</span>
  <span m='1741550'>this</span> <span m='1741670'>sort</span> <span m='1741910'>by</span>
  <span m='1742090'>x.</span> <span m='1743290'>But</span> <span m='1744010'>the</span>
  <span m='1744130'>merge</span> <span m='1744460'>short</span> <span m='1745010'>is</span>
  <span m='1745210'>on</span> <span m='1745390'>y.</span> <span m='1747980'>It</span>
  <span m='1748150'>makes</span> <span m='1748360'>more</span> <span m='1748510'>sense.</span>
  <span m='1748930'>If</span> <span m='1749110'>you're</span> <span m='1749290'>already</span>
  <span m='1749590'>in</span> <span m='1749680'>x</span> <span m='1749860'>order,</span>
  <span m='1750190'>sorting</span> <span m='1751470'>isn't</span> <span m='1751710'>going</span>
  <span m='1751840'>to</span> <span m='1751900'>learn</span> <span m='1752080'>you</span>
  <span m='1752170'>much.</span> <span m='1752670'>It isn't</span> <span m='1752850'>going</span>
  <span m='1753040'>to</span> <span m='1753100'>teach</span> <span m='1753340'>you</span>
  <span m='1753460'>much.</span> <span m='1755620'>So</span> <span m='1755920'>first</span>
  <span m='1756190'>you</span> <span m='1756280'>sort</span> <span m='1756470'>by</span>
  <span m='1756640'>x.</span> <span m='1757090'>Things</span> <span m='1757330'>are</span>
  <span m='1757420'>nicely</span> <span m='1757750'>ordered</span> <span m='1757960'>by</span>
  <span m='1758110'>x.</span> <span m='1758320'>So</span> <span m='1758440'>we</span>
  <span m='1758560'>get</span> <span m='1758710'>these</span> <span m='1758890'>nice</span>
  <span m='1759100'>horizontal</span> <span m='1759610'>slabs</span> <span m='1760150'>in</span>
  <span m='1760270'>the</span> <span m='1760440'>decomposition,</span> <span m='1761800'>but</span>
  <span m='1761950'>now</span> <span m='1762250'>when</span> <span m='1762370'>we</span>
  <span m='1762550'>merge--</span> </p><p><span m='1763450'>Now</span> <span m='1763660'>we're</span>
  <span m='1763750'>going</span> <span m='1763870'>to</span> <span m='1763960'>sort</span>
  <span m='1764290'>by</span> <span m='1764470'>y.</span> <span m='1764950'>So</span>
  <span m='1765070'>we're</span> <span m='1765160'>going</span> <span m='1765280'>to</span>
  <span m='1765340'>reorder</span> <span m='1765760'>the</span> <span m='1765880'>points</span>
  <span m='1766210'>and</span> <span m='1766360'>that's</span> <span m='1766600'>what</span>
  <span m='1766870'>lets</span> <span m='1767140'>us</span> <span m='1767290'>do</span>
  <span m='1767440'>the</span> <span m='1767530'>sweep.</span> <span m='1768680'>And</span>
  <span m='1768950'>we</span> <span m='1769090'>are,</span> <span m='1769420'>in</span>
  <span m='1769540'>the</span> <span m='1769690'>end,</span> <span m='1769840'>merging</span>
  <span m='1770230'>all</span> <span m='1770350'>these</span> <span m='1770500'>points</span>
  <span m='1770710'>together</span> <span m='1771100'>in</span> <span m='1771280'>y</span>
  <span m='1771580'>order.</span> <span m='1772690'>And</span> <span m='1772840'>as</span>
  <span m='1773110'>we</span> <span m='1773260'>do</span> <span m='1773440'>it,</span>
  <span m='1773890'>then</span> <span m='1774100'>we</span> <span m='1774220'>get</span>
  <span m='1774370'>the</span> <span m='1774490'>information</span> <span m='1774910'>we</span>
  <span m='1774970'>want</span> <span m='1775180'>about</span> <span m='1775360'>rectangles</span>
  <span m='1775840'>and</span> <span m='1775930'>points.</span> <span m='1777065'>OK,</span>
  <span m='1777460'>this</span> <span m='1777670'>is</span> <span m='1777940'>why</span>
  <span m='1778540'>I</span> <span m='1778630'>wanted</span> <span m='1778870'>this</span>
  <span m='1779050'>to</span> <span m='1779140'>be</span> <span m='1779260'>both</span>
  <span m='1779710'>x</span> <span m='1780040'>and</span> <span m='1780250'>y.</span>
  </p><p><span m='1781270'>But</span> <span m='1781390'>really,</span> <span m='1781600'>the</span>
  <span m='1781690'>divide</span> <span m='1781990'>and</span> <span m='1782080'>conquer</span>
  <span m='1782500'>is</span> <span m='1782620'>happening</span> <span m='1783040'>on</span>
  <span m='1783220'>x,</span> <span m='1783610'>but</span> <span m='1783760'>we</span>
  <span m='1783910'>are</span> <span m='1784090'>doing</span> <span m='1784390'>a
  merge</span> <span m='1785290'>sort</span> <span m='1786130'>on</span> <span m='1786310'>y.</span>
  <span m='1788170'>Finally</span> <span m='1788590'>clear.</span> <span m='1789950'>Thanks</span>
  <span m='1790090'>for</span> <span m='1790180'>helping</span> <span m='1790420'>me.</span>
  <span m='1791500'>This is</span> <span m='1791620'>a</span> <span m='1791710'>new</span>
  <span m='1791860'>lecturers,</span> <span m='1792115'>as</span> <span m='1792370'>you</span>
  <span m='1792490'>may</span> <span m='1792610'>have</span> <span m='1792730'>guessed,</span>
  <span m='1793972'>so</span> <span m='1794370'>still</span> <span m='1795010'>working</span>
  <span m='1795310'>out</span> <span m='1795430'>some</span> <span m='1795580'>kinks.</span>
  </p><p><span m='1797820'>I</span> <span m='1797950'>really</span> <span m='1798190'>wanted</span>
  <span m='1798400'>to</span> <span m='1798490'>introduce</span> <span m='1798880'>this</span>
  <span m='1799000'>lecture</span> <span m='1799330'>because</span> <span m='1801160'>the</span>
  <span m='1801250'>next</span> <span m='1801520'>thing</span> <span m='1801670'>we're</span>
  <span m='1801760'>going</span> <span m='1801880'>to</span> <span m='1801970'>cover,</span>
  <span m='1803100'>which</span> <span m='1803220'>is a</span> <span m='1803320'>way</span>
  <span m='1803500'>to</span> <span m='1803590'>do</span> <span m='1804100'>orthogonal</span>
  <span m='1804300'>2D</span> <span m='1804730'>range</span> <span m='1804970'>search</span>
  <span m='1805200'>and</span> <span m='1805320'>cache</span> <span m='1805630'>obviously,</span>
  <span m='1806640'>is</span> <span m='1806830'>super</span> <span m='1807280'>cool.</span>
  <span m='1807990'>It's</span> <span m='1808600'>like</span> <span m='1808810'>one</span>
  <span m='1808990'>of</span> <span m='1809050'>the</span> <span m='1809650'>craziest</span>
  <span m='1810310'>things</span> <span m='1811480'>there</span> <span m='1811630'>is.</span>
  <span m='1813540'>At</span> <span m='1813610'>least</span> <span m='1813840'>in</span>
  <span m='1813900'>the</span> <span m='1813960'>cache</span> <span m='1814210'>oblivious</span>
  <span m='1814570'>world.</span> <span m='1815530'>Any</span> <span m='1815770'>other</span>
  <span m='1815950'>questions</span> <span m='1816520'>before--</span> <span m='1817650'>Oh,</span>
  <span m='1817870'>I</span> <span m='1817930'>should</span> <span m='1818110'>say</span>
  <span m='1818260'>a</span> <span m='1818290'>little</span> <span m='1818500'>bit</span>
  <span m='1818620'>more</span> <span m='1818860'>about</span> <span m='1819100'>this.</span>
  </p><p><span m='1821740'>We've</span> <span m='1821980'>now</span> <span m='1822280'>solved</span>
  <span m='1823360'>this</span> <span m='1823750'>first</span> <span m='1824020'>step,</span>
  <span m='1825100'>which</span> <span m='1825280'>is</span> <span m='1825940'>figuring</span>
  <span m='1826360'>out</span> <span m='1826510'>the</span> <span m='1826660'>output</span>
  <span m='1827020'>size.</span> <span m='1828520'>Counting</span> <span m='1829330'>for</span>
  <span m='1829510'>each</span> <span m='1829750'>point</span> <span m='1830140'>how</span>
  <span m='1830320'>many</span> <span m='1830530'>rectangles</span> <span m='1831040'>contain</span>
  <span m='1831430'>it,</span> <span m='1832510'>which</span> <span m='1832690'>is</span>
  <span m='1832780'>an</span> <span m='1832840'>interesting</span> <span m='1833230'>problem</span>
  <span m='1833500'>by</span> <span m='1833650'>itself.</span> <span m='1834070'>That's</span>
  <span m='1834280'>the</span> <span m='1834370'>range</span> <span m='1834610'>counting</span>
  <span m='1834910'>problem.</span> <span m='1836470'>You</span> <span m='1836650'>can</span>
  <span m='1836800'>also</span> <span m='1837130'>use</span> <span m='1837370'>it</span>
  <span m='1837430'>to</span> <span m='1837550'>figure</span> <span m='1837880'>out,</span>
  <span m='1838420'>at</span> <span m='1838690'>this</span> <span m='1838900'>level,</span>
  <span m='1839620'>at</span> <span m='1839800'>this</span> <span m='1840040'>merging</span>
  <span m='1840430'>step,</span> <span m='1840730'>how</span> <span m='1841000'>many</span>
  <span m='1841240'>things</span> <span m='1841600'>will</span> <span m='1842050'>be</span>
  <span m='1842170'>output</span> <span m='1842620'>here?</span> <span m='1843760'>How</span>
  <span m='1843910'>many</span> <span m='1844150'>new</span> <span m='1844420'>outputs</span>
  <span m='1844840'>are</span> <span m='1844990'>there?</span> <span m='1845140'>How</span>
  <span m='1845320'>many</span> <span m='1845530'>points</span> <span m='1845950'>in</span>
  <span m='1846040'>rectangles</span> <span m='1846580'>are</span> <span m='1846700'>there?</span>
  <span m='1846920'>It's essentially</span> <span m='1847300'>just</span> <span m='1847480'>the</span>
  <span m='1847570'>sum</span> <span m='1847900'>of</span> <span m='1848020'>all</span>
  <span m='1848170'>those</span> <span m='1848410'>things.</span> </p><p><span m='1852650'>So</span>
  <span m='1852790'>you</span> <span m='1852850'>can</span> <span m='1853000'>count</span>
  <span m='1853360'>the</span> <span m='1853420'>number</span> <span m='1853660'>of</span>
  <span m='1853750'>outputs</span> <span m='1854140'>per</span> <span m='1854320'>merge</span>
  <span m='1855250'>and</span> <span m='1855400'>so</span> <span m='1855880'>then</span>
  <span m='1856930'>there's</span> <span m='1857260'>a</span> <span m='1858070'>natural</span>
  <span m='1858550'>strategy,</span> <span m='1859150'>which</span> <span m='1859390'>is</span>
  <span m='1860260'>you</span> <span m='1860530'>build</span> <span m='1860950'>a</span>
  <span m='1861100'>new</span> <span m='1861670'>funnel</span> <span m='1863110'>structure</span>
  <span m='1864240'>where</span> <span m='1864400'>these</span> <span m='1864640'>buffers</span>
  <span m='1865720'>have</span> <span m='1866200'>the</span> <span m='1866320'>right</span>
  <span m='1866590'>size.</span> <span m='1867900'>You've</span> <span m='1868060'>pre-computed</span>
  <span m='1868780'>what</span> <span m='1868960'>all</span> <span m='1869140'>sizes</span>
  <span m='1869560'>need</span> <span m='1869740'>to</span> <span m='1869860'>be.</span>
  <span m='1870220'>At</span> <span m='1870340'>every</span> <span m='1871240'>merge</span>
  <span m='1871690'>you</span> <span m='1871780'>know</span> <span m='1872020'>how</span>
  <span m='1872170'>many</span> <span m='1872380'>things</span> <span m='1872620'>are</span>
  <span m='1872690'>going</span> <span m='1872800'>to</span> <span m='1872920'>get</span>
  <span m='1873040'>spit</span> <span m='1873310'>out</span> <span m='1873490'>here.</span>
  </p><p><span m='1874540'>So</span> <span m='1874690'>you</span> <span m='1874810'>could</span>
  <span m='1874960'>allocate</span> <span m='1875410'>that</span> <span m='1875590'>much</span>
  <span m='1875770'>space</span> <span m='1877240'>and</span> <span m='1877480'>that</span>
  <span m='1877660'>will</span> <span m='1877780'>be</span> <span m='1878825'>a</span>
  <span m='1879160'>kind</span> <span m='1879580'>of</span> <span m='1879730'>decent</span>
  <span m='1881120'>merge</span> <span m='1881450'>sort.</span> <span m='1881710'>Because</span>
  <span m='1881890'>I</span> <span m='1881980'>haven't</span> <span m='1882190'>done</span>
  <span m='1882310'>the</span> <span m='1882400'>analysis,</span> <span m='1882870'>it's</span>
  <span m='1882970'>hard</span> <span m='1883180'>to</span> <span m='1883630'>get</span>
  <span m='1883840'>into</span> <span m='1883990'>detail</span> <span m='1884320'>about</span>
  <span m='1884590'>this.</span> <span m='1885370'>But</span> <span m='1886270'>it</span>
  <span m='1886480'>will</span> <span m='1886750'>not</span> <span m='1886990'>be</span>
  <span m='1887110'>optimal,</span> <span m='1887860'>unfortunately.</span> <span
  m='1889390'>To</span> <span m='1889540'>actually</span> <span m='1889930'>make</span>
  <span m='1890110'>it</span> <span m='1890200'>work,</span> <span m='1890830'>you</span>
  <span m='1890980'>end</span> <span m='1891130'>up</span> <span m='1891250'>having</span>
  <span m='1891580'>to</span> <span m='1891760'>take</span> <span m='1892060'>this</span>
  <span m='1892240'>tree,</span> <span m='1892960'>carving</span> <span m='1893500'>it</span>
  <span m='1893620'>into</span> <span m='1893860'>subtrees</span> <span m='1894640'>of</span>
  <span m='1894820'>linear</span> <span m='1895240'>size.</span> </p><p><span m='1896530'>So</span>
  <span m='1896710'>normally,</span> <span m='1897340'>the</span> <span m='1897460'>whole</span>
  <span m='1897610'>thing</span> <span m='1897820'>is</span> <span m='1897940'>linear</span>
  <span m='1898210'>size.</span> <span m='1898540'>Everything's</span> <span m='1898960'>fine.</span>
  <span m='1900070'>And</span> <span m='1900310'>where</span> <span m='1900490'>the</span>
  <span m='1900610'>analysis</span> <span m='1901060'>breaks,</span> <span m='1901390'>essentially,</span>
  <span m='1901810'>is</span> <span m='1901900'>if</span> <span m='1902020'>you</span>
  <span m='1902140'>have</span> <span m='1902290'>a</span> <span m='1902380'>giant</span>
  <span m='1902920'>buffer</span> <span m='1903790'>because</span> <span m='1904420'>one</span>
  <span m='1904600'>of</span> <span m='1904660'>the</span> <span m='1904780'>outputs--</span>
  <span m='1905470'>potentially,</span> <span m='1905860'>the</span> <span m='1905950'>output</span>
  <span m='1906220'>size</span> <span m='1906430'>here</span> <span m='1906520'>is</span>
  <span m='1906610'>quadratic.</span> <span m='1907760'>And</span> <span m='1907870'>so</span>
  <span m='1908710'>the</span> <span m='1908770'>overall</span> <span m='1909100'>thing</span>
  <span m='1909310'>might</span> <span m='1909490'>be</span> <span m='1909670'>super</span>
  <span m='1909980'>linear.</span> </p><p><span m='1911050'>And</span> <span m='1911170'>so</span>
  <span m='1911410'>when</span> <span m='1911590'>you</span> <span m='1911680'>have</span>
  <span m='1912040'>a</span> <span m='1912070'>super</span> <span m='1912430'>linear</span>
  <span m='1912700'>buffer</span> <span m='1913150'>or</span> <span m='1913570'>a</span>
  <span m='1913630'>bunch</span> <span m='1913930'>of</span> <span m='1913990'>very</span>
  <span m='1914290'>large</span> <span m='1914560'>buffers</span> <span m='1914920'>that</span>
  <span m='1915010'>sum</span> <span m='1915230'>to</span> <span m='1915370'>linear</span>
  <span m='1915640'>size,</span> <span m='1916060'>you</span> <span m='1916390'>essentially</span>
  <span m='1916720'>need</span> <span m='1916840'>to</span> <span m='1916960'>carve</span>
  <span m='1917290'>that</span> <span m='1917470'>tree,</span> <span m='1917770'>which</span>
  <span m='1917920'>you</span> <span m='1918040'>do</span> <span m='1918250'>by</span>
  <span m='1918610'>recursive</span> <span m='1920200'>carving</span> <span m='1920650'>of</span>
  <span m='1920770'>the</span> <span m='1920860'>tree.</span> <span m='1921670'>So</span>
  <span m='1921820'>that</span> <span m='1921940'>each</span> <span m='1922150'>of</span>
  <span m='1922210'>the</span> <span m='1922330'>trees</span> <span m='1922600'>has</span>
  <span m='1922720'>linear</span> <span m='1922990'>size.</span> <span m='1923260'>Then</span>
  <span m='1923380'>you</span> <span m='1923470'>apply</span> <span m='1923680'>the</span>
  <span m='1923770'>analysis</span> <span m='1924190'>to</span> <span m='1924280'>each</span>
  <span m='1924490'>of</span> <span m='1924550'>the</span> <span m='1924640'>trees</span>
  <span m='1924880'>separately.</span> </p><p><span m='1925420'>You</span> <span m='1925510'>store</span>
  <span m='1925720'>them</span> <span m='1925870'>consecutively,</span> <span m='1926530'>separately.</span>
  <span m='1928120'>Each</span> <span m='1928300'>of</span> <span m='1928390'>them</span>
  <span m='1928570'>has</span> <span m='1928900'>good</span> <span m='1929170'>optimal</span>
  <span m='1929500'>running</span> <span m='1929740'>time</span> <span m='1930040'>and</span>
  <span m='1930130'>then</span> <span m='1930280'>the</span> <span m='1930370'>combination</span>
  <span m='1930910'>does.</span> <span m='1931480'>That's</span> <span m='1931780'>the</span>
  <span m='1932080'>hand-wavy</span> <span m='1932590'>version</span> <span m='1933340'>of</span>
  <span m='1933490'>how</span> <span m='1933640'>to</span> <span m='1933730'>do</span>
  <span m='1933970'>actual</span> <span m='1935470'>range</span> <span m='1935800'>reporting</span>
  <span m='1936640'>with</span> <span m='1936910'>end</span> <span m='1937070'>points</span>
  <span m='1937380'>and end</span> <span m='1937560'>rectangles.</span> <span m='1938280'>If</span>
  <span m='1938350'>you're</span> <span m='1938440'>interested</span> <span m='1938740'>in</span>
  <span m='1938830'>the</span> <span m='1938920'>details,</span> <span m='1939820'>read</span>
  <span m='1939970'>the</span> <span m='1940060'>paper.</span> <span m='1940460'>It's</span>
  <span m='1940690'>just</span> <span m='1940870'>a</span> <span m='1940930'>little</span>
  <span m='1941140'>bit</span> <span m='1941290'>messy</span> <span m='1942640'>and</span>
  <span m='1943270'>especially</span> <span m='1943720'>when</span> <span m='1944050'>you</span>
  <span m='1944230'>don't</span> <span m='1944410'>know</span> <span m='1944620'>the</span>
  <span m='1944740'>analysis.</span> </p><p><span m='1946780'>I</span> <span m='1946900'>want</span>
  <span m='1947020'>to</span> <span m='1947080'>move</span> <span m='1947290'>on</span>
  <span m='1948040'>to</span> <span m='1948280'>online</span> <span m='1949480'>orthogonal</span>
  <span m='1949990'>2D</span> <span m='1950220'>range</span> <span m='1950460'>searching</span>
  <span m='1951400'>because</span> <span m='1951860'>it's</span> <span m='1954460'>the</span>
  <span m='1954580'>hardest</span> <span m='1955330'>and</span> <span m='1955810'>coolest</span>
  <span m='1958120'>of</span> <span m='1958240'>them</span> <span m='1958390'>all.</span>
  <span m='1958770'>Unless there</span> <span m='1958870'>are</span> <span m='1958930'>more</span>
  <span m='1959110'>questions.</span> <span m='1961126'>All right.</span> </p><p><span
  m='1964982'>AUDIENCE:</span> <span m='1965102'>So</span> <span m='1965222'>you</span>
  <span m='1965342'>do</span> <span m='1965464'>the range</span> <span m='1965946'>counting</span>
  <span m='1966428'>[INAUDIBLE]</span> <span m='1966910'>in detail,</span> <span m='1967392'>and</span>
  <span m='1967874'>[INAUDIBLE]</span> <span m='1968838'>to</span> <span m='1969320'>the</span>
  <span m='1969802'>[INAUDIBLE].</span> </p><p><span m='1972700'>ERIK DEMAINE:</span>
  <span m='1972827'>Exactly.</span> <span m='1973780'>At</span> <span m='1973930'>this</span>
  <span m='1974080'>point,</span> <span m='1974290'>if</span> <span m='1974440'>you</span>
  <span m='1974530'>believe</span> <span m='1974890'>in</span> <span m='1975010'>funnel</span>
  <span m='1975280'>sort,</span> <span m='1976090'>you</span> <span m='1976210'>should</span>
  <span m='1976360'>believe</span> <span m='1976840'>that</span> <span m='1977500'>range</span>
  <span m='1977860'>counting</span> <span m='1978610'>is</span> <span m='1978760'>easy</span>
  <span m='1979030'>to</span> <span m='1979180'>do,</span> <span m='1980260'>and</span>
  <span m='1980410'>I've</span> <span m='1980500'>just</span> <span m='1980800'>hand</span>
  <span m='1981000'>waved</span> <span m='1981190'>the</span> <span m='1981610'>range</span>
  <span m='1981910'>reporting</span> <span m='1982390'>part.</span> <span m='1984562'>Are</span>
  <span m='1984900'>you</span> <span m='1985030'>scribing?</span> <span m='1985285'>Is</span>
  <span m='1985540'>that</span> <span m='1985945'>why</span> <span m='1986350'>you</span>
  <span m='1986500'>ask?</span> <span m='1991080'>That's</span> <span m='1991420'>where</span>
  <span m='1991570'>we</span> <span m='1991690'>stand.</span> </p><p><span m='1994460'>The</span>
  <span m='1994510'>next</span> <span m='1994690'>thing</span> <span m='1994840'>we're</span>
  <span m='1994920'>going</span> <span m='1995000'>to</span> <span m='1995110'>do</span>
  <span m='1995260'>is</span> <span m='1995800'>regular</span> <span m='1996220'>range</span>
  <span m='1996490'>reporting,</span> <span m='1997450'>regular</span> <span m='1997840'>online</span>
  <span m='1998320'>stuff.</span> <span m='1999710'>So this</span> <span m='1999940'>is</span>
  <span m='2000120'>orthogonal</span> <span m='2002940'>2D</span> <span m='2003990'>range</span>
  <span m='2004290'>search.</span> <span m='2010110'>And</span> <span m='2010680'>we</span>
  <span m='2010860'>spent</span> <span m='2011130'>a</span> <span m='2011190'>couple</span>
  <span m='2011460'>of</span> <span m='2011520'>lectures</span> <span m='2011970'>on</span>
  <span m='2012240'>2D</span> <span m='2012720'>and</span> <span m='2012960'>3D</span>
  <span m='2013350'>range</span> <span m='2013590'>search.</span> <span m='2014520'>All</span>
  <span m='2014700'>this</span> <span m='2014850'>crazy</span> <span m='2015210'>stuff</span>
  <span m='2015600'>with</span> <span m='2017430'>fractional</span> <span m='2017850'>cascading,</span>
  <span m='2018450'>and</span> <span m='2018540'>so</span> <span m='2018720'>on,</span>
  <span m='2019380'>and</span> <span m='2019570'>the</span> <span m='2019680'>layered</span>
  <span m='2020360'>range</span> <span m='2020700'>trees.</span> </p><p><span m='2021720'>We're</span>
  <span m='2021920'>going</span> <span m='2022060'>to</span> <span m='2022110'>use</span>
  <span m='2022230'>some</span> <span m='2022470'>of</span> <span m='2022530'>those</span>
  <span m='2022680'>techniques</span> <span m='2023160'>that</span> <span m='2023310'>we</span>
  <span m='2024000'>built</span> <span m='2024240'>there,</span> <span m='2024450'>and</span>
  <span m='2024540'>in</span> <span m='2024630'>particular,</span> <span m='2025810'>you</span>
  <span m='2025910'>may</span> <span m='2025950'>recall</span> <span m='2027060'>there</span>
  <span m='2027180'>was</span> <span m='2027300'>this</span> <span m='2027480'>idea</span>
  <span m='2027900'>that</span> <span m='2028770'>if</span> <span m='2028950'>we</span>
  <span m='2029070'>have</span> <span m='2029400'>a</span> <span m='2029460'>bunch</span>
  <span m='2029790'>of</span> <span m='2030060'>points,</span> <span m='2031890'>regular</span>
  <span m='2032460'>2D</span> <span m='2032780'>range</span> <span m='2033050'>searching</span>
  <span m='2033330'>is</span> <span m='2033450'>I</span> <span m='2033540'>give</span>
  <span m='2033750'>you</span> <span m='2033930'>a</span> <span m='2034020'>rectangle,</span>
  <span m='2035010'>give</span> <span m='2035250'>me</span> <span m='2035370'>all</span>
  <span m='2035490'>the</span> <span m='2035580'>points</span> <span m='2035880'>in</span>
  <span m='2035970'>the</span> <span m='2036060'>rectangle.</span> <span m='2037260'>Fine.</span>
  <span m='2037740'>Our</span> <span m='2037890'>goal</span> <span m='2038190'>is</span>
  <span m='2038340'>to</span> <span m='2038550'>achieve</span> <span m='2039660'>log</span>
  <span m='2040410'>base</span> <span m='2040890'>B</span> <span m='2041180'>of</span>
  <span m='2041470'>N</span> <span m='2042900'>plus</span> <span m='2043740'>output</span>
  <span m='2044070'>size</span> <span m='2045220'>over</span> <span m='2045570'>B.</span>
  <span m='2046710'>That's</span> <span m='2046980'>the</span> <span m='2047100'>new</span>
  <span m='2047490'>optimal</span> <span m='2048030'>bound.</span> </p><p><span m='2048960'>This</span>
  <span m='2049110'>is</span> <span m='2049199'>how</span> <span m='2049380'>long</span>
  <span m='2049560'>it</span> <span m='2049620'>takes</span> <span m='2049830'>to</span>
  <span m='2049949'>do</span> <span m='2050159'>a regular</span> <span m='2050580'>search</span>
  <span m='2050969'>in</span> <span m='2051090'>one</span> <span m='2051330'>dimension.</span>
  <span m='2053550'>So</span> <span m='2054969'>if</span> <span m='2055110'>you</span>
  <span m='2055199'>have</span> <span m='2055320'>output</span> <span m='2055560'>size</span>
  <span m='2055920'>whatever--</span> <span m='2056659'>and</span> <span m='2056949'>we'll</span>
  <span m='2057120'>probably</span> <span m='2057420'>be</span> <span m='2057510'>able</span>
  <span m='2057659'>to</span> <span m='2057750'>do</span> <span m='2057900'>range</span>
  <span m='2058199'>counting,</span> <span m='2059030'>but</span> <span m='2059330'>I</span>
  <span m='2059429'>won't</span> <span m='2059580'>worry</span> <span m='2059730'>about</span>
  <span m='2059940'>it</span> <span m='2060030'>here.</span> <span m='2060210'>We'll</span>
  <span m='2060330'>just</span> <span m='2060659'>think</span> <span m='2060810'>about</span>
  <span m='2060960'>range</span> <span m='2061170'>reporting.</span> <span m='2061590'>If</span>
  <span m='2061650'>there's</span> <span m='2061800'>this</span> <span m='2061920'>many</span>
  <span m='2062130'>points,</span> <span m='2063330'>we'll</span> <span m='2063449'>output</span>
  <span m='2063659'>them</span> <span m='2063810'>all</span> <span m='2063989'>in</span>
  <span m='2064110'>that</span> <span m='2064230'>much</span> <span m='2064520'>over</span>
  <span m='2064719'>B.</span> </p><p><span m='2066330'>This</span> <span m='2066510'>is</span>
  <span m='2066659'>what</span> <span m='2067830'>we</span> <span m='2067949'>call</span>
  <span m='2068130'>a</span> <span m='2068159'>regular</span> <span m='2068760'>range</span>
  <span m='2069060'>search,</span> <span m='2069929'>but</span> <span m='2070110'>I'm</span>
  <span m='2070170'>going</span> <span m='2070320'>to</span> <span m='2070440'>distinguish</span>
  <span m='2070920'>it</span> <span m='2070980'>and</span> <span m='2071070'>call</span>
  <span m='2071250'>it</span> <span m='2071370'>a</span> <span m='2071520'>four</span>
  <span m='2071850'>sided</span> <span m='2072239'>range</span> <span m='2072719'>search</span>
  <span m='2073050'>because</span> <span m='2073949'>a</span> <span m='2074010'>rectangle</span>
  <span m='2074429'>has</span> <span m='2074850'>four</span> <span m='2075120'>sides.</span>
  <span m='2077489'>But</span> <span m='2077699'>you</span> <span m='2077850'>could</span>
  <span m='2077969'>think</span> <span m='2078210'>of</span> <span m='2078420'>the</span>
  <span m='2078540'>other</span> <span m='2078690'>versions</span> <span m='2079670'>and</span>
  <span m='2079800'>we</span> <span m='2079920'>actually</span> <span m='2080190'>did</span>
  <span m='2080400'>this</span> <span m='2080699'>when</span> <span m='2080880'>we</span>
  <span m='2081000'>were</span> <span m='2081090'>doing</span> <span m='2081330'>the</span>
  <span m='2081420'>3-D</span> <span m='2081929'>problem.</span> <span m='2083760'>So</span>
  <span m='2084030'>if</span> <span m='2084270'>these</span> <span m='2084510'>are</span>
  <span m='2085650'>two</span> <span m='2085889'>rays</span> <span m='2086550'>and</span>
  <span m='2086730'>an</span> <span m='2086820'>edge,</span> <span m='2087770'>this</span>
  <span m='2087960'>you</span> <span m='2088080'>might</span> <span m='2088290'>call</span>
  <span m='2088560'>a</span> <span m='2088710'>three</span> <span m='2088949'>sided</span>
  <span m='2089310'>rectangle,</span> <span m='2091530'>and</span> <span m='2091980'>you</span>
  <span m='2092100'>can</span> <span m='2092250'>go</span> <span m='2092460'>all</span>
  <span m='2092610'>the</span> <span m='2092699'>way</span> <span m='2092820'>down</span>
  <span m='2093120'>to</span> <span m='2093239'>two</span> <span m='2093480'>sides.</span>
  </p><p><span m='2094159'>Hard</span> <span m='2094380'>to</span> <span m='2094469'>go</span>
  <span m='2094620'>down</span> <span m='2094830'>to</span> <span m='2094980'>one</span>
  <span m='2095250'>side.</span> <span m='2098100'>Here's</span> <span m='2098490'>a</span>
  <span m='2098640'>two</span> <span m='2098850'>sided</span> <span m='2099210'>rectangle,</span>
  <span m='2099690'>it just</span> <span m='2099870'>has</span> <span m='2100050'>two</span>
  <span m='2100290'>rays.</span> <span m='2103150'>OK,</span> <span m='2103500'>as</span>
  <span m='2103630'>you</span> <span m='2103750'>might</span> <span m='2103930'>expect,</span>
  <span m='2104620'>this</span> <span m='2104920'>is</span> <span m='2105040'>easier</span>
  <span m='2106060'>than</span> <span m='2106210'>that.</span> <span m='2107530'>And</span>
  <span m='2107620'>if</span> <span m='2107740'>I</span> <span m='2107800'>recall,</span>
  <span m='2108160'>in</span> <span m='2108250'>3-D</span> <span m='2108880'>we</span>
  <span m='2109030'>ended</span> <span m='2109300'>up</span> <span m='2109450'>doing</span>
  <span m='2109780'>this</span> <span m='2110110'>thing</span> <span m='2110950'>in</span>
  <span m='2111310'>linear</span> <span m='2111760'>space</span> <span m='2112510'>with</span>
  <span m='2112660'>this</span> <span m='2112900'>fancy--</span> <span m='2114550'>first</span>
  <span m='2114910'>you</span> <span m='2115000'>do</span> <span m='2115120'>a</span>
  <span m='2115180'>search</span> <span m='2115480'>on</span> <span m='2115570'>the</span>
  <span m='2115660'>left</span> <span m='2116050'>coordinate</span> <span m='2116470'>and</span>
  <span m='2116620'>then</span> <span m='2116740'>you</span> <span m='2116800'>just</span>
  <span m='2117010'>walk.</span> </p><p><span m='2117970'>We'd</span> <span m='2118120'>subdivided</span>
  <span m='2119110'>with</span> <span m='2119290'>fractional</span> <span m='2119620'>cascading</span>
  <span m='2120220'>so</span> <span m='2120340'>that</span> <span m='2120490'>every</span>
  <span m='2120880'>face</span> <span m='2121330'>had</span> <span m='2121510'>constant</span>
  <span m='2121930'>size,</span> <span m='2123080'>and</span> <span m='2123130'>so</span>
  <span m='2123250'>you</span> <span m='2123340'>could</span> <span m='2123460'>just</span>
  <span m='2123580'>walk,</span> <span m='2124060'>and</span> <span m='2124210'>each</span>
  <span m='2124540'>step</span> <span m='2124870'>you'd</span> <span m='2124990'>report</span>
  <span m='2125410'>a</span> <span m='2125500'>new</span> <span m='2125650'>point.</span>
  <span m='2126400'>If you</span> <span m='2126490'>may</span> <span m='2126640'>recall</span>
  <span m='2127500'>for</span> <span m='2127630'>this</span> <span m='2127840'>kind</span>
  <span m='2128020'>of</span> <span m='2128110'>two</span> <span m='2128290'>sided</span>
  <span m='2128560'>thing.</span> <span m='2128760'>First,</span> <span m='2129040'>you
  would</span> <span m='2129220'>search</span> <span m='2129580'>for</span> <span
  m='2129700'>this,</span> <span m='2130040'>and</span> <span m='2130140'>then</span>
  <span m='2130240'>you would</span> <span m='2130340'>basically</span> <span m='2130540'>just</span>
  <span m='2130840'>follow</span> <span m='2131320'>this</span> <span m='2131500'>line</span>
  <span m='2132310'>until</span> <span m='2132610'>you</span> <span m='2132700'>found</span>
  <span m='2132970'>this</span> <span m='2133120'>point,</span> <span m='2134350'>this</span>
  <span m='2134530'>corner.</span> </p><p><span m='2137110'>This</span> <span m='2137320'>we</span>
  <span m='2137440'>could</span> <span m='2137560'>achieve</span> <span m='2137830'>in</span>
  <span m='2137980'>a</span> <span m='2138000'>linear</span> <span m='2138520'>space,</span>
  <span m='2140920'>logarithmic</span> <span m='2141520'>time.</span> <span m='2142750'>This</span>
  <span m='2142960'>one</span> <span m='2143230'>we</span> <span m='2143360'>needed</span>
  <span m='2144550'>N</span> <span m='2144760'>log</span> <span m='2145090'>N</span>
  <span m='2145300'>space.</span> <span m='2146200'>Actually,</span> <span m='2146530'>the</span>
  <span m='2146650'>best</span> <span m='2146950'>known</span> <span m='2147250'>is</span>
  <span m='2147380'>N</span> <span m='2147520'>log</span> <span m='2147890'>N</span>
  <span m='2148030'>divided</span> <span m='2148420'>by</span> <span m='2148570'>log</span>
  <span m='2148840'>log</span> <span m='2149080'>N.</span> <span m='2151660'>But we</span>
  <span m='2151750'>could</span> <span m='2151960'>N</span> <span m='2152110'>log</span>
  <span m='2152330'>N</span> <span m='2152470'>using</span> <span m='2152770'>range</span>
  <span m='2153040'>trees.</span> <span m='2154150'>And</span> <span m='2154870'>we</span>
  <span m='2155080'>got</span> <span m='2155320'>down</span> <span m='2155560'>to</span>
  <span m='2155680'>log</span> <span m='2156040'>N</span> <span m='2156190'>time</span>
  <span m='2156550'>using--</span> <span m='2158260'>log</span> <span m='2158560'>N
  query</span> <span m='2158920'>time</span> <span m='2159280'>and</span> <span m='2159460'>log</span>
  <span m='2159670'>N</span> <span m='2159790'>space</span> <span m='2160540'>using</span>
  <span m='2160840'>layered</span> <span m='2161110'>range</span> <span m='2161380'>trees.</span>
  <span m='2163390'>That</span> <span m='2163540'>was the</span> <span m='2163660'>internal</span>
  <span m='2164050'>memory</span> <span m='2164380'>regular</span> <span m='2165310'>algorithms.</span>
  </p><p><span m='2165910'>AUDIENCE:</span> <span m='2166061'>Aren't</span> <span
  m='2166212'>you</span> <span m='2166364'>missing an</span> <span m='2166818'>M/B</span>
  <span m='2167272'>though?</span> </p><p><span m='2169090'>ERIK DEMAINE:</span> <span
  m='2169175'>Am</span> <span m='2169260'>I</span> <span m='2169360'>missing</span>
  <span m='2169760'>an</span> <span m='2170130'>M/B?</span> <span m='2170460'>No,</span>
  <span m='2170620'>this</span> <span m='2170830'>is</span> <span m='2171010'>log</span>
  <span m='2171340'>base</span> <span m='2171580'>B</span> <span m='2171960'>of</span>
  <span m='2172170'>N,</span> <span m='2172420'>not</span> <span m='2172780'>log</span>
  <span m='2173020'>base</span> <span m='2173230'>M/B</span> <span m='2173830'>of</span>
  <span m='2173950'>N.</span> <span m='2174670'>Yeah,</span> <span m='2174920'>it's</span>
  <span m='2175000'>good</span> <span m='2175180'>to</span> <span m='2175270'>ask.</span>
  <span m='2175870'>When</span> <span m='2176050'>we're</span> <span m='2176200'>sorting</span>
  <span m='2178180'>this</span> <span m='2178360'>kind</span> <span m='2178570'>of</span>
  <span m='2178660'>thing,</span> <span m='2178930'>we</span> <span m='2179050'>get</span>
  <span m='2179230'>log</span> <span m='2179470'>base</span> <span m='2179680'>M/B,</span>
  <span m='2181720'>but</span> <span m='2181930'>when</span> <span m='2182110'>you're</span>
  <span m='2182260'>searching,</span> <span m='2182890'>the</span> <span m='2182980'>best</span>
  <span m='2183250'>you</span> <span m='2183340'>can</span> <span m='2183460'>do</span>
  <span m='2183550'>is</span> <span m='2183640'>log</span> <span m='2183880'>base</span>
  <span m='2184120'>B.</span> <span m='2184480'>We</span> <span m='2184570'>actually</span>
  <span m='2184840'>proved</span> <span m='2185050'>a</span> <span m='2185110'>lower</span>
  <span m='2185340'>bound</span> <span m='2185560'>about</span> <span m='2185770'>this</span>
  <span m='2186010'>in</span> <span m='2186100'>the</span> <span m='2186220'>first</span>
  <span m='2186730'>memory</span> <span m='2187030'>hierarchy</span> <span m='2187360'>lecture.</span>
  </p><p><span m='2191740'>Because</span> <span m='2191980'>this</span> <span m='2192100'>is</span>
  <span m='2192230'>online,</span> <span m='2192910'>you</span> <span m='2193060'>read</span>
  <span m='2193270'>it</span> <span m='2193390'>in</span> <span m='2193480'>a</span>
  <span m='2193510'>block.</span> <span m='2193900'>You</span> <span m='2194020'>can</span>
  <span m='2194140'>only</span> <span m='2194440'>learn</span> <span m='2194680'>where</span>
  <span m='2194830'>you</span> <span m='2194980'>fit</span> <span m='2195190'>among</span>
  <span m='2195460'>B</span> <span m='2195640'>items.</span> <span m='2196260'>And</span>
  <span m='2196390'>so</span> <span m='2196540'>the</span> <span m='2196660'>best</span>
  <span m='2196990'>you</span> <span m='2197050'>can</span> <span m='2197200'>hope</span>
  <span m='2197350'>to</span> <span m='2197440'>achieve</span> <span m='2197740'>is</span>
  <span m='2197830'>log</span> <span m='2198040'>base</span> <span m='2198210'>B</span>
  <span m='2198350'>of</span> <span m='2198450'>N</span> <span m='2199030'>for</span>
  <span m='2199210'>search</span> <span m='2199540'>in</span> <span m='2199630'>one</span>
  <span m='2199810'>dimension.</span> <span m='2200680'>So</span> <span m='2200860'>this</span>
  <span m='2201040'>is</span> <span m='2201160'>a</span> <span m='2201190'>lower</span>
  <span m='2201430'>bound</span> <span m='2201670'>for</span> <span m='2201790'>search.</span>
  <span m='2203170'>When</span> <span m='2203290'>you're</span> <span m='2203380'>doing</span>
  <span m='2203590'>batch</span> <span m='2203920'>operations,</span> <span m='2204490'>then</span>
  <span m='2204700'>you</span> <span m='2204820'>can</span> <span m='2204940'>hope</span>
  <span m='2205150'>to</span> <span m='2205240'>achieve</span> <span m='2205570'>this</span>
  <span m='2205750'>stuff,</span> <span m='2206950'>which</span> <span m='2207100'>is</span>
  <span m='2207190'>a</span> <span m='2207250'>lot</span> <span m='2207400'>faster.</span>
  <span m='2208350'>Then</span> <span m='2208640'>it's</span> <span m='2208750'>like</span>
  <span m='2208900'>1/B</span> <span m='2209420'>times</span> <span m='2209830'>log</span>
  <span m='2210050'>base</span> <span m='2210160'>M/B</span> <span m='2210370'>of</span>
  <span m='2210760'>M/B.</span> </p><p><span m='2212770'>OK,</span> <span m='2213400'>so</span>
  <span m='2213530'>in</span> <span m='2213570'>a</span> <span m='2213610'>certain</span>
  <span m='2213850'>sense,</span> <span m='2214090'>this</span> <span m='2214240'>is</span>
  <span m='2214300'>slower</span> <span m='2214720'>than</span> <span m='2214870'>the</span>
  <span m='2214930'>batched</span> <span m='2215240'>operations,</span> <span m='2215810'>but</span>
  <span m='2215860'>it's</span> <span m='2215980'>more</span> <span m='2216190'>online.</span>
  <span m='2216580'>So</span> <span m='2216730'>it's</span> <span m='2216850'>a</span>
  <span m='2216930'>trade-off.</span> <span m='2226080'>So</span> <span m='2226880'>for</span>
  <span m='2227060'>all</span> <span m='2227330'>these</span> <span m='2227510'>problems</span>
  <span m='2227930'>we</span> <span m='2228050'>can</span> <span m='2228170'>achieve</span>
  <span m='2228560'>log</span> <span m='2228810'>base</span> <span m='2229130'>B of</span>
  <span m='2229400'>N</span> <span m='2229790'>plus</span> <span m='2229970'>[? out
  ?]</span> <span m='2230140'>over B.</span> <span m='2230900'>The</span> <span m='2231260'>issue</span>
  <span m='2231560'>is</span> <span m='2231650'>with</span> <span m='2231770'>space.</span>
  <span m='2237980'>Maybe</span> <span m='2238340'>I'll</span> <span m='2238430'>do</span>
  <span m='2239440'>sort</span> <span m='2239630'>of</span> <span m='2240620'>regular</span>
  <span m='2241250'>RAM</span> <span m='2241670'>algorithms</span> <span m='2243470'>versus</span>
  <span m='2244910'>cache</span> <span m='2245240'>oblivious.</span> </p><p><span
  m='2250040'>So</span> <span m='2250430'>we've</span> <span m='2250550'>got</span>
  <span m='2250790'>two</span> <span m='2250970'>sided,</span> <span m='2251780'>three</span>
  <span m='2251990'>sided,</span> <span m='2252740'>four</span> <span m='2253040'>sided.</span>
  <span m='2254330'>And</span> <span m='2254810'>for</span> <span m='2254930'>two</span>
  <span m='2255140'>sided,</span> <span m='2261590'>I believe</span> <span m='2261890'>these
  are</span> <span m='2261980'>the</span> <span m='2262100'>right</span> <span m='2262340'>answers.</span>
  <span m='2264440'>Log</span> <span m='2264830'>N</span> <span m='2265040'>over</span>
  <span m='2265470'>log</span> <span m='2265520'>log</span> <span m='2265880'>N.</span>
  <span m='2268940'>But we</span> <span m='2269090'>haven't</span> <span m='2269330'>actually</span>
  <span m='2269600'>seen</span> <span m='2269810'>this</span> <span m='2270020'>one.</span>
  <span m='2275900'>And</span> <span m='2276350'>cache</span> <span m='2276650'>oblivious,</span>
  <span m='2278750'>here's</span> <span m='2278880'>what</span> <span m='2279020'>we
  can</span> <span m='2279200'>do.</span> <span m='2280310'>This</span> <span m='2280460'>is</span>
  <span m='2280520'>with</span> <span m='2280730'>optimal</span> <span m='2281270'>query</span>
  <span m='2281570'>times</span> <span m='2284050'>and</span> <span m='2284140'>this</span>
  <span m='2284230'>is</span> <span m='2284330'>all</span> <span m='2284480'>static.</span>
  </p><p><span m='2292270'>OK,</span> <span m='2292480'>and if</span> <span m='2292570'>there's</span>
  <span m='2292750'>time,</span> <span m='2293050'>I'll</span> <span m='2293170'>cover</span>
  <span m='2293470'>all</span> <span m='2293680'>of</span> <span m='2293770'>these.</span>
  <span m='2295450'>So</span> <span m='2295630'>they're</span> <span m='2295750'>not</span>
  <span m='2296650'>perfect.</span> <span m='2297130'>These</span> <span m='2297400'>two</span>
  <span m='2297800'>were</span> <span m='2297940'>off</span> <span m='2298180'>by</span>
  <span m='2298340'>a</span> <span m='2298360'>log</span> <span m='2298600'>factor,</span>
  <span m='2300130'>but</span> <span m='2300670'>not</span> <span m='2300820'>bad.</span>
  <span m='2301960'>Pretty</span> <span m='2302170'>good</span> <span m='2302710'>orthogonal</span>
  <span m='2303280'>2D</span> <span m='2304150'>range</span> <span m='2304360'>queries.</span>
  <span m='2304780'>And</span> <span m='2305020'>really,</span> <span m='2305290'>the</span>
  <span m='2305410'>coolest</span> <span m='2305890'>one</span> <span m='2306610'>is</span>
  <span m='2306760'>this</span> <span m='2306970'>one.</span> <span m='2307930'>This</span>
  <span m='2308140'>one</span> <span m='2308410'>blows</span> <span m='2308740'>my</span>
  <span m='2308890'>mind</span> <span m='2310300'>every</span> <span m='2310480'>time</span>
  <span m='2310750'>I</span> <span m='2310870'>see</span> <span m='2311140'>it.</span>
  <span m='2311780'>So</span> <span m='2312000'>let's</span> <span m='2312180'>do</span>
  <span m='2312270'>it.</span> </p><p><span m='2316600'>We'll</span> <span m='2316720'>start</span>
  <span m='2316990'>with</span> <span m='2317140'>two</span> <span m='2317290'>sided</span>
  <span m='2317740'>and</span> <span m='2317860'>then</span> <span m='2318060'>we</span>
  <span m='2318700'>have</span> <span m='2318850'>existing</span> <span m='2319300'>techniques</span>
  <span m='2319850'>once</span> <span m='2319960'>you</span> <span m='2320080'>have</span>
  <span m='2320260'>two</span> <span m='2320410'>sided</span> <span m='2320860'>to</span>
  <span m='2321730'>add</span> <span m='2322000'>on</span> <span m='2322660'>more</span>
  <span m='2322810'>sides,</span> <span m='2323800'>you</span> <span m='2323920'>may</span>
  <span m='2324070'>recall</span> <span m='2324430'>from</span> <span m='2324580'>the</span>
  <span m='2324670'>3D</span> <span m='2325630'>range</span> <span m='2325870'>searching</span>
  <span m='2326200'>lecture.</span> <span m='2326770'>So</span> <span m='2326920'>we're</span>
  <span m='2326990'>going</span> <span m='2327090'>to</span> <span m='2327190'>use</span>
  <span m='2327520'>those</span> <span m='2327730'>techniques</span> <span m='2328840'>and</span>
  <span m='2329170'>refine</span> <span m='2329590'>them</span> <span m='2329680'>a</span>
  <span m='2329740'>little</span> <span m='2329950'>bit</span> <span m='2331540'>to</span>
  <span m='2331660'>get</span> <span m='2331810'>that</span> <span m='2331960'>log</span>
  <span m='2332260'>log</span> <span m='2332500'>factor.</span> </p><p><span m='2335110'>But</span>
  <span m='2335200'>you</span> <span m='2335290'>may</span> <span m='2335410'>recall</span>
  <span m='2336550'>way</span> <span m='2336700'>back</span> <span m='2336970'>when,</span>
  <span m='2338100'>at</span> <span m='2338260'>lecture</span> <span m='2338950'>six</span>
  <span m='2339400'>or</span> <span m='2339490'>so,</span> <span m='2340780'>that</span>
  <span m='2341230'>we</span> <span m='2341410'>had</span> <span m='2341620'>a</span>
  <span m='2341680'>technique.</span> <span m='2342070'>Once</span> <span m='2342280'>it</span>
  <span m='2342350'>was</span> <span m='2342490'>two</span> <span m='2342670'>sided,</span>
  <span m='2343210'>every</span> <span m='2343480'>time</span> <span m='2343720'>we</span>
  <span m='2343840'>added</span> <span m='2344140'>a</span> <span m='2344200'>log</span>
  <span m='2344500'>factor</span> <span m='2344850'>in</span> <span m='2344930'>space,</span>
  <span m='2345280'>we</span> <span m='2345370'>could</span> <span m='2345490'>add</span>
  <span m='2345700'>another</span> <span m='2346030'>side.</span> <span m='2348130'>The</span>
  <span m='2348220'>hard</span> <span m='2348370'>part</span> <span m='2348550'>was</span>
  <span m='2348670'>getting</span> <span m='2348910'>up</span> <span m='2349030'>the</span>
  <span m='2349120'>number</span> <span m='2349330'>of</span> <span m='2349390'>dimensions.</span>
  <span m='2349900'>Then</span> <span m='2350020'>the</span> <span m='2350110'>easy</span>
  <span m='2350410'>part</span> <span m='2350650'>was</span> <span m='2351940'>turning</span>
  <span m='2352510'>half</span> <span m='2352900'>infinite</span> <span m='2354370'>intervals</span>
  <span m='2354820'>into</span> <span m='2355030'>regular</span> <span m='2355390'>intervals.</span>
  </p><p><span m='2356990'>So</span> <span m='2357460'>once</span> <span m='2357730'>we</span>
  <span m='2357820'>have</span> <span m='2358060'>this,</span> <span m='2358390'>it's</span>
  <span m='2358510'>easy</span> <span m='2358750'>to</span> <span m='2358840'>add</span>
  <span m='2359050'>a</span> <span m='2359170'>log,</span> <span m='2359530'>add</span>
  <span m='2359710'>another</span> <span m='2360010'>log.</span> <span m='2361300'>With</span>
  <span m='2361510'>a</span> <span m='2361570'>bit</span> <span m='2361750'>of</span>
  <span m='2361810'>sophistication,</span> <span m='2362470'>we</span> <span m='2362560'>can</span>
  <span m='2362920'>save</span> <span m='2363250'>a</span> <span m='2363280'>log</span>
  <span m='2363550'>log</span> <span m='2363730'>factor.</span> <span m='2365896'>OK,</span>
  <span m='2366340'>but</span> <span m='2366460'>let's</span> <span m='2366880'>do</span>
  <span m='2368200'>two</span> <span m='2368410'>sided.</span> <span m='2368930'>This</span>
  <span m='2369040'>will</span> <span m='2369130'>be</span> <span m='2369370'>the</span>
  <span m='2369520'>bulk</span> <span m='2369880'>of</span> <span m='2370900'>the</span>
  <span m='2370990'>lecture.</span> <span m='2376630'>This</span> <span m='2376900'>is</span>
  <span m='2377020'>a</span> <span m='2377110'>paper</span> <span m='2377440'>by</span>
  <span m='2378610'>[? Harga ?]</span> <span m='2379000'>and</span> <span m='2379180'>[?
  Zey ?]</span> <span m='2380100'>in</span> <span m='2380230'>2006.</span> <span m='2384420'>All
  right,</span> <span m='2384760'>so</span> <span m='2384970'>we</span> <span m='2385120'>want</span>
  <span m='2385360'>to</span> <span m='2385450'>do--</span> <span m='2386170'>I'm</span>
  <span m='2386230'>going</span> <span m='2386350'>to</span> <span m='2386410'>assume</span>
  <span m='2386830'>that</span> <span m='2386980'>they</span> <span m='2387160'>are</span>
  <span m='2388180'>this</span> <span m='2388390'>kind</span> <span m='2388630'>of</span>
  <span m='2388750'>quarter</span> <span m='2389050'>plain</span> <span m='2389380'>query.</span>
  </p><p><span m='2389770'>So</span> <span m='2390580'>less</span> <span m='2390970'>than</span>
  <span m='2391120'>or</span> <span m='2391210'>equal</span> <span m='2391510'>to</span>
  <span m='2391600'>x,</span> <span m='2393200'>less</span> <span m='2393580'>than</span>
  <span m='2393760'>or</span> <span m='2393940'>equal</span> <span m='2394270'>to</span>
  <span m='2396460'>some</span> <span m='2396730'>y-coordinate.</span> <span m='2398210'>We</span>
  <span m='2398260'>want</span> <span m='2398440'>to</span> <span m='2398500'>know</span>
  <span m='2398770'>all</span> <span m='2399010'>the</span> <span m='2399100'>points</span>
  <span m='2400240'>in</span> <span m='2400420'>that</span> <span m='2400690'>quarter</span>
  <span m='2400990'>plane.</span> <span m='2403390'>So</span> <span m='2404650'>here's</span>
  <span m='2404890'>what</span> <span m='2405040'>we're</span> <span m='2405100'>going</span>
  <span m='2405210'>to</span> <span m='2405310'>do.</span> <span m='2407800'>It's</span>
  <span m='2408010'>all</span> <span m='2408160'>static.</span> <span m='2409960'>We're</span>
  <span m='2410060'>going</span> <span m='2410140'>to</span> <span m='2410260'>have</span>
  <span m='2410500'>a</span> <span m='2410740'>Van Emde Boas</span> <span m='2411310'>layout.</span>
  <span m='2412540'>So</span> <span m='2413800'>a</span> <span m='2413830'>binary</span>
  <span m='2414220'>tree</span> <span m='2416890'>on</span> <span m='2418600'>the</span>
  <span m='2418750'>y-coordinate.</span> </p><p><span m='2421100'>So</span> <span
  m='2421180'>this</span> <span m='2421390'>just</span> <span m='2421570'>stores</span>
  <span m='2421930'>all</span> <span m='2422170'>the</span> <span m='2422290'>points</span>
  <span m='2422830'>sorted</span> <span m='2423220'>by</span> <span m='2423450'>y.</span>
  <span m='2426280'>So</span> <span m='2428180'>if</span> <span m='2428420'>you</span>
  <span m='2428510'>want</span> <span m='2428660'>to</span> <span m='2428720'>do</span>
  <span m='2428810'>this</span> <span m='2428990'>query,</span> <span m='2429670'>use</span>
  <span m='2429820'>search</span> <span m='2430250'>for</span> <span m='2430400'>that</span>
  <span m='2430670'>value</span> <span m='2431030'>of</span> <span m='2431120'>y,</span>
  <span m='2432750'>then</span> <span m='2433130'>each</span> <span m='2433370'>of</span>
  <span m='2433460'>these</span> <span m='2434750'>positions</span> <span m='2436630'>in</span>
  <span m='2437130'>between</span> <span m='2437600'>two</span> <span m='2438440'>keys</span>
  <span m='2438740'>in</span> <span m='2438830'>here</span> <span m='2439520'>has</span>
  <span m='2439670'>a</span> <span m='2439730'>pointer</span> <span m='2441500'>to</span>
  <span m='2441980'>an</span> <span m='2442100'>array.</span> <span m='2445370'>The</span>
  <span m='2445520'>array</span> <span m='2445910'>is</span> <span m='2446030'>not</span>
  <span m='2446210'>sorted</span> <span m='2446480'>by</span> <span m='2446660'>x</span>
  <span m='2446990'>or</span> <span m='2447110'>y,</span> <span m='2447620'>it's</span>
  <span m='2447830'>a</span> <span m='2448640'>very</span> <span m='2448910'>weird</span>
  <span m='2449240'>thing.</span> <span m='2452450'>And</span> <span m='2452570'>then</span>
  <span m='2452720'>here's</span> <span m='2452960'>the</span> <span m='2453110'>algorithm</span>
  <span m='2453530'>you</span> <span m='2453620'>follow.</span> </p><p><span m='2455330'>You</span>
  <span m='2455750'>follow</span> <span m='2456080'>this</span> <span m='2456260'>pointer,</span>
  <span m='2456890'>you</span> <span m='2457010'>go</span> <span m='2457190'>here,</span>
  <span m='2457730'>you</span> <span m='2457850'>walk</span> <span m='2458240'>to</span>
  <span m='2458360'>the</span> <span m='2458480'>right</span> <span m='2459920'>until</span>
  <span m='2460340'>you</span> <span m='2460520'>find</span> <span m='2461000'>a</span>
  <span m='2461060'>point</span> <span m='2462560'>whose</span> <span m='2463370'>x-coordinate</span>
  <span m='2464090'>is</span> <span m='2464270'>too</span> <span m='2464480'>big.</span>
  <span m='2467285'>It's</span> <span m='2467780'>bigger</span> <span m='2468170'>than</span>
  <span m='2468610'>x.</span> <span m='2469080'>I</span> <span m='2469170'>should</span>
  <span m='2469280'>probably</span> <span m='2469520'>call</span> <span m='2469700'>this</span>
  <span m='2470360'>x2,</span> <span m='2471110'>y2.</span> <span m='2472870'>So</span>
  <span m='2473060'>first</span> <span m='2473390'>you</span> <span m='2473480'>search</span>
  <span m='2473840'>for a</span> <span m='2474140'>y2</span> <span m='2474710'>here,</span>
  <span m='2477000'>in</span> <span m='2477170'>this</span> <span m='2477590'>thing</span>
  <span m='2477890'>keyed</span> <span m='2478160'>by</span> <span m='2478340'>y.</span>
  <span m='2479390'>Follow</span> <span m='2479580'>the</span> <span m='2479690'>pointer.</span>
  <span m='2480430'>You</span> <span m='2480920'>look</span> <span m='2481190'>at</span>
  <span m='2481280'>all</span> <span m='2481520'>the</span> <span m='2481610'>points</span>
  <span m='2482420'>that</span> <span m='2482540'>have</span> <span m='2482780'>x-coordinate</span>
  <span m='2483435'>less</span> <span m='2483820'>than or</span> <span m='2484190'>equal</span>
  <span m='2484580'>to</span> <span m='2484850'>x2.</span> <span m='2485270'>Those</span>
  <span m='2485450'>are</span> <span m='2485480'>the</span> <span m='2485570'>ones</span>
  <span m='2485750'>you</span> <span m='2485840'>want.</span> </p><p><span m='2486600'>Once</span>
  <span m='2486710'>you</span> <span m='2486800'>find</span> <span m='2487010'>a</span>
  <span m='2487070'>point</span> <span m='2487340'>whose</span> <span m='2487490'>x-coordinate</span>
  <span m='2487970'>is</span> <span m='2488180'>bigger</span> <span m='2488450'>than</span>
  <span m='2488590'>x2,</span> <span m='2489290'>you</span> <span m='2489410'>stop,</span>
  <span m='2490370'>and</span> <span m='2490490'>then</span> <span m='2490640'>you</span>
  <span m='2490730'>report</span> <span m='2491300'>these</span> <span m='2491600'>points.</span>
  <span m='2493410'>It's</span> <span m='2493550'>not</span> <span m='2493700'>quite</span>
  <span m='2494000'>so</span> <span m='2494150'>simple</span> <span m='2494510'>because</span>
  <span m='2494960'>some</span> <span m='2495260'>of</span> <span m='2495320'>these</span>
  <span m='2495440'>points</span> <span m='2495830'>might</span> <span m='2496100'>be</span>
  <span m='2496520'>duplicates.</span> <span m='2497630'>You</span> <span m='2497690'>have</span>
  <span m='2497780'>to</span> <span m='2497870'>remove</span> <span m='2498200'>duplicates.</span>
  <span m='2499400'>That</span> <span m='2499640'>is</span> <span m='2499880'>your</span>
  <span m='2500030'>answer.</span> <span m='2506170'>To</span> <span m='2506290'>me,</span>
  <span m='2506830'>this</span> <span m='2507070'>is</span> <span m='2507220'>an</span>
  <span m='2507340'>insane</span> <span m='2508060'>idea.</span> <span m='2509410'>I</span>
  <span m='2509530'>would</span> <span m='2509740'>never</span> <span m='2510130'>imagine</span>
  <span m='2510520'>this</span> <span m='2510670'>to</span> <span m='2510790'>work.</span>
  </p><p><span m='2511930'>But</span> <span m='2512590'>the</span> <span m='2512650'>claim</span>
  <span m='2513010'>is</span> <span m='2513820'>you</span> <span m='2514000'>can</span>
  <span m='2514150'>make</span> <span m='2514330'>this</span> <span m='2514500'>array</span>
  <span m='2514870'>have</span> <span m='2515110'>linear</span> <span m='2515590'>size.</span>
  <span m='2516730'>That's</span> <span m='2517000'>the</span> <span m='2517120'>hard</span>
  <span m='2517330'>part.</span> <span m='2519520'>Make</span> <span m='2519820'>this,</span>
  <span m='2520690'>the</span> <span m='2520780'>amount</span> <span m='2521020'>of</span>
  <span m='2521140'>stuff</span> <span m='2521500'>that</span> <span m='2521620'>you</span>
  <span m='2521710'>have</span> <span m='2521860'>to</span> <span m='2521950'>traverse</span>
  <span m='2522430'>here,</span> <span m='2523210'>be</span> <span m='2523390'>linear</span>
  <span m='2524050'>in</span> <span m='2526240'>out</span> <span m='2527210'>in</span>
  <span m='2527470'>the</span> <span m='2527560'>number</span> <span m='2527830'>of</span>
  <span m='2527890'>points</span> <span m='2528370'>that</span> <span m='2528490'>are</span>
  <span m='2528550'>actually</span> <span m='2528970'>in</span> <span m='2529180'>this</span>
  <span m='2529840'>range.</span> <span m='2532400'>You</span> <span m='2532720'>are</span>
  <span m='2532840'>going</span> <span m='2532960'>to</span> <span m='2533050'>do</span>
  <span m='2533140'>a</span> <span m='2533170'>little</span> <span m='2533380'>bit</span>
  <span m='2533890'>more</span> <span m='2534100'>work</span> <span m='2534340'>because</span>
  <span m='2534580'>there</span> <span m='2534670'>are</span> <span m='2534730'>duplicates</span>
  <span m='2535180'>in</span> <span m='2535330'>here,</span> <span m='2536050'>but</span>
  <span m='2536290'>only</span> <span m='2536620'>a</span> <span m='2536650'>constant</span>
  <span m='2537070'>factor of</span> <span m='2537400'>more</span> <span m='2537610'>work.</span>
  </p><p><span m='2538780'>And</span> <span m='2538930'>yet</span> <span m='2539170'>somehow,</span>
  <span m='2539920'>you've</span> <span m='2540100'>taken</span> <span m='2540400'>this</span>
  <span m='2540520'>two</span> <span m='2540700'>dimensional</span> <span m='2541060'>problem</span>
  <span m='2541360'>and</span> <span m='2541450'>squashed</span> <span m='2541900'>it</span>
  <span m='2541990'>onto</span> <span m='2542230'>a</span> <span m='2542290'>line.</span>
  <span m='2543790'>You</span> <span m='2543910'>did</span> <span m='2544120'>one</span>
  <span m='2544390'>search</span> <span m='2544660'>at</span> <span m='2544720'>the</span>
  <span m='2544810'>beginning,</span> <span m='2545270'>which</span> <span m='2545290'>costs</span>
  <span m='2545590'>you</span> <span m='2545680'>log</span> <span m='2545890'>base</span>
  <span m='2546130'>B</span> <span m='2546220'>of N,</span> <span m='2546490'>then</span>
  <span m='2546670'>you</span> <span m='2546760'>do</span> <span m='2546880'>this</span>
  <span m='2547030'>linear</span> <span m='2547390'>scan,</span> <span m='2548650'>and</span>
  <span m='2548950'>you</span> <span m='2549040'>get</span> <span m='2549190'>the</span>
  <span m='2549280'>right</span> <span m='2549460'>answer,</span> <span m='2549790'>magically.</span>
  <span m='2553300'>I</span> <span m='2553450'>don't</span> <span m='2553570'>know</span>
  <span m='2553690'>how</span> <span m='2554190'>they</span> <span m='2554290'>thought</span>
  <span m='2554530'>this</span> <span m='2554710'>would</span> <span m='2554860'>be</span>
  <span m='2554950'>possible,</span> <span m='2556120'>but</span> <span m='2556300'>magically,</span>
  <span m='2556810'>it</span> <span m='2556900'>turns</span> <span m='2557140'>out</span>
  <span m='2557290'>it</span> <span m='2557380'>is</span> <span m='2557500'>possible.</span>
  <span m='2558850'>It</span> <span m='2559000'>was</span> <span m='2559090'>kind</span>
  <span m='2559240'>of</span> <span m='2559330'>a</span> <span m='2559390'>breakthrough</span>
  <span m='2559990'>in</span> <span m='2561250'>cache</span> <span m='2561580'>oblivious</span>
  <span m='2562750'>range</span> <span m='2563020'>searching.</span> </p><p><span
  m='2563890'>It</span> <span m='2563950'>was</span> <span m='2564070'>known</span>
  <span m='2564310'>how</span> <span m='2564400'>to</span> <span m='2564520'>do</span>
  <span m='2564640'>this</span> <span m='2564870'>for</span> <span m='2564990'>external</span>
  <span m='2565390'>memory</span> <span m='2566920'>a</span> <span m='2566980'>lot</span>
  <span m='2567160'>easier.</span> <span m='2570680'>For</span> <span m='2570760'>example,</span>
  <span m='2571250'>you</span> <span m='2571270'>can</span> <span m='2571450'>do</span>
  <span m='2571600'>it</span> <span m='2571690'>with</span> <span m='2572230'>persistence,</span>
  <span m='2574950'>but</span> <span m='2576360'>this</span> <span m='2576540'>is</span>
  <span m='2576660'>a</span> <span m='2576720'>much</span> <span m='2576960'>cooler</span>
  <span m='2577320'>way</span> <span m='2577530'>to</span> <span m='2577955'>do</span>
  <span m='2578380'>two sided</span> <span m='2578760'>range</span> <span m='2578970'>queries.</span>
  <span m='2580050'>All</span> <span m='2580140'>right,</span> <span m='2580950'>so</span>
  <span m='2581160'>I've</span> <span m='2581310'>explained</span> <span m='2581730'>the</span>
  <span m='2581850'>query</span> <span m='2582320'>algorithm.</span> <span m='2587180'>The</span>
  <span m='2587240'>big</span> <span m='2587420'>thing</span> <span m='2587570'>I</span>
  <span m='2587660'>haven't</span> <span m='2588110'>explained</span> <span m='2588500'>is</span>
  <span m='2588590'>how</span> <span m='2588800'>to</span> <span m='2588890'>build</span>
  <span m='2589100'>this</span> <span m='2589280'>array.</span> </p><p><span m='2595600'>Maybe</span>
  <span m='2595780'>I'll</span> <span m='2595870'>write</span> <span m='2596020'>down</span>
  <span m='2596230'>the</span> <span m='2596320'>things</span> <span m='2596560'>we</span>
  <span m='2596650'>need</span> <span m='2596800'>to</span> <span m='2596890'>prove</span>
  <span m='2597280'>as</span> <span m='2597400'>well</span> <span m='2598430'>before</span>
  <span m='2598600'>we</span> <span m='2598690'>get</span> <span m='2598870'>there,</span>
  <span m='2599780'>so</span> <span m='2599800'>you</span> <span m='2599860'>can</span>
  <span m='2600010'>think</span> <span m='2600190'>about</span> <span m='2600490'>them</span>
  <span m='2600670'>as</span> <span m='2600910'>we're</span> <span m='2601000'>writing</span>
  <span m='2601270'>down</span> <span m='2601450'>the</span> <span m='2601570'>algorithm.</span>
  <span m='2603460'>First</span> <span m='2603730'>claim</span> <span m='2604150'>is</span>
  <span m='2604420'>that</span> <span m='2604530'>this</span> <span m='2604810'>algorithm,</span>
  <span m='2605320'>which</span> <span m='2605500'>just</span> <span m='2605980'>decides</span>
  <span m='2606460'>to</span> <span m='2606580'>stop</span> <span m='2607030'>whenever</span>
  <span m='2607330'>it</span> <span m='2607390'>gets</span> <span m='2607540'>an</span>
  <span m='2607630'>x-coordinate</span> <span m='2607810'>that</span> <span m='2608140'>is</span>
  <span m='2608380'>too</span> <span m='2608530'>big,</span> <span m='2609250'>actually</span>
  <span m='2609730'>finds</span> <span m='2610090'>the</span> <span m='2610180'>right</span>
  <span m='2610390'>answer.</span> <span m='2611230'>It</span> <span m='2611650'>Finds</span>
  <span m='2612100'>all</span> <span m='2612370'>points</span> <span m='2614500'>in</span>
  <span m='2615850'>the</span> <span m='2615940'>range</span> <span m='2616360'>that</span>
  <span m='2616480'>we</span> <span m='2616570'>care</span> <span m='2616780'>about.</span>
  </p><p><span m='2620710'>The second</span> <span m='2621100'>thing</span> <span
  m='2621550'>is</span> <span m='2621940'>that</span> <span m='2623530'>the</span>
  <span m='2623620'>number</span> <span m='2623980'>of</span> <span m='2624220'>scanned</span>
  <span m='2624760'>points,</span> <span m='2625210'>the</span> <span m='2625330'>length</span>
  <span m='2625720'>of</span> <span m='2625840'>that</span> <span m='2626620'>step</span>
  <span m='2627010'>here,</span> <span m='2631790'>is</span> <span m='2632180'>order</span>
  <span m='2633590'>the</span> <span m='2633890'>size</span> <span m='2634340'>of</span>
  <span m='2634430'>the</span> <span m='2634580'>output.</span> <span m='2636830'>The</span>
  <span m='2636920'>number</span> <span m='2637130'>of</span> <span m='2637220'>actual</span>
  <span m='2637550'>output</span> <span m='2637850'>points.</span> <span m='2639500'>We</span>
  <span m='2639590'>don't</span> <span m='2639740'>waste</span> <span m='2639980'>time</span>
  <span m='2640400'>doing</span> <span m='2640650'>the</span> <span m='2640690'>scan.</span>
  <span m='2642830'>And</span> <span m='2643340'>the</span> <span m='2643490'>other</span>
  <span m='2643670'>thing</span> <span m='2643940'>is</span> <span m='2644120'>that</span>
  <span m='2644360'>the</span> <span m='2646040'>array</span> <span m='2647690'>has</span>
  <span m='2648050'>size</span> <span m='2648560'>order</span> <span m='2648800'>N.</span>
  <span m='2649040'>That's</span> <span m='2649490'>the</span> <span m='2650780'>biggest</span>
  <span m='2651050'>surprise</span> <span m='2651650'>to</span> <span m='2651800'>me.</span>
  </p><p><span m='2654140'>So</span> <span m='2654300'>those</span> <span m='2654430'>are
  the</span> <span m='2654750'>three</span> <span m='2655010'>things</span> <span
  m='2655220'>we</span> <span m='2655280'>need</span> <span m='2655430'>to</span>
  <span m='2655520'>prove</span> <span m='2656630'>about</span> <span m='2656990'>the</span>
  <span m='2657140'>algorithm,</span> <span m='2658730'>which</span> <span m='2658910'>I</span>
  <span m='2659030'>will</span> <span m='2659150'>now</span> <span m='2659300'>tell</span>
  <span m='2659540'>you.</span> <span m='2676270'>OK,</span> <span m='2676580'>before</span>
  <span m='2676910'>I</span> <span m='2676950'>can</span> <span m='2677150'>define</span>
  <span m='2677720'>how</span> <span m='2677840'>this</span> <span m='2678020'>array</span>
  <span m='2678260'>works,</span> <span m='2679040'>I</span> <span m='2679130'>need</span>
  <span m='2679310'>to</span> <span m='2679430'>define</span> <span m='2679790'>a</span>
  <span m='2679850'>concept</span> <span m='2680240'>called</span> <span m='2680540'>density.</span>
  <span m='2689450'>If we</span> <span m='2689510'>look</span> <span m='2689690'>at</span>
  <span m='2689780'>a</span> <span m='2689840'>query,</span> <span m='2697050'>there's</span>
  <span m='2697500'>two</span> <span m='2697680'>things</span> <span m='2697950'>that</span>
  <span m='2698040'>could</span> <span m='2698220'>happen.</span> </p><p><span m='2699760'>The</span>
  <span m='2699780'>good</span> <span m='2700140'>thing</span> <span m='2700560'>for</span>
  <span m='2700770'>us</span> <span m='2701790'>would</span> <span m='2701940'>be</span>
  <span m='2702300'>if--</span> <span m='2705240'>get</span> <span m='2705390'>this</span>
  <span m='2705600'>right.</span> <span m='2710070'>The</span> <span m='2710190'>number</span>
  <span m='2710520'>of</span> <span m='2710640'>points</span> <span m='2714240'>in</span>
  <span m='2715110'>lesser</span> <span m='2715400'>or equal</span> <span m='2715680'>to</span>
  <span m='2715830'>x</span> <span m='2716850'>star</span> <span m='2720570'>is</span>
  <span m='2721170'>at</span> <span m='2721350'>most,</span> <span m='2722460'>alpha</span>
  <span m='2723780'>times</span> <span m='2725310'>the</span> <span m='2725370'>number</span>
  <span m='2725670'>of</span> <span m='2725760'>points</span> <span m='2727050'>in</span>
  <span m='2727290'>the</span> <span m='2727410'>answer.</span> <span m='2734530'>OK,</span>
  <span m='2734680'>star</span> <span m='2735070'>means</span> <span m='2735610'>no</span>
  <span m='2735880'>restriction</span> <span m='2736480'>on</span> <span m='2736840'>y.</span>
  <span m='2737680'>Minus</span> <span m='2738070'>infinity</span> <span m='2738520'>to</span>
  <span m='2738670'>infinity.</span> </p><p><span m='2745110'>This</span> <span m='2745290'>would</span>
  <span m='2745380'>be</span> <span m='2745500'>good</span> <span m='2745680'>for</span>
  <span m='2745860'>us</span> <span m='2746400'>because</span> <span m='2747690'>it</span>
  <span m='2747810'>says--</span> <span m='2748560'>ultimately</span> <span m='2749100'>what</span>
  <span m='2749220'>we're</span> <span m='2749340'>trying</span> <span m='2749670'>to</span>
  <span m='2749760'>do</span> <span m='2749970'>here</span> <span m='2750810'>is</span>
  <span m='2750960'>do</span> <span m='2751140'>a</span> <span m='2751170'>scan</span>
  <span m='2751650'>in</span> <span m='2751830'>x.</span> <span m='2757050'>It's</span>
  <span m='2757200'>the</span> <span m='2758400'>right</span> <span m='2758550'>thing</span>
  <span m='2758760'>to</span> <span m='2758850'>do</span> <span m='2759000'>here.</span>
  <span m='2760050'>Then</span> <span m='2760840'>for</span> <span m='2761130'>this</span>
  <span m='2761280'>particular</span> <span m='2761730'>y-coordinate,</span> <span
  m='2762460'>we</span> <span m='2762480'>could</span> <span m='2762630'>just</span>
  <span m='2762780'>basically</span> <span m='2763110'>start at</span> <span m='2763410'>the</span>
  <span m='2763530'>beginning</span> <span m='2763980'>of</span> <span m='2764040'>the</span>
  <span m='2764130'>array,</span> <span m='2765240'>start</span> <span m='2765600'>scanning,</span>
  <span m='2767070'>and</span> <span m='2767250'>just</span> <span m='2767460'>report</span>
  <span m='2767790'>all</span> <span m='2767910'>the</span> <span m='2768000'>points</span>
  <span m='2768300'>that</span> <span m='2768420'>are</span> <span m='2768510'>actually</span>
  <span m='2768960'>in</span> <span m='2769110'>our</span> <span m='2769230'>range.</span>
  </p><p><span m='2770410'>Sorry,</span> <span m='2770820'>I</span> <span m='2770920'>need</span>
  <span m='2771090'>to</span> <span m='2771360'>also</span> <span m='2772530'>potentially</span>
  <span m='2772950'>throw</span> <span m='2773250'>away</span> <span m='2774300'>points</span>
  <span m='2774690'>that</span> <span m='2774840'>are</span> <span m='2775050'>not</span>
  <span m='2776910'>low</span> <span m='2777150'>enough.</span> <span m='2778560'>So</span>
  <span m='2778770'>the</span> <span m='2778920'>answer</span> <span m='2779400'>is</span>
  <span m='2780270'>contained</span> <span m='2780870'>in</span> <span m='2780990'>here.</span>
  <span m='2782300'>I</span> <span m='2782370'>should</span> <span m='2782580'>say</span>
  <span m='2782850'>to</span> <span m='2783300'>throw</span> <span m='2783600'>away</span>
  <span m='2783780'>duplicates,</span> <span m='2784350'>you</span> <span m='2784410'>have</span>
  <span m='2784500'>to</span> <span m='2784590'>throw</span> <span m='2784830'>away</span>
  <span m='2785010'>points</span> <span m='2785370'>that</span> <span m='2785490'>are</span>
  <span m='2786030'>not</span> <span m='2786270'>in</span> <span m='2786360'>the</span>
  <span m='2786450'>range</span> <span m='2786720'>lesser or</span> <span m='2786900'>equal
  to</span> <span m='2787170'>x,</span> <span m='2787350'>comma</span> <span m='2787590'>lesser
  or</span> <span m='2788070'>equal to</span> <span m='2788130'>y.</span> <span m='2788730'>Still,</span>
  <span m='2789060'>we</span> <span m='2789180'>claim</span> <span m='2789450'>the</span>
  <span m='2789540'>number</span> <span m='2789750'>of</span> <span m='2789810'>scan</span>
  <span m='2790110'>points</span> <span m='2790500'>is</span> <span m='2791160'>proportional</span>
  <span m='2791760'>to</span> <span m='2791880'>the</span> <span m='2792000'>output</span>
  <span m='2792300'>size.</span> <span m='2793950'>That's</span> <span m='2794160'>what</span>
  <span m='2794250'>we</span> <span m='2794370'>need.</span> </p><p><span m='2795420'>So</span>
  <span m='2796770'>if</span> <span m='2796950'>this</span> <span m='2797190'>held</span>
  <span m='2797610'>for</span> <span m='2797910'>every</span> <span m='2798240'>query,</span>
  <span m='2798990'>we'd</span> <span m='2799140'>be</span> <span m='2799290'>happy.</span>
  <span m='2800120'>Just</span> <span m='2800190'>start</span> <span m='2800430'>at</span>
  <span m='2800490'>the</span> <span m='2800580'>beginning,</span> <span m='2801270'>scan,</span>
  <span m='2802710'>and</span> <span m='2802920'>as</span> <span m='2803010'>long</span>
  <span m='2803190'>as</span> <span m='2803280'>this</span> <span m='2803400'>alpha</span>
  <span m='2803810'>is some</span> <span m='2804030'>constant--</span> <span m='2804600'>it's</span>
  <span m='2804630'>going</span> <span m='2804780'>to</span> <span m='2804840'>be</span>
  <span m='2804900'>a</span> <span m='2804930'>constant</span> <span m='2805380'>bigger</span>
  <span m='2805590'>than</span> <span m='2805740'>1,</span> <span m='2808380'>then</span>
  <span m='2808770'>the</span> <span m='2808860'>number</span> <span m='2809070'>of</span>
  <span m='2809130'>points</span> <span m='2809460'>in</span> <span m='2809640'>the</span>
  <span m='2809820'>answer</span> <span m='2810220'>is</span> <span m='2810480'>proportional--</span>
  <span m='2812980'>sorry,</span> <span m='2813090'>the</span> <span m='2813180'>number</span>
  <span m='2813360'>of</span> <span m='2813420'>points</span> <span m='2813660'>we</span>
  <span m='2813750'>had</span> <span m='2813840'>to</span> <span m='2813900'>scan</span>
  <span m='2814200'>through</span> <span m='2814410'>is</span> <span m='2814500'>proportional</span>
  <span m='2814950'>to</span> <span m='2815020'>the</span> <span m='2815100'>number</span>
  <span m='2815310'>of</span> <span m='2815370'>points</span> <span m='2816590'>in</span>
  <span m='2816750'>the</span> <span m='2816870'>answer,</span> <span m='2817175'>and</span>
  <span m='2817480'>so</span> <span m='2817590'>we're</span> <span m='2817710'>done.</span>
  </p><p><span m='2818890'>So</span> <span m='2818940'>this</span> <span m='2819090'>is</span>
  <span m='2819150'>the</span> <span m='2819240'>easy</span> <span m='2819510'>case.</span>
  <span m='2819840'>We</span> <span m='2819960'>need</span> <span m='2820080'>to</span>
  <span m='2820200'>distinguish</span> <span m='2820680'>it,</span> <span m='2822060'>otherwise</span>
  <span m='2823680'>we</span> <span m='2823830'>call</span> <span m='2825120'>this</span>
  <span m='2825330'>range</span> <span m='2826550'>query</span> <span m='2827620'>sparse,</span>
  <span m='2829590'>and</span> <span m='2829710'>those</span> <span m='2829920'>are</span>
  <span m='2830010'>the</span> <span m='2830130'>interesting</span> <span m='2830490'>cases.</span>
  <span m='2833700'>So</span> <span m='2833880'>nothing</span> <span m='2834300'>deep</span>
  <span m='2834570'>here,</span> <span m='2835870'>but</span> <span m='2836010'>we're</span>
  <span m='2836130'>going</span> <span m='2836250'>to</span> <span m='2836310'>use</span>
  <span m='2836490'>this</span> <span m='2836640'>concept</span> <span m='2837030'>a</span>
  <span m='2837090'>lot.</span> <span m='2852650'>OK,</span> <span m='2854180'>so</span>
  <span m='2854330'>we're</span> <span m='2854450'>going</span> <span m='2854570'>to</span>
  <span m='2854660'>actually</span> <span m='2855020'>try</span> <span m='2855260'>to</span>
  <span m='2855350'>solve</span> <span m='2855620'>this</span> <span m='2855860'>problem</span>
  <span m='2856250'>twice.</span> </p><p><span m='2857840'>The</span> <span m='2857930'>first</span>
  <span m='2858380'>try</span> <span m='2859610'>isn't</span> <span m='2859820'>going</span>
  <span m='2859940'>to</span> <span m='2860030'>be</span> <span m='2860150'>quite</span>
  <span m='2860480'>successful,</span> <span m='2862010'>but</span> <span m='2862400'>it</span>
  <span m='2862610'>gets</span> <span m='2862880'>a</span> <span m='2862940'>lot</span>
  <span m='2863120'>of</span> <span m='2863180'>the</span> <span m='2863270'>right</span>
  <span m='2863480'>ideas.</span> <span m='2865160'>So</span> <span m='2865370'>I'm</span>
  <span m='2865460'>going</span> <span m='2865580'>to</span> <span m='2865670'>let</span>
  <span m='2866060'>S0</span> <span m='2867890'>be</span> <span m='2868490'>all</span>
  <span m='2868670'>the</span> <span m='2868790'>points</span> <span m='2872870'>sorted</span>
  <span m='2873440'>by</span> <span m='2873740'>x.</span> <span m='2875470'>It's</span>
  <span m='2875600'>going</span> <span m='2875720'>to</span> <span m='2875780'>be</span>
  <span m='2875900'>sorted</span> <span m='2876200'>by</span> <span m='2876380'>x.</span>
  <span m='2877940'>I</span> <span m='2878270'>put</span> <span m='2878420'>things</span>
  <span m='2878690'>down</span> <span m='2878900'>here.</span> <span m='2880340'>And</span>
  <span m='2880910'>just</span> <span m='2881090'>to</span> <span m='2881180'>give</span>
  <span m='2881360'>you</span> <span m='2881480'>an</span> <span m='2881570'>idea</span>
  <span m='2881770'>of</span> <span m='2881810'>where</span> <span m='2881930'>we're</span>
  <span m='2882020'>going,</span> <span m='2882830'>the</span> <span m='2883010'>array</span>
  <span m='2884554'>we're</span> <span m='2885440'>imagining</span> <span m='2885920'>here</span>
  <span m='2886070'>is</span> <span m='2886160'>first</span> <span m='2886490'>we</span>
  <span m='2886640'>write</span> <span m='2886850'>down</span> <span m='2887060'>all</span>
  <span m='2887270'>the</span> <span m='2887390'>points,</span> <span m='2888470'>then</span>
  <span m='2888680'>we'll</span> <span m='2888770'>write</span> <span m='2888950'>down</span>
  <span m='2889190'>some</span> <span m='2889400'>subset</span> <span m='2889820'>of</span>
  <span m='2889880'>the</span> <span m='2889970'>points,</span> <span m='2890340'>S1,</span>
  <span m='2891170'>then</span> <span m='2891380'>some</span> <span m='2891590'>subset</span>
  <span m='2892040'>of</span> <span m='2892130'>that</span> <span m='2892310'>subset,</span>
  <span m='2893270'>and</span> <span m='2893360'>so</span> <span m='2893600'>on</span>
  <span m='2893780'>until</span> <span m='2894230'>we</span> <span m='2895700'>get</span>
  <span m='2895850'>down</span> <span m='2896030'>to</span> <span m='2896120'>a</span>
  <span m='2896180'>constant</span> <span m='2896630'>size</span> <span m='2896900'>structure.</span>
  </p><p><span m='2898590'>OK,</span> <span m='2899090'>first</span> <span m='2899420'>we</span>
  <span m='2899540'>write</span> <span m='2899690'>down</span> <span m='2899870'>all</span>
  <span m='2900080'>the</span> <span m='2900170'>points.</span> <span m='2900630'>Why?</span>
  <span m='2901130'>Because</span> <span m='2901520'>for</span> <span m='2901730'>dense</span>
  <span m='2902090'>queries,</span> <span m='2902600'>that's</span> <span m='2902810'>what</span>
  <span m='2902930'>we</span> <span m='2903080'>want.</span> <span m='2903590'>We</span>
  <span m='2903680'>want</span> <span m='2903860'>all</span> <span m='2904010'>the</span>
  <span m='2904100'>points</span> <span m='2904430'>just</span> <span m='2904580'>sitting</span>
  <span m='2904850'>there.</span> <span m='2905610'>So</span> <span m='2905660'>then</span>
  <span m='2905870'>you</span> <span m='2905960'>can</span> <span m='2906110'>just</span>
  <span m='2906890'>read</span> <span m='2907070'>through</span> <span m='2907220'>all</span>
  <span m='2907340'>the</span> <span m='2907430'>points</span> <span m='2908660'>and</span>
  <span m='2908960'>dense</span> <span m='2909200'>queries</span> <span m='2909470'>will</span>
  <span m='2909560'>be</span> <span m='2909710'>happy.</span> </p><p><span m='2910680'>So</span>
  <span m='2911990'>if</span> <span m='2912260'>we</span> <span m='2912470'>detect</span>
  <span m='2912890'>a</span> <span m='2912920'>y-coordinate</span> <span m='2913520'>where</span>
  <span m='2914150'>the</span> <span m='2914690'>queries</span> <span m='2915080'>going</span>
  <span m='2915220'>to</span> <span m='2915290'>be</span> <span m='2915380'>dense--</span>
  <span m='2916510'>I don't</span> <span m='2916760'>know</span> <span m='2916970'>how</span>
  <span m='2917120'>we</span> <span m='2917240'>detect</span> <span m='2917540'>that.</span>
  <span m='2917810'>Let's</span> <span m='2918020'>not</span> <span m='2918140'>worry</span>
  <span m='2918290'>about</span> <span m='2918470'>it</span> <span m='2918530'>right</span>
  <span m='2918680'>now--</span> <span m='2919340'>then</span> <span m='2920300'>you</span>
  <span m='2920450'>could</span> <span m='2920570'>just</span> <span m='2920840'>look</span>
  <span m='2921050'>through</span> <span m='2921270'>S0.</span> <span m='2921620'>That's</span>
  <span m='2921830'>fine.</span> <span m='2922820'>But</span> <span m='2923000'>some</span>
  <span m='2923350'>queries</span> <span m='2923660'>are</span> <span m='2923720'>going</span>
  <span m='2923840'>to</span> <span m='2923900'>be</span> <span m='2923960'>sparse,</span>
  <span m='2924320'>and</span> <span m='2924410'>for</span> <span m='2924560'>that</span>
  <span m='2924740'>we're</span> <span m='2924800'>going</span> <span m='2924910'>to</span>
  <span m='2924980'>use</span> <span m='2925070'>S1,</span> <span m='2925520'>S2,</span>
  <span m='2925910'>and</span> <span m='2926030'>so</span> <span m='2926150'>on.</span>
  </p><p><span m='2927420'>The</span> <span m='2927490'>intuition</span> <span m='2927920'>is</span>
  <span m='2928040'>the</span> <span m='2928130'>following.</span> <span m='2930920'>If</span>
  <span m='2931130'>in</span> <span m='2931280'>your</span> <span m='2931430'>query,</span>
  <span m='2932250'>the</span> <span m='2932270'>y-coordinate</span> <span m='2933620'>is</span>
  <span m='2933830'>very</span> <span m='2934340'>large,</span> <span m='2935180'>like</span>
  <span m='2935390'>say</span> <span m='2935630'>infinity,</span> <span m='2937130'>then</span>
  <span m='2937280'>your</span> <span m='2937430'>query</span> <span m='2937790'>is</span>
  <span m='2937880'>guaranteed</span> <span m='2938540'>to</span> <span m='2938630'>be</span>
  <span m='2938750'>dense.</span> <span m='2939060'>It</span> <span m='2939120'>doesn't</span>
  <span m='2939320'>matter</span> <span m='2939560'>what</span> <span m='2939710'>x</span>
  <span m='2940040'>is.</span> <span m='2941930'>And</span> <span m='2942260'>in</span>
  <span m='2942410'>general,</span> <span m='2943220'>if</span> <span m='2943370'>y</span>
  <span m='2943640'>is</span> <span m='2943790'>near</span> <span m='2944060'>the</span>
  <span m='2944180'>top,</span> <span m='2944600'>like</span> <span m='2944870'>it's</span>
  <span m='2945470'>at</span> <span m='2945620'>the</span> <span m='2945710'>top</span>
  <span m='2946010'>most</span> <span m='2946250'>point,</span> <span m='2946700'>or</span>
  <span m='2946820'>maybe</span> <span m='2947030'>the</span> <span m='2947150'>next</span>
  <span m='2947410'>of</span> <span m='2947510'>top</span> <span m='2947750'>most</span>
  <span m='2947960'>point,</span> <span m='2948370'>or</span> <span m='2948500'>maybe</span>
  <span m='2948740'>a</span> <span m='2948770'>little</span> <span m='2949010'>bit</span>
  <span m='2949130'>farther</span> <span m='2949430'>down,</span> <span m='2949650'>it
  depends</span> <span m='2950030'>on</span> <span m='2950180'>the</span> <span m='2950300'>point</span>
  <span m='2950660'>set,</span> <span m='2951740'>then</span> <span m='2952010'>a</span>
  <span m='2952070'>lot</span> <span m='2952280'>of</span> <span m='2952400'>queries</span>
  <span m='2952700'>are</span> <span m='2952820'>going</span> <span m='2953060'>to</span>
  <span m='2953150'>be</span> <span m='2953240'>dense.</span> </p><p><span m='2954380'>So</span>
  <span m='2955640'>that's</span> <span m='2956150'>good</span> <span m='2956300'>news.</span>
  <span m='2956540'>Let's</span> <span m='2956750'>consider</span> <span m='2957140'>the</span>
  <span m='2957260'>first</span> <span m='2957710'>time</span> <span m='2958880'>when</span>
  <span m='2959030'>there's</span> <span m='2959210'>a</span> <span m='2959270'>sparse</span>
  <span m='2959630'>query.</span> <span m='2961620'>So</span> <span m='2961730'>we're</span>
  <span m='2961790'>going</span> <span m='2961940'>to</span> <span m='2962000'>let</span>
  <span m='2962990'>yi</span> <span m='2964940'>be</span> <span m='2966110'>the</span>
  <span m='2966230'>largest</span> <span m='2966770'>y-coordinate</span> <span m='2970460'>where</span>
  <span m='2972470'>some</span> <span m='2972980'>query,</span> <span m='2974480'>some</span>
  <span m='2974810'>x-coordinate--</span> <span m='2977420'>that</span> <span m='2977690'>y-coordinate.</span>
  <span m='2979130'>This is</span> <span m='2979470'>going to be</span> <span m='2979840'>less
  than</span> <span m='2980000'>or equal to</span> <span m='2980090'>x,</span> <span
  m='2980375'>comma</span> <span m='2980660'>less</span> <span m='2981050'>than or</span>
  <span m='2981620'>equal</span> <span m='2981770'>to</span> <span m='2981860'>yi--</span>
  <span m='2984920'>is</span> <span m='2985100'>sparse</span> <span m='2988620'>in</span>
  <span m='2989790'>Si</span> <span m='2991630'>minus</span> <span m='2992160'>1.</span>
  </p><p><span m='2993326'>OK,</span> <span m='2993790'>so</span> <span m='2993810'>initially</span>
  <span m='2994230'>we</span> <span m='2994290'>have</span> <span m='2994620'>S0,</span>
  <span m='2995340'>all</span> <span m='2995580'>points.</span> <span m='2996530'>y1</span>
  <span m='2997320'>is</span> <span m='2997470'>the</span> <span m='2997560'>largest</span>
  <span m='2997920'>y</span> <span m='2998130'>co-ordinate</span> <span m='2998520'>where</span>
  <span m='2998670'>there's--</span> <span m='2999300'>so</span> <span m='2999420'>we</span>
  <span m='2999510'>work</span> <span m='2999870'>our</span> <span m='2999930'>way</span>
  <span m='3000050'>down</span> <span m='3000290'>until</span> <span m='3000470'>there's</span>
  <span m='3000620'>some</span> <span m='3001490'>sparse</span> <span m='3001910'>query</span>
  <span m='3002330'>in</span> <span m='3002650'>S0.</span> <span m='3003556'>That's</span>
  <span m='3004010'>yi.</span> <span m='3006065'>So</span> <span m='3007550'>then</span>
  <span m='3008150'>we</span> <span m='3008300'>just</span> <span m='3008660'>filter,</span>
  <span m='3009980'>based</span> <span m='3010220'>on</span> <span m='3010370'>that.</span>
  <span m='3011400'>So</span> <span m='3011450'>throw</span> <span m='3011750'>away</span>
  <span m='3011990'>all</span> <span m='3012080'>the</span> <span m='3012200'>points</span>
  <span m='3013610'>above</span> <span m='3013880'>yi.</span> </p><p><span m='3015280'>So</span>
  <span m='3015380'>we're</span> <span m='3015440'>going</span> <span m='3015560'>to</span>
  <span m='3015740'>say</span> <span m='3016550'>take</span> <span m='3016820'>Si</span>
  <span m='3017180'>minus</span> <span m='3017480'>1,</span> <span m='3017860'>intersect</span>
  <span m='3018240'>it</span> <span m='3019000'>with</span> <span m='3019310'>the</span>
  <span m='3019430'>range</span> <span m='3019790'>query,</span> <span m='3021070'>star</span>
  <span m='3022200'>less than</span> <span m='3022610'>or equal to</span> <span m='3022820'>yi.</span>
  <span m='3024950'>OK,</span> <span m='3025160'>so the</span> <span m='3025280'>picture</span>
  <span m='3025610'>is</span> <span m='3026170'>we</span> <span m='3026230'>have</span>
  <span m='3026520'>some</span> <span m='3027380'>point</span> <span m='3027700'>set.</span>
  <span m='3035930'>Up</span> <span m='3036450'>here,</span> <span m='3037340'>every</span>
  <span m='3037700'>possible</span> <span m='3038150'>query</span> <span m='3039110'>along</span>
  <span m='3039440'>this</span> <span m='3039590'>line</span> <span m='3040370'>is</span>
  <span m='3040490'>going</span> <span m='3040670'>to</span> <span m='3040730'>be</span>
  <span m='3040850'>dense</span> <span m='3041510'>because</span> <span m='3041720'>everything</span>
  <span m='3042110'>to</span> <span m='3042200'>the</span> <span m='3042260'>left</span>
  <span m='3042560'>of</span> <span m='3042680'>the</span> <span m='3042800'>x-coordinate</span>
  <span m='3043310'>will</span> <span m='3043460'>be</span> <span m='3043610'>in</span>
  <span m='3043730'>the</span> <span m='3044120'>output.</span> </p><p><span m='3045260'>At</span>
  <span m='3045380'>some</span> <span m='3045620'>point,</span> <span m='3046010'>we're</span>
  <span m='3046120'>going</span> <span m='3046190'>to</span> <span m='3046280'>decide</span>
  <span m='3046970'>this</span> <span m='3047240'>is</span> <span m='3047360'>too</span>
  <span m='3047510'>scary.</span> <span m='3048600'>There's</span> <span m='3048680'>a</span>
  <span m='3048740'>query</span> <span m='3049070'>here,</span> <span m='3049340'>maybe</span>
  <span m='3049580'>this</span> <span m='3049760'>one,</span> <span m='3050510'>or</span>
  <span m='3050630'>maybe</span> <span m='3050870'>it's</span> <span m='3050990'>this</span>
  <span m='3051170'>query</span> <span m='3052720'>that's</span> <span m='3052880'>sparse.</span>
  <span m='3053630'>And</span> <span m='3053750'>so</span> <span m='3053960'>we</span>
  <span m='3054020'>say</span> <span m='3054160'>OK,</span> <span m='3055110'>throw</span>
  <span m='3055490'>away</span> <span m='3055670'>these</span> <span m='3055850'>points.</span>
  <span m='3056960'>Redo</span> <span m='3057380'>the</span> <span m='3057500'>data</span>
  <span m='3057680'>structure</span> <span m='3058130'>from</span> <span m='3058310'>here</span>
  <span m='3058460'>down,</span> <span m='3059330'>ignoring</span> <span m='3059780'>all</span>
  <span m='3059910'>these</span> <span m='3060080'>points,</span> <span m='3062420'>repeat,</span>
  <span m='3063710'>and</span> <span m='3064130'>write</span> <span m='3064370'>down</span>
  <span m='3065030'>these</span> <span m='3065240'>things.</span> </p><p><span m='3066960'>So</span>
  <span m='3066980'>the</span> <span m='3067100'>idea</span> <span m='3067400'>is</span>
  <span m='3067700'>that</span> <span m='3067820'>if</span> <span m='3068000'>you</span>
  <span m='3068120'>look</span> <span m='3068360'>at</span> <span m='3068450'>a</span>
  <span m='3068510'>particular</span> <span m='3068930'>query,</span> <span m='3069620'>it</span>
  <span m='3069770'>will</span> <span m='3069920'>be</span> <span m='3070100'>dense</span>
  <span m='3072080'>in</span> <span m='3072290'>one</span> <span m='3072590'>of</span>
  <span m='3072710'>these</span> <span m='3072920'>Si's.</span> <span m='3074950'>And</span>
  <span m='3075100'>you</span> <span m='3075220'>can</span> <span m='3075370'>tell</span>
  <span m='3075610'>that</span> <span m='3075850'>just</span> <span m='3076390'>according</span>
  <span m='3076780'>to</span> <span m='3076900'>your</span> <span m='3077080'>y-coordinate.</span>
  <span m='3078370'>Because</span> <span m='3078560'>you</span> <span m='3078620'>said</span>
  <span m='3078850'>oh,</span> <span m='3079030'>well,</span> <span m='3079210'>if</span>
  <span m='3079330'>you're</span> <span m='3079450'>up</span> <span m='3079660'>here</span>
  <span m='3080140'>in</span> <span m='3080260'>y-coordinate,</span> <span m='3080830'>you're</span>
  <span m='3080950'>guaranteed</span> <span m='3081400'>safe.</span> <span m='3083060'>So</span>
  <span m='3083260'>just</span> <span m='3084340'>do</span> <span m='3084520'>that</span>
  <span m='3084700'>search</span> <span m='3085850'>and</span> <span m='3086050'>you're</span>
  <span m='3086510'>OK.</span> </p><p><span m='3087520'>In</span> <span m='3087640'>general,</span>
  <span m='3087910'>we</span> <span m='3088060'>continue</span> <span m='3089140'>this</span>
  <span m='3089290'>process</span> <span m='3092320'>until</span> <span m='3093550'>we</span>
  <span m='3093700'>get</span> <span m='3093850'>to</span> <span m='3093940'>some</span>
  <span m='3094180'>Si</span> <span m='3095220'>that</span> <span m='3095350'>has</span>
  <span m='3095530'>constant</span> <span m='3095980'>size.</span> <span m='3097150'>At</span>
  <span m='3097300'>that</span> <span m='3097450'>point,</span> <span m='3098170'>we're</span>
  <span m='3098290'>done,</span> <span m='3098740'>and</span> <span m='3098860'>then
  we</span> <span m='3098950'>can</span> <span m='3099070'>afford</span> <span m='3099310'>to</span>
  <span m='3099370'>look</span> <span m='3099520'>through</span> <span m='3099670'>all</span>
  <span m='3099790'>the</span> <span m='3099880'>points.</span> <span m='3102250'>Unfortunately,</span>
  <span m='3102910'>this</span> <span m='3103300'>is</span> <span m='3103420'>not</span>
  <span m='3103660'>a</span> <span m='3103720'>very</span> <span m='3103930'>good</span>
  <span m='3104050'>strategy,</span> <span m='3104800'>but</span> <span m='3105220'>it's</span>
  <span m='3105370'>the</span> <span m='3105430'>first</span> <span m='3106090'>cut,</span>
  <span m='3106450'>and</span> <span m='3106630'>it's</span> <span m='3107290'>close</span>
  <span m='3107650'>to</span> <span m='3107830'>what</span> <span m='3108040'>works.</span>
  </p><p><span m='3110300'>Here's</span> <span m='3110550'>a</span> <span m='3110610'>problem</span>
  <span m='3111070'>with</span> <span m='3111250'>it.</span> <span m='3112540'>Suppose</span>
  <span m='3113020'>you</span> <span m='3113140'>have</span> <span m='3113680'>this</span>
  <span m='3113960'>point set.</span> <span m='3118960'>OK,</span> <span m='3119400'>what</span>
  <span m='3119520'>happens</span> <span m='3119940'>is</span> <span m='3120330'>you</span>
  <span m='3120630'>start</span> <span m='3120840'>at</span> <span m='3120900'>the</span>
  <span m='3120990'>top,</span> <span m='3121290'>everything</span> <span m='3121650'>looks</span>
  <span m='3121860'>fine.</span> <span m='3122770'>At</span> <span m='3122820'>some</span>
  <span m='3123060'>point</span> <span m='3123300'>you</span> <span m='3123420'>decide</span>
  <span m='3124560'>there's</span> <span m='3124770'>a</span> <span m='3124830'>query</span>
  <span m='3125250'>here,</span> <span m='3125950'>namely</span> <span m='3126510'>this</span>
  <span m='3126690'>one,</span> <span m='3127000'>which</span> <span m='3127050'>has</span>
  <span m='3127230'>an</span> <span m='3127350'>empty</span> <span m='3127830'>answer,</span>
  <span m='3129420'>and</span> <span m='3129570'>yet</span> <span m='3129870'>there</span>
  <span m='3130080'>are</span> <span m='3130140'>points</span> <span m='3130530'>to</span>
  <span m='3130650'>the</span> <span m='3130710'>left</span> <span m='3131730'>of</span>
  <span m='3131910'>this</span> <span m='3132090'>x-coordinate.</span> <span m='3133020'>So</span>
  <span m='3133140'>that's</span> <span m='3133380'>bad</span> <span m='3134660'>because</span>
  <span m='3135870'>it's</span> <span m='3136020'>very</span> <span m='3136230'>hard</span>
  <span m='3136440'>to</span> <span m='3136500'>get</span> <span m='3136620'>within</span>
  <span m='3136860'>a</span> <span m='3136890'>constant</span> <span m='3137220'>factor</span>
  <span m='3137490'>of</span> <span m='3137550'>zero.</span> </p><p><span m='3138540'>So</span>
  <span m='3139470'>pretty</span> <span m='3139650'>much</span> <span m='3139860'>immediately</span>
  <span m='3140400'>you've</span> <span m='3140580'>got</span> <span m='3140760'>to</span>
  <span m='3141450'>draw</span> <span m='3141750'>a</span> <span m='3141780'>line</span>
  <span m='3142110'>here</span> <span m='3142290'>and</span> <span m='3142380'>say</span>
  <span m='3142560'>OK,</span> <span m='3143220'>S0</span> <span m='3144480'>is</span>
  <span m='3144660'>all</span> <span m='3144840'>points,</span> <span m='3146090'>S1</span>
  <span m='3147690'>is</span> <span m='3147840'>these</span> <span m='3148080'>points,</span>
  <span m='3150280'>S2</span> <span m='3150930'>is</span> <span m='3151080'>going</span>
  <span m='3151230'>to</span> <span m='3151320'>be</span> <span m='3151680'>these</span>
  <span m='3151980'>points.</span> <span m='3153240'>In</span> <span m='3153300'>general,</span>
  <span m='3153570'>there's</span> <span m='3153720'>suffixes</span> <span m='3154980'>of</span>
  <span m='3155130'>the</span> <span m='3155220'>points,</span> <span m='3156270'>and</span>
  <span m='3156390'>so</span> <span m='3156540'>the</span> <span m='3156630'>total</span>
  <span m='3156900'>space</span> <span m='3157200'>will</span> <span m='3157290'>be</span>
  <span m='3157380'>quadratic.</span> <span m='3159240'>So</span> <span m='3159780'>the</span>
  <span m='3159870'>first</span> <span m='3160140'>two</span> <span m='3160260'>properties</span>
  <span m='3160740'>will</span> <span m='3160920'>be</span> <span m='3161100'>correct</span>
  <span m='3161990'>because</span> <span m='3162150'>you're</span> <span m='3162240'>just</span>
  <span m='3162360'>looking</span> <span m='3163130'>in</span> <span m='3163430'>S0,</span>
  <span m='3163860'>or</span> <span m='3164100'>S1,</span> <span m='3164550'>or</span>
  <span m='3164640'>whatever.</span> <span m='3165780'>Everything</span> <span m='3166140'>looks</span>
  <span m='3166350'>fine,</span> <span m='3167370'>but</span> <span m='3167580'>your</span>
  <span m='3167820'>right</span> <span m='3168030'>does</span> <span m='3168150'>not</span>
  <span m='3168300'>have</span> <span m='3168450'>linear</span> <span m='3168690'>size.</span>
  </p><p><span m='3170400'>So</span> <span m='3171300'>no</span> <span m='3171450'>good.</span>
  <span m='3172650'>First</span> <span m='3172920'>try,</span> <span m='3173700'>failed.</span>
  <span m='3179290'>Second</span> <span m='3179590'>time's</span> <span m='3179830'>the</span>
  <span m='3179890'>charm.</span> <span m='3191840'>You need</span> <span m='3191980'>a</span>
  <span m='3192010'>little</span> <span m='3192370'>more</span> <span m='3192550'>sophistication</span>
  <span m='3195840'>in</span> <span m='3196360'>how</span> <span m='3196570'>we</span>
  <span m='3196690'>do</span> <span m='3196870'>this</span> <span m='3197530'>partitioning,</span>
  <span m='3198900'>how</span> <span m='3199060'>we</span> <span m='3199120'>build</span>
  <span m='3199390'>our</span> <span m='3199520'>array,</span> <span m='3200740'>and</span>
  <span m='3200980'>we'll</span> <span m='3201070'>get</span> <span m='3201280'>it.</span>
  <span m='3211810'>I</span> <span m='3211890'>didn't</span> <span m='3212100'>read</span>
  <span m='3212280'>this</span> <span m='3212430'>before.</span> <span m='3213450'>This</span>
  <span m='3213630'>one</span> <span m='3214440'>line</span> <span m='3214700'>that</span>
  <span m='3214770'>says</span> <span m='3215070'>maximize</span> <span m='3216960'>common</span>
  <span m='3218880'>suffix.</span> <span m='3220135'>I</span> <span m='3220490'>have</span>
  <span m='3220620'>no</span> <span m='3220800'>idea</span> <span m='3221040'>what</span>
  <span m='3221160'>this</span> <span m='3221340'>means,</span> <span m='3221920'>but</span>
  <span m='3221970'>maybe</span> <span m='3222210'>it</span> <span m='3222270'>will</span>
  <span m='3222390'>mean</span> <span m='3222570'>something</span> <span m='3222960'>by</span>
  <span m='3223080'>the</span> <span m='3223200'>end.</span> <span m='3223470'>Let's</span>
  <span m='3223730'>see.</span> </p><p><span m='3225120'>OK,</span> <span m='3226800'>this</span>
  <span m='3227070'>is</span> <span m='3227130'>the</span> <span m='3227220'>part</span>
  <span m='3227400'>I</span> <span m='3227460'>read.</span> <span m='3229530'>So</span>
  <span m='3229920'>xi</span> <span m='3232240'>is</span> <span m='3232410'>going</span>
  <span m='3232590'>to</span> <span m='3232650'>be--</span> <span m='3233790'>so</span>
  <span m='3233910'>we</span> <span m='3233970'>had</span> <span m='3234060'>a</span>
  <span m='3234120'>yi</span> <span m='3235520'>That's</span> <span m='3235740'>going</span>
  <span m='3235860'>to</span> <span m='3235950'>be</span> <span m='3236040'>the</span>
  <span m='3236160'>same</span> <span m='3236430'>as</span> <span m='3236550'>before.</span>
  <span m='3237120'>This is</span> <span m='3237360'>why I</span> <span m='3237540'>did
  the</span> <span m='3237630'>first</span> <span m='3237900'>attempt.</span> <span
  m='3238200'>This</span> <span m='3238950'>definition</span> <span m='3239910'>remains</span>
  <span m='3240270'>the</span> <span m='3240330'>same.</span> <span m='3241070'>So</span>
  <span m='3241170'>largest</span> <span m='3241560'>y</span> <span m='3242220'>where</span>
  <span m='3242310'>we</span> <span m='3242400'>have</span> <span m='3242550'>some</span>
  <span m='3242850'>sparse</span> <span m='3243210'>query</span> <span m='3244140'>in</span>
  <span m='3244280'>Si</span> <span m='3244570'>minus</span> <span m='3244890'>1.</span>
  <span m='3246930'>I</span> <span m='3247020'>want</span> <span m='3247230'>to</span>
  <span m='3247290'>look</span> <span m='3247590'>at</span> <span m='3247800'>what</span>
  <span m='3248100'>that</span> <span m='3248280'>x-coordinate</span> <span m='3249120'>is.</span>
  <span m='3251240'>It's just</span> <span m='3251490'>that here</span> <span m='3251670'>it</span>
  <span m='3251730'>says</span> <span m='3251970'>there's</span> <span m='3252120'>some</span>
  <span m='3252540'>x.</span> <span m='3255420'>What</span> <span m='3255720'>is</span>
  <span m='3255900'>that</span> <span m='3256110'>x?</span> </p><p><span m='3258620'>Let's</span>
  <span m='3258840'>just</span> <span m='3258990'>look</span> <span m='3259140'>at</span>
  <span m='3259260'>the</span> <span m='3259380'>maximum</span> <span m='3259920'>possible</span>
  <span m='3260370'>x</span> <span m='3260850'>that</span> <span m='3260970'>it</span>
  <span m='3261030'>could</span> <span m='3261180'>be.</span> <span m='3262260'>This</span>
  <span m='3262440'>will</span> <span m='3262530'>turn</span> <span m='3262740'>out</span>
  <span m='3262860'>to</span> <span m='3262980'>be</span> <span m='3263460'>really</span>
  <span m='3264090'>useful.</span> <span m='3265150'>The</span> <span m='3265250'>maximum</span>
  <span m='3265620'>x-coordinate</span> <span m='3267810'>where</span> <span m='3269140'>less
  than</span> <span m='3269430'>or equal to</span> <span m='3269550'>xi,</span> <span
  m='3270700'>comma</span> <span m='3271100'>less than or</span> <span m='3271470'>equal</span>
  <span m='3271560'>to</span> <span m='3271650'>yi</span> <span m='3273240'>is</span>
  <span m='3273360'>sparse--</span> <span m='3277020'>and</span> <span m='3277480'>Si</span>
  <span m='3277800'>minus</span> <span m='3278130'>1.</span> <span m='3280440'>OK,</span>
  <span m='3280560'>we know</span> <span m='3280710'>there's</span> <span m='3280860'>something</span>
  <span m='3281250'>we</span> <span m='3281370'>can</span> <span m='3281490'>put</span>
  <span m='3281640'>in</span> <span m='3281730'>here</span> <span m='3281910'>that</span>
  <span m='3282030'>makes</span> <span m='3282280'>yi</span> <span m='3282780'>sparse.</span>
  <span m='3283530'>So</span> <span m='3284730'>look</span> <span m='3284910'>at</span>
  <span m='3284970'>the</span> <span m='3285060'>largest</span> <span m='3285420'>possible</span>
  <span m='3286050'>such</span> <span m='3286320'>x.</span> </p><p><span m='3287190'>So</span>
  <span m='3287340'>that</span> <span m='3287490'>means</span> <span m='3288360'>any</span>
  <span m='3288630'>query--</span> <span m='3290100'>so</span> <span m='3290340'>we</span>
  <span m='3290490'>have</span> <span m='3290700'>this</span> <span m='3290880'>new</span>
  <span m='3291120'>point.</span> <span m='3292750'>It's</span> <span m='3292890'>not</span>
  <span m='3293100'>an</span> <span m='3293190'>actual</span> <span m='3293490'>point</span>
  <span m='3293790'>in</span> <span m='3293950'>our</span> <span m='3294420'>problem,</span>
  <span m='3295060'>but</span> <span m='3295110'>it's</span> <span m='3295380'>a</span>
  <span m='3296100'>query,</span> <span m='3296480'>xi,</span> <span m='3296810'>yi.</span>
  <span m='3299280'>And</span> <span m='3299610'>it's</span> <span m='3299820'>dense,</span>
  <span m='3300800'>oh</span> <span m='3300990'>sorry,</span> <span m='3301170'>it's</span>
  <span m='3301290'>sparse.</span> <span m='3301740'>It's</span> <span m='3301860'>bad.</span>
  <span m='3303430'>We</span> <span m='3303450'>know</span> <span m='3303780'>that</span>
  <span m='3305160'>any</span> <span m='3305430'>query</span> <span m='3306600'>up</span>
  <span m='3306820'>here</span> <span m='3310260'>is</span> <span m='3310650'>dense.</span>
  <span m='3311700'>That</span> <span m='3311830'>was</span> <span m='3311970'>the</span>
  <span m='3312030'>definition</span> <span m='3312480'>of</span> <span m='3312550'>yi.</span>
  <span m='3314280'>And</span> <span m='3314430'>now</span> <span m='3314550'>we</span>
  <span m='3314700'>also</span> <span m='3315090'>know</span> <span m='3315540'>that</span>
  <span m='3315670'>any</span> <span m='3315950'>query</span> <span m='3318210'>over</span>
  <span m='3318570'>here,</span> <span m='3318930'>I</span> <span m='3319050'>guess,</span>
  <span m='3320130'>that's</span> <span m='3320280'>saying</span> <span m='3320490'>a</span>
  <span m='3320550'>lot.</span> <span m='3321990'>But</span> <span m='3322200'>these</span>
  <span m='3322500'>queries</span> <span m='3322890'>are</span> <span m='3323010'>also</span>
  <span m='3323820'>dense.</span> </p><p><span m='3324450'>Because</span> <span m='3324720'>again,</span>
  <span m='3324990'>if</span> <span m='3325110'>you're</span> <span m='3325200'>far</span>
  <span m='3325410'>enough</span> <span m='3325590'>to</span> <span m='3325680'>the</span>
  <span m='3325800'>right,</span> <span m='3326010'>that's</span> <span m='3326220'>going</span>
  <span m='3326350'>to</span> <span m='3326430'>be</span> <span m='3326550'>basically</span>
  <span m='3326880'>everything.</span> <span m='3328020'>So</span> <span m='3328190'>let's</span>
  <span m='3328740'>get</span> <span m='3328920'>rid</span> <span m='3329040'>of</span>
  <span m='3329100'>that</span> <span m='3329310'>as</span> <span m='3329430'>well.</span>
  <span m='3330570'>And</span> <span m='3330720'>this</span> <span m='3330900'>is</span>
  <span m='3330990'>a</span> <span m='3331050'>problem,</span> <span m='3332010'>queries</span>
  <span m='3332520'>over</span> <span m='3332730'>here</span> <span m='3333100'>are</span>
  <span m='3333380'>also</span> <span m='3333690'>potentially</span> <span m='3334140'>a</span>
  <span m='3334200'>problem.</span> <span m='3334640'>We</span> <span m='3334740'>don't</span>
  <span m='3334890'>know.</span> <span m='3336600'>It</span> <span m='3336660'>doesn't</span>
  <span m='3336870'>seem</span> <span m='3337080'>like</span> <span m='3337440'>much,</span>
  <span m='3337990'>but</span> <span m='3338160'>it</span> <span m='3338820'>will</span>
  <span m='3338910'>be</span> <span m='3339030'>enough.</span> <span m='3340830'>We're</span>
  <span m='3340980'>going</span> <span m='3341100'>to</span> <span m='3341190'>redefine</span>
  <span m='3341610'>Si</span> <span m='3342000'>as</span> <span m='3342120'>well.</span>
  </p><p><span m='3343360'>So</span> <span m='3343410'>here's</span> <span m='3343650'>the</span>
  <span m='3343740'>fun</span> <span m='3343950'>part.</span> <span m='3345210'>If</span>
  <span m='3345540'>we</span> <span m='3345690'>have</span> <span m='3347760'>some</span>
  <span m='3348390'>Si</span> <span m='3348810'>minus</span> <span m='3349170'>1,</span>
  <span m='3352080'>we're going</span> <span m='3352570'>to</span> <span m='3352690'>define</span>
  <span m='3352950'>a</span> <span m='3353010'>new</span> <span m='3353130'>thing,</span>
  <span m='3353400'>which</span> <span m='3353550'>is</span> <span m='3353670'>Pi</span>
  <span m='3354210'>minus</span> <span m='3354540'>1,</span> <span m='3358960'>which</span>
  <span m='3361620'>is</span> <span m='3361800'>this.</span> <span m='3363672'>This</span>
  <span m='3364140'>is</span> <span m='3364290'>a</span> <span m='3364410'>funny</span>
  <span m='3365160'>thing,</span> <span m='3367140'>but</span> <span m='3367350'>it</span>
  <span m='3367470'>is</span> <span m='3369180'>this</span> <span m='3369450'>part</span>
  <span m='3373060'>of</span> <span m='3373210'>the</span> <span m='3373300'>point</span>
  <span m='3373510'>set.</span> <span m='3373960'>This</span> <span m='3374200'>is</span>
  <span m='3375100'>Pi</span> <span m='3376000'>minus</span> <span m='3376390'>1.</span>
  <span m='3377990'>So</span> <span m='3378280'>the</span> <span m='3378400'>points</span>
  <span m='3378670'>we</span> <span m='3378880'>care</span> <span m='3379240'>about</span>
  <span m='3379480'>are</span> <span m='3379570'>kind</span> <span m='3379810'>of</span>
  <span m='3379960'>here,</span> <span m='3380500'>but</span> <span m='3380710'>let's</span>
  <span m='3380920'>just</span> <span m='3381040'>take</span> <span m='3381340'>everything</span>
  <span m='3381850'>to</span> <span m='3381970'>the</span> <span m='3382060'>left</span>
  <span m='3382990'>of</span> <span m='3383080'>this</span> <span m='3383260'>x-coordinate.</span>
  <span m='3384220'>Why</span> <span m='3384400'>not?</span> <span m='3384700'>It's</span>
  <span m='3384850'>a</span> <span m='3384910'>thing.</span> <span m='3386530'>That</span>
  <span m='3386710'>is</span> <span m='3386860'>Pi</span> <span m='3387760'>minus</span>
  <span m='3388080'>1.</span> </p><p><span m='3388880'>So Si</span> <span m='3389170'>minus</span>
  <span m='3389440'>1</span> <span m='3389590'>is</span> <span m='3389740'>everything</span>
  <span m='3390220'>in</span> <span m='3390310'>this</span> <span m='3390430'>picture.</span>
  <span m='3392590'>First,</span> <span m='3392950'>let's</span> <span m='3393100'>restrict</span>
  <span m='3393400'>to</span> <span m='3393520'>x,</span> <span m='3394270'>then</span>
  <span m='3394480'>the</span> <span m='3394570'>next</span> <span m='3394780'>step</span>
  <span m='3395020'>is</span> <span m='3395110'>we're</span> <span m='3395170'>going</span>
  <span m='3395290'>to</span> <span m='3395380'>restrict</span> <span m='3395680'>to</span>
  <span m='3395830'>y.</span> <span m='3397600'>But</span> <span m='3397810'>it's</span>
  <span m='3398020'>in</span> <span m='3398200'>a</span> <span m='3398260'>funny</span>
  <span m='3398530'>way.</span> <span m='3399940'>This</span> <span m='3400120'>is</span>
  <span m='3400240'>the</span> <span m='3400390'>Si,</span> <span m='3400960'>the</span>
  <span m='3401050'>next</span> <span m='3402040'>s</span> <span m='3402580'>set.</span>
  <span m='3404200'>Take</span> <span m='3404410'>the</span> <span m='3404500'>previous</span>
  <span m='3404870'>set</span> <span m='3405543'>and</span> <span m='3406270'>we</span>
  <span m='3406390'>intersect</span> <span m='3406750'>it</span> <span m='3407110'>with</span>
  <span m='3408400'>a</span> <span m='3408430'>funny</span> <span m='3408730'>thing.</span>
  </p><p><span m='3413150'>It's</span> <span m='3413170'>harder</span> <span m='3413470'>to</span>
  <span m='3413560'>write</span> <span m='3413780'>algebraically</span> <span m='3414400'>than</span>
  <span m='3414580'>it</span> <span m='3414670'>is</span> <span m='3414820'>to</span>
  <span m='3414970'>draw</span> <span m='3415180'>the</span> <span m='3415300'>picture.</span>
  <span m='3421160'>So</span> <span m='3421430'>it's</span> <span m='3421610'>intersected</span>
  <span m='3422120'>with</span> <span m='3422300'>a</span> <span m='3422390'>union,</span>
  <span m='3422990'>which</span> <span m='3423200'>is</span> <span m='3423320'>basically--</span>
  <span m='3425800'>dare I</span> <span m='3425930'>draw</span> <span m='3426290'>it
  on</span> <span m='3426410'>the</span> <span m='3426500'>same</span> <span m='3426740'>picture?</span>
  <span m='3428020'>Where's</span> <span m='3428130'>my</span> <span m='3428460'>red?</span>
  <span m='3435960'>It's</span> <span m='3436070'>going</span> <span m='3436220'>to</span>
  <span m='3436310'>be</span> <span m='3437210'>less</span> <span m='3437480'>than</span>
  <span m='3437640'>or</span> <span m='3437700'>equal</span> <span m='3437900'>to</span>
  <span m='3438200'>y.</span> <span m='3448640'>This</span> <span m='3448880'>thing</span>
  <span m='3449270'>is</span> <span m='3449420'>going</span> <span m='3449600'>to</span>
  <span m='3449690'>be</span> <span m='3449900'>Si.</span> <span m='3459250'>We'll</span>
  <span m='3459370'>see</span> <span m='3459610'>why,</span> <span m='3459880'>eventually,</span>
  <span m='3460900'>this</span> <span m='3461110'>works.</span> </p><p><span m='3462370'>I</span>
  <span m='3462410'>still</span> <span m='3462610'>don't</span> <span m='3462730'>know</span>
  <span m='3462820'>what</span> <span m='3462940'>maximize</span> <span m='3463370'>common</span>
  <span m='3463660'>suffix</span> <span m='3464080'>means,</span> <span m='3464420'>but</span>
  <span m='3465240'>we'll</span> <span m='3465580'>get</span> <span m='3465730'>there.</span>
  <span m='3467450'>So</span> <span m='3468520'>we're</span> <span m='3468700'>looking</span>
  <span m='3469120'>at</span> <span m='3469480'>the</span> <span m='3469630'>points</span>
  <span m='3469960'>below</span> <span m='3470350'>the</span> <span m='3470470'>line.</span>
  <span m='3470770'>That's</span> <span m='3470980'>what</span> <span m='3471070'>we</span>
  <span m='3471160'>did</span> <span m='3471340'>before.</span> <span m='3472180'>We</span>
  <span m='3472270'>used</span> <span m='3472450'>to</span> <span m='3472540'>say</span>
  <span m='3472750'>Si</span> <span m='3473050'>is</span> <span m='3473350'>just</span>
  <span m='3473650'>the</span> <span m='3473990'>intersection</span> <span m='3474490'>with</span>
  <span m='3474580'>less</span> <span m='3474790'>than or</span> <span m='3475030'>equal</span>
  <span m='3475130'>to</span> <span m='3475210'>yi.</span> <span m='3476380'>But</span>
  <span m='3477010'>things</span> <span m='3477370'>are</span> <span m='3477670'>just</span>
  <span m='3477940'>a</span> <span m='3477970'>little</span> <span m='3478360'>bit</span>
  <span m='3478540'>messier</span> <span m='3479560'>because</span> <span m='3480130'>of</span>
  <span m='3481690'>this</span> <span m='3482200'>restriction.</span> <span m='3483270'>Do
  I</span> <span m='3483340'>really</span> <span m='3483610'>not</span> <span m='3483790'>have</span>
  <span m='3483940'>a P</span> <span m='3484280'>here?</span> <span m='3486400'>OK,</span>
  <span m='3486790'>here's</span> <span m='3487060'>the</span> <span m='3487180'>difference.</span>
  <span m='3488770'>The</span> <span m='3488830'>reason</span> <span m='3489100'>we</span>
  <span m='3489220'>have</span> <span m='3489400'>to</span> <span m='3489490'>go</span>
  <span m='3489640'>through</span> <span m='3489820'>this</span> <span m='3490000'>business.</span>
  </p><p><span m='3490720'>The</span> <span m='3490870'>array</span> <span m='3491200'>that</span>
  <span m='3491350'>we're</span> <span m='3491440'>going</span> <span m='3491560'>to</span>
  <span m='3491620'>store</span> <span m='3492550'>is</span> <span m='3492730'>not</span>
  <span m='3493270'>the</span> <span m='3493510'>Si's.</span> <span m='3494740'>Si's</span>
  <span m='3495010'>are</span> <span m='3495100'>still</span> <span m='3495490'>too</span>
  <span m='3495670'>big,</span> <span m='3495950'>potentially.</span> <span m='3497270'>What
  we're</span> <span m='3497420'>going</span> <span m='3497530'>to</span> <span m='3497590'>store</span>
  <span m='3497950'>are</span> <span m='3498070'>the</span> <span m='3498400'>Pi's.</span>
  <span m='3507664'>Pi</span> <span m='3508150'>minus</span> <span m='3508560'>1.</span>
  <span m='3509630'>And</span> <span m='3509780'>then</span> <span m='3509930'>in</span>
  <span m='3510020'>the</span> <span m='3510140'>end,</span> <span m='3510390'>we're</span>
  <span m='3510490'>in</span> <span m='3510590'>a</span> <span m='3510690'>store</span>
  <span m='3510770'>Si.</span> <span m='3511265'>Si,</span> <span m='3511760'>again,</span>
  <span m='3511990'>has</span> <span m='3512210'>constant</span> <span m='3512600'>size.</span>
  <span m='3514250'>The</span> <span m='3514340'>final</span> <span m='3514730'>Si</span>
  <span m='3515300'>has</span> <span m='3515480'>constants size.</span> <span m='3515870'>I</span>
  <span m='3516020'>probably</span> <span m='3516260'>should</span> <span m='3516410'>have</span>
  <span m='3516560'>used a</span> <span m='3516620'>different</span> <span m='3516890'>letter,</span>
  <span m='3517130'>Sk</span> <span m='3517550'>or</span> <span m='3517610'>whatever.</span>
  </p><p><span m='3519490'>We</span> <span m='3519650'>keep</span> <span m='3519890'>doing</span>
  <span m='3520190'>this</span> <span m='3520640'>until</span> <span m='3520910'>we</span>
  <span m='3521000'>get</span> <span m='3521120'>down</span> <span m='3521300'>to</span>
  <span m='3521360'>something</span> <span m='3521630'>constant</span> <span m='3521960'>sized,</span>
  <span m='3522260'>then</span> <span m='3522410'>we</span> <span m='3522500'>store</span>
  <span m='3522800'>it.</span> <span m='3523190'>That's</span> <span m='3523460'>the</span>
  <span m='3523730'>easy</span> <span m='3523970'>case.</span> <span m='3526460'>Until</span>
  <span m='3526820'>then,</span> <span m='3527330'>we</span> <span m='3527450'>just</span>
  <span m='3527660'>store</span> <span m='3527810'>the</span> <span m='3527910'>Pi's,</span>
  <span m='3528350'>because</span> <span m='3528530'>really,</span> <span m='3529850'>we</span>
  <span m='3530060'>know</span> <span m='3530390'>that</span> <span m='3530960'>all</span>
  <span m='3531140'>the</span> <span m='3531230'>queries</span> <span m='3531620'>up</span>
  <span m='3531770'>here</span> <span m='3532280'>and</span> <span m='3532400'>over</span>
  <span m='3532610'>here</span> <span m='3533660'>are</span> <span m='3534020'>OK.</span>
  <span m='3535800'>They're</span> <span m='3535850'>nice</span> <span m='3536060'>and</span>
  <span m='3536150'>dense.</span> <span m='3537200'>We</span> <span m='3537380'>sort</span>
  <span m='3537650'>of</span> <span m='3537740'>only</span> <span m='3538040'>care</span>
  <span m='3538280'>about</span> <span m='3538520'>the</span> <span m='3538640'>points</span>
  <span m='3539210'>to</span> <span m='3539300'>the</span> <span m='3539390'>left</span>
  <span m='3539660'>of</span> <span m='3539720'>the</span> <span m='3539840'>line.</span>
  </p><p><span m='3542210'>OK,</span> <span m='3542630'>but</span> <span m='3543500'>essentially,</span>
  <span m='3544600'>the</span> <span m='3544790'>Si has</span> <span m='3544910'>to
  pick</span> <span m='3545090'>up</span> <span m='3545210'>the</span> <span m='3545330'>slack</span>
  <span m='3547310'>and</span> <span m='3547550'>we</span> <span m='3547670'>have</span>
  <span m='3547850'>to</span> <span m='3547940'>include</span> <span m='3548420'>these</span>
  <span m='3548930'>points</span> <span m='3549970'>in</span> <span m='3550430'>the</span>
  <span m='3550550'>next</span> <span m='3550880'>Si.</span> <span m='3551390'>Whereas,</span>
  <span m='3551660'>before,</span> <span m='3552080'>we</span> <span m='3552200'>did</span>
  <span m='3552380'>not.</span> <span m='3552950'>Before</span> <span m='3553340'>we</span>
  <span m='3553490'>just</span> <span m='3553760'>took</span> <span m='3553970'>things</span>
  <span m='3554240'>below</span> <span m='3554570'>the</span> <span m='3554690'>line.</span>
  <span m='3555440'>Now</span> <span m='3555600'>we</span> <span m='3555640'>have</span>
  <span m='3555740'>to</span> <span m='3555830'>take</span> <span m='3555980'>things</span>
  <span m='3556160'>that</span> <span m='3556280'>are</span> <span m='3556340'>below</span>
  <span m='3556580'>the</span> <span m='3556670'>line</span> <span m='3557030'>or</span>
  <span m='3557390'>to</span> <span m='3557540'>the</span> <span m='3557690'>right</span>
  <span m='3559340'>of</span> <span m='3559520'>the</span> <span m='3559640'>vertical</span>
  <span m='3559970'>line.</span> <span m='3563390'>This is</span> <span m='3563600'>essentially</span>
  <span m='3564100'>necessary</span> <span m='3564620'>for</span> <span m='3565040'>correctness.</span>
  </p><p><span m='3571640'>So</span> <span m='3571990'>we</span> <span m='3572170'>kind</span>
  <span m='3572380'>of</span> <span m='3572440'>win</span> <span m='3572650'>some,</span>
  <span m='3572980'>we</span> <span m='3573070'>lose</span> <span m='3573250'>some.</span>
  <span m='3574480'>But</span> <span m='3574630'>it</span> <span m='3574720'>turns</span>
  <span m='3575050'>out</span> <span m='3578050'>all</span> <span m='3578380'>is</span>
  <span m='3578560'>well.</span> <span m='3579730'>So</span> <span m='3580150'>I</span>
  <span m='3580240'>know</span> <span m='3580390'>this</span> <span m='3580570'>is</span>
  <span m='3580690'>weird,</span> <span m='3583340'>but</span> <span m='3583480'>let's</span>
  <span m='3584020'>jump</span> <span m='3584440'>to</span> <span m='3586030'>the</span>
  <span m='3586150'>analysis.</span> <span m='3586840'>These</span> <span m='3587020'>claims,</span>
  <span m='3587800'>in</span> <span m='3587920'>particular,</span> <span m='3588430'>that</span>
  <span m='3588610'>the</span> <span m='3588820'>array</span> <span m='3589210'>has</span>
  <span m='3589420'>linear</span> <span m='3589810'>size.</span> <span m='3591370'>Let's
  think</span> <span m='3591490'>about</span> <span m='3591760'>that</span> <span
  m='3592620'>and</span> <span m='3592720'>it</span> <span m='3592810'>will</span>
  <span m='3592900'>become</span> <span m='3593200'>clear</span> <span m='3593470'>why</span>
  <span m='3593980'>the</span> <span m='3594100'>heck</span> <span m='3594460'>we've</span>
  <span m='3594700'>made</span> <span m='3594940'>these</span> <span m='3595150'>choices.</span>
  <span m='3598120'>Unless</span> <span m='3598270'>you have</span> <span m='3598360'>a</span>
  <span m='3598390'>question</span> <span m='3598690'>first.</span> </p><p><span m='3599210'>AUDIENCE:</span>
  <span m='3599374'>Is</span> <span m='3599538'>there</span> <span m='3599702'>any
  relationship</span> <span m='3600194'>between the</span> <span m='3600686'>Si here</span>
  <span m='3601178'>and</span> <span m='3601301'>the</span> <span m='3601424'>Si</span>
  <span m='3601670'>on the</span> <span m='3602162'>first try?</span> </p><p><span
  m='3602660'>ERIK DEMAINE:</span> <span m='3602730'>No,</span> <span m='3603180'>this</span>
  <span m='3603460'>definition</span> <span m='3603910'>of</span> <span m='3604000'>Si</span>
  <span m='3604480'>is</span> <span m='3604600'>no</span> <span m='3604840'>longer</span>
  <span m='3605170'>in</span> <span m='3605260'>effect.</span> <span m='3606340'>S0</span>
  <span m='3607470'>is</span> <span m='3607690'>correct,</span> <span m='3608890'>and</span>
  <span m='3609040'>all</span> <span m='3609190'>the</span> <span m='3609350'>Si's</span>
  <span m='3609640'>are</span> <span m='3609730'>still</span> <span m='3609910'>sorted</span>
  <span m='3610210'>by</span> <span m='3610360'>x.</span> <span m='3612250'>We're</span>
  <span m='3612370'>no</span> <span m='3612520'>longer</span> <span m='3612760'>doing</span>
  <span m='3613030'>this.</span> <span m='3613900'>Instead</span> <span m='3614410'>of</span>
  <span m='3614530'>this</span> <span m='3615100'>rule,</span> <span m='3615880'>we're</span>
  <span m='3616000'>doing</span> <span m='3616300'>this</span> <span m='3616540'>rule.</span>
  <span m='3618010'>This</span> <span m='3618190'>part</span> <span m='3618430'>is</span>
  <span m='3618550'>the</span> <span m='3618640'>same,</span> <span m='3619580'>but</span>
  <span m='3619630'>we</span> <span m='3619720'>have</span> <span m='3619840'>this</span>
  <span m='3619990'>extra</span> <span m='3620260'>union,</span> <span m='3620620'>which</span>
  <span m='3620950'>contradicts</span> <span m='3621490'>the</span> <span m='3621580'>previous</span>
  <span m='3622000'>rule.</span> <span m='3623320'>So</span> <span m='3623480'>the</span>
  <span m='3623630'>yi</span> <span m='3624010'>definition</span> <span m='3624460'>is</span>
  <span m='3624550'>the</span> <span m='3624640'>same.</span> <span m='3625480'>Sorry,</span>
  <span m='3625690'>it's</span> <span m='3625840'>a</span> <span m='3625870'>little</span>
  <span m='3626050'>weird.</span> <span m='3626710'>xi</span> <span m='3626995'>is</span>
  <span m='3627280'>new,</span> <span m='3628000'>Pi</span> <span m='3628495'>is new,</span>
  <span m='3629500'>and</span> <span m='3629710'>Si</span> <span m='3630110'>is</span>
  <span m='3630280'>new.</span> </p><p><span m='3636900'>At</span> <span m='3637020'>this</span>
  <span m='3637200'>point,</span> <span m='3637530'>it's</span> <span m='3637805'>this</span>
  <span m='3638080'>algebraic</span> <span m='3638670'>weird</span> <span m='3638880'>thing.</span>
  <span m='3639940'>Here's</span> <span m='3640230'>the</span> <span m='3640320'>cool</span>
  <span m='3640530'>thing.</span> <span m='3643080'>For</span> <span m='3643350'>the</span>
  <span m='3643410'>space</span> <span m='3643720'>bound,</span> <span m='3645828'>the</span>
  <span m='3646260'>claim</span> <span m='3646710'>is</span> <span m='3650930'>Pi</span>
  <span m='3651670'>minus</span> <span m='3652100'>1</span> <span m='3652522'>intersect</span>
  <span m='3653790'>Si</span> <span m='3655400'>is</span> <span m='3655670'>less</span>
  <span m='3655910'>than</span> <span m='3656000'>or</span> <span m='3656060'>equal</span>
  <span m='3656300'>to</span> <span m='3657410'>1</span> <span m='3657710'>over</span>
  <span m='3657980'>alpha</span> <span m='3659480'>times</span> <span m='3660880'>Pi</span>
  <span m='3661610'>minus</span> <span m='3662030'>1.</span> <span m='3664370'>This
  is</span> <span m='3664490'>hard</span> <span m='3664670'>to</span> <span m='3664760'>even</span>
  <span m='3665000'>interpret</span> <span m='3665450'>what</span> <span m='3665600'>it</span>
  <span m='3665690'>means,</span> <span m='3666590'>but</span> <span m='3667340'>it's</span>
  <span m='3667520'>good news.</span> </p><p><span m='3669450'>So</span> <span m='3670130'>remember,</span>
  <span m='3670580'>alpha</span> <span m='3671000'>is</span> <span m='3671180'>a</span>
  <span m='3671240'>number</span> <span m='3671630'>bigger</span> <span m='3671930'>than</span>
  <span m='3672110'>1.</span> <span m='3672920'>It's</span> <span m='3673880'>what</span>
  <span m='3674060'>we</span> <span m='3674180'>use</span> <span m='3674420'>in</span>
  <span m='3674510'>the</span> <span m='3674600'>definition</span> <span m='3675050'>of</span>
  <span m='3675140'>density,</span> <span m='3675560'>and</span> <span m='3675610'>you</span>
  <span m='3675660'>could</span> <span m='3675800'>set</span> <span m='3676010'>this</span>
  <span m='3676160'>parameter</span> <span m='3676490'>to</span> <span m='3676530'>whatever</span>
  <span m='3676790'>you</span> <span m='3676880'>want,</span> <span m='3677090'>say</span>
  <span m='3677300'>2.</span> <span m='3680420'>So</span> <span m='3680660'>then</span>
  <span m='3680870'>we're</span> <span m='3680980'>going</span> <span m='3681060'>to</span>
  <span m='3681160'>get</span> <span m='3681520'>that</span> <span m='3681980'>this</span>
  <span m='3682250'>thing,</span> <span m='3682620'>whatever</span> <span m='3682790'>it</span>
  <span m='3682880'>is,</span> <span m='3683360'>is</span> <span m='3683510'>at</span>
  <span m='3683570'>most</span> <span m='3683840'>half</span> <span m='3684290'>the</span>
  <span m='3684410'>size</span> <span m='3684770'>of</span> <span m='3684830'>the</span>
  <span m='3684920'>previous</span> <span m='3685490'>one.</span> </p><p><span m='3688640'>I</span>
  <span m='3688790'>claim</span> <span m='3689090'>this</span> <span m='3689270'>is</span>
  <span m='3689360'>good</span> <span m='3689510'>news.</span> <span m='3690680'>I</span>
  <span m='3690770'>claim</span> <span m='3691190'>it</span> <span m='3691280'>means</span>
  <span m='3691670'>that</span> <span m='3691970'>these</span> <span m='3692360'>Pi's</span>
  <span m='3693320'>essentially</span> <span m='3694820'>are</span> <span m='3695270'>geometrically</span>
  <span m='3696080'>decreasing</span> <span m='3696650'>in</span> <span m='3696770'>size,</span>
  <span m='3697780'>which</span> <span m='3697850'>is</span> <span m='3697980'>how</span>
  <span m='3698150'>we</span> <span m='3698270'>get--</span> <span m='3700550'>that's</span>
  <span m='3700760'>not</span> <span m='3700910'>quite</span> <span m='3701210'>right,</span>
  <span m='3701520'>but</span> <span m='3702170'>this</span> <span m='3702350'>will</span>
  <span m='3702470'>give</span> <span m='3702650'>us</span> <span m='3702740'>a</span>
  <span m='3702830'>charging</span> <span m='3703250'>scheme.</span> <span m='3705050'>which</span>
  <span m='3705290'>will</span> <span m='3705440'>prove</span> <span m='3705680'>that</span>
  <span m='3705790'>the</span> <span m='3705920'>whole</span> <span m='3706070'>thing</span>
  <span m='3706280'>has</span> <span m='3706400'>linear</span> <span m='3706700'>size.</span>
  </p><p><span m='3707530'>First,</span> <span m='3708440'>why</span> <span m='3708830'>is</span>
  <span m='3708980'>this</span> <span m='3709160'>true?</span> <span m='3710830'>It
  could</span> <span m='3711110'>really</span> <span m='3711320'>only</span> <span
  m='3711500'>be</span> <span m='3711620'>true</span> <span m='3711890'>for</span>
  <span m='3712670'>sparsity</span> <span m='3713360'>from</span> <span m='3713810'>the</span>
  <span m='3713990'>alpha.</span> <span m='3715010'>Right,</span> <span m='3715190'>so</span>
  <span m='3715340'>we</span> <span m='3715400'>said</span> <span m='3715730'>oh,</span>
  <span m='3716330'>density</span> <span m='3716840'>is</span> <span m='3716990'>good.</span>
  <span m='3717550'>If we</span> <span m='3717640'>have</span> <span m='3717770'>dense,</span>
  <span m='3719010'>there's</span> <span m='3719090'>nothing</span> <span m='3719390'>to</span>
  <span m='3719480'>do.</span> <span m='3719840'>Just</span> <span m='3720320'>put</span>
  <span m='3720530'>the</span> <span m='3720620'>points</span> <span m='3720920'>in</span>
  <span m='3721040'>x</span> <span m='3721220'>order,</span> <span m='3721730'>we're</span>
  <span m='3721820'>done.</span> <span m='3723650'>Sparse</span> <span m='3724100'>is</span>
  <span m='3724220'>bad.</span> <span m='3724670'>But</span> <span m='3724850'>actually,</span>
  <span m='3725330'>sparse</span> <span m='3725720'>tells</span> <span m='3726050'>us</span>
  <span m='3726140'>something.</span> <span m='3727470'>It</span> <span m='3727490'>tells</span>
  <span m='3727820'>us</span> <span m='3728360'>there</span> <span m='3728480'>are</span>
  <span m='3728510'>a</span> <span m='3728570'>lot</span> <span m='3728780'>of</span>
  <span m='3728870'>points</span> <span m='3729680'>that</span> <span m='3729800'>are</span>
  <span m='3729890'>not</span> <span m='3730130'>in</span> <span m='3730250'>the</span>
  <span m='3730370'>answer.</span> </p><p><span m='3731550'>So</span> <span m='3731600'>we're</span>
  <span m='3731690'>looking</span> <span m='3731960'>at</span> <span m='3732050'>this</span>
  <span m='3732260'>query,</span> <span m='3732560'>xi</span> <span m='3732930'>yi.</span>
  <span m='3734250'>And</span> <span m='3734580'>we'd</span> <span m='3734750'>like</span>
  <span m='3734930'>to</span> <span m='3735020'>just</span> <span m='3735170'>say</span>
  <span m='3735380'>oh,</span> <span m='3735820'>start</span> <span m='3736190'>at</span>
  <span m='3737120'>negative</span> <span m='3737390'>infinity,</span> <span m='3737750'>and
  just</span> <span m='3738020'>take</span> <span m='3738320'>all</span> <span m='3738710'>the</span>
  <span m='3738830'>points</span> <span m='3739160'>up</span> <span m='3739310'>to</span>
  <span m='3739430'>here.</span> <span m='3741350'>If</span> <span m='3741500'>we're</span>
  <span m='3741590'>dense,</span> <span m='3742490'>that</span> <span m='3742670'>is</span>
  <span m='3743090'>within</span> <span m='3743360'>a</span> <span m='3743420'>constant</span>
  <span m='3743780'>factor</span> <span m='3744320'>of</span> <span m='3744650'>the</span>
  <span m='3744890'>number</span> <span m='3745160'>of</span> <span m='3745250'>points</span>
  <span m='3745580'>that</span> <span m='3745670'>are</span> <span m='3745760'>actually</span>
  <span m='3746480'>in</span> <span m='3746630'>the</span> <span m='3746780'>answer,</span>
  <span m='3747240'>which</span> <span m='3747320'>is</span> <span m='3747410'>down</span>
  <span m='3747650'>here.</span> <span m='3749400'>If</span> <span m='3749480'>we're</span>
  <span m='3749600'>sparse,</span> <span m='3750230'>that</span> <span m='3750470'>means</span>
  <span m='3750860'>there</span> <span m='3751040'>are</span> <span m='3751070'>a</span>
  <span m='3751130'>lot</span> <span m='3751460'>of</span> <span m='3751550'>points</span>
  <span m='3751815'>up</span> <span m='3752080'>here.</span> <span m='3754730'>Most</span>
  <span m='3755300'>of</span> <span m='3755360'>the</span> <span m='3755480'>points</span>
  <span m='3755840'>have</span> <span m='3756050'>to</span> <span m='3756140'>be</span>
  <span m='3756290'>up</span> <span m='3756470'>here</span> <span m='3756740'>in</span>
  <span m='3756860'>order</span> <span m='3757040'>to</span> <span m='3757160'>be</span>
  <span m='3757280'>sparse.</span> <span m='3759710'>And</span> <span m='3759830'>that's</span>
  <span m='3760100'>actually</span> <span m='3760370'>what</span> <span m='3760550'>this</span>
  <span m='3760700'>is</span> <span m='3760760'>saying</span> <span m='3761480'>if</span>
  <span m='3761630'>you</span> <span m='3762080'>expand</span> <span m='3762680'>the</span>
  <span m='3762770'>definitions.</span> </p><p><span m='3763870'>So</span> <span m='3764040'>Pi</span>
  <span m='3764420'>minus</span> <span m='3764750'>1,</span> <span m='3765110'>that
  was</span> <span m='3765320'>all</span> <span m='3765620'>the</span> <span m='3765740'>stuff</span>
  <span m='3766070'>to</span> <span m='3766250'>the</span> <span m='3766370'>left.</span>
  <span m='3767820'>So</span> <span m='3767900'>that's</span> <span m='3768230'>this</span>
  <span m='3768430'>thing.</span> <span m='3768980'>This</span> <span m='3769190'>is</span>
  <span m='3769250'>what</span> <span m='3769430'>we</span> <span m='3769580'>would</span>
  <span m='3769820'>get</span> <span m='3770060'>if</span> <span m='3770180'>we</span>
  <span m='3770270'>just</span> <span m='3770510'>did</span> <span m='3770690'>a</span>
  <span m='3770750'>linear</span> <span m='3771080'>scan</span> <span m='3771410'>from</span>
  <span m='3771590'>left</span> <span m='3771770'>to</span> <span m='3771860'>right.</span>
  <span m='3773810'>Versus</span> <span m='3775160'>we're</span> <span m='3775250'>considering</span>
  <span m='3775700'>the</span> <span m='3775790'>points</span> <span m='3776870'>in</span>
  <span m='3777470'>Pi</span> <span m='3777920'>minus</span> <span m='3778250'>1,</span>
  <span m='3778965'>which</span> <span m='3779240'>just</span> <span m='3779410'>restricts</span>
  <span m='3779840'>to</span> <span m='3779960'>x,</span> <span m='3780980'>and</span>
  <span m='3781160'>then</span> <span m='3781310'>we're</span> <span m='3781430'>looking</span>
  <span m='3781790'>at</span> <span m='3782060'>Si.</span> </p><p><span m='3784090'>Si</span>
  <span m='3784610'>does</span> <span m='3785300'>this</span> <span m='3786260'>business.</span>
  <span m='3786890'>But</span> <span m='3787100'>if</span> <span m='3787250'>we</span>
  <span m='3787400'>restrict</span> <span m='3787790'>to</span> <span m='3787940'>the</span>
  <span m='3788060'>Si</span> <span m='3788480'>points</span> <span m='3789200'>that</span>
  <span m='3789320'>are</span> <span m='3789410'>to</span> <span m='3789560'>the</span>
  <span m='3789620'>left</span> <span m='3790010'>of</span> <span m='3790100'>the</span>
  <span m='3790220'>line--</span> <span m='3791660'>so</span> <span m='3791840'>we're</span>
  <span m='3791960'>looking</span> <span m='3792260'>at,</span> <span m='3792440'>basically,</span>
  <span m='3793280'>this</span> <span m='3793460'>left</span> <span m='3793940'>portion,</span>
  <span m='3795140'>which</span> <span m='3795260'>was</span> <span m='3795410'>this</span>
  <span m='3795560'>white</span> <span m='3795830'>rectangle,</span> <span m='3796460'>intersected</span>
  <span m='3797150'>with</span> <span m='3797300'>this</span> <span m='3797510'>funny</span>
  <span m='3797870'>red</span> <span m='3798140'>rectangle,</span> <span m='3799640'>which</span>
  <span m='3799760'>was</span> <span m='3799850'>kind</span> <span m='3800030'>of</span>
  <span m='3800150'>awkward--</span> <span m='3800750'>the</span> <span m='3800870'>intersection</span>
  <span m='3801350'>is</span> <span m='3801440'>just</span> <span m='3801590'>this.</span>
  <span m='3802310'>That's the</span> <span m='3802460'>answer</span> <span m='3803360'>for</span>
  <span m='3803750'>this</span> <span m='3803990'>query,</span> <span m='3804380'>xi
  yi.</span> <span m='3806120'>OK,</span> <span m='3806300'>so</span> <span m='3806450'>this</span>
  <span m='3806690'>is</span> <span m='3806840'>the</span> <span m='3808910'>size</span>
  <span m='3809270'>of</span> <span m='3809330'>the</span> <span m='3809480'>answer</span>
  <span m='3813620'>for</span> <span m='3815720'>xi yi.</span> <span m='3818540'>And</span>
  <span m='3818780'>this</span> <span m='3819080'>was</span> <span m='3826240'>the</span>
  <span m='3826520'>number</span> <span m='3826760'>of</span> <span m='3826820'>points</span>
  <span m='3827270'>in</span> <span m='3828470'>less</span> <span m='3828780'>than</span>
  <span m='3828880'>or</span> <span m='3828980'>equal</span> <span m='3829130'>to</span>
  <span m='3829580'>xi</span> <span m='3830500'>star.</span> </p><p><span m='3833660'>We</span>
  <span m='3833840'>wanted</span> <span m='3834110'>to</span> <span m='3834200'>just</span>
  <span m='3834380'>do</span> <span m='3834500'>a</span> <span m='3834530'>linear</span>
  <span m='3834800'>scan</span> <span m='3835160'>like</span> <span m='3835310'>this.</span>
  <span m='3836330'>But</span> <span m='3836540'>this</span> <span m='3836720'>is</span>
  <span m='3836870'>the</span> <span m='3836990'>correct</span> <span m='3837380'>answer</span>
  <span m='3838280'>and</span> <span m='3838490'>because</span> <span m='3839090'>we</span>
  <span m='3839300'>know</span> <span m='3839600'>that</span> <span m='3839780'>this</span>
  <span m='3839960'>point</span> <span m='3840260'>is</span> <span m='3840410'>sparse--</span>
  <span m='3840890'>that</span> <span m='3841040'>was</span> <span m='3841190'>the</span>
  <span m='3841250'>definition</span> <span m='3841820'>of</span> <span m='3841970'>xi</span>
  <span m='3842150'>and</span> <span m='3842600'>yi,</span> <span m='3842810'>it was</span>
  <span m='3842960'>the</span> <span m='3843080'>maximum</span> <span m='3843650'>sparse</span>
  <span m='3843980'>point.</span> <span m='3844280'>So</span> <span m='3844430'>it's</span>
  <span m='3844520'>a</span> <span m='3844580'>sparse</span> <span m='3844910'>point,</span>
  <span m='3845600'>therefore</span> <span m='3845930'>we</span> <span m='3846050'>know</span>
  <span m='3846230'>that</span> <span m='3846410'>this</span> <span m='3846710'>does</span>
  <span m='3846890'>not</span> <span m='3847190'>hold.</span> </p><p><span m='3848940'>So</span>
  <span m='3849080'>the</span> <span m='3849110'>number</span> <span m='3849350'>of</span>
  <span m='3849410'>points</span> <span m='3849720'>less than</span> <span m='3850070'>or
  equal</span> <span m='3850230'>to x comma</span> <span m='3850730'>star</span> <span
  m='3851000'>is</span> <span m='3851150'>greater</span> <span m='3851810'>than</span>
  <span m='3852110'>alpha</span> <span m='3853280'>times the</span> <span m='3853520'>number</span>
  <span m='3853730'>of</span> <span m='3853790'>points</span> <span m='3854180'>in</span>
  <span m='3854450'>the</span> <span m='3854570'>correct</span> <span m='3855020'>range.</span>
  <span m='3856190'>And</span> <span m='3856290'>if</span> <span m='3856310'>I</span>
  <span m='3856400'>got</span> <span m='3856610'>it</span> <span m='3856700'>right,</span>
  <span m='3857870'>that</span> <span m='3857990'>should</span> <span m='3858170'>be</span>
  <span m='3858260'>this.</span> <span m='3858700'>You could put</span> <span m='3858920'>alpha</span>
  <span m='3859280'>over</span> <span m='3859520'>here</span> <span m='3859940'>without</span>
  <span m='3860210'>the</span> <span m='3860330'>one</span> <span m='3860540'>over</span>
  <span m='3861240'>and</span> <span m='3861650'>I</span> <span m='3861680'>guess</span>
  <span m='3861890'>this</span> <span m='3862070'>is</span> <span m='3862160'>strictly</span>
  <span m='3862580'>greater.</span> <span m='3863840'>No</span> <span m='3863930'>big</span>
  <span m='3864080'>deal.</span> <span m='3866000'>So</span> <span m='3866180'>that's</span>
  <span m='3866400'>the</span> <span m='3866450'>definition</span> <span m='3866870'>of</span>
  <span m='3866930'>sparsity.</span> <span m='3868820'>So</span> <span m='3868950'>this</span>
  <span m='3869100'>is</span> <span m='3869220'>the</span> <span m='3869310'>cool</span>
  <span m='3869550'>thing</span> <span m='3869760'>we</span> <span m='3869850'>know.</span>
  <span m='3870690'>Now,</span> <span m='3873030'>we're</span> <span m='3873180'>going</span>
  <span m='3873290'>to</span> <span m='3873390'>use--</span> <span m='3873930'>this</span>
  <span m='3874110'>is</span> <span m='3874200'>now</span> <span m='3874380'>a</span>
  <span m='3874440'>numbered</span> <span m='3874800'>less</span> <span m='3875130'>than</span>
  <span m='3875280'>1.</span> <span m='3876630'>Question?</span> </p><p><span m='3877080'>AUDIENCE:</span>
  <span m='3877324'>So</span> <span m='3877568'>for</span> <span m='3878056'>Pi</span>
  <span m='3878544'>minus 1,</span> <span m='3879032'>we add them</span> <span m='3879520'>as
  the number of</span> <span m='3880008'>points</span> <span m='3880089'>less</span>
  <span m='3880170'>than</span> <span m='3880251'>xi</span> <span m='3880413'>star.</span>
  <span m='3881472'>But</span> <span m='3881960'>for example--</span> </p><p><span
  m='3882450'>ERIK DEMAINE:</span> <span m='3882690'>Yes,</span> <span m='3882930'>that's</span>
  <span m='3883110'>the</span> <span m='3883170'>definition</span> <span m='3883620'>here.</span>
  </p><p><span m='3883860'>AUDIENCE:</span> <span m='3884092'>[INAUDIBLE]</span> <span
  m='3884325'>like Pi,</span> <span m='3884790'>you don't</span> <span m='3885255'>have</span>
  <span m='3885720'>that block</span> <span m='3886185'>in</span> <span m='3886650'>the</span>
  <span m='3887115'>top</span> <span m='3887580'>left</span> <span m='3888045'>corner,</span>
  <span m='3888510'>right?</span> </p><p><span m='3888980'>ERIK DEMAINE:</span> <span
  m='3889100'>Right.</span> <span m='3890250'>After</span> <span m='3890550'>we</span>
  <span m='3890730'>restrict</span> <span m='3891130'>to</span> <span m='3891210'>Si,</span>
  <span m='3891720'>yeah,</span> <span m='3891900'>we've</span> <span m='3892080'>thrown</span>
  <span m='3892410'>away</span> <span m='3892650'>all</span> <span m='3892830'>of</span>
  <span m='3892920'>these</span> <span m='3893070'>points.</span> </p><p><span m='3893490'>AUDIENCE:</span>
  <span m='3893740'>Right.</span> <span m='3893990'>So if you take</span> <span m='3894490'>the
  next</span> <span m='3894990'>Pi,</span> <span m='3895490'>it's not necessarily</span>
  <span m='3895990'>going to be</span> <span m='3896490'>the points</span> <span m='3896990'>less
  than or equal</span> <span m='3897490'>to xi--</span> </p><p><span m='3897990'>ERIK
  DEMAINE:</span> <span m='3898080'>It's</span> <span m='3898170'>true.</span> <span
  m='3899280'>When</span> <span m='3899460'>I</span> <span m='3899520'>say</span>
  <span m='3899730'>points,</span> <span m='3900120'>I</span> <span m='3900210'>don't</span>
  <span m='3900390'>mean</span> <span m='3900630'>all</span> <span m='3900810'>points.</span>
  <span m='3901650'>I</span> <span m='3901800'>mean</span> <span m='3902430'>points</span>
  <span m='3902790'>in</span> <span m='3902960'>Si</span> <span m='3903250'>minus</span>
  <span m='3903610'>1.</span> <span m='3904480'>I'm</span> <span m='3904770'>dropping</span>
  <span m='3905220'>that</span> <span m='3905400'>because</span> <span m='3905610'>it</span>
  <span m='3905670'>gets</span> <span m='3905880'>awkward</span> <span m='3906240'>to</span>
  <span m='3906330'>keep</span> <span m='3906450'>talking</span> <span m='3906780'>about.</span>
  <span m='3908610'>So</span> <span m='3908760'>that's a</span> <span m='3909220'>correctness</span>
  <span m='3909840'>issue,</span> <span m='3910080'>essentially.</span> <span m='3910530'>You</span>
  <span m='3910680'>have</span> <span m='3910800'>to</span> <span m='3910890'>argue</span>
  <span m='3911220'>that</span> <span m='3911400'>we</span> <span m='3911550'>can</span>
  <span m='3911820'>throw</span> <span m='3912000'>away</span> <span m='3912150'>these</span>
  <span m='3912330'>points</span> <span m='3912600'>and</span> <span m='3912690'>it's</span>
  <span m='3912810'>safe.</span> <span m='3914070'>Once</span> <span m='3914280'>we</span>
  <span m='3914400'>do,</span> <span m='3914730'>then</span> <span m='3914940'>you</span>
  <span m='3915000'>could</span> <span m='3915080'>just</span> <span m='3915570'>ignore</span>
  <span m='3916140'>their</span> <span m='3916290'>existence.</span> </p><p><span
  m='3918940'>You</span> <span m='3918960'>can</span> <span m='3919080'>ignore</span>
  <span m='3919320'>their</span> <span m='3919410'>existence</span> <span m='3919740'>because</span>
  <span m='3921700'>you</span> <span m='3921930'>already</span> <span m='3922140'>solved</span>
  <span m='3922410'>all</span> <span m='3922500'>the</span> <span m='3922620'>dense</span>
  <span m='3922860'>queries,</span> <span m='3923220'>which</span> <span m='3923400'>are</span>
  <span m='3923460'>over</span> <span m='3923640'>here,</span> <span m='3924060'>or
  over</span> <span m='3924270'>here,</span> <span m='3924640'>which</span> <span
  m='3924720'>involve</span> <span m='3925080'>those</span> <span m='3925290'>points.</span>
  <span m='3926700'>And</span> <span m='3926820'>so</span> <span m='3927300'>we</span>
  <span m='3927450'>now</span> <span m='3927660'>know</span> <span m='3927840'>that</span>
  <span m='3927930'>we're</span> <span m='3928050'>only</span> <span m='3928290'>going</span>
  <span m='3928410'>to</span> <span m='3928470'>be</span> <span m='3928560'>doing</span>
  <span m='3928890'>queries</span> <span m='3929250'>from</span> <span m='3929490'>here</span>
  <span m='3929700'>down.</span> <span m='3931950'>Otherwise,</span> <span m='3932400'>you</span>
  <span m='3932670'>look</span> <span m='3932850'>at</span> <span m='3932930'>P0.</span>
  </p><p><span m='3934140'>So</span> <span m='3934320'>forget</span> <span m='3934590'>about</span>
  <span m='3934830'>those.</span> <span m='3935250'>Forget</span> <span m='3935490'>about</span>
  <span m='3935700'>those</span> <span m='3935880'>points.</span> <span m='3936970'>Now</span>
  <span m='3937590'>you're</span> <span m='3937830'>going</span> <span m='3937980'>to</span>
  <span m='3938040'>be</span> <span m='3938310'>searching</span> <span m='3938700'>in</span>
  <span m='3938790'>one</span> <span m='3938880'>of</span> <span m='3938940'>these</span>
  <span m='3939120'>structures.</span> <span m='3939790'>So</span> <span m='3939870'>you</span>
  <span m='3939960'>can</span> <span m='3940110'>forget</span> <span m='3940380'>about</span>
  <span m='3940710'>all the</span> <span m='3940800'>points</span> <span m='3941070'>over</span>
  <span m='3941250'>here.</span> <span m='3942040'>So</span> <span m='3942090'>that's</span>
  <span m='3942300'>that</span> <span m='3942450'>argument.</span> <span m='3944385'>Once</span>
  <span m='3944730'>you've</span> <span m='3944880'>restricted</span> <span m='3945510'>to</span>
  <span m='3945600'>Si</span> <span m='3945930'>minus</span> <span m='3946240'>1</span>
  <span m='3946680'>and</span> <span m='3946770'>you don't</span> <span m='3947010'>have</span>
  <span m='3947160'>to</span> <span m='3947220'>look</span> <span m='3947370'>at</span>
  <span m='3947460'>any</span> <span m='3947610'>other</span> <span m='3947790'>points,</span>
  <span m='3948090'>among</span> <span m='3948360'>those</span> <span m='3948630'>points,</span>
  <span m='3949480'>this</span> <span m='3949590'>is</span> <span m='3949650'>going</span>
  <span m='3949810'>to</span> <span m='3949890'>be</span> <span m='3949980'>all</span>
  <span m='3950160'>the</span> <span m='3950250'>points</span> <span m='3950580'>less
  than</span> <span m='3950790'>or equal</span> <span m='3951000'>to</span> <span
  m='3951090'>xi.</span> </p><p><span m='3952800'>But</span> <span m='3952980'>that's</span>
  <span m='3953250'>how</span> <span m='3953400'>we</span> <span m='3953520'>were</span>
  <span m='3953610'>defining</span> <span m='3954030'>bar</span> <span m='3954360'>sparse.</span>
  <span m='3954600'>We</span> <span m='3954660'>said</span> <span m='3954870'>sparse</span>
  <span m='3955410'>in</span> <span m='3955680'>Si</span> <span m='3956100'>minus</span>
  <span m='3956400'>1.</span> <span m='3956920'>So</span> <span m='3956930'>it's</span>
  <span m='3957090'>among</span> <span m='3957420'>those</span> <span m='3957630'>points</span>
  <span m='3958560'>we</span> <span m='3958680'>have</span> <span m='3958830'>sparsity.</span>
  <span m='3959520'>So</span> <span m='3959700'>this</span> <span m='3959940'>is</span>
  <span m='3960810'>the</span> <span m='3960900'>definition</span> <span m='3961320'>of</span>
  <span m='3961470'>what</span> <span m='3961620'>we</span> <span m='3961830'>have.</span>
  <span m='3963800'>OK,</span> <span m='3963960'>the</span> <span m='3964080'>claim</span>
  <span m='3964410'>is</span> <span m='3964710'>it's</span> <span m='3964860'>a</span>
  <span m='3964920'>good</span> <span m='3965100'>thing.</span> <span m='3965490'>Here's</span>
  <span m='3965710'>the</span> <span m='3965770'>charging</span> <span m='3966150'>scheme.</span>
  <span m='3969790'>So</span> <span m='3969900'>this</span> <span m='3970140'>is</span>
  <span m='3970410'>by</span> <span m='3970620'>sparsity.</span> </p><p><span m='3977910'>So</span>
  <span m='3978300'>I'm</span> <span m='3978390'>going</span> <span m='3978540'>to</span>
  <span m='3978600'>charge</span> <span m='3980790'>storing</span> <span m='3983580'>Pi</span>
  <span m='3984570'>minus</span> <span m='3984960'>1</span> <span m='3985854'>to</span>
  <span m='3988160'>Pi</span> <span m='3988280'>minus</span> <span m='3988620'>1</span>
  <span m='3989070'>minus</span> <span m='3990270'>Si.</span> <span m='3992290'>This</span>
  <span m='3992460'>algebra,</span> <span m='3993470'>I</span> <span m='3993940'>have</span>
  <span m='3994170'>to</span> <span m='3994470'>interpret</span> <span m='3994980'>every</span>
  <span m='3995190'>single</span> <span m='3995490'>time,</span> <span m='3995760'>but</span>
  <span m='3995880'>that's</span> <span m='3996210'>fine.</span> <span m='3997410'>Let's</span>
  <span m='3997500'>look</span> <span m='3997620'>at</span> <span m='3997680'>the</span>
  <span m='3997740'>picture.</span> <span m='3998700'>OK,</span> <span m='3998985'>Pi</span>
  <span m='3999270'>minus</span> <span m='3999570'>1 remember,</span> <span m='4000200'>was</span>
  <span m='4000560'>this</span> <span m='4000890'>white</span> <span m='4001250'>rectangle</span>
  <span m='4001820'>over here.</span> <span m='4003800'>Everything</span> <span m='4004190'>to</span>
  <span m='4004310'>the</span> <span m='4004430'>left</span> <span m='4004730'>of</span>
  <span m='4004790'>the</span> <span m='4004910'>line.</span> </p><p><span m='4007690'>We</span>
  <span m='4007920'>have</span> <span m='4008210'>to</span> <span m='4008300'>store</span>
  <span m='4008600'>Pi.</span> <span m='4009950'>We</span> <span m='4010130'>want
  that</span> <span m='4010250'>the</span> <span m='4010370'>sum</span> <span m='4010670'>of</span>
  <span m='4010730'>the</span> <span m='4010820'>sizes</span> <span m='4011240'>of</span>
  <span m='4011300'>the</span> <span m='4011490'>Pi's</span> <span m='4011970'>is</span>
  <span m='4012080'>good.</span> <span m='4012950'>And</span> <span m='4013130'>so</span>
  <span m='4013250'>here's</span> <span m='4013490'>my</span> <span m='4013640'>charging</span>
  <span m='4014030'>scheme.</span> <span m='4014510'>We</span> <span m='4014600'>have</span>
  <span m='4014750'>to</span> <span m='4014840'>store</span> <span m='4015020'>Pi</span>
  <span m='4015560'>minus</span> <span m='4015890'>1.</span> <span m='4016590'>I'm</span>
  <span m='4016940'>going</span> <span m='4017060'>to</span> <span m='4017150'>charge</span>
  <span m='4017510'>it</span> <span m='4018050'>to</span> <span m='4018200'>these</span>
  <span m='4018680'>points.</span> <span m='4019200'>What</span> <span m='4019430'>are</span>
  <span m='4019490'>those</span> <span m='4019760'>points?</span> <span m='4021210'>Those</span>
  <span m='4021290'>are</span> <span m='4021320'>the</span> <span m='4021440'>points</span>
  <span m='4021650'>that</span> <span m='4021760'>are</span> <span m='4021890'>inside</span>
  <span m='4022340'>the</span> <span m='4022430'>white</span> <span m='4022640'>rectangle,</span>
  <span m='4023360'>but</span> <span m='4023600'>outside</span> <span m='4026590'>the</span>
  <span m='4026780'>red</span> <span m='4026990'>L-shape.</span> </p><p><span m='4028220'>So</span>
  <span m='4028370'>that's</span> <span m='4028760'>these</span> <span m='4029030'>points.</span>
  <span m='4029900'>This</span> <span m='4030200'>is</span> <span m='4031030'>Pi</span>
  <span m='4031640'>minus</span> <span m='4032090'>1</span> <span m='4032900'>minus</span>
  <span m='4033450'>Si.</span> <span m='4034730'>Those</span> <span m='4034970'>are</span>
  <span m='4035030'>the</span> <span m='4035120'>points</span> <span m='4035390'>that</span>
  <span m='4035480'>I'm</span> <span m='4035570'>throwing</span> <span m='4035810'>away.</span>
  <span m='4036830'>That's</span> <span m='4037040'>good.</span> <span m='4037730'>So</span>
  <span m='4037850'>if I</span> <span m='4037940'>charge</span> <span m='4038330'>them</span>
  <span m='4038540'>now,</span> <span m='4038930'>I</span> <span m='4039080'>will</span>
  <span m='4039230'>never</span> <span m='4039530'>charge</span> <span m='4039890'>them</span>
  <span m='4040070'>in</span> <span m='4040160'>the</span> <span m='4040220'>future</span>
  <span m='4041810'>because</span> <span m='4041990'>I</span> <span m='4042080'>just</span>
  <span m='4042260'>threw</span> <span m='4042530'>them</span> <span m='4042680'>away.</span>
  <span m='4043670'>They are</span> <span m='4043820'>not</span> <span m='4044090'>in</span>
  <span m='4044270'>the</span> <span m='4044360'>next</span> <span m='4044630'>Si.</span>
  <span m='4048800'>Each</span> <span m='4049040'>point</span> <span m='4049490'>overall</span>
  <span m='4050090'>in</span> <span m='4050180'>the</span> <span m='4050270'>point
  set</span> <span m='4051230'>only</span> <span m='4051500'>gets</span> <span m='4051740'>charged</span>
  <span m='4052220'>once.</span> </p><p><span m='4061080'>OK,</span> <span m='4061530'>how</span>
  <span m='4061770'>much</span> <span m='4062010'>does</span> <span m='4062190'>it</span>
  <span m='4062250'>get</span> <span m='4062490'>charged?</span> <span m='4063960'>How</span>
  <span m='4064200'>do</span> <span m='4064650'>these</span> <span m='4065010'>things</span>
  <span m='4065370'>relate</span> <span m='4065700'>to</span> <span m='4065820'>each</span>
  <span m='4065970'>other</span> <span m='4066180'>in</span> <span m='4066360'>size?</span>
  <span m='4067380'>That's</span> <span m='4067620'>where</span> <span m='4067800'>we</span>
  <span m='4067920'>use</span> <span m='4068130'>this</span> <span m='4068370'>thing.</span>
  <span m='4069660'>It</span> <span m='4069840'>gets</span> <span m='4070320'>confusing</span>
  <span m='4070820'>to</span> <span m='4070860'>think</span> <span m='4071010'>about</span>
  <span m='4071460'>intersection</span> <span m='4072180'>versus</span> <span m='4072570'>difference,</span>
  <span m='4073170'>but</span> <span m='4073380'>the</span> <span m='4073470'>point</span>
  <span m='4073710'>is</span> <span m='4074560'>if we</span> <span m='4074640'>look</span>
  <span m='4074790'>at</span> <span m='4074850'>the</span> <span m='4074940'>Pi</span>
  <span m='4075250'>minus</span> <span m='4075540'>ones</span> <span m='4075810'>that</span>
  <span m='4075930'>are</span> <span m='4076150'>in</span> <span m='4076510'>Si,</span>
  <span m='4077640'>that's</span> <span m='4077970'>a</span> <span m='4078090'>small</span>
  <span m='4079350'>fraction.</span> </p><p><span m='4080070'>Think</span> <span m='4080280'>of</span>
  <span m='4080400'>alpha</span> <span m='4080640'>as</span> <span m='4080770'>100.</span>
  <span m='4081750'>So</span> <span m='4081900'>then</span> <span m='4082410'>the</span>
  <span m='4082510'>Pi</span> <span m='4083250'>minus</span> <span m='4083580'>1--</span>
  <span m='4083895'>so</span> <span m='4084210'>this</span> <span m='4084480'>part</span>
  <span m='4084870'>down</span> <span m='4085110'>here</span> <span m='4085810'>that's</span>
  <span m='4085860'>in Si,</span> <span m='4086880'>this</span> <span m='4087060'>is</span>
  <span m='4087150'>only</span> <span m='4087420'>1/100</span> <span m='4088680'>of</span>
  <span m='4088860'>the</span> <span m='4088980'>whole</span> <span m='4089370'>white</span>
  <span m='4089610'>rectangle.</span> <span m='4091030'>So</span> <span m='4091080'>that</span>
  <span m='4091200'>means</span> <span m='4091440'>this</span> <span m='4091650'>part</span>
  <span m='4092700'>is</span> <span m='4092850'>99/100</span> <span m='4095970'>of</span>
  <span m='4096300'>the</span> <span m='4096450'>Pi.</span> <span m='4097800'>So</span>
  <span m='4097979'>if</span> <span m='4098040'>we</span> <span m='4098189'>charged</span>
  <span m='4098729'>the</span> <span m='4098850'>storing</span> <span m='4099450'>of</span>
  <span m='4099600'>the</span> <span m='4099689'>entire</span> <span m='4100140'>rectangle</span>
  <span m='4100950'>to</span> <span m='4101069'>these</span> <span m='4101310'>guys,</span>
  <span m='4102240'>we're</span> <span m='4102390'>only</span> <span m='4102660'>losing</span>
  <span m='4103020'>a</span> <span m='4103080'>very</span> <span m='4103439'>small</span>
  <span m='4103830'>factor</span> <span m='4104279'>like</span> <span m='4104460'>100/99</span>
  <span m='4105660'>or</span> <span m='4105750'>something.</span> <span m='4106840'>It
  isn't</span> <span m='4107040'>actually</span> <span m='4107700'>exactly</span>
  <span m='4108090'>100/99,</span> <span m='4109029'>I</span> <span m='4109140'>believe.</span>
  </p><p><span m='4110460'>I</span> <span m='4110670'>worked</span> <span m='4110939'>it</span>
  <span m='4111060'>out</span> <span m='4111930'>and</span> <span m='4112620'>the</span>
  <span m='4112740'>factor</span> <span m='4113340'>of</span> <span m='4113490'>charging,</span>
  <span m='4114689'>assuming</span> <span m='4115050'>I</span> <span m='4115109'>did</span>
  <span m='4115290'>it</span> <span m='4115350'>correctly,</span> <span m='4115770'>is</span>
  <span m='4115950'>1</span> <span m='4116370'>over</span> <span m='4116790'>1</span>
  <span m='4117120'>minus</span> <span m='4117600'>1</span> <span m='4118140'>over</span>
  <span m='4118590'>alpha,</span> <span m='4119880'>which</span> <span m='4120600'>works</span>
  <span m='4120899'>out</span> <span m='4121020'>to</span> <span m='4121170'>alpha</span>
  <span m='4121560'>over</span> <span m='4121830'>alpha</span> <span m='4122160'>minus</span>
  <span m='4122550'>1.</span> <span m='4123420'>It</span> <span m='4123510'>doesn't</span>
  <span m='4123750'>really</span> <span m='4123930'>matter,</span> <span m='4124569'>but</span>
  <span m='4124620'>the</span> <span m='4124740'>point</span> <span m='4124920'>is</span>
  <span m='4125010'>it's</span> <span m='4125130'>constant.</span> <span m='4126279'>I</span>
  <span m='4126359'>think</span> <span m='4126510'>that's</span> <span m='4126779'>easy</span>
  <span m='4126990'>to</span> <span m='4127080'>believe.</span> <span m='4128939'>Maybe</span>
  <span m='4129149'>it's</span> <span m='4129270'>actually</span> <span m='4129490'>easiest</span>
  <span m='4129609'>to</span> <span m='4129840'>think</span> <span m='4130020'>about</span>
  <span m='4130260'>when</span> <span m='4130410'>alpha</span> <span m='4130609'>is</span>
  <span m='4130790'>2.</span> </p><p><span m='4134939'>At</span> <span m='4135090'>most,</span>
  <span m='4135450'>half</span> <span m='4135660'>the</span> <span m='4135750'>points</span>
  <span m='4136020'>are</span> <span m='4136109'>here.</span> <span m='4136920'>At</span>
  <span m='4137010'>least,</span> <span m='4137310'>half</span> <span m='4137490'>the</span>
  <span m='4137580'>points</span> <span m='4137850'>are</span> <span m='4137910'>here.</span>
  <span m='4138710'>And</span> <span m='4138840'>so</span> <span m='4139229'>we're</span>
  <span m='4139380'>charging</span> <span m='4139859'>storing</span> <span m='4140189'>the</span>
  <span m='4140279'>entire</span> <span m='4140729'>point</span> <span m='4141000'>set</span>
  <span m='4141210'>to</span> <span m='4141359'>these</span> <span m='4141600'>points,</span>
  <span m='4141930'>which</span> <span m='4142109'>will</span> <span m='4142529'>never</span>
  <span m='4142740'>get</span> <span m='4142859'>charged</span> <span m='4143189'>again.</span>
  <span m='4143850'>So</span> <span m='4143939'>we're</span> <span m='4144000'>only</span>
  <span m='4144210'>charging</span> <span m='4144520'>with</span> <span m='4144630'>a</span>
  <span m='4144660'>factor</span> <span m='4144960'>of</span> <span m='4145050'>two.</span>
  <span m='4146220'>That's</span> <span m='4146430'>all</span> <span m='4146550'>we</span>
  <span m='4146640'>need,</span> <span m='4147050'>a</span> <span m='4147330'>constant</span>
  <span m='4147660'>factor.</span> </p><p><span m='4149000'>OK,</span> <span m='4149100'>therefore,</span>
  <span m='4149670'>this</span> <span m='4149970'>thing</span> <span m='4150180'>has</span>
  <span m='4150359'>linear</span> <span m='4150689'>size.</span> <span m='4152580'>That's
  the</span> <span m='4152819'>cool</span> <span m='4153050'>thing.</span> <span m='4153870'>We</span>
  <span m='4153990'>get</span> <span m='4154140'>more</span> <span m='4154380'>though.</span>
  <span m='4155250'>We</span> <span m='4155430'>also</span> <span m='4155729'>get</span>
  <span m='4155910'>the</span> <span m='4156180'>query</span> <span m='4156540'>bound
  we</span> <span m='4156630'>want.</span> <span m='4160779'>Let's</span> <span m='4161050'>think
  about</span> <span m='4161250'>the</span> <span m='4161340'>query</span> <span m='4161550'>bound.</span>
  <span m='4171590'>This</span> <span m='4171740'>is</span> <span m='4171920'>fun.</span>
  <span m='4173090'>Think</span> <span m='4173240'>about</span> <span m='4173450'>where</span>
  <span m='4173569'>the</span> <span m='4173660'>query</span> <span m='4173920'>is.</span>
  <span m='4174109'>It</span> <span m='4174229'>used</span> <span m='4174529'>to</span>
  <span m='4174680'>be</span> <span m='4175490'>over</span> <span m='4175729'>here.</span>
  <span m='4176420'>We</span> <span m='4176569'>do</span> <span m='4176720'>a</span>
  <span m='4176779'>search</span> <span m='4177770'>in</span> <span m='4178609'>S0,</span>
  <span m='4179569'>or</span> <span m='4179960'>we</span> <span m='4180109'>do</span>
  <span m='4180229'>a</span> <span m='4180290'>search</span> <span m='4180560'>in</span>
  <span m='4180649'>S1,</span> <span m='4181220'>or</span> <span m='4181490'>we</span>
  <span m='4181609'>do</span> <span m='4181729'>a</span> <span m='4181790'>search</span>
  <span m='4182020'>in</span> <span m='4182080'>S2.</span> </p><p><span m='4183950'>We'd</span>
  <span m='4184010'>never</span> <span m='4184250'>look</span> <span m='4184430'>at</span>
  <span m='4184520'>multiple</span> <span m='4184939'>Si's</span> <span m='4185359'>because</span>
  <span m='4185540'>there'd</span> <span m='4185660'>be</span> <span m='4185750'>no</span>
  <span m='4185899'>point.</span> <span m='4187819'>Either</span> <span m='4188120'>S0</span>
  <span m='4188479'>was</span> <span m='4188630'>dense,</span> <span m='4188899'>and</span>
  <span m='4188990'>we're</span> <span m='4189109'>fine,</span> <span m='4189410'>just</span>
  <span m='4189560'>do</span> <span m='4189740'>it.</span> <span m='4190420'>Or</span>
  <span m='4190640'>you</span> <span m='4190760'>have</span> <span m='4190910'>to</span>
  <span m='4191000'>jump</span> <span m='4191180'>to</span> <span m='4191279'>S1,</span>
  <span m='4191779'>skip</span> <span m='4192140'>some</span> <span m='4192350'>guys</span>
  <span m='4192620'>up</span> <span m='4192740'>top,</span> <span m='4193850'>do the</span>
  <span m='4194060'>search</span> <span m='4194330'>in</span> <span m='4194420'>there.</span>
  <span m='4194660'>Fine.</span> <span m='4195600'>We</span> <span m='4195700'>no</span>
  <span m='4195710'>longer</span> <span m='4195950'>have</span> <span m='4196100'>that</span>
  <span m='4196250'>luxury</span> <span m='4196640'>over</span> <span m='4196820'>here</span>
  <span m='4197030'>because</span> <span m='4197690'>we're</span> <span m='4197810'>using</span>
  <span m='4198080'>Pi's</span> <span m='4198560'>instead</span> <span m='4198800'>of</span>
  <span m='4198920'>Si's.</span> </p><p><span m='4199970'>So</span> <span m='4200120'>it</span>
  <span m='4200210'>actually</span> <span m='4200660'>may</span> <span m='4200750'>be</span>
  <span m='4200980'>the</span> <span m='4201110'>search</span> <span m='4201410'>starts</span>
  <span m='4201740'>in</span> <span m='4201890'>P1,</span> <span m='4202730'>but</span>
  <span m='4202880'>then</span> <span m='4203060'>has</span> <span m='4203270'>to</span>
  <span m='4203360'>go</span> <span m='4203510'>through</span> <span m='4203720'>P2,</span>
  <span m='4204170'>and</span> <span m='4204260'>has</span> <span m='4204440'>to</span>
  <span m='4204560'>go</span> <span m='4204710'>through</span> <span m='4204890'>P3.</span>
  <span m='4206630'>But</span> <span m='4207200'>it's</span> <span m='4207380'>OK</span>
  <span m='4208430'>because</span> <span m='4209030'>the</span> <span m='4209150'>farther</span>
  <span m='4209570'>we</span> <span m='4209720'>go</span> <span m='4209900'>right,</span>
  <span m='4211700'>we</span> <span m='4212060'>have</span> <span m='4212330'>this</span>
  <span m='4212450'>sparsity</span> <span m='4212990'>condition</span> <span m='4213470'>that</span>
  <span m='4213560'>tells</span> <span m='4213860'>us</span> <span m='4214040'>basically</span>
  <span m='4214460'>the</span> <span m='4214580'>points</span> <span m='4214850'>we're</span>
  <span m='4214940'>looking</span> <span m='4215270'>at</span> <span m='4216200'>are--</span>
  <span m='4217760'>the</span> <span m='4217850'>number</span> <span m='4218090'>of</span>
  <span m='4218150'>points</span> <span m='4218360'>we're</span> <span m='4218480'>looking</span>
  <span m='4218720'>at</span> <span m='4219230'>are</span> <span m='4219350'>getting</span>
  <span m='4219560'>smaller</span> <span m='4220010'>and</span> <span m='4220100'>smaller.</span>
  </p><p><span m='4223560'>So</span> <span m='4224890'>I'll</span> <span m='4224960'>wave</span>
  <span m='4225170'>my</span> <span m='4225290'>hands</span> <span m='4225500'>a</span>
  <span m='4225530'>little</span> <span m='4225710'>bit</span> <span m='4225830'>here,</span>
  <span m='4226070'>but</span> <span m='4226850'>the</span> <span m='4228950'>claim</span>
  <span m='4229250'>is</span> <span m='4229460'>it's</span> <span m='4229580'>a</span>
  <span m='4229640'>geometric</span> <span m='4230120'>series.</span> <span m='4233130'>This</span>
  <span m='4233280'>needs</span> <span m='4233480'>a</span> <span m='4233570'>formal</span>
  <span m='4233900'>proof,</span> <span m='4234270'>but</span> <span m='4234920'>we</span>
  <span m='4235310'>won't</span> <span m='4235520'>go</span> <span m='4235670'>through</span>
  <span m='4235850'>it</span> <span m='4235940'>here.</span> <span m='4237860'>Decreasing--</span>
  <span m='4241220'>so</span> <span m='4242030'>this</span> <span m='4242240'>is</span>
  <span m='4242450'>the</span> <span m='4242860'>query</span> <span m='4243270'>bound.</span>
  <span m='4243680'>The number</span> <span m='4243980'>of</span> <span m='4244040'>scanned</span>
  <span m='4244430'>points</span> <span m='4244880'>is</span> <span m='4245050'>order</span>
  <span m='4246350'>output</span> <span m='4246710'>size.</span> </p><p><span m='4247670'>So</span>
  <span m='4247770'>you</span> <span m='4247790'>have</span> <span m='4247880'>to</span>
  <span m='4248000'>check</span> <span m='4248240'>that</span> <span m='4248330'>no</span>
  <span m='4248450'>matter</span> <span m='4248720'>where</span> <span m='4249020'>you</span>
  <span m='4249170'>start</span> <span m='4249650'>in</span> <span m='4250060'>Pi--</span>
  <span m='4250610'>that's</span> <span m='4250880'>the</span> <span m='4250910'>little</span>
  <span m='4251180'>bit</span> <span m='4251300'>tricky</span> <span m='4251600'>part.</span>
  <span m='4251930'>We're</span> <span m='4252020'>not</span> <span m='4252170'>looking</span>
  <span m='4252410'>at</span> <span m='4252500'>all</span> <span m='4252770'>of Pi.</span>
  <span m='4253760'>We're</span> <span m='4253850'>looking</span> <span m='4254090'>at</span>
  <span m='4254270'>some</span> <span m='4254910'>of Pi</span> <span m='4256490'>and</span>
  <span m='4256640'>then</span> <span m='4256760'>we're</span> <span m='4256880'>going</span>
  <span m='4257150'>to</span> <span m='4257270'>the</span> <span m='4257490'>right</span>
  <span m='4258200'>from there.</span> <span m='4259580'>Actually,</span> <span m='4259790'>is</span>
  <span m='4259910'>that</span> <span m='4260000'>true?</span> <span m='4260180'>Maybe</span>
  <span m='4260420'>we</span> <span m='4260540'>always</span> <span m='4260720'>look</span>
  <span m='4260900'>at</span> <span m='4260960'>all</span> <span m='4261170'>of</span>
  <span m='4261260'>Pi.</span> <span m='4264290'>Let me</span> <span m='4264440'>think
  about</span> <span m='4264680'>this.</span> <span m='4268410'>I</span> <span m='4268510'>think</span>
  <span m='4268550'>we</span> <span m='4268640'>do,</span> <span m='4269270'>actually.</span>
  <span m='4270170'>Sorry.</span> <span m='4272810'>That's what</span> <span m='4272900'>we</span>
  <span m='4272960'>did</span> <span m='4273080'>before.</span> </p><p><span m='4278360'>We</span>
  <span m='4278630'>basically</span> <span m='4279050'>figure</span> <span m='4279320'>out</span>
  <span m='4279380'>where</span> <span m='4279590'>we</span> <span m='4279770'>are</span>
  <span m='4279920'>in</span> <span m='4280070'>y-coordinate.</span> <span m='4280830'>That</span>
  <span m='4280950'>was</span> <span m='4281060'>the</span> <span m='4281180'>overall</span>
  <span m='4281540'>structure.</span> <span m='4282080'>We</span> <span m='4282200'>had</span>
  <span m='4282350'>a</span> <span m='4282900'>Van Emde Boas</span> <span m='4283400'>search</span>
  <span m='4283700'>tree</span> <span m='4283940'>on</span> <span m='4284120'>y.</span>
  <span m='4285290'>So</span> <span m='4285410'>all</span> <span m='4285680'>we</span>
  <span m='4285830'>know</span> <span m='4285980'>at</span> <span m='4286070'>this</span>
  <span m='4286220'>point</span> <span m='4286520'>is</span> <span m='4286730'>the</span>
  <span m='4287060'>y-coordinate</span> <span m='4287930'>of</span> <span m='4288080'>our</span>
  <span m='4288200'>search.</span> <span m='4289400'>And</span> <span m='4289550'>so</span>
  <span m='4289790'>we</span> <span m='4289910'>use</span> <span m='4290150'>that</span>
  <span m='4290330'>to</span> <span m='4290420'>determine</span> <span m='4290840'>which</span>
  <span m='4291050'>of</span> <span m='4291110'>the</span> <span m='4291200'>Pi's</span>
  <span m='4291740'>we</span> <span m='4291830'>go</span> <span m='4292010'>to,</span>
  <span m='4293000'>based</span> <span m='4293360'>on</span> <span m='4293890'>where</span>
  <span m='4294410'>the</span> <span m='4294530'>yi</span> <span m='4294980'>becomes</span>
  <span m='4295640'>no</span> <span m='4295850'>longer</span> <span m='4296650'>dense.</span>
  </p><p><span m='4299720'>And</span> <span m='4299810'>then</span> <span m='4299990'>we're</span>
  <span m='4300050'>going</span> <span m='4300170'>to</span> <span m='4300230'>have</span>
  <span m='4300320'>to</span> <span m='4300410'>search</span> <span m='4300640'>through</span>
  <span m='4300740'>that</span> <span m='4300890'>entire</span> <span m='4301300'>Pi</span>
  <span m='4301820'>and</span> <span m='4302000'>potentially</span> <span m='4302570'>more</span>
  <span m='4302870'>of</span> <span m='4302990'>them</span> <span m='4306770'>because</span>
  <span m='4306950'>this</span> <span m='4307100'>is</span> <span m='4307190'>no</span>
  <span m='4307340'>longer</span> <span m='4307520'>an</span> <span m='4307610'>Si.</span>
  <span m='4308390'>It's</span> <span m='4308600'>just</span> <span m='4308930'>doing</span>
  <span m='4309170'>the</span> <span m='4309260'>things</span> <span m='4309530'>to</span>
  <span m='4309640'>the</span> <span m='4309680'>left.</span> <span m='4311150'>And</span>
  <span m='4311270'>so</span> <span m='4312200'>if</span> <span m='4312350'>we're</span>
  <span m='4312470'>lucky,</span> <span m='4314280'>the</span> <span m='4314630'>Pi</span>
  <span m='4315110'>we're</span> <span m='4315260'>looking</span> <span m='4315590'>at,</span>
  <span m='4316250'>or</span> <span m='4316490'>the</span> <span m='4317300'>query</span>
  <span m='4317690'>we're</span> <span m='4317810'>doing,</span> <span m='4318980'>is</span>
  <span m='4319130'>not</span> <span m='4319430'>to</span> <span m='4319580'>the</span>
  <span m='4319700'>right</span> <span m='4320090'>of</span> <span m='4320210'>this</span>
  <span m='4320390'>point.</span> <span m='4321650'>OK,</span> <span m='4321890'>maybe</span>
  <span m='4322130'>it's</span> <span m='4322250'>right</span> <span m='4322430'>here.</span>
  <span m='4322730'>That</span> <span m='4322880'>would</span> <span m='4322970'>be</span>
  <span m='4323090'>great.</span> <span m='4323360'>Then</span> <span m='4323630'>all</span>
  <span m='4323750'>our</span> <span m='4323870'>answers</span> <span m='4324230'>are</span>
  <span m='4324320'>done.</span> </p><p><span m='4326880'>If our</span> <span m='4327290'>query
  is</span> <span m='4327710'>here,</span> <span m='4328010'>that</span> <span m='4328220'>would</span>
  <span m='4328340'>have</span> <span m='4328430'>been</span> <span m='4328580'>dense,</span>
  <span m='4328850'>so</span> <span m='4329030'>we</span> <span m='4329120'>would</span>
  <span m='4329240'>have</span> <span m='4329330'>done</span> <span m='4329510'>it</span>
  <span m='4329600'>at</span> <span m='4329720'>an</span> <span m='4329810'>earlier</span>
  <span m='4330200'>stage.</span> <span m='4331400'>Our</span> <span m='4331490'>query</span>
  <span m='4331790'>might</span> <span m='4332000'>be</span> <span m='4332090'>down</span>
  <span m='4332330'>here</span> <span m='4332600'>though.</span> <span m='4333860'>When</span>
  <span m='4333980'>the</span> <span m='4334040'>query's</span> <span m='4334370'>down</span>
  <span m='4334610'>here,</span> <span m='4337610'>we</span> <span m='4337730'>need</span>
  <span m='4337880'>to</span> <span m='4337970'>report</span> <span m='4338300'>on</span>
  <span m='4338420'>these</span> <span m='4338600'>points.</span> <span m='4339550'>Then</span>
  <span m='4339680'>we're</span> <span m='4339790'>going</span> <span m='4339950'>to
  have</span> <span m='4340040'>to do</span> <span m='4340160'>more</span> <span m='4340640'>and
  that's</span> <span m='4340880'>going</span> <span m='4340990'>to</span> <span m='4341090'>be</span>
  <span m='4341330'>Pi</span> <span m='4341645'>plus</span> <span m='4341960'>1.</span>
  <span m='4342860'>So</span> <span m='4343030'>we'll</span> <span m='4343160'>do</span>
  <span m='4343310'>more</span> <span m='4343550'>and</span> <span m='4343640'>more</span>
  <span m='4344970'>Pi's</span> <span m='4345530'>until</span> <span m='4345830'>we</span>
  <span m='4345950'>get</span> <span m='4346190'>to</span> <span m='4346460'>our</span>
  <span m='4346580'>actual</span> <span m='4347090'>query</span> <span m='4348260'>here.</span>
  </p><p><span m='4350930'>But</span> <span m='4351170'>in</span> <span m='4351320'>any</span>
  <span m='4351500'>case,</span> <span m='4351740'>the</span> <span m='4351830'>claim</span>
  <span m='4352130'>is</span> <span m='4352280'>that</span> <span m='4352370'>this</span>
  <span m='4352610'>is</span> <span m='4352730'>geometrically</span> <span m='4353270'>decreasing</span>
  <span m='4353780'>by</span> <span m='4353960'>the</span> <span m='4354080'>same</span>
  <span m='4354440'>charging</span> <span m='4354830'>scheme.</span> <span m='4358150'>OK,</span>
  <span m='4358420'>that's</span> <span m='4358780'>two</span> <span m='4359230'>out</span>
  <span m='4359380'>of</span> <span m='4359500'>the</span> <span m='4359620'>three</span>
  <span m='4359890'>claims.</span> <span m='4360220'>There's</span> <span m='4360400'>one</span>
  <span m='4360610'>more,</span> <span m='4365620'>which</span> <span m='4365700'>is</span>
  <span m='4365790'>closely</span> <span m='4366150'>related.</span> <span m='4366530'>It's</span>
  <span m='4366720'>still</span> <span m='4367020'>about</span> <span m='4367290'>the</span>
  <span m='4367380'>query</span> <span m='4368180'>problem.</span> <span m='4368520'>What</span>
  <span m='4368610'>we</span> <span m='4368730'>haven't</span> <span m='4369000'>shown</span>
  <span m='4369930'>is</span> <span m='4370080'>that</span> <span m='4370170'>we</span>
  <span m='4370290'>actually</span> <span m='4370650'>find</span> <span m='4370980'>all</span>
  <span m='4371070'>the</span> <span m='4371190'>points.</span> <span m='4371490'>This</span>
  <span m='4371670'>is</span> <span m='4371850'>what</span> <span m='4372000'>you</span>
  <span m='4372120'>might</span> <span m='4372690'>call</span> <span m='4372960'>correctness.</span>
  </p><p><span m='4377640'>To</span> <span m='4377760'>prove</span> <span m='4378060'>this,</span>
  <span m='4379130'>what</span> <span m='4379360'>we</span> <span m='4379530'>need</span>
  <span m='4379710'>to</span> <span m='4379860'>say--</span> <span m='4381360'>what</span>
  <span m='4381510'>we</span> <span m='4381630'>claim</span> <span m='4382450'>is</span>
  <span m='4382800'>that</span> <span m='4382920'>after</span> <span m='4383280'>you</span>
  <span m='4383400'>do</span> <span m='4383550'>the</span> <span m='4383640'>P1's--</span>
  <span m='4387280'>and</span> <span m='4387720'>now</span> <span m='4387930'>you</span>
  <span m='4388020'>do</span> <span m='4388110'>the</span> <span m='4388230'>P2's.</span>
  <span m='4392910'>Well,</span> <span m='4393060'>I'll tell</span> <span m='4393300'>you.</span>
  <span m='4393900'>The</span> <span m='4393990'>claim</span> <span m='4394980'>is</span>
  <span m='4395160'>that</span> <span m='4396470'>you</span> <span m='4396660'>visited</span>
  <span m='4397050'>some</span> <span m='4397230'>x-coordinates</span> <span m='4397920'>here.</span>
  <span m='4398790'>The</span> <span m='4399120'>Pi's were</span> <span m='4399240'>all</span>
  <span m='4399420'>the</span> <span m='4399510'>things</span> <span m='4399750'>up</span>
  <span m='4399930'>to</span> <span m='4400020'>some</span> <span m='4400230'>x-coordinate.</span>
  <span m='4401380'>Claim</span> <span m='4401640'>that</span> <span m='4401760'>the</span>
  <span m='4401880'>very</span> <span m='4402300'>next</span> <span m='4402930'>point</span>
  <span m='4403230'>in</span> <span m='4403380'>here,</span> <span m='4403530'>in</span>
  <span m='4403650'>P2,</span> <span m='4405060'>has</span> <span m='4405300'>a</span>
  <span m='4405390'>smaller</span> <span m='4406080'>x-coordinate</span> <span m='4406770'>than</span>
  <span m='4406920'>what</span> <span m='4407100'>you</span> <span m='4407250'>just</span>
  <span m='4407460'>did.</span> </p><p><span m='4410600'>I</span> <span m='4410690'>think</span>
  <span m='4410960'>that</span> <span m='4411230'>should</span> <span m='4411530'>be</span>
  <span m='4412310'>clear</span> <span m='4413030'>because</span> <span m='4413630'>presumably</span>
  <span m='4413960'>there</span> <span m='4414110'>are</span> <span m='4414140'>some</span>
  <span m='4414350'>points</span> <span m='4414680'>in</span> <span m='4414770'>here,</span>
  <span m='4415490'>and</span> <span m='4415940'>so</span> <span m='4416150'>the</span>
  <span m='4416450'>very</span> <span m='4416750'>next</span> <span m='4417350'>Pi,</span>
  <span m='4417860'>it's</span> <span m='4418610'>restricted</span> <span m='4419120'>within</span>
  <span m='4419390'>this</span> <span m='4419540'>red</span> <span m='4419750'>thing,</span>
  <span m='4420050'>but</span> <span m='4420170'>it's</span> <span m='4420260'>going</span>
  <span m='4420370'>to</span> <span m='4420470'>be</span> <span m='4420620'>up</span>
  <span m='4420800'>to</span> <span m='4420890'>some</span> <span m='4421130'>x-coordinate.</span>
  <span m='4421700'>So you're</span> <span m='4422090'>basically</span> <span m='4422420'>starting</span>
  <span m='4422840'>over.</span> <span m='4423080'>Every</span> <span m='4423320'>time</span>
  <span m='4423530'>you</span> <span m='4423620'>go</span> <span m='4423740'>to</span>
  <span m='4423800'>the</span> <span m='4424010'>Pi's,</span> <span m='4424430'>you're
  starting</span> <span m='4424850'>over</span> <span m='4425060'>in</span> <span
  m='4425150'>x.</span> <span m='4427310'>Go</span> <span m='4427460'>back</span>
  <span m='4427760'>to</span> <span m='4428000'>minus</span> <span m='4428300'>infinity</span>
  <span m='4428750'>in</span> <span m='4428840'>x.</span> </p><p><span m='4430010'>So</span>
  <span m='4430340'>the</span> <span m='4430490'>idea</span> <span m='4430760'>is</span>
  <span m='4431510'>the</span> <span m='4431630'>picture</span> <span m='4431930'>will</span>
  <span m='4432440'>look</span> <span m='4432620'>something</span> <span m='4432890'>like</span>
  <span m='4433010'>this.</span> <span m='4433130'>You</span> <span m='4433220'>start</span>
  <span m='4433540'>at</span> <span m='4433610'>minus</span> <span m='4433880'>infinity,</span>
  <span m='4434720'>you</span> <span m='4434840'>read</span> <span m='4435050'>some</span>
  <span m='4435200'>points.</span> <span m='4435560'>At</span> <span m='4435650'>some</span>
  <span m='4435830'>point,</span> <span m='4435980'>you</span> <span m='4436070'>run</span>
  <span m='4436280'>out</span> <span m='4436340'>of</span> <span m='4436400'>the</span>
  <span m='4436490'>Pi's.</span> <span m='4436890'>Then</span> <span m='4437000'>you</span>
  <span m='4437090'>start</span> <span m='4437420'>over</span> <span m='4437660'>again,</span>
  <span m='4438500'>you</span> <span m='4438590'>read</span> <span m='4438800'>some</span>
  <span m='4439010'>smaller</span> <span m='4439520'>set</span> <span m='4439700'>of</span>
  <span m='4439760'>the</span> <span m='4439880'>points.</span> <span m='4440180'>Maybe</span>
  <span m='4440390'>you</span> <span m='4440450'>get</span> <span m='4440600'>a</span>
  <span m='4440630'>little</span> <span m='4440840'>farther.</span> <span m='4441230'>You</span>
  <span m='4441440'>start</span> <span m='4441800'>over</span> <span m='4442040'>again,</span>
  <span m='4442680'>read</span> <span m='4442940'>a</span> <span m='4443000'>little</span>
  <span m='4443210'>farther.</span> <span m='4444140'>At</span> <span m='4444260'>some</span>
  <span m='4444560'>point,</span> <span m='4444860'>you're</span> <span m='4444950'>going</span>
  <span m='4445070'>to</span> <span m='4445160'>reach</span> <span m='4445490'>your</span>
  <span m='4445820'>threshold</span> <span m='4446390'>x.</span> <span m='4447050'>That's</span>
  <span m='4447260'>when</span> <span m='4447380'>you</span> <span m='4447470'>stop.</span>
  <span m='4448990'>So</span> <span m='4449170'>that's</span> <span m='4449720'>correctness.</span>
  <span m='4453760'>I</span> <span m='4453850'>feel</span> <span m='4454000'>like</span>
  <span m='4454150'>I</span> <span m='4454180'>need</span> <span m='4454330'>another</span>
  <span m='4454600'>sentence</span> <span m='4454990'>there.</span> </p><p><span m='4459310'>Once</span>
  <span m='4460390'>your</span> <span m='4460490'>Pi</span> <span m='4460900'>encompasses</span>
  <span m='4461680'>your</span> <span m='4461830'>x</span> <span m='4462070'>range,</span>
  <span m='4463180'>that's</span> <span m='4463450'>going</span> <span m='4463600'>to</span>
  <span m='4463690'>have</span> <span m='4463930'>your</span> <span m='4464050'>answer.</span>
  <span m='4464620'>Then</span> <span m='4464860'>you're</span> <span m='4465040'>done.</span>
  <span m='4465590'>So</span> <span m='4465610'>that's</span> <span m='4465880'>this</span>
  <span m='4466060'>moment.</span> <span m='4467260'>And so</span> <span m='4467470'>the</span>
  <span m='4467650'>only</span> <span m='4468010'>worry</span> <span m='4468760'>is</span>
  <span m='4468910'>that</span> <span m='4469100'>an</span> <span m='4469390'>early</span>
  <span m='4469750'>Pi,</span> <span m='4470200'>basically,</span> <span m='4471570'>or</span>
  <span m='4472150'>maybe</span> <span m='4472690'>the</span> <span m='4472780'>next</span>
  <span m='4472970'>Pi</span> <span m='4473710'>does</span> <span m='4473980'>this,</span>
  <span m='4474910'>and</span> <span m='4475060'>then</span> <span m='4475330'>we</span>
  <span m='4475450'>do</span> <span m='4475600'>this</span> <span m='4475990'>or</span>
  <span m='4476080'>something</span> <span m='4476350'>like</span> <span m='4476530'>this.</span>
  <span m='4477130'>That</span> <span m='4477310'>never</span> <span m='4477550'>happens</span>
  <span m='4477910'>basically</span> <span m='4478270'>because</span> <span m='4478510'>you're</span>
  <span m='4478600'>always</span> <span m='4478840'>resetting</span> <span m='4479290'>x</span>
  <span m='4479500'>range.</span> <span m='4479770'>And</span> <span m='4479860'>so</span>
  <span m='4479980'>your</span> <span m='4480160'>x</span> <span m='4480940'>will</span>
  <span m='4481060'>always</span> <span m='4481270'>start</span> <span m='4481540'>over</span>
  <span m='4481840'>to</span> <span m='4482020'>something</span> <span m='4482320'>less</span>
  <span m='4482590'>than</span> <span m='4482710'>what</span> <span m='4482860'>you</span>
  <span m='4482980'>had.</span> </p><p><span m='4484060'>And</span> <span m='4484210'>so</span>
  <span m='4485440'>the</span> <span m='4485650'>termination</span> <span m='4486310'>condition,</span>
  <span m='4486760'>which</span> <span m='4486970'>I</span> <span m='4487060'>probably</span>
  <span m='4487360'>didn't</span> <span m='4487570'>write</span> <span m='4487750'>down</span>
  <span m='4488020'>here,</span> <span m='4488850'>but</span> <span m='4489130'>which</span>
  <span m='4489370'>is</span> <span m='4491090'>stop</span> <span m='4491680'>when</span>
  <span m='4491950'>your</span> <span m='4492100'>x-coordinate</span> <span m='4492580'>is</span>
  <span m='4492700'>bigger</span> <span m='4492970'>than</span> <span m='4493120'>what</span>
  <span m='4493240'>you</span> <span m='4493330'>want.</span> <span m='4494140'>Never</span>
  <span m='4494440'>terminates</span> <span m='4494980'>early.</span> <span m='4496210'>Therefore</span>
  <span m='4496630'>we</span> <span m='4496750'>get</span> <span m='4496930'>all</span>
  <span m='4497050'>the</span> <span m='4497140'>points</span> <span m='4497410'>we</span>
  <span m='4497500'>care</span> <span m='4497680'>about.</span> </p><p><span m='4499480'>OK,</span>
  <span m='4499540'>a little</span> <span m='4499840'>bit</span> <span m='4499960'>hand-wavy,</span>
  <span m='4500860'>but</span> <span m='4501040'>that</span> <span m='4501250'>is</span>
  <span m='4502630'>why</span> <span m='4502870'>this</span> <span m='4503050'>structure</span>
  <span m='4503470'>works.</span> <span m='4504520'>It's</span> <span m='4504730'>a</span>
  <span m='4504790'>very</span> <span m='4505000'>weird</span> <span m='4505390'>set</span>
  <span m='4505680'>up,</span> <span m='4508320'>but</span> <span m='4508970'>linear</span>
  <span m='4509120'>sized,</span> <span m='4510350'>and</span> <span m='4510470'>you</span>
  <span m='4510560'>just</span> <span m='4510740'>jump</span> <span m='4511040'>into</span>
  <span m='4511190'>the</span> <span m='4511280'>right</span> <span m='4511430'>point</span>
  <span m='4511640'>in</span> <span m='4511710'>the</span> <span m='4511800'>array,</span>
  <span m='4512510'>start</span> <span m='4512870'>reading,</span> <span m='4514370'>throw</span>
  <span m='4514610'>away</span> <span m='4514820'>the</span> <span m='4514910'>points</span>
  <span m='4515180'>that</span> <span m='4515300'>aren't</span> <span m='4515430'>in</span>
  <span m='4515540'>your</span> <span m='4515630'>range</span> <span m='4516470'>because</span>
  <span m='4516650'>they</span> <span m='4516770'>just</span> <span m='4516950'>happen</span>
  <span m='4517200'>to</span> <span m='4517280'>be</span> <span m='4517430'>there.</span>
  <span m='4517790'>Those</span> <span m='4518000'>would</span> <span m='4518090'>be</span>
  <span m='4518210'>these</span> <span m='4518390'>points</span> <span m='4518660'>up
  here.</span> </p><p><span m='4520270'>Throw</span> <span m='4520920'>away</span>
  <span m='4522260'>duplicates.</span> <span m='4524560'>Just</span> <span m='4524870'>output</span>
  <span m='4525130'>the</span> <span m='4525250'>points</span> <span m='4525520'>in</span>
  <span m='4525610'>your</span> <span m='4525730'>range</span> <span m='4526810'>and</span>
  <span m='4527380'>it</span> <span m='4527500'>gives</span> <span m='4527800'>you,</span>
  <span m='4528010'>magically,</span> <span m='4528700'>all</span> <span m='4528910'>the</span>
  <span m='4529030'>points</span> <span m='4529810'>in</span> <span m='4529990'>here</span>
  <span m='4530230'>by</span> <span m='4530440'>a</span> <span m='4530530'>linear</span>
  <span m='4530980'>scan.</span> <span m='4531790'>I</span> <span m='4531850'>still</span>
  <span m='4532090'>find</span> <span m='4532270'>this</span> <span m='4532390'>so</span>
  <span m='4532630'>weird,</span> <span m='4534310'>but</span> <span m='4534910'>it's</span>
  <span m='4535030'>true.</span> <span m='4538050'>Truth</span> <span m='4538320'>is</span>
  <span m='4538380'>stranger</span> <span m='4538710'>than</span> <span m='4538830'>fiction,</span>
  <span m='4539220'>I</span> <span m='4539280'>guess.</span> <span m='4540740'>They're</span>
  <span m='4540900'>fun</span> <span m='4541200'>facts.</span> <span m='4541620'>You</span>
  <span m='4541770'>can</span> <span m='4542220'>actually</span> <span m='4542640'>compute</span>
  <span m='4543120'>this</span> <span m='4543330'>thing</span> <span m='4544080'>in</span>
  <span m='4544230'>the</span> <span m='4544320'>sorting</span> <span m='4544680'>bound.</span>
  <span m='4545220'>So</span> <span m='4545580'>pre-processing</span> <span m='4546300'>is</span>
  <span m='4546420'>just</span> <span m='4546570'>sort.</span> <span m='4548700'>I</span>
  <span m='4549030'>won't</span> <span m='4549540'>prove</span> <span m='4549720'>that</span>
  <span m='4549900'>here.</span> </p><p><span m='4552125'>So</span> <span m='4552480'>this</span>
  <span m='4552660'>was</span> <span m='4552780'>two</span> <span m='4553020'>sided.</span>
  <span m='4553440'>Let</span> <span m='4553590'>me</span> <span m='4553740'>briefly</span>
  <span m='4554130'>tell</span> <span m='4554370'>you</span> <span m='4554580'>how</span>
  <span m='4554820'>to</span> <span m='4554910'>solve</span> <span m='4556080'>three</span>
  <span m='4556350'>sided</span> <span m='4557310'>and</span> <span m='4557460'>four</span>
  <span m='4557640'>sided.</span> <span m='4558300'>We</span> <span m='4558420'>basically</span>
  <span m='4558840'>already</span> <span m='4559050'>did</span> <span m='4559500'>this</span>
  <span m='4559710'>one,</span> <span m='4562050'>which</span> <span m='4562350'>was--</span>
  <span m='4562830'>I'll</span> <span m='4562910'>remind</span> <span m='4563310'>you</span>
  <span m='4564330'>what</span> <span m='4564420'>it</span> <span m='4564480'>looks</span>
  <span m='4564720'>like.</span> <span m='4570550'>So</span> <span m='4570960'>you</span>
  <span m='4571080'>have</span> <span m='4571410'>a</span> <span m='4571470'>binary</span>
  <span m='4571800'>tree,</span> <span m='4573790'>and</span> <span m='4573870'>in</span>
  <span m='4573960'>each</span> <span m='4574170'>node</span> <span m='4575160'>you</span>
  <span m='4575310'>store</span> <span m='4575410'>two</span> <span m='4576750'>augmented</span>
  <span m='4577320'>structures.</span> </p><p><span m='4578400'>One</span> <span m='4578850'>which</span>
  <span m='4579030'>can</span> <span m='4579180'>do</span> <span m='4579270'>ranged</span>
  <span m='4579570'>queries</span> <span m='4579840'>like</span> <span m='4580020'>this,</span>
  <span m='4580910'>and</span> <span m='4581040'>one</span> <span m='4581280'>which</span>
  <span m='4581430'>can</span> <span m='4581580'>do</span> <span m='4581850'>inverted</span>
  <span m='4582330'>range</span> <span m='4582570'>queries</span> <span m='4582870'>like</span>
  <span m='4583060'>this.</span> <span m='4584170'>This should</span> <span m='4584370'>look</span>
  <span m='4584520'>familiar.</span> <span m='4587900'>And</span> <span m='4588060'>so</span>
  <span m='4590040'>you</span> <span m='4590280'>do</span> <span m='4590640'>a</span>
  <span m='4590730'>search</span> <span m='4591360'>on--</span> <span m='4591930'>let's</span>
  <span m='4592080'>say</span> <span m='4592230'>we</span> <span m='4592380'>want</span>
  <span m='4592560'>to</span> <span m='4592620'>do</span> <span m='4593970'>this</span>
  <span m='4594210'>thing.</span> <span m='4594420'>So we have</span> <span m='4594690'>x1,</span>
  <span m='4595030'>x2,</span> <span m='4596640'>y2.</span> <span m='4599490'>You
  search</span> <span m='4599790'>for</span> <span m='4599880'>x1,</span> <span m='4600330'>you</span>
  <span m='4600420'>search</span> <span m='4600720'>for</span> <span m='4600840'>x2.</span>
  <span m='4601740'>You</span> <span m='4602010'>find the</span> <span m='4602130'>LCA</span>
  <span m='4603780'>and</span> <span m='4603960'>then</span> <span m='4605940'>in
  this</span> <span m='4606180'>subtree,</span> <span m='4607560'>you</span> <span
  m='4607740'>do</span> <span m='4608100'>a</span> <span m='4608280'>search.</span>
  </p><p><span m='4610140'>In</span> <span m='4610300'>this</span> <span m='4610510'>subtree,</span>
  <span m='4610770'>you</span> <span m='4610890'>already</span> <span m='4611220'>know</span>
  <span m='4611370'>that</span> <span m='4611490'>you're</span> <span m='4611610'>less</span>
  <span m='4611820'>than</span> <span m='4611940'>x2,</span> <span m='4612900'>and</span>
  <span m='4613020'>so</span> <span m='4613170'>you</span> <span m='4613320'>do</span>
  <span m='4613620'>the</span> <span m='4614560'>x1,</span> <span m='4618510'>y2</span>
  <span m='4619140'>search</span> <span m='4620400'>in</span> <span m='4621090'>this</span>
  <span m='4621300'>node.</span> <span m='4622650'>And</span> <span m='4622800'>then</span>
  <span m='4622980'>in</span> <span m='4623070'>the</span> <span m='4623160'>right</span>
  <span m='4623400'>subtree,</span> <span m='4624360'>you</span> <span m='4624540'>do</span>
  <span m='4624870'>the</span> <span m='4626910'>x2,</span> <span m='4627300'>y2</span>
  <span m='4629070'>search.</span> <span m='4629460'>You</span> <span m='4629550'>take</span>
  <span m='4629760'>the</span> <span m='4629850'>union</span> <span m='4630240'>of</span>
  <span m='4630300'>those</span> <span m='4630540'>two</span> <span m='4630690'>results</span>
  <span m='4631990'>and</span> <span m='4632010'>that</span> <span m='4632220'>is</span>
  <span m='4633240'>this</span> <span m='4633640'>query.</span> <span m='4635170'>That's</span>
  <span m='4635340'>how</span> <span m='4635460'>we</span> <span m='4635550'>did</span>
  <span m='4635700'>it</span> <span m='4635760'>before.</span> <span m='4638370'>No</span>
  <span m='4638460'>difficulty</span> <span m='4638970'>here.</span> </p><p><span
  m='4639560'>And the</span> <span m='4639570'>point</span> <span m='4639780'>is,</span>
  <span m='4641130'>you</span> <span m='4641250'>can</span> <span m='4641400'>build</span>
  <span m='4641610'>this,</span> <span m='4642240'>put</span> <span m='4642390'>it</span>
  <span m='4642460'>in a</span> <span m='4642600'>Van Emde Boas</span> <span m='4643500'>layout.</span>
  <span m='4644040'>You</span> <span m='4644160'>do</span> <span m='4644310'>this</span>
  <span m='4644490'>search,</span> <span m='4645240'>you</span> <span m='4645330'>do</span>
  <span m='4645480'>this</span> <span m='4645660'>search,</span> <span m='4645960'>you</span>
  <span m='4646020'>find</span> <span m='4646260'>the</span> <span m='4646350'>LCA</span>
  <span m='4646830'>in</span> <span m='4646980'>log</span> <span m='4647250'>base</span>
  <span m='4647490'>B</span> <span m='4647730'>of N--</span> <span m='4648300'>to</span>
  <span m='4648420'>check</span> <span m='4648630'>that</span> <span m='4648720'>everything</span>
  <span m='4649080'>works,</span> <span m='4649370'>cache</span> <span m='4649600'>obviously.</span>
  <span m='4650760'>Then</span> <span m='4651480'>these</span> <span m='4651750'>structures</span>
  <span m='4652410'>are</span> <span m='4652530'>just</span> <span m='4652670'>structures</span>
  <span m='4653100'>which</span> <span m='4653280'>we</span> <span m='4653430'>already</span>
  <span m='4653700'>built,</span> <span m='4654930'>and</span> <span m='4655080'>so</span>
  <span m='4655920'>yes,</span> <span m='4656160'>we</span> <span m='4656250'>lose</span>
  <span m='4656430'>a</span> <span m='4656460'>lag</span> <span m='4656700'>factor</span>
  <span m='4657120'>because</span> <span m='4657570'>every</span> <span m='4657840'>point</span>
  <span m='4658560'>appears</span> <span m='4658950'>in</span> <span m='4659100'>log</span>
  <span m='4659460'>data</span> <span m='4659700'>structures,</span> <span m='4662190'>but</span>
  <span m='4663360'>that's</span> <span m='4663570'>it.</span> <span m='4664530'>Everything</span>
  <span m='4664860'>else</span> <span m='4665010'>works</span> <span m='4665220'>the</span>
  <span m='4665310'>same.</span> </p><p><span m='4665710'>So</span> <span m='4665790'>we</span>
  <span m='4665880'>get</span> <span m='4666020'>N</span> <span m='4666120'>log</span>
  <span m='4666390'>N</span> <span m='4666540'>space</span> <span m='4667560'>log</span>
  <span m='4667770'>base</span> <span m='4667980'>B</span> <span m='4668140'>of</span>
  <span m='4668260'>N</span> <span m='4668430'>plus</span> <span m='4668670'>output</span>
  <span m='4669030'>over</span> <span m='4669220'>B query.</span> <span m='4671190'>Because</span>
  <span m='4671670'>now</span> <span m='4671880'>we</span> <span m='4671970'>just</span>
  <span m='4672090'>have</span> <span m='4672210'>to</span> <span m='4672300'>do</span>
  <span m='4672420'>two</span> <span m='4672660'>queries</span> <span m='4673020'>instead</span>
  <span m='4673290'>of</span> <span m='4673350'>one.</span> <span m='4673560'>We</span>
  <span m='4673620'>don't</span> <span m='4673800'>there's</span> <span m='4673950'>a</span>
  <span m='4674010'>log</span> <span m='4674190'>factor.</span> <span m='4676908'>That's</span>
  <span m='4677310'>the</span> <span m='4677700'>trick</span> <span m='4677940'>we</span>
  <span m='4678000'>did</span> <span m='4678120'>before</span> <span m='4680090'>OK,</span>
  <span m='4680970'>that</span> <span m='4681320'>was</span> <span m='4681450'>easy.</span>
  <span m='4685510'>One</span> <span m='4685690'>more.</span> <span m='4688140'>So
  that</span> <span m='4688290'>was</span> <span m='4688500'>three</span> <span m='4688800'>sided.</span>
  <span m='4693580'>Next</span> <span m='4694000'>is</span> <span m='4694330'>four
  sided.</span> </p><p><span m='4700850'>Four sided,</span> <span m='4701240'>of</span>
  <span m='4701390'>course,</span> <span m='4701730'>we</span> <span m='4701750'>could</span>
  <span m='4701870'>do</span> <span m='4702020'>exactly</span> <span m='4702500'>the</span>
  <span m='4702590'>same</span> <span m='4702860'>thing.</span> <span m='4703520'>Lose</span>
  <span m='4703760'>another</span> <span m='4704060'>log</span> <span m='4704330'>factor</span>
  <span m='4704660'>in</span> <span m='4704750'>space.</span> <span m='4709040'>Maintain</span>
  <span m='4709790'>log</span> <span m='4710030'>base</span> <span m='4710230'>B</span>
  <span m='4710420'>of N</span> <span m='4710750'>plus</span> <span m='4711140'>output</span>
  <span m='4711320'>over</span> <span m='4711530'>B</span> <span m='4712040'>query</span>
  <span m='4712280'>time.</span> <span m='4713300'>But</span> <span m='4714170'>I</span>
  <span m='4714290'>want</span> <span m='4714470'>to</span> <span m='4714530'>do</span>
  <span m='4714650'>slightly</span> <span m='4715160'>better</span> <span m='4715840'>and</span>
  <span m='4715960'>this</span> <span m='4716120'>is</span> <span m='4716240'>a</span>
  <span m='4716300'>trick</span> <span m='4716570'>we</span> <span m='4716660'>could</span>
  <span m='4716840'>have</span> <span m='4716930'>done</span> <span m='4717440'>in</span>
  <span m='4717650'>internal</span> <span m='4718010'>memory</span> <span m='4718310'>as</span>
  <span m='4718400'>well.</span> <span m='4719150'>But</span> <span m='4719960'>I</span>
  <span m='4720050'>have</span> <span m='4721130'>two</span> <span m='4721340'>minutes</span>
  <span m='4721640'>to</span> <span m='4721730'>show</span> <span m='4721880'>it</span>
  <span m='4721940'>to</span> <span m='4722090'>you.</span> <span m='4722270'>So</span>
  <span m='4722600'>here's</span> <span m='4723620'>a</span> <span m='4724060'>bonus.</span>
  </p><p><span m='4726980'>Didn't</span> <span m='4727190'>have</span> <span m='4727370'>to</span>
  <span m='4727420'>do</span> <span m='4727470'>this</span> <span m='4727640'>in</span>
  <span m='4727700'>external</span> <span m='4728540'>memory</span> <span m='4728810'>context,</span>
  <span m='4729230'>but</span> <span m='4729410'>we</span> <span m='4729530'>can.</span>
  <span m='4732500'>Four sided.</span> <span m='4734690'>So</span> <span m='4735530'>we're</span>
  <span m='4735660'>going</span> <span m='4735780'>to</span> <span m='4735890'>do</span>
  <span m='4736040'>the</span> <span m='4736160'>same</span> <span m='4736490'>thing,</span>
  <span m='4737600'>but</span> <span m='4737780'>not</span> <span m='4738200'>on</span>
  <span m='4738320'>a</span> <span m='4738380'>binary</span> <span m='4738890'>tree.</span>
  <span m='4740150'>Take</span> <span m='4740390'>this</span> <span m='4740570'>binary</span>
  <span m='4740990'>tree,</span> <span m='4741370'>this</span> <span m='4741590'>is</span>
  <span m='4742310'>sorted</span> <span m='4742700'>by</span> <span m='4742880'>x,</span>
  <span m='4743270'>I</span> <span m='4743330'>suppose.</span> <span m='4745120'>This
  is</span> <span m='4745530'>key</span> <span m='4745785'>on</span> <span m='4746410'>x.</span>
  <span m='4749540'>Instead</span> <span m='4749810'>of</span> <span m='4749900'>making</span>
  <span m='4750170'>it</span> <span m='4750200'>binary,</span> <span m='4751550'>make</span>
  <span m='4751820'>it</span> <span m='4752780'>root</span> <span m='4753110'>log</span>
  <span m='4753560'>[? N ary. ?]</span> </p><p><span m='4756200'>So</span> <span m='4756560'>imagine</span>
  <span m='4756950'>taking</span> <span m='4757250'>the</span> <span m='4757340'>binary</span>
  <span m='4757700'>tree,</span> <span m='4758300'>taking</span> <span m='4758600'>little</span>
  <span m='4759170'>chunks,</span> <span m='4760430'>which</span> <span m='4760670'>have</span>
  <span m='4760850'>size</span> <span m='4761180'>square</span> <span m='4761600'>root</span>
  <span m='4761810'>log</span> <span m='4762130'>N.</span> <span m='4763900'>Its</span>
  <span m='4764300'>capital</span> <span m='4764770'>N.</span> <span m='4766130'>And</span>
  <span m='4766250'>imagine</span> <span m='4766730'>contracting</span> <span m='4767630'>those</span>
  <span m='4767870'>chunks</span> <span m='4768260'>into</span> <span m='4768560'>single</span>
  <span m='4768890'>nodes.</span> <span m='4769220'>So we</span> <span m='4769310'>have</span>
  <span m='4769490'>a</span> <span m='4769520'>single</span> <span m='4769850'>note</span>
  <span m='4770690'>which</span> <span m='4770900'>has</span> <span m='4771680'>square</span>
  <span m='4772070'>root</span> <span m='4772280'>log</span> <span m='4772610'>N.</span>
  <span m='4774650'>Children</span> <span m='4775130'>[INAUDIBLE]</span> <span m='4775590'>has</span>
  <span m='4775820'>square</span> <span m='4776060'>root</span> <span m='4776650'>log
  N</span> <span m='4777050'>children.</span> <span m='4778290'>This</span> <span
  m='4778430'>is</span> <span m='4778550'>all</span> <span m='4778700'>static.</span>
  <span m='4781470'>And</span> <span m='4781570'>so</span> <span m='4781640'>on.</span>
  </p><p><span m='4782190'>Otherwise,</span> <span m='4782780'>the</span> <span m='4782930'>same.</span>
  <span m='4785060'>The</span> <span m='4785310'>augmentation</span> <span m='4785605'>is</span>
  <span m='4785900'>going</span> <span m='4786040'>to</span> <span m='4786110'>be</span>
  <span m='4786200'>a</span> <span m='4786230'>little</span> <span m='4786440'>bit</span>
  <span m='4786530'>different.</span> <span m='4787890'>If</span> <span m='4787940'>we</span>
  <span m='4788030'>look</span> <span m='4788210'>at</span> <span m='4788270'>a</span>
  <span m='4788330'>node,</span> <span m='4789980'>we're</span> <span m='4790250'>going</span>
  <span m='4790490'>to</span> <span m='4790610'>store</span> <span m='4791540'>the</span>
  <span m='4791810'>same</span> <span m='4792110'>things</span> <span m='4792320'>we</span>
  <span m='4792410'>had</span> <span m='4792530'>before,</span> <span m='4792950'>which</span>
  <span m='4793160'>was</span> <span m='4793790'>this</span> <span m='4793970'>kind</span>
  <span m='4794210'>of</span> <span m='4794300'>query,</span> <span m='4795320'>and</span>
  <span m='4795640'>this</span> <span m='4795830'>kind</span> <span m='4796040'>of</span>
  <span m='4796130'>query.</span> <span m='4797270'>We're</span> <span m='4797330'>going</span>
  <span m='4797450'>to</span> <span m='4797510'>store</span> <span m='4797840'>a</span>
  <span m='4797870'>little</span> <span m='4798110'>bit</span> <span m='4798290'>more.</span>
  </p><p><span m='4800120'>Namely,</span> <span m='4801440'>for</span> <span m='4801680'>any</span>
  <span m='4802070'>interval</span> <span m='4802670'>of</span> <span m='4802790'>children,</span>
  <span m='4804230'>like</span> <span m='4804530'>here</span> <span m='4805130'>you</span>
  <span m='4805190'>have</span> <span m='4805310'>some</span> <span m='4805520'>start</span>
  <span m='4805820'>child</span> <span m='4806240'>and</span> <span m='4806330'>some</span>
  <span m='4806510'>end</span> <span m='4806720'>child.</span> <span m='4808010'>I</span>
  <span m='4808130'>want</span> <span m='4808280'>to</span> <span m='4808370'>store</span>
  <span m='4809150'>for</span> <span m='4809360'>all</span> <span m='4809630'>the</span>
  <span m='4809720'>points</span> <span m='4810050'>that</span> <span m='4810170'>are</span>
  <span m='4810260'>down</span> <span m='4810530'>there.</span> <span m='4812060'>For</span>
  <span m='4812270'>this</span> <span m='4812510'>thing,</span> <span m='4813200'>store</span>
  <span m='4813560'>a</span> <span m='4813680'>regular</span> <span m='4814430'>binary</span>
  <span m='4814820'>search</span> <span m='4815150'>tree</span> <span m='4816290'>on</span>
  <span m='4816860'>y</span> <span m='4818210'>for</span> <span m='4818390'>those</span>
  <span m='4818690'>points.</span> <span m='4820650'>Why?</span> <span m='4821510'>Because</span>
  <span m='4822500'>if</span> <span m='4822590'>we</span> <span m='4822680'>do</span>
  <span m='4822800'>a</span> <span m='4822860'>search--</span> <span m='4824090'>OK,</span>
  <span m='4824270'>same</span> <span m='4824600'>deal--</span> <span m='4825770'>we</span>
  <span m='4825950'>find</span> <span m='4826250'>the</span> <span m='4826430'>LCA</span>
  <span m='4828540'>of</span> <span m='4828770'>x1,</span> <span m='4830430'>x1?</span>
  <span m='4832610'>I</span> <span m='4832640'>don't</span> <span m='4832790'>know.</span>
  <span m='4833920'>Let's</span> <span m='4834080'>say</span> <span m='4834230'>it's</span>
  <span m='4834350'>on</span> <span m='4834510'>x.</span> </p><p><span m='4835760'>We'll</span>
  <span m='4835940'>have</span> <span m='4836090'>to do it</span> <span m='4836150'>again</span>
  <span m='4836390'>on</span> <span m='4837350'>y</span> <span m='4837380'>whatever.</span>
  <span m='4839940'>So</span> <span m='4840560'>here's</span> <span m='4840830'>the</span>
  <span m='4840950'>LCA.</span> <span m='4841820'>Let's</span> <span m='4842210'>say</span>
  <span m='4842450'>there's a</span> <span m='4842540'>lot</span> <span m='4842690'>of</span>
  <span m='4842750'>children.</span> <span m='4843730'>OK,</span> <span m='4844100'>maybe</span>
  <span m='4845270'>here</span> <span m='4846500'>is</span> <span m='4846950'>x1</span>
  <span m='4848240'>and</span> <span m='4848510'>here</span> <span m='4849740'>is</span>
  <span m='4849950'>x2.</span> <span m='4852410'>So</span> <span m='4852860'>in</span>
  <span m='4853040'>this</span> <span m='4853360'>subtree,</span> <span m='4854570'>we</span>
  <span m='4854720'>do</span> <span m='4855590'>this--</span> <span m='4856490'>sorry,</span>
  <span m='4856760'>we</span> <span m='4856880'>do</span> <span m='4857360'>this</span>
  <span m='4857840'>range</span> <span m='4858170'>query</span> <span m='4860120'>because</span>
  <span m='4860690'>we</span> <span m='4860810'>want</span> <span m='4860960'>to</span>
  <span m='4861020'>go</span> <span m='4861110'>from</span> <span m='4861260'>x1</span>
  <span m='4861740'>to</span> <span m='4861920'>infinity.</span> </p><p><span m='4863330'>Over</span>
  <span m='4863660'>in</span> <span m='4863780'>this</span> <span m='4863990'>subtree,</span>
  <span m='4864920'>we</span> <span m='4865070'>want</span> <span m='4865250'>to</span>
  <span m='4865340'>do</span> <span m='4866450'>this</span> <span m='4866750'>range</span>
  <span m='4867050'>query</span> <span m='4867440'>because</span> <span m='4867650'>we</span>
  <span m='4867770'>want</span> <span m='4867920'>to</span> <span m='4867980'>go</span>
  <span m='4868100'>from</span> <span m='4869240'>negative</span> <span m='4869510'>infinity</span>
  <span m='4869930'>to</span> <span m='4870540'>x2.</span> <span m='4871430'>But</span>
  <span m='4871580'>then</span> <span m='4871730'>there's</span> <span m='4871880'>all</span>
  <span m='4872090'>this</span> <span m='4872270'>stuff</span> <span m='4872540'>in</span>
  <span m='4872660'>the</span> <span m='4872750'>middle.</span> <span m='4873620'>I</span>
  <span m='4873770'>don't</span> <span m='4873950'>want</span> <span m='4874070'>to</span>
  <span m='4874160'>have</span> <span m='4874310'>to</span> <span m='4874400'>do</span>
  <span m='4874520'>a</span> <span m='4874550'>query</span> <span m='4874790'>for</span>
  <span m='4874940'>every</span> <span m='4875240'>single</span> <span m='4875840'>tree.</span>
  <span m='4877310'>Instead,</span> <span m='4878060'>I</span> <span m='4878210'>have</span>
  <span m='4878510'>this</span> <span m='4878780'>augmentation</span> <span m='4879350'>that</span>
  <span m='4879410'>says</span> <span m='4879590'>for</span> <span m='4879740'>this</span>
  <span m='4879920'>interval,</span> <span m='4880550'>here</span> <span m='4880850'>are
  all</span> <span m='4881150'>the</span> <span m='4881300'>points</span> <span m='4882260'>sorted</span>
  <span m='4882740'>by</span> <span m='4884390'>x-coordinate.</span> <span m='4884870'>I
  guess</span> <span m='4885663'>we're</span> <span m='4886370'>doing</span> <span
  m='4886580'>it</span> <span m='4886670'>this</span> <span m='4886850'>way.</span>
  </p><p><span m='4890090'>Fine,</span> <span m='4890540'>so</span> <span m='4890750'>then</span>
  <span m='4891020'>it</span> <span m='4891200'>is</span> <span m='4891380'>a</span>
  <span m='4892040'>range</span> <span m='4892430'>query.</span> <span m='4893780'>I
  want</span> <span m='4893990'>to</span> <span m='4894050'>know</span> <span m='4894710'>what</span>
  <span m='4894980'>are</span> <span m='4895070'>all</span> <span m='4895250'>the</span>
  <span m='4895340'>points.</span> <span m='4897170'>Whoa,</span> <span m='4897320'>this
  is</span> <span m='4897440'>confusing.</span> <span m='4899390'>I feel like</span>
  <span m='4899560'>I've</span> <span m='4899690'>missed</span> <span m='4899870'>something</span>
  <span m='4900230'>here.</span> <span m='4901190'>No,</span> <span m='4901310'>this</span>
  <span m='4901490'>on</span> <span m='4901700'>y.</span> <span m='4902170'>Sorry.</span>
  <span m='4905360'>These</span> <span m='4905660'>points</span> <span m='4905990'>I've</span>
  <span m='4906110'>got</span> <span m='4906290'>sorted</span> <span m='4906680'>by</span>
  <span m='4906920'>y.</span> <span m='4907460'>So</span> <span m='4907700'>I</span>
  <span m='4907790'>should</span> <span m='4908000'>draw</span> <span m='4908240'>it</span>
  <span m='4908300'>the</span> <span m='4908450'>other</span> <span m='4908660'>way.</span>
  <span m='4910250'>These</span> <span m='4910460'>points</span> <span m='4910790'>we</span>
  <span m='4910970'>already</span> <span m='4911450'>know</span> <span m='4911810'>are</span>
  <span m='4911980'>in-between</span> <span m='4912560'>x1</span> <span m='4912890'>and</span>
  <span m='4912980'>x2</span> <span m='4913370'>in</span> <span m='4913520'>x.</span>
  <span m='4914240'>We've</span> <span m='4914390'>already</span> <span m='4914660'>solved</span>
  <span m='4915020'>the</span> <span m='4915290'>x problem</span> <span m='4915620'>here.</span>
  </p><p><span m='4916320'>So</span> <span m='4916370'>now</span> <span m='4916610'>I</span>
  <span m='4916700'>just</span> <span m='4916940'>need</span> <span m='4917120'>to</span>
  <span m='4917240'>restrict</span> <span m='4918500'>to</span> <span m='4919040'>the</span>
  <span m='4919190'>y</span> <span m='4919520'>range</span> <span m='4919940'>from</span>
  <span m='4920180'>y1</span> <span m='4921200'>to</span> <span m='4921350'>y2.</span>
  <span m='4923510'>In</span> <span m='4924080'>these</span> <span m='4924620'>trees,</span>
  <span m='4925220'>these</span> <span m='4925430'>already</span> <span m='4925730'>match</span>
  <span m='4926000'>in</span> <span m='4926090'>x.</span> <span m='4926330'>I</span>
  <span m='4926420'>just</span> <span m='4926540'>need</span> <span m='4926690'>to</span>
  <span m='4926750'>make</span> <span m='4926870'>sure</span> <span m='4926990'>they</span>
  <span m='4927110'>match</span> <span m='4927440'>in</span> <span m='4927590'>y.</span>
  <span m='4928610'>So</span> <span m='4928790'>I</span> <span m='4928880'>do</span>
  <span m='4929090'>a</span> <span m='4929150'>regular</span> <span m='4929660'>1D</span>
  <span m='4930240'>range</span> <span m='4930500'>tree.</span> <span m='4930910'>I</span>
  <span m='4931010'>search</span> <span m='4931250'>for</span> <span m='4931370'>y1,</span>
  <span m='4931890'>I search</span> <span m='4931970'>for</span> <span m='4932100'>y2,</span>
  <span m='4932570'>take</span> <span m='4932810'>all</span> <span m='4932930'>the</span>
  <span m='4933020'>points</span> <span m='4933290'>in</span> <span m='4933380'>between.</span>
  <span m='4934490'>This</span> <span m='4934730'>is</span> <span m='4934850'>cheap</span>
  <span m='4936050'>if</span> <span m='4936230'>I</span> <span m='4936290'>just</span>
  <span m='4936470'>have</span> <span m='4936620'>a</span> <span m='4936680'>regular</span>
  <span m='4937160'>old</span> <span m='4937370'>binary</span> <span m='4937700'>search</span>
  <span m='4937970'>tree.</span> </p><p><span m='4938510'>Now,</span> <span m='4938660'>this</span>
  <span m='4938960'>thing</span> <span m='4939740'>has</span> <span m='4939950'>linear</span>
  <span m='4940340'>size.</span> <span m='4942380'>This</span> <span m='4942650'>thing</span>
  <span m='4943460'>has--</span> <span m='4945410'>sorry,</span> <span m='4946490'>I</span>
  <span m='4946550'>think</span> <span m='4946730'>I</span> <span m='4946820'>actually</span>
  <span m='4947210'>need--</span> <span m='4949340'>I</span> <span m='4949430'>should</span>
  <span m='4949580'>have</span> <span m='4949730'>a</span> <span m='4949790'>three</span>
  <span m='4950030'>sided</span> <span m='4950360'>range</span> <span m='4950600'>query.</span>
  <span m='4951440'>Thanks.</span> <span m='4953780'>These</span> <span m='4953930'>should</span>
  <span m='4954140'>be</span> <span m='4954260'>three</span> <span m='4954530'>sided</span>
  <span m='4956480'>because</span> <span m='4956720'>here</span> <span m='4956960'>I</span>
  <span m='4957080'>know</span> <span m='4957350'>that</span> <span m='4958160'>I've</span>
  <span m='4958280'>got</span> <span m='4958490'>the</span> <span m='4958700'>right</span>
  <span m='4959000'>side</span> <span m='4959300'>covered</span> <span m='4959720'>already</span>
  <span m='4960140'>in</span> <span m='4960290'>this</span> <span m='4960470'>tree,</span>
  <span m='4960770'>I've</span> <span m='4960830'>got</span> <span m='4960980'>the</span>
  <span m='4961070'>left</span> <span m='4961310'>side</span> <span m='4961520'>covered</span>
  <span m='4961850'>already</span> <span m='4962210'>in</span> <span m='4962330'>this</span>
  <span m='4962540'>tree,</span> <span m='4963140'>but</span> <span m='4963290'>I</span>
  <span m='4963350'>still</span> <span m='4963560'>need</span> <span m='4963740'>the</span>
  <span m='4963860'>remaining</span> <span m='4964340'>three</span> <span m='4964550'>sides.</span>
  </p><p><span m='4964970'>In</span> <span m='4965120'>here,</span> <span m='4965510'>I</span>
  <span m='4965630'>only</span> <span m='4965840'>need</span> <span m='4966020'>these</span>
  <span m='4966290'>two</span> <span m='4966500'>sides</span> <span m='4966980'>because</span>
  <span m='4967160'>I've</span> <span m='4967280'>already</span> <span m='4967460'>got</span>
  <span m='4967610'>x1</span> <span m='4968330'>and</span> <span m='4968420'>x2</span>
  <span m='4968750'>covered.</span> <span m='4970050'>OK,</span> <span m='4970190'>so</span>
  <span m='4970340'>this</span> <span m='4970610'>is</span> <span m='4970760'>cheap.</span>
  <span m='4971600'>I</span> <span m='4971660'>only</span> <span m='4971840'>need</span>
  <span m='4971980'>a</span> <span m='4972050'>linear</span> <span m='4972350'>space</span>
  <span m='4972650'>data</span> <span m='4972860'>structure.</span> <span m='4973220'>This</span>
  <span m='4973430'>thing</span> <span m='4973760'>is</span> <span m='4973910'>not</span>
  <span m='4974090'>so</span> <span m='4974210'>cheap.</span> <span m='4974570'>I'm</span>
  <span m='4974720'>using</span> <span m='4975080'>the</span> <span m='4975170'>previous</span>
  <span m='4975560'>data</span> <span m='4975800'>structure.</span> <span m='4976940'>This</span>
  <span m='4977120'>thing,</span> <span m='4977660'>which</span> <span m='4977780'>has</span>
  <span m='4977960'>N</span> <span m='4978140'>log</span> <span m='4978350'>N</span>
  <span m='4978500'>size,</span> <span m='4978950'>these</span> <span m='4979190'>are</span>
  <span m='4979310'>three</span> <span m='4979580'>sided</span> <span m='4979970'>range</span>
  <span m='4980240'>queries.</span> <span m='4981330'>Sorry</span> <span m='4981980'>for</span>
  <span m='4982340'>drawing</span> <span m='4982610'>it</span> <span m='4982700'>wrong.</span>
  </p><p><span m='4985550'>So</span> <span m='4986240'>I</span> <span m='4986330'>need</span>
  <span m='4986510'>two</span> <span m='4987140'>three</span> <span m='4987350'>sided</span>
  <span m='4987680'>structures.</span> <span m='4988760'>Then</span> <span m='4988940'>I</span>
  <span m='4989000'>need</span> <span m='4989210'>actually</span> <span m='4989510'>a</span>
  <span m='4989570'>whole</span> <span m='4989900'>bunch</span> <span m='4990290'>of</span>
  <span m='4990410'>these</span> <span m='4990590'>structures</span> <span m='4991070'>because</span>
  <span m='4991970'>this</span> <span m='4992170'>was</span> <span m='4992270'>for</span>
  <span m='4992420'>every</span> <span m='4992720'>interval.</span> <span m='4993440'>But</span>
  <span m='4993590'>conveniently,</span> <span m='4994130'>they're</span> <span m='4994280'>only</span>
  <span m='4994520'>log</span> <span m='4994910'>N</span> <span m='4995060'>intervals</span>
  <span m='4995660'>because</span> <span m='4995840'>there's</span> <span m='4996010'>root</span>
  <span m='4996230'>log</span> <span m='4996470'>N</span> <span m='4996620'>children.</span>
  <span m='4997500'>So</span> <span m='4997570'>root log</span> <span m='4997910'>N</span>
  <span m='4998060'>squared</span> <span m='4998540'>is</span> <span m='4998750'>log
  N.</span> <span m='4999860'>So</span> <span m='5000070'>there's</span> <span m='5000390'>root</span>
  <span m='5000730'>N,</span> <span m='5001410'>but</span> <span m='5001570'>then</span>
  <span m='5001750'>we</span> <span m='5001840'>need</span> <span m='5002560'>log</span>
  <span m='5003040'>N</span> <span m='5003160'>of them.</span> <span m='5004460'>And</span>
  <span m='5004480'>so</span> <span m='5004660'>that's</span> <span m='5004990'>why</span>
  <span m='5005290'>these</span> <span m='5005470'>things</span> <span m='5005650'>balance</span>
  <span m='5006040'>out.</span> <span m='5007260'>See?</span> </p><p><span m='5008820'>So</span>
  <span m='5009570'>normally,</span> <span m='5010320'>this</span> <span m='5010500'>would</span>
  <span m='5010590'>be</span> <span m='5011060'>N log</span> <span m='5011880'>squared</span>
  <span m='5012420'>N</span> <span m='5013800'>because</span> <span m='5014190'>every</span>
  <span m='5014430'>point</span> <span m='5014790'>would</span> <span m='5014910'>appear</span>
  <span m='5015300'>in</span> <span m='5015420'>log</span> <span m='5015720'>N</span>
  <span m='5016200'>trees.</span> <span m='5017040'>But now</span> <span m='5017370'>the</span>
  <span m='5017460'>height</span> <span m='5017790'>of</span> <span m='5017910'>my</span>
  <span m='5018060'>tree</span> <span m='5018930'>is</span> <span m='5019170'>merely</span>
  <span m='5020220'>log</span> <span m='5020670'>N</span> <span m='5021510'>over</span>
  <span m='5021780'>log</span> <span m='5022050'>log</span> <span m='5022260'>N</span>
  <span m='5022920'>with</span> <span m='5023190'>a</span> <span m='5024240'>factor</span>
  <span m='5024550'>2</span> <span m='5024870'>out</span> <span m='5025020'>here</span>
  <span m='5025380'>because</span> <span m='5025740'>I</span> <span m='5025800'>have</span>
  <span m='5025980'>a</span> <span m='5026100'>square</span> <span m='5026430'>root</span>
  <span m='5026700'>here.</span> </p><p><span m='5029170'>OK,</span> <span m='5029670'>so</span>
  <span m='5030060'>the</span> <span m='5030330'>tree</span> <span m='5030510'>has</span>
  <span m='5030720'>height</span> <span m='5030930'>log</span> <span m='5031170'>N</span>
  <span m='5031240'>over</span> <span m='5031340'>log</span> <span m='5031460'>log
  N.</span> <span m='5031950'>So</span> <span m='5032100'>each</span> <span m='5032310'>point</span>
  <span m='5032580'>only</span> <span m='5032850'>appears</span> <span m='5033150'>in</span>
  <span m='5033240'>log</span> <span m='5033480'>N</span> <span m='5033600'>over</span>
  <span m='5033810'>log</span> <span m='5034020'>log</span> <span m='5034230'>N</span>
  <span m='5034770'>structures.</span> <span m='5035760'>Each</span> <span m='5035970'>of</span>
  <span m='5036030'>them</span> <span m='5036390'>needs</span> <span m='5036690'>a</span>
  <span m='5036750'>structure</span> <span m='5037170'>size</span> <span m='5037440'>N</span>
  <span m='5037620'>log</span> <span m='5037830'>N.</span> <span m='5038580'>So</span>
  <span m='5039210'>we</span> <span m='5039390'>end</span> <span m='5039600'>up</span>
  <span m='5039840'>with</span> <span m='5040290'>N</span> <span m='5040490'>log</span>
  <span m='5040890'>squared</span> <span m='5041130'>N</span> <span m='5041640'>over</span>
  <span m='5041850'>log</span> <span m='5042150'>log</span> <span m='5042390'>N</span>
  <span m='5042570'>space.</span> </p><p><span m='5043470'>Kind</span> <span m='5043620'>of</span>
  <span m='5043710'>crazy,</span> <span m='5044520'>but</span> <span m='5044610'>this</span>
  <span m='5044790'>is</span> <span m='5044910'>how</span> <span m='5045030'>you</span>
  <span m='5045150'>get</span> <span m='5045300'>that</span> <span m='5045480'>last</span>
  <span m='5045900'>little</span> <span m='5046200'>bit</span> <span m='5046380'>of</span>
  <span m='5046500'>log</span> <span m='5046770'>log</span> <span m='5046980'>N</span>
  <span m='5047100'>space</span> <span m='5047430'>improvement</span> <span m='5047850'>by</span>
  <span m='5048030'>contracting</span> <span m='5048540'>nodes,</span> <span m='5049440'>doing</span>
  <span m='5049650'>a</span> <span m='5049710'>simpler</span> <span m='5050160'>data</span>
  <span m='5050400'>structure</span> <span m='5052500'>for</span> <span m='5052800'>these</span>
  <span m='5053460'>middle</span> <span m='5053760'>children,</span> <span m='5054780'>and</span>
  <span m='5054930'>just</span> <span m='5055200'>focusing</span> <span m='5055740'>on--</span>
  <span m='5056290'>The</span> <span m='5056610'>left</span> <span m='5056820'>child</span>
  <span m='5057090'>and</span> <span m='5057150'>the</span> <span m='5057210'>right</span>
  <span m='5057360'>child</span> <span m='5057760'>you</span> <span m='5057860'>have</span>
  <span m='5057960'>to</span> <span m='5058060'>do</span> <span m='5058260'>one</span>
  <span m='5059100'>three</span> <span m='5059280'>sided</span> <span m='5059550'>call,</span>
  <span m='5060190'>but</span> <span m='5060300'>then</span> <span m='5060450'>the</span>
  <span m='5060510'>middle</span> <span m='5060780'>is</span> <span m='5060930'>a</span>
  <span m='5060990'>very</span> <span m='5061230'>simple</span> <span m='5061560'>two</span>
  <span m='5061710'>sided</span> <span m='5062010'>call.</span> <span m='5062140'>It's</span>
  <span m='5062280'>just</span> <span m='5062460'>a</span> <span m='5062520'>1D</span>
  <span m='5062880'>structure</span> <span m='5064030'>and</span> <span m='5064140'>so</span>
  <span m='5064290'>it's</span> <span m='5064410'>really</span> <span m='5064620'>cheap.</span>
  <span m='5066960'>That's</span> <span m='5067140'>it.</span> </p>
type: course
uid: 9903f5d93cb683be10f5349809d8827c

---
None